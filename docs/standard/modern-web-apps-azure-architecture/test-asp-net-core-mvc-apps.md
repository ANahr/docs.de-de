---
title: Testen von ASP.NET Core MVC-Apps
description: Innovative Webanwendungen mit ASP.NET Core und Azure Architekt | Testen von ASP.NET Core MVC-Apps
author: ardalis
ms.author: wiwagn
ms.date: 10/08/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.openlocfilehash: 4611ffa8334e124946e849306d3281b695830eb1
ms.sourcegitcommit: bbde43da655ae7bea1977f7af7345eb87bd7fd5f
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 10/21/2017
---
# <a name="test-aspnet-core-mvc-apps"></a><span data-ttu-id="82209-103">Testen von ASP.NET Core MVC-Apps</span><span class="sxs-lookup"><span data-stu-id="82209-103">Test ASP.NET Core MVC Apps</span></span>

> <span data-ttu-id="82209-104">_"Wenn Sie Komponententests für das Produkt nicht mögen, wird nicht sehr wahrscheinlich Ihre Kunden möchten, entweder testen."_</span><span class="sxs-lookup"><span data-stu-id="82209-104">_"If you don't like unit testing your product, most likely your customers won't like to test it, either."_</span></span>
> <span data-ttu-id="82209-105">_ - Anonyme -</span><span class="sxs-lookup"><span data-stu-id="82209-105">_- Anonymous-</span></span>

## <a name="summary"></a><span data-ttu-id="82209-106">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="82209-106">Summary</span></span>

<span data-ttu-id="82209-107">Software von beliebiger Komplexität kann auf unerwartete Weise als Reaktion auf Änderungen fehlschlagen.</span><span class="sxs-lookup"><span data-stu-id="82209-107">Software of any complexity can fail in unexpected ways in response to changes.</span></span> <span data-ttu-id="82209-108">Daher ist die Tests nach Änderungen für alle Spalten mit Ausnahme der unbedeutendsten (oder am wenigsten wichtigen) Anwendungen erforderlich.</span><span class="sxs-lookup"><span data-stu-id="82209-108">Thus, testing after making changes is required for all but the most trivial (or least critical) applications.</span></span> <span data-ttu-id="82209-109">Manuelle Tests ist der langsamste, mindestens zuverlässige Weise über die teuersten zum Testen von Software.</span><span class="sxs-lookup"><span data-stu-id="82209-109">Manual testing is the slowest, least reliable, most expensive way to test software.</span></span> <span data-ttu-id="82209-110">Wenn Anwendungen nicht getestet werden können konzipiert wurden, kann es leider die einzige Möglichkeit, die verfügbar sein.</span><span class="sxs-lookup"><span data-stu-id="82209-110">Unfortunately, if applications are not designed to be testable, it can be the only means available.</span></span> <span data-ttu-id="82209-111">Architekturprinzipien angeordnet, Folgendes in Kapitel X geschriebene Anwendungen sollten Einheit getestet werden können, und ASP.NET Core Anwendungen automatisierte Integration und Funktionstests ebenfalls unterstützt.</span><span class="sxs-lookup"><span data-stu-id="82209-111">Applications written following the architectural principles laid out in chapter X should be unit testable, and ASP.NET Core applications support automated integration and functional testing as well.</span></span>

## <a name="kinds-of-automated-tests"></a><span data-ttu-id="82209-112">Arten von automatisierten Tests</span><span class="sxs-lookup"><span data-stu-id="82209-112">Kinds of Automated Tests</span></span>

<span data-ttu-id="82209-113">Es gibt viele Arten von automatisierten Tests für softwareanwendungen.</span><span class="sxs-lookup"><span data-stu-id="82209-113">There are many kinds of automated tests for software applications.</span></span> <span data-ttu-id="82209-114">Die einfachste niedrigste Ebene Test hat den Komponententest.</span><span class="sxs-lookup"><span data-stu-id="82209-114">The simplest, lowest level test is the unit test.</span></span> <span data-ttu-id="82209-115">Auf einer etwas höheren Ebene sind bei der Integration und funktionale Tests vorhanden.</span><span class="sxs-lookup"><span data-stu-id="82209-115">At a slightly higher level there are integration tests and functional tests.</span></span> <span data-ttu-id="82209-116">Andere Arten von Tests, z. B. UI-Tests, Auslastungstests, Belastungstests und Feuerprobe durch sind nicht Gegenstand dieses Dokuments.</span><span class="sxs-lookup"><span data-stu-id="82209-116">Other kinds of tests, like UI tests, load tests, stress tests, and smoke tests, are beyond the scope of this document.</span></span>

### <a name="unit-tests"></a><span data-ttu-id="82209-117">Komponententests</span><span class="sxs-lookup"><span data-stu-id="82209-117">Unit Tests</span></span>

<span data-ttu-id="82209-118">Ein Komponententest testet ein einzelnes Teil der Logik Ihrer Anwendung.</span><span class="sxs-lookup"><span data-stu-id="82209-118">A unit test tests a single part of your application's logic.</span></span> <span data-ttu-id="82209-119">Eine kann weitere beschreiben sie durch einige der Aufgaben, die dies nicht der Fall auflisten.</span><span class="sxs-lookup"><span data-stu-id="82209-119">One can further describe it by listing some of the things that it isn't.</span></span> <span data-ttu-id="82209-120">Ein Komponententest Testen nicht, wie der Code funktioniert mit Abhängigkeiten oder Infrastruktur – welche Integrationstests sind.</span><span class="sxs-lookup"><span data-stu-id="82209-120">A unit test doesn't test how your code works with dependencies or infrastructure – that's what integration tests are for.</span></span> <span data-ttu-id="82209-121">Ein Komponententest nicht die Framework-Code geschrieben wird, auf Testen – Sie davon ausgehen er funktioniert oder, wenn Sie es finden nicht, einen Fehler, und code dieses Problem zu umgehen.</span><span class="sxs-lookup"><span data-stu-id="82209-121">A unit test doesn't test the framework your code is written on – you should assume it works or, if you find it doesn't, file a bug and code a workaround.</span></span> <span data-ttu-id="82209-122">Ein Komponententest wird vollständig im Arbeitsspeicher und im Prozess ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="82209-122">A unit test runs completely in memory and in process.</span></span> <span data-ttu-id="82209-123">Es ist nicht mit dem Dateisystem, das Netzwerk oder eine Datenbank kommunizieren.</span><span class="sxs-lookup"><span data-stu-id="82209-123">It doesn't communicate with the file system, the network, or a database.</span></span> <span data-ttu-id="82209-124">Komponententests sollte nur den Code zu testen.</span><span class="sxs-lookup"><span data-stu-id="82209-124">Unit tests should only test your code.</span></span>

<span data-ttu-id="82209-125">Komponententests, die aufgrund der Tatsache, dass sie nur eine einzelne Einheit des Codes, ohne externe Abhängigkeiten testen sollte äußerst schnell ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="82209-125">Unit tests, by virtue of the fact that they test only a single unit of your code, with no external dependencies, should execute extremely quickly.</span></span> <span data-ttu-id="82209-126">Daher sollten Sie von Testsammlungen aus Hunderten von Komponententests in wenigen Sekunden ausführen können.</span><span class="sxs-lookup"><span data-stu-id="82209-126">Thus, you should be able to run test suites of hundreds of unit tests in a few seconds.</span></span> <span data-ttu-id="82209-127">Führen Sie sie häufig, idealerweise vor jeder Push eine freigegebene Quellcodeverwaltungs-Repository und sicherlich mit jedem Build automatisierte auf dem Buildserver.</span><span class="sxs-lookup"><span data-stu-id="82209-127">Run them frequently, ideally before every push to a shared source control repository, and certainly with every automated build on your build server.</span></span>

### <a name="integration-tests"></a><span data-ttu-id="82209-128">Integrationstests</span><span class="sxs-lookup"><span data-stu-id="82209-128">Integration Tests</span></span>

<span data-ttu-id="82209-129">Zwar eine gute Idee, Code zu kapseln, der Interaktion mit Infrastrukturkomponenten, wie Datenbanken und Dateisysteme, noch müssen Teil des Codes, und Sie sollten es zu testen.</span><span class="sxs-lookup"><span data-stu-id="82209-129">Although it's a good idea to encapsulate your code that interacts with infrastructure like databases and file systems, you will still have some of that code, and you will probably want to test it.</span></span> <span data-ttu-id="82209-130">Darüber hinaus sollten Sie sicherstellen, dass die Ebenen des Codes interagieren, wie Sie erwarten, wenn Ihre Anwendung Abhängigkeiten vollständig aufgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="82209-130">Additionally, you should verify that your code's layers interact as you expect when your application's dependencies are fully resolved.</span></span> <span data-ttu-id="82209-131">Dies ist der Verantwortung des Integrationstests.</span><span class="sxs-lookup"><span data-stu-id="82209-131">This is the responsibility of integration tests.</span></span> <span data-ttu-id="82209-132">Integrationstests tendenziell langsamer und schwieriger als Komponententests, die eingerichtet sein, da sie häufig externe Abhängigkeiten sowie Infrastruktur abhängig sind.</span><span class="sxs-lookup"><span data-stu-id="82209-132">Integration tests tend to be slower and more difficult to set up than unit tests, because they often depend on external dependencies and infrastructure.</span></span> <span data-ttu-id="82209-133">Daher sollten Sie vermeiden, testen die Aufgaben aus, die Tests bei Komponententests in Integrationstests werden konnte.</span><span class="sxs-lookup"><span data-stu-id="82209-133">Thus, you should avoid testing things that could be tests with unit tests in integration tests.</span></span> <span data-ttu-id="82209-134">Wenn Sie ein bestimmtes Szenario mit einem Komponententest testen können, sollten Sie es mit einem Komponententest testen.</span><span class="sxs-lookup"><span data-stu-id="82209-134">If you can test a given scenario with a unit test, you should test it with a unit test.</span></span> <span data-ttu-id="82209-135">Wenn Sie nicht möglich ist, sollten Sie einen Integrationstest verwenden.</span><span class="sxs-lookup"><span data-stu-id="82209-135">If you can't, then consider using an integration test.</span></span>

<span data-ttu-id="82209-136">Integrationstests müssen häufig komplexere Setup- und teardownvorgänge Prozeduren als Komponententests.</span><span class="sxs-lookup"><span data-stu-id="82209-136">Integration tests will often have more complex setup and teardown procedures than unit tests.</span></span> <span data-ttu-id="82209-137">Beispielsweise benötigen ein Integrationstest, der für eine tatsächliche Datenbank geht eine Möglichkeit zum Zurückgeben der Datenbank in einen bekannten Zustand vor jedem Test ausführen.</span><span class="sxs-lookup"><span data-stu-id="82209-137">For example, an integration test that goes against an actual database will need a way to return the database to a known state before each test run.</span></span> <span data-ttu-id="82209-138">Wenn neue Tests hinzugefügt werden, und das Datenbankschema Produktion weiterentwickelt, diese Tests Skripts erfolgen tendenziell in Größe und Komplexität wachsen.</span><span class="sxs-lookup"><span data-stu-id="82209-138">As new tests are added and the production database schema evolves, these test scripts will tend to grow in size and complexity.</span></span> <span data-ttu-id="82209-139">In zahlreiche großen Systemen ist es unpraktisch, vollständige Auflistungen von Integrationstests auf Entwicklerarbeitsstationen ausgeführt wird, vor dem Einchecken von Änderungen an den freigegebenen Datenquellen-Steuerelements.</span><span class="sxs-lookup"><span data-stu-id="82209-139">In many large systems, it is impractical to run full suites of integration tests on developer workstations before checking in changes to shared source control.</span></span> <span data-ttu-id="82209-140">In diesen Fällen können die Integrationstests erfolgreich auf einem Build-Server ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="82209-140">In these cases, integration tests may be run on a build server.</span></span>

<span data-ttu-id="82209-141">Die Implementierungsklasse LocalFileImageService implementiert die Logik zum Abrufen und Zurückgeben einer Bilddatei Bytes aus einem bestimmten Ordner eine Id zugewiesen:</span><span class="sxs-lookup"><span data-stu-id="82209-141">The LocalFileImageService implementation class implements the logic for fetching and returning the bytes of an image file from a particular folder given an id:</span></span>

```cs
public class LocalFileImageService : IImageService
{
    private readonly IHostingEnvironment _env;
    public LocalFileImageService(IHostingEnvironment env)
    {
        _env = env;
    }
    public byte[] GetImageBytesById(int id)
    {
        try
        {
            var contentRoot = _env.ContentRootPath + "//Pics";
            var path = Path.Combine(contentRoot, id + ".png");
            return File.ReadAllBytes(path);
```

### <a name="functional-tests"></a><span data-ttu-id="82209-142">Funktionstests</span><span class="sxs-lookup"><span data-stu-id="82209-142">Functional Tests</span></span>

<span data-ttu-id="82209-143">Integrationstests werden geschrieben, aus der Perspektive des Entwicklers, um sicherzustellen, dass einige Komponenten des Systems ordnungsgemäß zusammenwirken.</span><span class="sxs-lookup"><span data-stu-id="82209-143">Integration tests are written from the perspective of the developer, to verify that some components of the system work correctly together.</span></span> <span data-ttu-id="82209-144">Funktionstests werden geschrieben, aus der Perspektive des Benutzers, und überprüfen die Richtigkeit des Systems basierend auf den Anforderungen.</span><span class="sxs-lookup"><span data-stu-id="82209-144">Functional tests are written from the perspective of the user, and verify the correctness of the system based on its requirements.</span></span> <span data-ttu-id="82209-145">Der folgende Auszug bietet Analogie zum sind im Wesentlichen Funktionstests, im Vergleich zu Komponententests:</span><span class="sxs-lookup"><span data-stu-id="82209-145">The following excerpt offers a useful analogy for how to think about functional tests, compared to unit tests:</span></span>

> <span data-ttu-id="82209-146">"Oft die Entwicklung eines Systems ist auf die Erstellung eines Hauses Statusmodul vergleichbar.</span><span class="sxs-lookup"><span data-stu-id="82209-146">"Many times the development of a system is likened to the building of a house.</span></span> <span data-ttu-id="82209-147">Während diese Analogie nicht ganz richtig ist, können wir ihn im Rahmen der Unterschied zwischen Einheit und Funktionstests erweitern.</span><span class="sxs-lookup"><span data-stu-id="82209-147">While this analogy isn't quite correct, we can extend it for the purposes of understanding the difference between unit and functional tests.</span></span> <span data-ttu-id="82209-148">UnitTests erfolgt analog zur ein Erstellen von Inspektor ein Haus Konstruktion Website besuchen.</span><span class="sxs-lookup"><span data-stu-id="82209-148">Unit testing is analogous to a building inspector visiting a house's construction site.</span></span> <span data-ttu-id="82209-149">Er konzentriert sich auf die verschiedenen internen Systemen des Hauses, die Grundlage, Abfassung, für die elektrische Sanitär- und usw..</span><span class="sxs-lookup"><span data-stu-id="82209-149">He is focused on the various internal systems of the house, the foundation, framing, electrical, plumbing, and so on.</span></span> <span data-ttu-id="82209-150">Er stellt sicher, dass die Teile des Hauses werden voll funktionsfähig und sicher, d. h. das Erstellen von Code zu erfüllen (Tests).</span><span class="sxs-lookup"><span data-stu-id="82209-150">He ensures (tests) that the parts of the house will work correctly and safely, that is, meet the building code.</span></span> <span data-ttu-id="82209-151">Funktionstests in diesem Szenario sind vergleichbar mit dem Hauseigentümer derselben Konstruktion Website besuchen.</span><span class="sxs-lookup"><span data-stu-id="82209-151">Functional tests in this scenario are analogous to the homeowner visiting this same construction site.</span></span> <span data-ttu-id="82209-152">Er wird davon ausgegangen, dass die internen Systemen entsprechend verhält, dass das Erstellen von Inspektor seine Aufgabe ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="82209-152">He assumes that the internal systems will behave appropriately, that the building inspector is performing his task.</span></span> <span data-ttu-id="82209-153">Die Hauseigentümer konzentriert sich darauf, was er z. B. in diesem Haus Gültigkeitsdauer kann.</span><span class="sxs-lookup"><span data-stu-id="82209-153">The homeowner is focused on what it will be like to live in this house.</span></span> <span data-ttu-id="82209-154">Er hat Bedenken hinsichtlich des Hauses wie sieht, sind die verschiedenen Räumen eine angenehme Größe und passt die House der Familie muss, sind die Fenster an eine gute Stelle zum Abfangen von Sun morgen.</span><span class="sxs-lookup"><span data-stu-id="82209-154">He is concerned with how the house looks, are the various rooms a comfortable size, does the house fit the family's needs, are the windows in a good spot to catch the morning sun.</span></span> <span data-ttu-id="82209-155">Die Hauseigentümer wird auf die House Funktionstests ausführen.</span><span class="sxs-lookup"><span data-stu-id="82209-155">The homeowner is performing functional tests on the house.</span></span> <span data-ttu-id="82209-156">Er verfügt über die Sicht des Benutzers.</span><span class="sxs-lookup"><span data-stu-id="82209-156">He has the user's perspective.</span></span> <span data-ttu-id="82209-157">Erstellen von Inspektor ausführt Komponententests auf die House.</span><span class="sxs-lookup"><span data-stu-id="82209-157">The building inspector is performing unit tests on the house.</span></span> <span data-ttu-id="82209-158">Er verfügt über die Perspektive des."</span><span class="sxs-lookup"><span data-stu-id="82209-158">He has the builder's perspective."</span></span>

<span data-ttu-id="82209-159">Quelle: [Komponententests im Vergleich zu Funktionstests](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span><span class="sxs-lookup"><span data-stu-id="82209-159">Source: [Unit Testing versus Functional Tests](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span></span>

<span data-ttu-id="82209-160">Ich bin sagen löschen "als Entwickler ein Fehler auf zwei Arten: Sie erstellen das, was falsche oder das falsche, was Sie erstellen."</span><span class="sxs-lookup"><span data-stu-id="82209-160">I'm fond of saying "As developers, we fail in two ways: we build the thing wrong, or we build the wrong thing."</span></span> <span data-ttu-id="82209-161">Komponententests stellen Sie sicher, dass Sie der Sache rechts erstellen; Funktionstests stellen Sie sicher, dass Sie das richtige erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="82209-161">Unit tests ensure you are building the thing right; functional tests ensure you are building the right thing.</span></span>

<span data-ttu-id="82209-162">Da Funktionstests auf Systemebene ausgeführt werden, können sie ein gewisses Maß an UI-Automatisierung verlangen.</span><span class="sxs-lookup"><span data-stu-id="82209-162">Since functional tests operate at the system level, they may require some degree of UI automation.</span></span> <span data-ttu-id="82209-163">Wie Integrationstests arbeiten sie in der Regel mit irgendeine Testinfrastruktur ebenfalls.</span><span class="sxs-lookup"><span data-stu-id="82209-163">Like integration tests, they usually work with some kind of test infrastructure as well.</span></span> <span data-ttu-id="82209-164">Dadurch sind sie langsamer und anfälliger als Einheit und Integration Tests.</span><span class="sxs-lookup"><span data-stu-id="82209-164">This makes them slower and more brittle than unit and integration tests.</span></span> <span data-ttu-id="82209-165">Sie müssen nur so viele Funktionstests, da Sie überzeugt ist das System verhält, als Benutzer erwarten, dass sein müssen.</span><span class="sxs-lookup"><span data-stu-id="82209-165">You should have only as many functional tests as you need to be confident the system is behaving as users expect.</span></span>

### <a name="testing-pyramid"></a><span data-ttu-id="82209-166">Testen der Pyramide</span><span class="sxs-lookup"><span data-stu-id="82209-166">Testing Pyramid</span></span>

<span data-ttu-id="82209-167">Smell geschrieben wurde, zu der Tests Pyramide, ein die Beispiel für die in Abbildung 9 – 1 angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="82209-167">Martin Fowler wrote about the testing pyramid, an example of which is shown in Figure 9-1.</span></span>

![](./media/image9-1.png)

<span data-ttu-id="82209-168">Abbildung 9 – 1 Pyramide testen</span><span class="sxs-lookup"><span data-stu-id="82209-168">Figure 9-1 Testing Pyramid</span></span>

<span data-ttu-id="82209-169">Die verschiedenen Ebenen der Pyramide und ihre relativen Größen darstellen, verschiedene Arten von Tests und wie viele für Ihre Anwendung geschrieben werden soll.</span><span class="sxs-lookup"><span data-stu-id="82209-169">The different layers of the pyramid, and their relative sizes, represent different kinds of tests and how many you should write for your application.</span></span> <span data-ttu-id="82209-170">Wie Sie sehen können, ist die Empfehlung eine große Basis von Komponententests, die durch eine kleinere Ebene von Integrationstests, mit dem eine noch kleinere Ebene der Funktionstests unterstützt.</span><span class="sxs-lookup"><span data-stu-id="82209-170">As you can see, the recommendation is to have a large base of unit tests, supported by a smaller layer of integration tests, with an even smaller layer of functional tests.</span></span> <span data-ttu-id="82209-171">Jede Ebene sollte idealerweise nur Tests enthalten, die auf einer niedrigeren Ebene nicht ordnungsgemäß ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="82209-171">Each layer should ideally only have tests in it that cannot be performed adequately at a lower layer.</span></span> <span data-ttu-id="82209-172">Wenn Sie entscheiden, welche Art von Tests benötigen Sie für ein bestimmtes Szenario möchten, sollten Sie Bedenken der Pyramide testen.</span><span class="sxs-lookup"><span data-stu-id="82209-172">Keep the testing pyramid in mind when you are trying to decide which kind of test you need for a particular scenario.</span></span>

### <a name="what-to-test"></a><span data-ttu-id="82209-173">Den Testgegenstand</span><span class="sxs-lookup"><span data-stu-id="82209-173">What to Test</span></span>

<span data-ttu-id="82209-174">Ein häufig auftretendes Problem für Entwickler, die für das Schreiben automatisierter Tests unerfahrenen stammt mit, was Sie testen.</span><span class="sxs-lookup"><span data-stu-id="82209-174">A common problem for developers who are inexperienced with writing automated tests is coming up with what to test.</span></span> <span data-ttu-id="82209-175">Ein guter Ausgangspunkt ist bedingten Logik zu testen.</span><span class="sxs-lookup"><span data-stu-id="82209-175">A good starting point is to test conditional logic.</span></span> <span data-ttu-id="82209-176">Eine beliebige Stelle stehen Ihnen eine Methode mit dem Verhalten, die Änderungen auf einer bedingten Anweisung basieren (If-else wechseln, usw.), Sie muss sich mindestens eine Reihe von Tests geschaltet wird, die das richtige Verhalten für bestimmte Bedingungen zu bestätigen.</span><span class="sxs-lookup"><span data-stu-id="82209-176">Anywhere you have a method with behavior that changes based on a conditional statement (if-else, switch, etc.), you should be able to come up at least a couple of tests that confirm the correct behavior for certain conditions.</span></span> <span data-ttu-id="82209-177">Wenn der Code fehlerbedingungen aufweist, ist es hilfreich, zumindest ein Test für die "zufriedene Path" durch den Code (mit keine Fehler) und mindestens ein Test für die "sad-Path" (mit Fehlern oder untypische Ergebnisse) zu schreiben, um zu bestätigen, dass Ihre Anwendung verhält sich wie erwartet bei Fehlern.</span><span class="sxs-lookup"><span data-stu-id="82209-177">If your code has error conditions, it's good to write at least one test for the "happy path" through the code (with no errors), and at least one test for the "sad path" (with errors or atypical results) to confirm your application behaves as expected in the face of errors.</span></span> <span data-ttu-id="82209-178">Schließlich versucht, darauf konzentrieren, testen die Aufgaben aus, die ausgeführt werden können, statt die schwerpunktmäßige Darstellung Metriken wie Code Coverage.</span><span class="sxs-lookup"><span data-stu-id="82209-178">Finally, try to focus on testing things that can fail, rather than focusing on metrics like code coverage.</span></span> <span data-ttu-id="82209-179">Weitere Code Coverage ist in der Regel kleiner, besser.</span><span class="sxs-lookup"><span data-stu-id="82209-179">More code coverage is better than less, generally.</span></span> <span data-ttu-id="82209-180">Schreiben einer Methode sehr komplex und Ihre geschäftskritischen einige weitere Tests ist jedoch in der Regel eine bessere Verwendung von Zeit als das Schreiben von Tests für den Auto-Eigenschaften, um Tests Code Coverage Metriken zu verbessern.</span><span class="sxs-lookup"><span data-stu-id="82209-180">However, writing a few more tests of a very complex and business-critical method is usually a better use of time than writing tests for auto-properties just to improve test code coverage metrics.</span></span>

## <a name="organizing-test-projects"></a><span data-ttu-id="82209-181">Organisieren von Projekten für Tests</span><span class="sxs-lookup"><span data-stu-id="82209-181">Organizing Test Projects</span></span>

<span data-ttu-id="82209-182">Testprojekte können organisiert werden, jedoch für Sie am besten.</span><span class="sxs-lookup"><span data-stu-id="82209-182">Test projects can be organized however works best for you.</span></span> <span data-ttu-id="82209-183">Es ist eine gute Idee, trennen die Tests nach Typ (Komponententest, Integrationstest), und was sie (durch Projekt durch den Namespace) testen.</span><span class="sxs-lookup"><span data-stu-id="82209-183">It's a good idea to separate tests by type (unit test, integration test) and by what they are testing (by project, by namespace).</span></span> <span data-ttu-id="82209-184">Ob diese Trennung von Ordnern in einem einzelnen Testprojekt anlegen und mehrere Testprojekte besteht aus ist eine Entscheidung auf.</span><span class="sxs-lookup"><span data-stu-id="82209-184">Whether this separation consists of folders within a single test project, or multiple test projects, is a design decision.</span></span> <span data-ttu-id="82209-185">Ein Projekt ist am einfachsten, allerdings bei großen Projekten mit vielen Tests oder um leichter verschiedene Gruppen von Tests ausführen, sollten Sie mehrere verschiedene Testprojekte haben.</span><span class="sxs-lookup"><span data-stu-id="82209-185">One project is simplest, but for large projects with many tests, or in order to more easily run different sets of tests, you might want to have several different test projects.</span></span> <span data-ttu-id="82209-186">Viele Teams organisieren Testprojekte, die basierend auf das Projekt, das sie testen, das was für Anwendungen mit mehr als ein paar Projekte zu einer großen Anzahl von Testprojekte, führen kann, insbesondere dann, wenn Sie weiterhin diese Aufgliedern nach, welche Art von Tests in jedem Projekt sind.</span><span class="sxs-lookup"><span data-stu-id="82209-186">Many teams organize test projects based on the project they are testing, which for applications with more than a few projects can result in a large number of test projects, especially if you still break these down according to what kind of tests are in each project.</span></span> <span data-ttu-id="82209-187">Ein Kompromiss-Ansatz ist, haben ein Projekt pro Art von Tests pro Anwendung, die Ordner in der Testprojekte, um die zu testenden Projekt (und -Klasse) anzugeben.</span><span class="sxs-lookup"><span data-stu-id="82209-187">A compromise approach is to have one project per kind of test, per application, with folders inside the test projects to indicate the project (and class) being tested.</span></span>

<span data-ttu-id="82209-188">Eine gängige Methode ist die Anwendungsprojekte in einem Ordner "Src", und die Anwendung Testprojekte in einem parallelen "tests" Ordner zu organisieren.</span><span class="sxs-lookup"><span data-stu-id="82209-188">A common approach is to organize the application projects under a ‘src' folder, and the application's test projects under a parallel ‘tests' folder.</span></span> <span data-ttu-id="82209-189">Sie können übereinstimmende Projektmappenordner in Visual Studio erstellen, wenn Sie diese Organisation nützlich sein.</span><span class="sxs-lookup"><span data-stu-id="82209-189">You can create matching solution folders in Visual Studio, if you find this organization useful.</span></span>

![](./media/image9-2.png)

<span data-ttu-id="82209-190">Abbildung 9-2-Test-Organisation in der Projektmappe</span><span class="sxs-lookup"><span data-stu-id="82209-190">Figure 9-2 Test organization in your solution</span></span>

<span data-ttu-id="82209-191">Sie können unabhängig davon, welche Testframework gewünscht.</span><span class="sxs-lookup"><span data-stu-id="82209-191">You can use whichever test framework you prefer.</span></span> <span data-ttu-id="82209-192">Das Framework xUnit gut funktioniert und was ist alle Tests ASP.NET Core und EF Core geschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="82209-192">The xUnit framework works well and is what all of the ASP.NET Core and EF Core tests are written in.</span></span> <span data-ttu-id="82209-193">Sie können ein xUnit Testprojekt in Visual Studio mithilfe der Vorlage angezeigt, in Abbildung 9 – 3 oder über die CLI mit neuen Xunit Dotnet hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="82209-193">You can add an xUnit test project in Visual Studio using the template shown in Figure 9-3, or from the CLI using dotnet new xunit.</span></span>

![](./media/image9-3.png)

<span data-ttu-id="82209-194">Abbildung 9 – 3 hinzufügen ein xUnit Testprojekt in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="82209-194">Figure 9-3 Add an xUnit Test Project in Visual Studio</span></span>

### <a name="test-naming"></a><span data-ttu-id="82209-195">Testen Sie die Benennung</span><span class="sxs-lookup"><span data-stu-id="82209-195">Test Naming</span></span>

<span data-ttu-id="82209-196">Sie sollten die Tests auf konsistente Weise, mit Namen benennen, die angeben, was bewirkt, dass jeder Test.</span><span class="sxs-lookup"><span data-stu-id="82209-196">You should name your tests in a consistent fashion, with names that indicate what each test does.</span></span> <span data-ttu-id="82209-197">Ein Ansatz besteht darin, die erfolgreich waren werden Namen von Testklassen gemäß der Klasse und Methode, die sie testen möchten.</span><span class="sxs-lookup"><span data-stu-id="82209-197">One approach I've had great success with is to name test classes according to the class and method they are testing.</span></span> <span data-ttu-id="82209-198">Führt dies zu viele kleine Testklassen, allerdings vereinfacht extrem verdeutlichen, was jeder Test für zuständig ist.</span><span class="sxs-lookup"><span data-stu-id="82209-198">This results in many small test classes, but it makes it extremely clear what each test is responsible for.</span></span> <span data-ttu-id="82209-199">Mit dem Test-Klassennamen, der zum Identifizieren der Klasse und die zu testende Methode einrichten kann der Methodennamen für den Test verwendet werden, zum Festlegen des Verhaltens, das getestet wird.</span><span class="sxs-lookup"><span data-stu-id="82209-199">With the test class name set up to identify the class and method to be tested, the test method name can be used to specify the behavior being tested.</span></span> <span data-ttu-id="82209-200">Dazu gehören das erwartete Verhalten und Eingaben oder Annahmen, die dieses Verhalten ergeben sollten.</span><span class="sxs-lookup"><span data-stu-id="82209-200">This should include the expected behavior and any inputs or assumptions that should yield this behavior.</span></span> <span data-ttu-id="82209-201">Einige Beispielnamen Test:</span><span class="sxs-lookup"><span data-stu-id="82209-201">Some example test names:</span></span>

-   <span data-ttu-id="82209-202">CatalogControllerGetImage.CallsImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="82209-202">CatalogControllerGetImage.CallsImageServiceWithId</span></span>

-   <span data-ttu-id="82209-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="82209-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span></span>

-   <span data-ttu-id="82209-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span><span class="sxs-lookup"><span data-stu-id="82209-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span></span>

-   <span data-ttu-id="82209-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="82209-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span></span>

<span data-ttu-id="82209-206">Eine Variante dieses Ansatzes endet jeder Test-Klassennamen in "Sollte" und die Zeitformen geringfügig geändert:</span><span class="sxs-lookup"><span data-stu-id="82209-206">A variation of this approach ends each test class name with "Should" and modifies the tense slightly:</span></span>

-   <span data-ttu-id="82209-207">CatalogControllerGetImage**sollten**. **Rufen Sie**ImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="82209-207">CatalogControllerGetImage**Should**.**Call**ImageServiceWithId</span></span>

-   <span data-ttu-id="82209-208">CatalogControllerGetImage**sollten**. **Protokoll**WarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="82209-208">CatalogControllerGetImage**Should**.**Log**WarningGivenImageMissingException</span></span>

<span data-ttu-id="82209-209">Einige Teams finden naming Ansatz klarer, jedoch etwas ausführlicher.</span><span class="sxs-lookup"><span data-stu-id="82209-209">Some teams find the second naming approach clearer, though slightly more verbose.</span></span> <span data-ttu-id="82209-210">In jedem Fall verwenden Sie eine Benennungskonvention, die einen Einblick in das Verhalten von Testserver bereitstellt, wenn eine oder mehrere Tests fehlschlagen, aus deren Namen ersichtlich ist welchen Fällen fehlschlugen.</span><span class="sxs-lookup"><span data-stu-id="82209-210">In any case, try to use a naming convention that provides insight into test behavior, so that when one or more tests fail, it's obvious from their names what cases have failed.</span></span> <span data-ttu-id="82209-211">Vermeiden Sie benennen Sie Tests vaguely, z. B. ControllerTests.Test1, da diese kein Wert bieten, wenn Sie sie in Testergebnisse finden Sie unter.</span><span class="sxs-lookup"><span data-stu-id="82209-211">Avoid naming you tests vaguely, such as ControllerTests.Test1, as these offer no value when you see them in test results.</span></span>

<span data-ttu-id="82209-212">Wenn Sie eine Benennungskonvention befolgen, wie die gezeigte, die viele kleine Testklassen erzeugt, ist es eine gute Idee, um die Tests unter Verwendung von Ordnern und Namespaces anzuordnen.</span><span class="sxs-lookup"><span data-stu-id="82209-212">If you follow a naming convention like the one above that produces many small test classes, it's a good idea to further organize your tests using folders and namespaces.</span></span> <span data-ttu-id="82209-213">Abbildung 9 – 4 zeigt eine Möglichkeit zum Organisieren von Tests nach dem Ordner, in mehrere Testprojekte.</span><span class="sxs-lookup"><span data-stu-id="82209-213">Figure 9-4 shows one approach to organizing tests by folder within several test projects.</span></span>

![](./media/image9-4.png)

<span data-ttu-id="82209-214">**Abbildung 9 – 4.**</span><span class="sxs-lookup"><span data-stu-id="82209-214">**Figure 9-4.**</span></span> <span data-ttu-id="82209-215">Organisieren von Testklassen Ordner basierend auf der Klasse getestet wird.</span><span class="sxs-lookup"><span data-stu-id="82209-215">Organizing test classes by folder based on class being tested.</span></span>

<span data-ttu-id="82209-216">Natürlich, wenn eine bestimmte Anwendung-Klasse verfügt über zahlreiche Methoden, die zu testenden (und daher viele Testklassen), kann es sich, platzieren Sie diese in einen Ordner für die Anwendungsklasse einzubinden.</span><span class="sxs-lookup"><span data-stu-id="82209-216">Of course, if a particular application class has many methods being tested (and thus many test classes), it may make sense to place these in a folder corresponding to the application class.</span></span> <span data-ttu-id="82209-217">Diese Organisation ist, unterscheidet sich nicht, wie Sie Dateien in Ordnern an anderer Stelle organisieren können.</span><span class="sxs-lookup"><span data-stu-id="82209-217">This organization is no different than how you might organize files into folders elsewhere.</span></span> <span data-ttu-id="82209-218">Wenn Sie über mehr als drei oder vier Dateien in einem Ordner mit vielen anderen Dateien beziehen, ist es oft hilfreich, die sie in ihren eigenen Unterordner verschieben.</span><span class="sxs-lookup"><span data-stu-id="82209-218">If you have more than three or four related files in a folder containing many other files, it's often helpful to move them into their own subfolder.</span></span>

## <a name="unit-testing-aspnet-core-apps"></a><span data-ttu-id="82209-219">Einheit Testen von ASP.NET Core-Apps</span><span class="sxs-lookup"><span data-stu-id="82209-219">Unit Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="82209-220">In einer gut entworfenen ASP.NET Core-Anwendung wird ein Großteil der Komplexität und Geschäftslogik in Geschäftseinheiten und eine Vielzahl von Diensten gekapselt werden.</span><span class="sxs-lookup"><span data-stu-id="82209-220">In a well-designed ASP.NET Core application, most of the complexity and business logic will be encapsulated in business entities and a variety of services.</span></span> <span data-ttu-id="82209-221">Die ASP.NET Core MVC-app selbst mit seiner Controller, Filter, Viewmodels und Ansichten, müssen normalerweise nur sehr wenige Komponententests.</span><span class="sxs-lookup"><span data-stu-id="82209-221">The ASP.NET Core MVC app itself, with its controllers, filters, viewmodels, and views, should require very few unit tests.</span></span> <span data-ttu-id="82209-222">Viele der Funktionen einer bestimmten Aktion liegt außerhalb der Aktionsmethode selbst.</span><span class="sxs-lookup"><span data-stu-id="82209-222">Much of the functionality of a given action lies outside the action method itself.</span></span> <span data-ttu-id="82209-223">Testen, ob routing ordnungsgemäß funktioniert oder globalen Fehlerbehandlung, kann nicht mit einem Komponententest effektiv erfolgen.</span><span class="sxs-lookup"><span data-stu-id="82209-223">Testing whether routing works correctly, or global error handling, cannot be done effectively with a unit test.</span></span> <span data-ttu-id="82209-224">Ebenso alle, einschließlich modellvalidierung und Authentifizierung und Autorisierungsfilter, nicht mit Komponententests getestet.</span><span class="sxs-lookup"><span data-stu-id="82209-224">Likewise, any filters, including model validation and authentication and authorization filters, cannot be unit tested.</span></span> <span data-ttu-id="82209-225">Ohne diese Quellen des Verhaltens sollte die meisten Aktionsmethoden Trivial "klein", delegieren den Großteil der Arbeit bei Diensten, die unabhängig von der Controller getestet werden können, die sie verwendet.</span><span class="sxs-lookup"><span data-stu-id="82209-225">Without these sources of behavior, most action methods should be trivially small, delegating the bulk of their work to services that can be tested independent of the controller that uses them.</span></span>

<span data-ttu-id="82209-226">In einigen Fällen müssen Sie für die Umgestaltung in Code bestellen Komponententest.</span><span class="sxs-lookup"><span data-stu-id="82209-226">Sometimes you'll need to refactor your code in order to unit test it.</span></span> <span data-ttu-id="82209-227">Dies umfasst das häufig Abstraktionen identifizieren und mithilfe der Abhängigkeitsinjektion zu die Abstraktion im Code zugreifen, die Sie testen möchten, anstatt direkt auf die Infrastruktur Codierung.</span><span class="sxs-lookup"><span data-stu-id="82209-227">Frequently this involves identifying abstractions and using dependency injection to access the abstraction in the code you'd like to test, rather than coding directly against infrastructure.</span></span> <span data-ttu-id="82209-228">Betrachten Sie beispielsweise diese einfache Aktion-Methode für das Anzeigen von Bildern aus:</span><span class="sxs-lookup"><span data-stu-id="82209-228">For example, consider this simple action method for displaying images:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")]
public IActionResult GetImage(int id)
{
    var contentRoot = _env.ContentRootPath + "//Pics";
    var path = Path.Combine(contentRoot, id + ".png");
    Byte[] b = System.IO.File.ReadAllBytes(path);
    return File(b, "image/png");
}
```

<span data-ttu-id="82209-229">Komponententests, die diese Methode nur schwer von seiner direkte Abhängigkeit System.IO.File, erfolgt die verwendet wird, aus dem Dateisystem gelesen.</span><span class="sxs-lookup"><span data-stu-id="82209-229">Unit testing this method is made difficult by its direct dependency on System.IO.File, which it uses to read from the file system.</span></span> <span data-ttu-id="82209-230">Sie können dieses Verhalten, um sicherzustellen, dass sie erwartungsgemäß funktioniert, aber mit echten Dateien, die auf diese Weise wird ein Integrationstest testen.</span><span class="sxs-lookup"><span data-stu-id="82209-230">You can test this behavior to ensure it works as expected, but doing so with real files is an integration test.</span></span> <span data-ttu-id="82209-231">Beachten Sie können nicht testen diese Methode Route – sehen Sie, wie Sie dies in Kürze mit getestet durchführen.</span><span class="sxs-lookup"><span data-stu-id="82209-231">It's worth noting you can't test this method's route – you'll see how to do this with a functional test shortly.</span></span>

<span data-ttu-id="82209-232">Wenn Sie nicht direkt Komponententest das Systemverhalten für die Datei, und Sie können nicht die Route testen, besteht was testen?</span><span class="sxs-lookup"><span data-stu-id="82209-232">If you can't unit test the file system behavior directly, and you can't test the route, what is there to test?</span></span> <span data-ttu-id="82209-233">Auch nach der Umgestaltung um Komponententests zu ermöglichen, werden Sie möglicherweise einige Testfälle und fehlende Verhalten, z. B. Fehlerbehandlung feststellen.</span><span class="sxs-lookup"><span data-stu-id="82209-233">Well, after refactoring to make unit testing possible, you may discover some test cases and missing behavior, such as error handling.</span></span> <span data-ttu-id="82209-234">Wie funktioniert die Methode? Wenn Sie eine Datei nicht gefunden wird</span><span class="sxs-lookup"><span data-stu-id="82209-234">What does the method do when a file isn't found?</span></span> <span data-ttu-id="82209-235">Was muss dabei vorgehen?</span><span class="sxs-lookup"><span data-stu-id="82209-235">What should it do?</span></span> <span data-ttu-id="82209-236">In diesem Beispiel sieht die umgestaltete Methode:</span><span class="sxs-lookup"><span data-stu-id="82209-236">In this example, the refactored method looks like this:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")\]
public IActionResult GetImage(int id)
{
    byte[] imageBytes;
    try
    {
        imageBytes = _imageService.GetImageBytesById(id);
    }
    catch (CatalogImageMissingException ex)
    {
        _logger.LogWarning($"No image found for id: {id}");
        return NotFound();
    }
    return File(imageBytes, "image/png");
}
```

<span data-ttu-id="82209-237">Die \_Protokollierung und \_ImageService werden sowohl als Abhängigkeiten eingefügt.</span><span class="sxs-lookup"><span data-stu-id="82209-237">The \_logger and \_imageService are both injected as dependencies.</span></span> <span data-ttu-id="82209-238">Nun können Sie testen, dass dieselbe Id, die an die Aktionsmethode übergeben wird, übergeben, wird die \_ImageService, und die resultierenden Bytes werden als Teil der FileResult zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="82209-238">Now you can test that the same id that is passed to the action method is passed to the \_imageService, and that the resulting bytes are returned as part of the FileResult.</span></span> <span data-ttu-id="82209-239">Sie können auch testen, dass die Protokollierung von Anzeigefehlern wie erwartet erfolgt und ein NotFound Ergebnis zurückgegeben wird, wenn das Bild ist nicht vorhanden ist, vorausgesetzt, dass dies wichtig Anwendungsverhalten (d. h. nicht nur temporäre Code vom Entwickler hinzugefügt, um ein Problem zu diagnostizieren) ist.</span><span class="sxs-lookup"><span data-stu-id="82209-239">You can also test that error logging is happening as expected, and that a NotFound result is returned if the image is missing, assuming this is important application behavior (that is, not just temporary code the developer added to diagnose an issue).</span></span> <span data-ttu-id="82209-240">Die eigentliche Datei Logik in einem separaten Implementierung Dienst verschoben wurde, und wurde erweitert wurde, um eine anwendungsspezifische-Ausnahme für den Fall einer fehlenden Datei zurück.</span><span class="sxs-lookup"><span data-stu-id="82209-240">The actual file logic has moved into a separate implementation service, and has been augmented to return an application-specific exception for the case of a missing file.</span></span> <span data-ttu-id="82209-241">Sie können diese Implementierung unabhängig voneinander und testen, verwenden einen Integrationstest.</span><span class="sxs-lookup"><span data-stu-id="82209-241">You can test this implementation independently, using an integration test.</span></span>

## <a name="integration-testing-aspnet-core-apps"></a><span data-ttu-id="82209-242">Integration Testen von ASP.NET Core-Apps</span><span class="sxs-lookup"><span data-stu-id="82209-242">Integration Testing ASP.NET Core Apps</span></span>

```cs
    }
        catch (FileNotFoundException ex)
        {
            throw new CatalogImageMissingException(ex);
        }
    }
}
```

<span data-ttu-id="82209-243">Dieser Dienst verwendet die IHostingEnvironment ebenso wie der Code hat, bevor es in einem separaten Dienst umgestaltet wurde CatalogController.</span><span class="sxs-lookup"><span data-stu-id="82209-243">This service uses the IHostingEnvironment, just as the CatalogController code did before it was refactored into a separate service.</span></span> <span data-ttu-id="82209-244">Da dies der einzige Code im Controller, die IHostingEnvironment verwendet wurde, wurde diese Abhängigkeit vom Konstruktor des CatalogController entfernt.</span><span class="sxs-lookup"><span data-stu-id="82209-244">Since this was the only code in the controller that used IHostingEnvironment, that dependency was removed from CatalogController's constructor.</span></span>

<span data-ttu-id="82209-245">Um zu testen, dass dieser Dienst ordnungsgemäß funktioniert, müssen Sie eine bekannte Test Image erstellt, und stellen Sie sicher, dass der Dienst eine bestimmte Eingaben zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="82209-245">To test that this service works correctly, you need to create a known test image file and verify that the service returns it given a specific input.</span></span> <span data-ttu-id="82209-246">Sie sollten darauf achten nicht zur Verwendung von Pseudoobjekten auf das Verhalten, die Sie tatsächlich (in diesem Fall aus dem Dateisystem lesen) testen möchten.</span><span class="sxs-lookup"><span data-stu-id="82209-246">You should take care not to use mock objects on the behavior you actually want to test (in this case, reading from the file system).</span></span> <span data-ttu-id="82209-247">Pseudoobjekte sind jedoch immer noch nützlich zum Einrichten von Integrationstests möglicherweise.</span><span class="sxs-lookup"><span data-stu-id="82209-247">However, mock objects may still be useful to set up integration tests.</span></span> <span data-ttu-id="82209-248">In diesem Fall können Sie IHostingEnvironment modellieren, damit seine ContentRootPath auf den Ordner verweist, die für die Test-Image verwendet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="82209-248">In this case, you can mock IHostingEnvironment so that its ContentRootPath points to the folder you're going to use for your test image.</span></span> <span data-ttu-id="82209-249">Die vollständige arbeiten Integration Testklasse wird hier gezeigt:</span><span class="sxs-lookup"><span data-stu-id="82209-249">The complete working integration test class is shown here:</span></span>

```cs
public class LocalFileImageServiceGetImageBytesById
{
    private byte[] _testBytes = new byte[] { 0x01, 0x02, 0x03 };
    private readonly Mock<IHostingEnvironment> _mockEnvironment = new Mock<IHostingEnvironment>();
    private int _testImageId = 123;
    private string _testFileName = "123.png";
    public LocalFileImageServiceGetImageBytesById()
    {
        // create folder if necessary
        Directory.CreateDirectory(Path.Combine(GetFileDirectory(), "Pics"));
        string filePath = GetFilePath(_testFileName);
        System.IO.File.WriteAllBytes(filePath, _testBytes);
        _mockEnvironment.SetupGet<string>(m => m.ContentRootPath).Returns(GetFileDirectory());
    }
    private string GetFilePath(string fileName)
    {
        return Path.Combine(GetFileDirectory(), "Pics", fileName);
        }
            private string GetFileDirectory()
        {
            var location = System.Reflection.Assembly.GetEntryAssembly().Location;
            return Path.GetDirectoryName(location);
        }

        [Fact]
        public void ReturnsFileContentResultGivenValidId()
        {
            var fileService = new LocalFileImageService(_mockEnvironment.Object);
            var result = fileService.GetImageBytesById(_testImageId);
            Assert.Equal(_testBytes, result);
        }
    }
```

> [!NOTE]
> <span data-ttu-id="82209-250">dass der Test selbst sehr einfache – ist ist der Großteil des Codes erforderlich, das System konfigurieren und Erstellen von der Testinfrastruktur (in diesem Fall kann eine tatsächliche Datei vom Datenträger gelesen werden).</span><span class="sxs-lookup"><span data-stu-id="82209-250">that the test itself is very simple – the bulk of the code is necessary to configure the system and create the testing infrastructure (in this case, an actual file to be read from disk).</span></span> <span data-ttu-id="82209-251">Dies ist typisch für Integrationstests, die häufig komplexen Setup als Komponententests in Anspruch nehmen.</span><span class="sxs-lookup"><span data-stu-id="82209-251">This is typical for integration tests, which often require more complex setup work than unit tests.</span></span>

## <a name="functional-testing-aspnet-core-apps"></a><span data-ttu-id="82209-252">Funktionale Testen von ASP.NET Core-Apps</span><span class="sxs-lookup"><span data-stu-id="82209-252">Functional Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="82209-253">Für ASP.NET Core-Anwendungen erleichtert die TestServer-Klasse Funktionstests relativ zum Schreiben.</span><span class="sxs-lookup"><span data-stu-id="82209-253">For ASP.NET Core applications, the TestServer class makes functional tests fairly easy to write.</span></span> <span data-ttu-id="82209-254">Sie konfigurieren einen TestServer verwenden eine WebHostBuilder, ebenso wie Sie normalerweise für Ihre Anwendung.</span><span class="sxs-lookup"><span data-stu-id="82209-254">You configure a TestServer using a WebHostBuilder, just as you normally do for your application.</span></span> <span data-ttu-id="82209-255">Diese WebHostBuilder muss konfiguriert werden, wie Ihre echten Anwendungshost, aber Sie können ändern, dass alle Aspekte des Zertifikats, die testen vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="82209-255">This WebHostBuilder should be configured just like your application's real host, but you can modify any aspects of it that make testing easier.</span></span> <span data-ttu-id="82209-256">In den meisten Fällen, müssen Sie wiederverwenden der gleichen TestServer für viele Testfälle, damit Sie es in eine wiederverwendbare-Methode (möglicherweise in einer Basisklasse) kapseln können:</span><span class="sxs-lookup"><span data-stu-id="82209-256">Most of the time, you'll reuse the same TestServer for many test cases, so you can encapsulate it in a reusable method (perhaps in a base class):</span></span>

```cs
public abstract class BaseWebTest
{
    protected readonly HttpClient _client;
    protected string _contentRoot;

    public BaseWebTest()
    {
        _client = GetClient();
    }
    
    protected HttpClient GetClient()
    {
        var startupAssembly = typeof(Startup).GetTypeInfo().Assembly;
        _contentRoot = GetProjectPath("src", startupAssembly);
        var builder = new WebHostBuilder()
        .UseContentRoot(_contentRoot)
        .UseStartup&lt;Startup&gt;();
        var server = new TestServer(builder);
        var client = server.CreateClient();
        return client;
    }
}
```

<span data-ttu-id="82209-257">GetProjectPath-Methode gibt einfach den physischen Pfad zum Webprojekt (Download-Beispielprojektmappe) zurück.</span><span class="sxs-lookup"><span data-stu-id="82209-257">The GetProjectPath method simply returns the physical path to the web project (download sample solution).</span></span> <span data-ttu-id="82209-258">Die WebHostBuilder gibt in diesem Fall einfach, wobei die Inhalte-Stamm für die Webanwendung und verweist auf die gleiche Startup-Klasse, die die echte Webanwendung verwendet.</span><span class="sxs-lookup"><span data-stu-id="82209-258">The WebHostBuilder in this case simply specifies where the content root for the web application is, and references the same Startup class the real web application uses.</span></span> <span data-ttu-id="82209-259">Um mit dem TestServer arbeiten, verwenden Sie der System.Net.HttpClient als Standardtyp, um Anforderungen zu stellen.</span><span class="sxs-lookup"><span data-stu-id="82209-259">To work with the TestServer, you use the standard System.Net.HttpClient type to make requests to it.</span></span> <span data-ttu-id="82209-260">TestServer macht eine hilfreiche CreateClient-Methode, die einen vorkonfigurierten Client, der bereitstellt für die Anforderungen an die Anwendung auf dem TestServer senden bereit ist.</span><span class="sxs-lookup"><span data-stu-id="82209-260">TestServer exposes a helpful CreateClient method that provides a pre-configured client that is ready to make requests to the application running on the TestServer.</span></span> <span data-ttu-id="82209-261">Verwenden Sie diesen Client (Legen Sie auf den geschützten \_Client-Element auf der Basis Test oben) beim Funktionstests für die ASP.NET Core-Anwendung zu schreiben:</span><span class="sxs-lookup"><span data-stu-id="82209-261">You use this client (set to the protected \_client member on the base test above) when writing functional tests for your ASP.NET Core application:</span></span>

```cs
public class CatalogControllerGetImage : BaseWebTest
{
    [Fact]
    public async Task ReturnsFileContentResultGivenValidId()
    {
        var testFilePath = Path.Combine(_contentRoot, "pics//1.png");
        var expectedFileBytes = File.ReadAllBytes(testFilePath);
        var response = await _client.GetAsync("/catalog/pic/1");
        response.EnsureSuccessStatusCode();
        var streamResponse = await response.Content.ReadAsStreamAsync();
        byte[] byteResult;
        using (var ms = new MemoryStream())
        {
            streamResponse.CopyTo(ms);
            byteResult = ms.ToArray();
        }
        Assert.Equal(expectedFileBytes, byteResult);
    }
}
```

<span data-ttu-id="82209-262">Diese funktionale Tests ausführt, die vollständige Aufrufliste zur ASP.NET Core MVC-Anwendung, einschließlich aller Middleware, Filter, Bindern usw., die vorhanden sein können.</span><span class="sxs-lookup"><span data-stu-id="82209-262">This functional test exercises the full ASP.NET Core MVC application stack, including all middleware, filters, binders, etc. that may be in place.</span></span> <span data-ttu-id="82209-263">Überprüft, ob eine angegebene Route ("/ Katalog/Pic/1") gibt das erwartete Bytearray für eine Datei an einem bekannten Speicherort.</span><span class="sxs-lookup"><span data-stu-id="82209-263">It verifies that a given route ("/catalog/pic/1") returns the expected byte array for a file in a known location.</span></span> <span data-ttu-id="82209-264">Es tut ohne einen echten Webserver einrichten zu müssen, und vermeidet also ein Großteil der unzulänglichen, bei denen unter Verwendung einer echten Server zum Testen (z. B. bei Problemen mit Firewalleinstellungen) auftreten kann.</span><span class="sxs-lookup"><span data-stu-id="82209-264">It does so without setting up a real web server, and so avoids much of the brittleness that using a real web server for testing can experience (for example, problems with firewall settings).</span></span> <span data-ttu-id="82209-265">Funktionstests, die für den TestServer ausgeführt sind normalerweise langsamer als Integration und Komponententests, aber wesentlich schneller durchführt als Tests, die über das Netzwerk an einen Test-Webserver ausführen würden.</span><span class="sxs-lookup"><span data-stu-id="82209-265">Functional tests that run against TestServer are usually slower than integration and unit tests, but are much faster than tests that would run over the network to a test web server.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="82209-266">[Vorherigen] (Work-with-data-in-asp-net-core-apps.md) [weiter] (Development-Prozess-für-azure.md)</span><span class="sxs-lookup"><span data-stu-id="82209-266">[Previous] (work-with-data-in-asp-net-core-apps.md) [Next] (development-process-for-azure.md)</span></span>
