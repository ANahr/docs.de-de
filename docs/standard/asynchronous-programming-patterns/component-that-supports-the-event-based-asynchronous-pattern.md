---
title: "Exemplarische Vorgehensweise: Implementieren einer Komponente, die das ereignisbasierte asynchrone Muster unterstützt"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- components [.NET Framework], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
caps.latest.revision: "21"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 150e4b27cc149774895574ddd196de5f9bc2acd8
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 11/21/2017
---
# <a name="walkthrough-implementing-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="b2e82-102">Exemplarische Vorgehensweise: Implementieren einer Komponente, die das ereignisbasierte asynchrone Muster unterstützt</span><span class="sxs-lookup"><span data-stu-id="b2e82-102">Walkthrough: Implementing a Component That Supports the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="b2e82-103">Wenn Sie eine Klasse mit einigen Vorgängen, die merkliche Wartezeiten entstehen schreiben, in Betracht ziehen es asynchronen Funktionalität durch Implementieren der [Übersicht über ereignisbasierte asynchrone Muster](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b2e82-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="b2e82-104">In dieser exemplarischen Vorgehensweise wird veranschaulicht, wie eine Komponente erstellen, die das ereignisbasierte asynchrone Muster implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="b2e82-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="b2e82-105">Er implementiert wird, mithilfe von Hilfsklassen aus dem <xref:System.ComponentModel?displayProperty=nameWithType> Namespace, der sicherstellt, dass die Komponente unter jedem beliebigen Anwendungsmodell ordnungsgemäß funktioniert, einschließlich [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], Konsole und Windows Forms-Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)], Console applications and Windows Forms applications.</span></span> <span data-ttu-id="b2e82-106">Diese Komponente ist außerdem mit ausführbar eine <xref:System.Windows.Forms.PropertyGrid> Steuerung und eine eigene benutzerdefinierte Designer.</span><span class="sxs-lookup"><span data-stu-id="b2e82-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="b2e82-107">Wenn Sie über sind, müssen Sie eine Anwendung, die Primzahlen asynchron berechnet.</span><span class="sxs-lookup"><span data-stu-id="b2e82-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="b2e82-108">Die Anwendung wird eine Benutzeroberfläche (UI) des Hauptbenutzerthread und einen Thread für jede Berechnung Primzahl haben.</span><span class="sxs-lookup"><span data-stu-id="b2e82-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="b2e82-109">Obwohl testen, ob eine große Anzahl ist Primzahlen kann eine spürbar Zeit dauern, der Hauptbenutzeroberflächen-Thread nicht unterbrochen wird, indem diese Verzögerung und das Formular werden während der Berechnung reaktionsfähig.</span><span class="sxs-lookup"><span data-stu-id="b2e82-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="b2e82-110">Sie werden ausgeführt, wie viele Berechnungen wie gleichzeitig und selektiv gewünscht ausstehende Berechnungen "Abbrechen".</span><span class="sxs-lookup"><span data-stu-id="b2e82-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="b2e82-111">In dieser exemplarischen Vorgehensweise werden u. a. folgende Aufgaben veranschaulicht:</span><span class="sxs-lookup"><span data-stu-id="b2e82-111">Tasks illustrated in this walkthrough include:</span></span>  
  
-   <span data-ttu-id="b2e82-112">Erstellen der Komponente</span><span class="sxs-lookup"><span data-stu-id="b2e82-112">Creating the Component</span></span>  
  
-   <span data-ttu-id="b2e82-113">Definieren von öffentlichen asynchrone Ereignisse und Delegaten</span><span class="sxs-lookup"><span data-stu-id="b2e82-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
-   <span data-ttu-id="b2e82-114">Definieren von privaten Delegaten</span><span class="sxs-lookup"><span data-stu-id="b2e82-114">Defining Private Delegates</span></span>  
  
-   <span data-ttu-id="b2e82-115">Implementieren öffentliche Ereignisse</span><span class="sxs-lookup"><span data-stu-id="b2e82-115">Implementing Public Events</span></span>  
  
-   <span data-ttu-id="b2e82-116">Implementieren der Abschlussmethode</span><span class="sxs-lookup"><span data-stu-id="b2e82-116">Implementing the Completion Method</span></span>  
  
-   <span data-ttu-id="b2e82-117">Implementieren der Workermethoden</span><span class="sxs-lookup"><span data-stu-id="b2e82-117">Implementing the Worker Methods</span></span>  
  
-   <span data-ttu-id="b2e82-118">Implementieren von Start- und Cancel-Methode</span><span class="sxs-lookup"><span data-stu-id="b2e82-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="b2e82-119">Um den Code in diesem Thema als einzelne Auflistung kopieren zu können, finden Sie unter [wie: implementieren eine Komponente, die das ereignisbasierte asynchrone Muster unterstützt](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="b2e82-119">To copy the code in this topic as a single listing, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="b2e82-120">Erstellen der Komponente</span><span class="sxs-lookup"><span data-stu-id="b2e82-120">Creating the Component</span></span>  
 <span data-ttu-id="b2e82-121">Der erste Schritt ist zum Erstellen der Komponente, die das ereignisbasierte asynchrone Muster implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="b2e82-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
#### <a name="to-create-the-component"></a><span data-ttu-id="b2e82-122">So erstellen Sie die Komponente</span><span class="sxs-lookup"><span data-stu-id="b2e82-122">To create the component</span></span>  
  
-   <span data-ttu-id="b2e82-123">Erstellen Sie eine Klasse namens `PrimeNumberCalculator` von erbt <xref:System.ComponentModel.Component>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="b2e82-124">Definieren von öffentlichen asynchrone Ereignisse und Delegaten</span><span class="sxs-lookup"><span data-stu-id="b2e82-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="b2e82-125">Die Komponente kommuniziert mit Clients mithilfe von Ereignissen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="b2e82-126">Die *MethodName* `Completed` Ereignis benachrichtigt Clients, die bis zum Abschluss einer asynchronen Aufgabe und die *MethodName* `ProgressChanged` Ereignis informiert Clients über den Fortschritt einer asynchronen Aufgabe.</span><span class="sxs-lookup"><span data-stu-id="b2e82-126">The *MethodName*`Completed` event alerts clients to the completion of an asynchronous task, and the *MethodName*`ProgressChanged` event informs clients of the progress of an asynchronous task.</span></span>  
  
#### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="b2e82-127">So definieren Sie asynchrone Ereignisse für Clients der Komponente</span><span class="sxs-lookup"><span data-stu-id="b2e82-127">To define asynchronous events for clients of your component:</span></span>  
  
1.  <span data-ttu-id="b2e82-128">Importieren der <xref:System.Threading?displayProperty=nameWithType> und <xref:System.Collections.Specialized?displayProperty=nameWithType> Namespaces am Anfang der Datei.</span><span class="sxs-lookup"><span data-stu-id="b2e82-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#11)]  
  
2.  <span data-ttu-id="b2e82-129">Bevor Sie die `PrimeNumberCalculator` Klassendefinition, deklarieren von Delegaten für Ereignisse von Status und den Abschluss.</span><span class="sxs-lookup"><span data-stu-id="b2e82-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#7)]  
  
3.  <span data-ttu-id="b2e82-130">In der `PrimeNumberCalculator` Klassendefinition, deklarieren von Ereignissen für die Berichterstattung, Status und den Abschluss an Clients.</span><span class="sxs-lookup"><span data-stu-id="b2e82-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#8)]  
  
4.  <span data-ttu-id="b2e82-131">Nach der `PrimeNumberCalculator` Klassendefinition, leiten Sie die `CalculatePrimeCompletedEventArgs` Klasse für die Berichterstattung im Rahmen jeder Ereignishandler des Clients für die Berechnung der `CalculatePrimeCompleted`.event.</span><span class="sxs-lookup"><span data-stu-id="b2e82-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="b2e82-132">Zusätzlich zu den `AsyncCompletedEventArgs` Eigenschaften, diese Klasse ermöglicht es dem Client, um zu bestimmen, welche Zahl getestet wurde, gibt an, ob eine Primzahl ist und was der erste Divisor ist, wenn es keine Primzahl ist.</span><span class="sxs-lookup"><span data-stu-id="b2e82-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="b2e82-133">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="b2e82-133">Checkpoint</span></span>  
 <span data-ttu-id="b2e82-134">An diesem Punkt können Sie die Komponente zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-134">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="b2e82-135">So testen Sie die Komponente</span><span class="sxs-lookup"><span data-stu-id="b2e82-135">To test your component</span></span>  
  
-   <span data-ttu-id="b2e82-136">Kompilieren Sie die Komponente.</span><span class="sxs-lookup"><span data-stu-id="b2e82-136">Compile the component.</span></span>  
  
     <span data-ttu-id="b2e82-137">Sie erhalten zwei compilerwarnungen:</span><span class="sxs-lookup"><span data-stu-id="b2e82-137">You will receive two compiler warnings:</span></span>  
  
    ```  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="b2e82-138">Diese Warnungen werden im nächsten Abschnitt gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="b2e82-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="b2e82-139">Definieren von privaten Delegaten</span><span class="sxs-lookup"><span data-stu-id="b2e82-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="b2e82-140">Die asynchronen Aspekte der der `PrimeNumberCalculator` Komponente werden intern mit einem speziellen Delegaten genannt implementiert eine <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="b2e82-141">Ein <xref:System.Threading.SendOrPostCallback> stellt eine Rückrufmethode, die auf führt eine <xref:System.Threading.ThreadPool> Thread.</span><span class="sxs-lookup"><span data-stu-id="b2e82-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="b2e82-142">Die Rückrufmethode muss eine Signatur, die einen einzelnen Parameter vom Typ akzeptiert haben <xref:System.Object>, das bedeutet, dass Zustand zwischen Delegaten in einen Wrapperklasse übergeben müssen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="b2e82-143">Weitere Informationen finden Sie unter <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
#### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="b2e82-144">Interne asynchrone Verhalten der Komponente zu implementieren:</span><span class="sxs-lookup"><span data-stu-id="b2e82-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1.  <span data-ttu-id="b2e82-145">Deklarieren und erstellen Sie die <xref:System.Threading.SendOrPostCallback> in delegiert die `PrimeNumberCalculator` Klasse.</span><span class="sxs-lookup"><span data-stu-id="b2e82-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="b2e82-146">Erstellen der <xref:System.Threading.SendOrPostCallback> Objekte in eine Hilfsprogrammmethode, so genannte `InitializeDelegates`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="b2e82-147">Sie benötigen zwei Delegaten: eine für die Statusmeldung an den Client, und eine für die Berichterstattung Abschluss an den Client.</span><span class="sxs-lookup"><span data-stu-id="b2e82-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#20)]  
  
2.  <span data-ttu-id="b2e82-148">Rufen Sie die `InitializeDelegates` -Methode im Konstruktor der Komponente.</span><span class="sxs-lookup"><span data-stu-id="b2e82-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#21)]  
  
3.  <span data-ttu-id="b2e82-149">Deklarieren Sie einen Delegaten in der `PrimeNumberCalculator` -Klasse, die verarbeitet die eigentliche Arbeit, die asynchron ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="b2e82-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="b2e82-150">Dieser Delegat umschließt die Workermethode, die testet, ob eine Zahl eine Primzahl ist.</span><span class="sxs-lookup"><span data-stu-id="b2e82-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="b2e82-151">Nimmt der Delegat einer <xref:System.ComponentModel.AsyncOperation> Parameter, der verwendet wird, um die Lebensdauer eines asynchronen Vorgangs nachzuverfolgen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#22)]  
  
4.  <span data-ttu-id="b2e82-152">Erstellen Sie eine Sammlung für die Verwaltung der Lebensdauer der ausstehende asynchrone Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="b2e82-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="b2e82-153">Der Client benötigt eine Möglichkeit zum Nachverfolgen von Vorgängen verwendet werden kann, wie sie ausgeführt und abgeschlossen werden, und diese Überwachung erfolgt durch, dass der Client ein eindeutiges Token oder ein Task-ID übergeben, wenn der Client die die asynchrone Methode aufruft.</span><span class="sxs-lookup"><span data-stu-id="b2e82-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="b2e82-154">Die `PrimeNumberCalculator` Komponente muss Nachverfolgen von jedem Aufruf vom entsprechenden Aufruf die Task-ID zuordnen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="b2e82-155">Wenn der Client eine Aufgaben-ID übergibt, die nicht eindeutig ist, ist die `PrimeNumberCalculator` Komponente eine Ausnahme ausgelöst werden muss.</span><span class="sxs-lookup"><span data-stu-id="b2e82-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="b2e82-156">Die `PrimeNumberCalculator` Komponente der nachverfolgt Task-ID mithilfe einer speziellen Auflistungsklasse aufgerufen eine <xref:System.Collections.Specialized.HybridDictionary>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="b2e82-157">Erstellen Sie in der Klassendefinition ein <xref:System.Collections.Specialized.HybridDictionary> aufgerufen `userTokenToLifetime`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="b2e82-158">Implementieren öffentliche Ereignisse</span><span class="sxs-lookup"><span data-stu-id="b2e82-158">Implementing Public Events</span></span>  
 <span data-ttu-id="b2e82-159">Komponenten, die das ereignisbasierte asynchrone Muster implementieren, kommunizieren mit Clients mithilfe von Ereignissen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="b2e82-160">Diese Ereignisse werden im entsprechenden Thread anhand des aufgerufen der <xref:System.ComponentModel.AsyncOperation> Klasse.</span><span class="sxs-lookup"><span data-stu-id="b2e82-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
#### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="b2e82-161">Zum Auslösen von Ereignissen für die Komponente Clients:</span><span class="sxs-lookup"><span data-stu-id="b2e82-161">To raise events to your component's clients:</span></span>  
  
1.  <span data-ttu-id="b2e82-162">Implementieren Sie die öffentlichen Ereignisse für die Berichterstattung an Clients.</span><span class="sxs-lookup"><span data-stu-id="b2e82-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="b2e82-163">Sie benötigen ein Ereignis für die Berichterstattung ausgeführt und eine für die Berichterstattung Abschluss.</span><span class="sxs-lookup"><span data-stu-id="b2e82-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="b2e82-164">Implementieren der Abschlussmethode</span><span class="sxs-lookup"><span data-stu-id="b2e82-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="b2e82-165">Die Delegaten für den Abschluss wird die Methode, mit der das zugrunde liegende, Freethread-Verhalten für den asynchronen aufgerufen wird, wenn nach erfolgreichem Abschluss, Fehler oder Abbruch der asynchrone Vorgang beendet.</span><span class="sxs-lookup"><span data-stu-id="b2e82-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="b2e82-166">Dieser Aufruf erfolgt auf einen beliebigen Thread.</span><span class="sxs-lookup"><span data-stu-id="b2e82-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="b2e82-167">Diese Methode ist, in denen der Client-Task-ID aus der internen Auflistung der eindeutigen Clienttokens entfernt wird.</span><span class="sxs-lookup"><span data-stu-id="b2e82-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="b2e82-168">Diese Methode beendet die Lebensdauer für einen bestimmten asynchronen Vorgang auch durch Aufrufen der <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> Methode des entsprechenden <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="b2e82-169">Dieser Aufruf löst das Abschlussereignis in dem Thread, der für das Anwendungsmodell geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="b2e82-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="b2e82-170">Nach der <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> -Methode aufgerufen wird, wird diese Instanz von <xref:System.ComponentModel.AsyncOperation> nicht mehr verwendet werden können, und nachfolgende wird eine Ausnahme auslösen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="b2e82-171">Die `CompletionMethod` Signatur muss alle Zustände enthalten sind, um das Ergebnis des asynchronen Vorgangs zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="b2e82-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="b2e82-172">Er behält den Status für die Zahl, die von dieser bestimmten asynchronen Vorgang getestet wurde, ob die Anzahl Primzahlen und der Wert der ersten Divisors ist, wenn es sich nicht um eine Primzahl ist.</span><span class="sxs-lookup"><span data-stu-id="b2e82-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="b2e82-173">Außerdem enthält Sie alle aufgetretenen Ausnahme, Status und die <xref:System.ComponentModel.AsyncOperation> dieser bestimmten Aufgabe entspricht.</span><span class="sxs-lookup"><span data-stu-id="b2e82-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
#### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="b2e82-174">So schließen Sie einen asynchronen Vorgang ab:</span><span class="sxs-lookup"><span data-stu-id="b2e82-174">To complete an asynchronous operation:</span></span>  
  
-   <span data-ttu-id="b2e82-175">Implementieren Sie die Abschlussmethode.</span><span class="sxs-lookup"><span data-stu-id="b2e82-175">Implement the completion method.</span></span> <span data-ttu-id="b2e82-176">Dauert die sechs Parameter an, die verwendet wird, zum Auffüllen einer `CalculatePrimeCompletedEventArgs` an den Client über des Clients zurückgegebenen `CalculatePrimeCompletedEventHandler`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="b2e82-177">Task-ID-Token des Clients aus der internen Auflistung entfernt, und beendet den asynchronen Vorgang Lebensdauer mit einem Aufruf von <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="b2e82-178">Die <xref:System.ComponentModel.AsyncOperation> marshallt den Aufruf an den Thread oder Kontext, der für das Anwendungsmodell geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="b2e82-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="b2e82-179">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="b2e82-179">Checkpoint</span></span>  
 <span data-ttu-id="b2e82-180">An diesem Punkt können Sie die Komponente zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-180">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="b2e82-181">So testen Sie die Komponente</span><span class="sxs-lookup"><span data-stu-id="b2e82-181">To test your component</span></span>  
  
-   <span data-ttu-id="b2e82-182">Kompilieren Sie die Komponente.</span><span class="sxs-lookup"><span data-stu-id="b2e82-182">Compile the component.</span></span>  
  
     <span data-ttu-id="b2e82-183">Sie erhalten eine compilerwarnung:</span><span class="sxs-lookup"><span data-stu-id="b2e82-183">You will receive one compiler warning:</span></span>  
  
    ```  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="b2e82-184">Diese Warnung wird im nächsten Abschnitt aufgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="b2e82-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="b2e82-185">Implementieren der Workermethoden</span><span class="sxs-lookup"><span data-stu-id="b2e82-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="b2e82-186">Sie haben bisher implementiert den unterstützenden asynchronen Code für die `PrimeNumberCalculator` Komponente.</span><span class="sxs-lookup"><span data-stu-id="b2e82-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="b2e82-187">Jetzt können Sie den Code zu implementieren, der die eigentliche Arbeit übernimmt.</span><span class="sxs-lookup"><span data-stu-id="b2e82-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="b2e82-188">Implementieren Sie drei Methoden: `CalculateWorker`, `BuildPrimeNumberList`, und `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="b2e82-189">Zusammen `BuildPrimeNumberList` und `IsPrime` bilden einen bekannten Algorithmus die Sieb des Eratosthenes, mit der bestimmt, ob eine Zahl eine Primzahl ist durch die Primzahlen bis die Quadratwurzel der Anzahl der Tests zu suchen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="b2e82-190">Wenn keine Teiler von diesem Punkt gefunden werden, ist die Anzahl der Tests eine Primzahl.</span><span class="sxs-lookup"><span data-stu-id="b2e82-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="b2e82-191">Wenn diese Komponente für maximaler Effizienz geschrieben wurden, würde es alle die von verschiedenen Aufrufe für viele verschiedene ermittelt Primzahlen Denken Sie daran.</span><span class="sxs-lookup"><span data-stu-id="b2e82-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="b2e82-192">Sie würden auch für triviale Teiler z. B. 2, 3 und 5 überprüfen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="b2e82-193">Der Zweck dieses Beispiels wird veranschaulicht wie zeitaufwändige Operationen können asynchron ausgeführt, allerdings damit diese Optimierungen für Sie als Übung übrig sind.</span><span class="sxs-lookup"><span data-stu-id="b2e82-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="b2e82-194">Die `CalculateWorker` Methode wird in einem Delegaten umschlossen und mit einem Aufruf von asynchron aufgerufen `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="b2e82-195">Fortschrittsberichterstattung implementiert wird, der `BuildPrimeNumberList` Methode.</span><span class="sxs-lookup"><span data-stu-id="b2e82-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="b2e82-196">Auf schnellen Computern `ProgressChanged` Ereignisse können in schneller Folge ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="b2e82-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="b2e82-197">Der Client-Thread, auf dem diese Ereignisse ausgelöst werden, muss diese Situation zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="b2e82-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="b2e82-198">Code für die Benutzeroberfläche mit Nachrichten überflutet und kann nicht rechtzeitig verarbeitet, möglicherweise hängenden Verhalten führt.</span><span class="sxs-lookup"><span data-stu-id="b2e82-198">User interface code may be flooded with messages and unable to keep up, resulting in hanging behavior.</span></span> <span data-ttu-id="b2e82-199">Eine Beispiel-Benutzeroberfläche, die diese Situation behandelt, finden Sie unter [Vorgehensweise: Implementieren eines Clients des ereignisbasierten asynchronen Musters](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="b2e82-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
#### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="b2e82-200">Um die Berechnung Primzahl asynchron ausgeführt werden soll:</span><span class="sxs-lookup"><span data-stu-id="b2e82-200">To execute the prime number calculation asynchronously:</span></span>  
  
1.  <span data-ttu-id="b2e82-201">Implementieren der `TaskCanceled` Utility-Methode.</span><span class="sxs-lookup"><span data-stu-id="b2e82-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="b2e82-202">Dies überprüft die Auflistung der Lebensdauer für die angegebene Aufgaben-ID und gibt `true` Wenn Task-ID nicht gefunden wird.</span><span class="sxs-lookup"><span data-stu-id="b2e82-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#32)]  
  
2.  <span data-ttu-id="b2e82-203">Implementieren Sie die `CalculateWorker`-Methode.</span><span class="sxs-lookup"><span data-stu-id="b2e82-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="b2e82-204">Es werden zwei Parameter: eine Zahl ein, um zu testen, und eine <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#27)]  
  
3.  <span data-ttu-id="b2e82-205">Implementieren Sie `BuildPrimeNumberList`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="b2e82-206">Es werden zwei Parameter: die Anzahl der zu testen, und ein <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="b2e82-207">Er verwendet die <xref:System.ComponentModel.AsyncOperation> zum Fortschritt und inkrementelle Ergebnisse.</span><span class="sxs-lookup"><span data-stu-id="b2e82-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="b2e82-208">Dadurch wird sichergestellt, dass die Ereignishandler des Clients auf den richtigen Thread oder Kontext Anwendungsmodells aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="b2e82-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="b2e82-209">Wenn `BuildPrimeNumberList` eine Primzahl findet, es meldet dies als inkrementelle Ergebnis an den Client-Ereignishandler für das `ProgressChanged` Ereignis.</span><span class="sxs-lookup"><span data-stu-id="b2e82-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="b2e82-210">Dies erfordert, dass eine Klasse abgeleitet <xref:System.ComponentModel.ProgressChangedEventArgs>namens `CalculatePrimeProgressChangedEventArgs`, die über eine hinzugefügte Eigenschaft mit dem Namen `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="b2e82-211">Die `BuildPrimeNumberList` Methodenaufrufe in regelmäßigen Abständen die `TaskCanceled` -Methode und wird beendet, wenn die-Methode zurückgibt `true`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#5)]  
  
4.  <span data-ttu-id="b2e82-212">Implementieren Sie `IsPrime`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-212">Implement `IsPrime`.</span></span> <span data-ttu-id="b2e82-213">Es verwendet drei Parameter: eine Liste der bekannten Primzahlen, die Anzahl der zu testen und ein Output-Parameter für den ersten gefundenen Divisor.</span><span class="sxs-lookup"><span data-stu-id="b2e82-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="b2e82-214">Wenn Sie die Liste der Primzahlen, bestimmt, ob die Anzahl der Tests eine Primzahl ist.</span><span class="sxs-lookup"><span data-stu-id="b2e82-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#28)]  
  
5.  <span data-ttu-id="b2e82-215">Leiten Sie `CalculatePrimeProgressChangedEventArgs` aus <xref:System.ComponentModel.ProgressChangedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="b2e82-216">Diese Klasse ist notwendig, damit der Client-Ereignishandler für inkrementelle Ergebnisse meldet die `ProgressChanged` Ereignis.</span><span class="sxs-lookup"><span data-stu-id="b2e82-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="b2e82-217">Es wurde eine zusätzliche Eigenschaft mit dem Namen `LatestPrimeNumber`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="b2e82-218">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="b2e82-218">Checkpoint</span></span>  
 <span data-ttu-id="b2e82-219">An diesem Punkt können Sie die Komponente zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-219">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="b2e82-220">So testen Sie die Komponente</span><span class="sxs-lookup"><span data-stu-id="b2e82-220">To test your component</span></span>  
  
-   <span data-ttu-id="b2e82-221">Kompilieren Sie die Komponente.</span><span class="sxs-lookup"><span data-stu-id="b2e82-221">Compile the component.</span></span>  
  
     <span data-ttu-id="b2e82-222">Alle bleibt zu schreibenden sind die Methoden zum Starten und Abbrechen von asynchronen Operationen `CalculatePrimeAsync` und `CancelAsync`.</span><span class="sxs-lookup"><span data-stu-id="b2e82-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="b2e82-223">Implementieren die Start- und Cancel-Methode</span><span class="sxs-lookup"><span data-stu-id="b2e82-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="b2e82-224">Sie starten die Workermethode in einem eigenen Thread, durch den Aufruf `BeginInvoke` für den Delegaten, der ihn umschließt.</span><span class="sxs-lookup"><span data-stu-id="b2e82-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="b2e82-225">Rufen Sie zum Verwalten der Lebensdauer für einen bestimmten asynchronen Vorgang, der <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> Methode für die <xref:System.ComponentModel.AsyncOperationManager> Hilfsklasse.</span><span class="sxs-lookup"><span data-stu-id="b2e82-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="b2e82-226">Dies gibt eine <xref:System.ComponentModel.AsyncOperation>, die Aufrufe an die Ereignishandler des Clients an den richtigen Thread oder Kontext gemarshallt.</span><span class="sxs-lookup"><span data-stu-id="b2e82-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="b2e82-227">"Abbrechen" eine bestimmte ausstehenden Vorgang durch Aufrufen von <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> auf das entsprechende <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="b2e82-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="b2e82-228">Damit wird beendet, diesen Vorgang und alle nachfolgenden Aufrufe der <xref:System.ComponentModel.AsyncOperation> wird eine Ausnahme ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="b2e82-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
#### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="b2e82-229">Zu Anfang zu implementieren und Cancel-Funktion:</span><span class="sxs-lookup"><span data-stu-id="b2e82-229">To implement Start and Cancel functionality:</span></span>  
  
1.  <span data-ttu-id="b2e82-230">Implementieren Sie die `CalculatePrimeAsync`-Methode.</span><span class="sxs-lookup"><span data-stu-id="b2e82-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="b2e82-231">Stellen Sie sicher, dass der Client bereitgestellte Token (Task-ID) in Bezug auf alle Tokens der derzeit ausstehenden Aufgaben eindeutig ist.</span><span class="sxs-lookup"><span data-stu-id="b2e82-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="b2e82-232">Wenn der Client ein nicht eindeutiges Token übergibt `CalculatePrimeAsync` löst eine Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="b2e82-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="b2e82-233">Andernfalls wird das Token die Task-ID-Sammlung hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="b2e82-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#3)]  
  
2.  <span data-ttu-id="b2e82-234">Implementieren Sie die `CancelAsync`-Methode.</span><span class="sxs-lookup"><span data-stu-id="b2e82-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="b2e82-235">Wenn die `taskId` Parameter in der token-Auflistung vorhanden ist, wird es entfernt.</span><span class="sxs-lookup"><span data-stu-id="b2e82-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="b2e82-236">Dies verhindert, dass abgebrochene Aufgaben, die Ausführung nicht gestartet wurden.</span><span class="sxs-lookup"><span data-stu-id="b2e82-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="b2e82-237">Wenn der Task ausgeführt wird, die `BuildPrimeNumberList` Methode beendet wird, wenn er erkennt, dass die Aufgaben-ID aus der Auflistung der Lebensdauer entfernt wurde.</span><span class="sxs-lookup"><span data-stu-id="b2e82-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="b2e82-238">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="b2e82-238">Checkpoint</span></span>  
 <span data-ttu-id="b2e82-239">An diesem Punkt können Sie die Komponente zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="b2e82-239">At this point, you can build the component.</span></span>  
  
#### <a name="to-test-your-component"></a><span data-ttu-id="b2e82-240">So testen Sie die Komponente</span><span class="sxs-lookup"><span data-stu-id="b2e82-240">To test your component</span></span>  
  
-   <span data-ttu-id="b2e82-241">Kompilieren Sie die Komponente.</span><span class="sxs-lookup"><span data-stu-id="b2e82-241">Compile the component.</span></span>  
  
 <span data-ttu-id="b2e82-242">Die `PrimeNumberCalculator` Komponente ist jetzt vollständig und einsatzbereit.</span><span class="sxs-lookup"><span data-stu-id="b2e82-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="b2e82-243">Ein Beispiel für einen Client, der verwendet die `PrimeNumberCalculator` Komponente finden Sie unter [Vorgehensweise: Implementieren eines Clients des ereignisbasierten asynchronen Musters](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="b2e82-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="b2e82-244">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="b2e82-244">Next Steps</span></span>  
 <span data-ttu-id="b2e82-245">In diesem Beispiel füllen, indem Sie schreiben `CalculatePrime`, das Äquivalent zu synchronen `CalculatePrimeAsync` Methode.</span><span class="sxs-lookup"><span data-stu-id="b2e82-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="b2e82-246">Dies veranlasst den `PrimeNumberCalculator` Komponente vollständig kompatibel mit dem ereignisbasierten asynchronen Muster.</span><span class="sxs-lookup"><span data-stu-id="b2e82-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="b2e82-247">Sie können in diesem Beispiel verbessern, indem Sie die Liste der alle von der verschiedenen Aufrufe für viele verschiedene ermittelt Primzahlen beibehalten.</span><span class="sxs-lookup"><span data-stu-id="b2e82-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="b2e82-248">Bei dieser Vorgehensweise profitieren jede Aufgabe von der Arbeit, die von vorherigen Tasks.</span><span class="sxs-lookup"><span data-stu-id="b2e82-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="b2e82-249">Achten Sie darauf, dass Sie diese Liste mit Schutz `lock` Regionen, damit der Zugriff auf die Liste von verschiedenen Threads serialisiert wird.</span><span class="sxs-lookup"><span data-stu-id="b2e82-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="b2e82-250">Sie können auch in diesem Beispiel verbessern, indem Sie Tests für triviale Teiler, z. B. 2, 3 und 5.</span><span class="sxs-lookup"><span data-stu-id="b2e82-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b2e82-251">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="b2e82-251">See Also</span></span>  
 [<span data-ttu-id="b2e82-252">Gewusst wie: Ausführen eines Vorgangs im Hintergrund</span><span class="sxs-lookup"><span data-stu-id="b2e82-252">How to: Run an Operation in the Background</span></span>](../../../docs/framework/winforms/controls/how-to-run-an-operation-in-the-background.md)  
 [<span data-ttu-id="b2e82-253">Event-based Asynchronous Pattern Overview (Übersicht über ereignisbasierte asynchrone Muster)</span><span class="sxs-lookup"><span data-stu-id="b2e82-253">Event-based Asynchronous Pattern Overview</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)  
 [<span data-ttu-id="b2e82-254">NICHT im BUILD: Multithreading in Visual Basic</span><span class="sxs-lookup"><span data-stu-id="b2e82-254">NOT IN BUILD: Multithreading in Visual Basic</span></span>](http://msdn.microsoft.com/en-us/c731a50c-09c1-4468-9646-54c86b75d269)  
 [<span data-ttu-id="b2e82-255">Gewusst wie: Implementieren einer Komponente, die das ereignisbasierte asynchrone Muster unterstützt</span><span class="sxs-lookup"><span data-stu-id="b2e82-255">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)  
 [<span data-ttu-id="b2e82-256">Multithreadprogrammierung mit dem ereignisbasierten asynchronen Muster</span><span class="sxs-lookup"><span data-stu-id="b2e82-256">Multithreaded Programming with the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/multithreaded-programming-with-the-event-based-asynchronous-pattern.md)
