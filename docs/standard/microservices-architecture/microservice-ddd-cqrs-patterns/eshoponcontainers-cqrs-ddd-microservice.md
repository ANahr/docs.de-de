---
title: Anwenden von CQRS- und CQS-Ansätzen in einem DDD-Microservice in eShopOnContainers
description: .NET-Microservicesarchitektur für .NET-Containeranwendungen | Anwenden von CQRS- und CQS-Ansätzen in einem DDD-Microservice in eShopOnContainers
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 6be8b52f42e3e37ff03e561af45c46f4dd283d9e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 05/04/2018
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="7ec98-103">Anwenden von CQRS- und CQS-Ansätzen in einem DDD-Microservice in eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="7ec98-103">Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="7ec98-104">Die Struktur des Microservices für Bestellungen in der Referenzanwendung „eShopOnContainers“ basiert auf CQRS-Prinzipien.</span><span class="sxs-lookup"><span data-stu-id="7ec98-104">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="7ec98-105">Allerdings wird darin der einfachste Ansatz verwendet, bei dem Abfragen von Befehlen getrennt werden und dieselbe Datenbank für beide Aktionen dient.</span><span class="sxs-lookup"><span data-stu-id="7ec98-105">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="7ec98-106">Das Wichtigste daran ist, dass Abfragen idempotent sind: Egal wie oft Sie ein System abfragen, der Zustand des Systems ändert sich nicht, selbst wenn Sie ein anderes Datenmodell für Lesevorgänge verwenden als das Domänenmodell für Schreibvorgänge der Transaktionslogik, obwohl der Microservice für Bestellungen dieselbe Datenbank verwendet.</span><span class="sxs-lookup"><span data-stu-id="7ec98-106">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system will not change You could even use a different “reads” data model than the transactional logic “writes” domain model, although the ordering microservices is using the same database.</span></span> <span data-ttu-id="7ec98-107">Daher ist es ein vereinfachter CQRS-Ansatz.</span><span class="sxs-lookup"><span data-stu-id="7ec98-107">Hence this is a simplified CQRS approach.</span></span>

<span data-ttu-id="7ec98-108">Befehle, die Transaktionen und Datenupdates auslösen, ändern wiederum den Zustand im System.</span><span class="sxs-lookup"><span data-stu-id="7ec98-108">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="7ec98-109">Mit Befehlen müssen Sie im Zusammenhang mit Komplexität und sich kontinuierlich ändernden Geschäftsregeln sorgfältig umgehen.</span><span class="sxs-lookup"><span data-stu-id="7ec98-109">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="7ec98-110">An dieser Stelle können Sie DDD-Techniken anwenden, um das System besser zu modellieren.</span><span class="sxs-lookup"><span data-stu-id="7ec98-110">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="7ec98-111">Die in diesem Leitfaden vorgestellten DDD-Muster sollten nicht universell angewendet werden,</span><span class="sxs-lookup"><span data-stu-id="7ec98-111">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="7ec98-112">denn sie wirken sich negativ auf Ihren Entwurf aus.</span><span class="sxs-lookup"><span data-stu-id="7ec98-112">They introduce constraints on your design.</span></span> <span data-ttu-id="7ec98-113">Diese Einschränkungen haben zwar Vorteile wie höhere Qualität im Laufe der Zeit, vor allem bei Befehlen und anderen Codezeilen, die den Systemstatus ändern,</span><span class="sxs-lookup"><span data-stu-id="7ec98-113">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="7ec98-114">erhöhen jedoch auch die Komplexität, was Nachteile für das Lesen und Abfragen von Daten hat.</span><span class="sxs-lookup"><span data-stu-id="7ec98-114">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="7ec98-115">Ein solches Muster ist das Aggregatmuster, das wir in späteren Abschnitten kennenlernen.</span><span class="sxs-lookup"><span data-stu-id="7ec98-115">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="7ec98-116">Beim Aggregatmuster werden viele Domänenobjekte aufgrund ihrer Beziehung zur Domäne als eine einzelne Einheit behandelt.</span><span class="sxs-lookup"><span data-stu-id="7ec98-116">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="7ec98-117">In Abfragen ist dieses Muster nicht immer vorteilhaft, da es die Komplexität der Abfragelogik verkomplizieren kann.</span><span class="sxs-lookup"><span data-stu-id="7ec98-117">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="7ec98-118">Bei schreibgeschützten Abfragen werden viele Objekte nicht als einzelnes Aggregat behandelt.</span><span class="sxs-lookup"><span data-stu-id="7ec98-118">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="7ec98-119">In diesem Fall erhöht sich nur die Komplexität.</span><span class="sxs-lookup"><span data-stu-id="7ec98-119">You only get the complexity.</span></span>

<span data-ttu-id="7ec98-120">Wie in Abbildung 9-2 dargestellt, empfiehlt dieser Leitfaden, DDD-Muster nur im Bereich der Transaktionen/Updates Ihres Microservices zu verwenden, d.h. in dem Bereich, in dem Befehle ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="7ec98-120">As shown in Figure 9-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="7ec98-121">Abfragen können einem einfacheren Ansatz folgen und sollten im Sinne des CQRS-Ansatzes von Befehlen getrennt werden.</span><span class="sxs-lookup"><span data-stu-id="7ec98-121">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="7ec98-122">Bei der Implementierung der Abfrageseite können Sie zwischen vielen Ansätzen wählen, z.B. ein vollständiger ORM wie EF Core, AutoMapper-Projektionen, gespeicherte Prozeduren, Ansichten, materialisierte Sichten oder ein Mikro-ORM.</span><span class="sxs-lookup"><span data-stu-id="7ec98-122">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="7ec98-123">In diesem Leitfaden und in eShopOnContainers (insbesondere beim Microservice für Bestellungen) implementieren wir direkte Abfragen mit dem Mikro-ORM [Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="7ec98-123">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="7ec98-124">So können Sie jede Abfrage auf SQL-Anweisungen basierend implementieren, um aufgrund des schlanken Frameworks mit äußerst wenig Mehraufwand eine optimale Leistung zu erzielen.</span><span class="sxs-lookup"><span data-stu-id="7ec98-124">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="7ec98-125">Hinweis: Wenn Sie so vorgehen, erfordern alle Updates für das Modell, die in einer SQL-Datenbank aufbewahrt werden, auch separate Updates für SQL-Abfragen, die von Dapper oder anderen Abfrageansätzen (nicht EF) verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7ec98-125">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="7ec98-126">CQRS und DDD-Muster sind keine Architekturen oberster Ebene</span><span class="sxs-lookup"><span data-stu-id="7ec98-126">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="7ec98-127">CQRS und die meisten DDD-Muster (z.B. DDD-Ebenen oder ein Domänenmodell mit Aggregaten) sind keine Architekturstile, sondern nur Architekturmuster.</span><span class="sxs-lookup"><span data-stu-id="7ec98-127">It important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="7ec98-128">Microservices, SOA und ereignisgesteuerte Architekturen (Event-Driven Architecture, EDA) sind Beispiele für Architekturstile,</span><span class="sxs-lookup"><span data-stu-id="7ec98-128">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="7ec98-129">denn Sie beschreiben ein System mit vielen Komponenten, z.B. viele Microservices.</span><span class="sxs-lookup"><span data-stu-id="7ec98-129">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="7ec98-130">CQRS und DDD-Muster beschreiben etwas innerhalb eines einzelnen Systems oder einer einzelnen Komponente, in diesem Fall etwas in einem Microservice.</span><span class="sxs-lookup"><span data-stu-id="7ec98-130">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="7ec98-131">Unterschiedliche Kontextgrenzen (Bounded Contexts, BCs) wenden außerdem verschiedene Muster an.</span><span class="sxs-lookup"><span data-stu-id="7ec98-131">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="7ec98-132">Sie haben unterschiedliche Aufgaben, und das führt häufig zu unterschiedlichen Lösungen.</span><span class="sxs-lookup"><span data-stu-id="7ec98-132">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="7ec98-133">Wenn überall dasselbe Muster erzwungen wird, führt das jedoch zu einem Fehler.</span><span class="sxs-lookup"><span data-stu-id="7ec98-133">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="7ec98-134">Daher sollten Sie dies auf keinen Fall tun.</span><span class="sxs-lookup"><span data-stu-id="7ec98-134">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="7ec98-135">Viele Teilsysteme, BCs oder Microservices sind einfacher und können leichter mithilfe einfacher CRUD-Dienste oder einer anderen Lösung implementiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="7ec98-135">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="7ec98-136">Es gibt nur eine Anwendungsarchitektur: die Architektur der System- oder der End-to-End-Anwendung, die Sie gerade entwerfen (z.B. die Microservicesarchitektur).</span><span class="sxs-lookup"><span data-stu-id="7ec98-136">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="7ec98-137">Der Entwurf der einzelnen Kontextgrenzen oder Microservices in dieser Anwendung spiegelt die eigenen Vor-und Nachteile und die interne Entwurfsentscheidungen auf Ebene der Musterarchitektur wider.</span><span class="sxs-lookup"><span data-stu-id="7ec98-137">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="7ec98-138">Wenden Sie auf keinen Fall überall dieselben Architekturmuster wie CQRS oder DDD an.</span><span class="sxs-lookup"><span data-stu-id="7ec98-138">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

####  <a name="additional-resources"></a><span data-ttu-id="7ec98-139">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="7ec98-139">Additional resources</span></span>

-   <span data-ttu-id="7ec98-140">**Martin Fowler. CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="7ec98-140">**Martin Fowler. CQRS**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="7ec98-141">**Greg Young. CQS vs. CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span><span class="sxs-lookup"><span data-stu-id="7ec98-141">**Greg Young. CQS vs. CQRS**
[*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span></span>

-   <span data-ttu-id="7ec98-142">**Greg Young. CQRS-Dokumente**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span><span class="sxs-lookup"><span data-stu-id="7ec98-142">**Greg Young. CQRS Documents**
[*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span></span>

-   <span data-ttu-id="7ec98-143">**Greg Young. CQRS, aufgabenbasierte Benutzeroberflächen und Event Sourcing**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span><span class="sxs-lookup"><span data-stu-id="7ec98-143">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
[*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span></span>

-   <span data-ttu-id="7ec98-144">**Udi Dahan. Clarified CQRS (Erläuterung zu CQRS)**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="7ec98-144">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="7ec98-145">**CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="7ec98-145">**CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="7ec98-146">**Event Sourcing**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span><span class="sxs-lookup"><span data-stu-id="7ec98-146">**Event-Sourcing (ES)**
[*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="7ec98-147">[Zurück] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Weiter] (cqrs-microservice-reads.md)</span><span class="sxs-lookup"><span data-stu-id="7ec98-147">[Previous] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Next] (cqrs-microservice-reads.md)</span></span>
