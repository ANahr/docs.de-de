---
title: Herausforderungen und Lösungen für die verteilte Datenverwaltung
description: .NET-Microservices-Architektur für .NET-Containeranwendungen | Herausforderungen und Lösungen für die verteilte Datenverwaltung
keywords: Docker, Microservices, ASP.NET, Container
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: a26f4243acee52e493a10f13ff18899823fd03ba
ms.sourcegitcommit: 2e8acae16ae802f2d6d04e3ce0a6dbf04e476513
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 04/18/2018
---
# <a name="challenges-and-solutions-for-distributed-data-management"></a><span data-ttu-id="7d909-104">Herausforderungen und Lösungen für die verteilte Datenverwaltung</span><span class="sxs-lookup"><span data-stu-id="7d909-104">Challenges and solutions for distributed data management</span></span>

## <a name="challenge-1-how-to-define-the-boundaries-of-each-microservice"></a><span data-ttu-id="7d909-105">Herausforderung \#1: Definieren der Grenzen der einzelnen Microservices</span><span class="sxs-lookup"><span data-stu-id="7d909-105">Challenge \#1: How to define the boundaries of each microservice</span></span>

<span data-ttu-id="7d909-106">Das Definieren der Grenzen der Microservices stellt wahrscheinlich für jedermann die erste Herausforderung dar.</span><span class="sxs-lookup"><span data-stu-id="7d909-106">Defining microservice boundaries is probably the first challenge anyone encounters.</span></span> <span data-ttu-id="7d909-107">Jeder Microservice muss ein Teil Ihrer Anwendung sein, sollte aber einschließlich all seiner Vor- und Nachteile autonom sein.</span><span class="sxs-lookup"><span data-stu-id="7d909-107">Each microservice has to be a piece of your application and each microservice should be autonomous with all the benefits and challenges that it conveys.</span></span> <span data-ttu-id="7d909-108">Aber wie erkennen Sie diese Grenzen?</span><span class="sxs-lookup"><span data-stu-id="7d909-108">But how do you identify those boundaries?</span></span>

<span data-ttu-id="7d909-109">Zunächst müssen Sie sich auf die logischen Domänenmodelle der Anwendung und die zugehörigen Daten konzentrieren.</span><span class="sxs-lookup"><span data-stu-id="7d909-109">First, you need to focus on the application’s logical domain models and related data.</span></span> <span data-ttu-id="7d909-110">Sie müssen versuchen, entkoppelte Daten-Inseln und unterschiedliche Kontexte innerhalb einer Anwendung zu identifizieren.</span><span class="sxs-lookup"><span data-stu-id="7d909-110">You must try to identify decoupled islands of data and different contexts within the same application.</span></span> <span data-ttu-id="7d909-111">Jeder Kontext weist möglicherweise eine andere Geschäftssprache (unterschiedliche Geschäftsbegriffe) auf.</span><span class="sxs-lookup"><span data-stu-id="7d909-111">Each context could have a different business language (different business terms).</span></span> <span data-ttu-id="7d909-112">Die Kontexte sollten unabhängig voneinander definiert und verwaltet werden.</span><span class="sxs-lookup"><span data-stu-id="7d909-112">The contexts should be defined and managed independently.</span></span> <span data-ttu-id="7d909-113">Die in diesen unterschiedlichen Kontexten verwendeten Begriffe und Entitäten klingen unter Umständen ähnlich, aber Sie werden vermutlich feststellen, dass ein Geschäftskonzept in einem bestimmten Kontext für einen anderen Zweck verwendet wird als in einem anderen Kontext und möglicherweise auch einen anderen Namen aufweist.</span><span class="sxs-lookup"><span data-stu-id="7d909-113">The terms and entities used in those different contexts might sound similar, but you might discover that in a particular context, a business concept with one is used for a different purpose in another context, and might even have a different name.</span></span> <span data-ttu-id="7d909-114">Ein Benutzer kann beispielsweise im Kontext Identität oder Mitgliedschaft als Benutzer, im Kontext CRM als Kunde und in einem Bestellkontext als Käufer bezeichnet werden usw.</span><span class="sxs-lookup"><span data-stu-id="7d909-114">For instance, a user can be referred as a user in the identity or membership context, as a customer in a CRM context, as a buyer in an ordering context, and so forth.</span></span>

<span data-ttu-id="7d909-115">Die Methode, mit der Sie Grenzen zwischen mehreren Anwendungskontexten mit einer unterschiedlichen Domäne pro Kontext ermitteln, ist dieselbe Methode, mit der Sie auch die Grenzen für die einzelnen Unternehmensmicroservices und deren zugehörige Domänenmodelle und Daten ermitteln.</span><span class="sxs-lookup"><span data-stu-id="7d909-115">The way you identify boundaries between multiple application contexts with a different domain for each context is exactly how you can identify the boundaries for each business microservice and its related domain model and data.</span></span> <span data-ttu-id="7d909-116">Sie versuchen stets, die Kopplung zwischen diesen Microservices zu minimieren.</span><span class="sxs-lookup"><span data-stu-id="7d909-116">You always attempt to minimize the coupling between those microservices.</span></span> <span data-ttu-id="7d909-117">Dieser Leitfaden befasst sich in seinem nachstehenden Abschnitt [Identifying domain-model boundaries for each microservice (Identifizieren von Domänenmodell-Grenzen für jeden Microservice)](#identifying-domain-model-boundaries-for-each-microservice) eingehender mit dieser Identifizierung und dem Domänenmodell-Entwurf.</span><span class="sxs-lookup"><span data-stu-id="7d909-117">This guide goes into more detail about this identification and domain model design in the section [Identifying domain-model boundaries for each microservice](#identifying-domain-model-boundaries-for-each-microservice) later.</span></span>

## <a name="challenge-2-how-to-create-queries-that-retrieve-data-from-several-microservices"></a><span data-ttu-id="7d909-118">Herausforderung \#2: Erstellen von Abfragen, die Daten aus mehreren Microservices abrufen</span><span class="sxs-lookup"><span data-stu-id="7d909-118">Challenge \#2: How to create queries that retrieve data from several microservices</span></span>

<span data-ttu-id="7d909-119">Eine zweite Herausforderung besteht darin, Abfragen zu implementieren, die Daten aus mehreren Microservices abrufen, und dabei gleichzeitig eine übermäßige Kommunikation von Remoteclient-Apps zu den Microservices zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="7d909-119">A second challenge is how to implement queries that retrieve data from several microservices, while avoiding chatty communication to the microservices from remote client apps.</span></span> <span data-ttu-id="7d909-120">Ein Beispiel hierfür ist ein einzelner Bildschirm einer mobilen App, auf der Benutzerinformationen angezeigt werden müssen, die den Microservices Warenkorb, Katalog und Benutzeridentität gehören.</span><span class="sxs-lookup"><span data-stu-id="7d909-120">An example could be a single screen from a mobile app that needs to show user information that is owned by the basket, catalog, and user identity microservices.</span></span> <span data-ttu-id="7d909-121">Ein weiteres Beispiel wäre ein komplexer Bericht, der zahlreiche Tabellen umfasst, die sich in mehreren Microservices befinden.</span><span class="sxs-lookup"><span data-stu-id="7d909-121">Another example would be a complex report involving many tables located in multiple microservices.</span></span> <span data-ttu-id="7d909-122">Die richtige Lösung hängt von der Komplexität der Abfragen ab.</span><span class="sxs-lookup"><span data-stu-id="7d909-122">The right solution depends on the complexity of the queries.</span></span> <span data-ttu-id="7d909-123">Sie benötigen jedoch in jedem Fall eine Möglichkeit, Informationen zu aggregieren, wenn Sie die Kommunikation Ihres Systems effizienter gestalten wollen.</span><span class="sxs-lookup"><span data-stu-id="7d909-123">But in any case, you will need a way to aggregate information if you want to improve the efficiency in the communications of your system.</span></span> <span data-ttu-id="7d909-124">Am häufigsten kommen dabei die nachstehenden Lösungen zur Anwendung.</span><span class="sxs-lookup"><span data-stu-id="7d909-124">The most popular solutions are the following.</span></span>

<span data-ttu-id="7d909-125">**API-Gateway**.</span><span class="sxs-lookup"><span data-stu-id="7d909-125">**API Gateway**.</span></span> <span data-ttu-id="7d909-126">Für eine einfache Datenaggregation aus mehreren Microservices, die verschiedene Datenbanken besitzen, besteht die empfohlene Vorgehensweise in einem Aggregations-Microservice, der als API-Gateway bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="7d909-126">For simple data aggregation from multiple microservices that own different databases, the recommended approach is an aggregation microservice referred to as an API Gateway.</span></span> <span data-ttu-id="7d909-127">Allerdings müssen Sie bei der Implementierung dieses Musters vorsichtig sein, da es zu einem Engpass in Ihrem System führen und gegen den Grundsatz der Autonomie der Microservices verstoßen kann.</span><span class="sxs-lookup"><span data-stu-id="7d909-127">However, you need to be careful about implementing this pattern, because it can be a choke point in your system, and it can violate the principle of microservice autonomy.</span></span> <span data-ttu-id="7d909-128">Um dieses Risiko zu mindern, können Sie mehrere abgestimmte API-Gateways verwenden, die sich jeweils auf ein vertikales „Segment“ bzw. einen Geschäftsbereich des Systems konzentrieren.</span><span class="sxs-lookup"><span data-stu-id="7d909-128">To mitigate this possibility, you can have multiple fined-grained API Gateways each one focusing on a vertical “slice” or business area of the system.</span></span> <span data-ttu-id="7d909-129">Das API-Gateway-Muster wird weiter unten im Abschnitt über die Verwendung eines API-Gateways ausführlicher erläutert.</span><span class="sxs-lookup"><span data-stu-id="7d909-129">The API Gateway pattern is explained in more detail in the section in the Using an API Gateway later.</span></span>

<span data-ttu-id="7d909-130">**CQRS mit Abfrage-/Lesetabellen**.</span><span class="sxs-lookup"><span data-stu-id="7d909-130">**CQRS with query/reads tables**.</span></span> <span data-ttu-id="7d909-131">Eine weitere Lösung für das Aggregieren von Daten aus mehreren Microservices ist das [Muster für materialisierte Sichten](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span><span class="sxs-lookup"><span data-stu-id="7d909-131">Another solution for aggregating data from multiple microservices is the [Materialized View pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="7d909-132">Bei diesem Ansatz generieren Sie vorab eine schreibgeschützte Tabelle mit den Daten, die mehreren Microservices gehören (d.h. Sie bereiten bereits vor den eigentlichen Abfragen denormalisierte Daten vor).</span><span class="sxs-lookup"><span data-stu-id="7d909-132">In this approach, you generate, in advance (prepare denormalized data before the actual queries happen), a read-only table with the data that is owned by multiple microservices.</span></span> <span data-ttu-id="7d909-133">Die Tabelle weist ein für die Anforderungen der Client-App geeignetes Format auf.</span><span class="sxs-lookup"><span data-stu-id="7d909-133">The table has a format suited to the client app’s needs.</span></span>

<span data-ttu-id="7d909-134">Stellen Sie sich beispielsweise den Bildschirm einer mobilen App vor.</span><span class="sxs-lookup"><span data-stu-id="7d909-134">Consider something like the screen for a mobile app.</span></span> <span data-ttu-id="7d909-135">Wenn Sie nur über eine Datenbank verfügen, können Sie die Daten für diesen Bildschirm vermutlich mit einer SQL-Abfrage zusammentragen, die eine komplexe Verknüpfung mit mehreren Tabellen ausführt.</span><span class="sxs-lookup"><span data-stu-id="7d909-135">If you have a single database, you might pull together the data for that screen using a SQL query that performs a complex join involving multiple tables.</span></span> <span data-ttu-id="7d909-136">Wenn Sie jedoch mehrere Datenbanken haben und jede Datenbank im Besitz eines anderen Microservice ist, können Sie diese Datenbanken nicht abfragen und eine SQL-Verknüpfung erstellen.</span><span class="sxs-lookup"><span data-stu-id="7d909-136">However, when you have multiple databases, and each database is owned by a different microservice, you cannot query those databases and create a SQL join.</span></span> <span data-ttu-id="7d909-137">Ihre komplexe Abfrage wird zur einer Herausforderung.</span><span class="sxs-lookup"><span data-stu-id="7d909-137">Your complex query becomes a challenge.</span></span> <span data-ttu-id="7d909-138">Diese Anforderung lässt sich mit einem CQRS-Ansatz meistern. Hierzu erstellen Sie eine denormalisierte Tabelle in einer anderen Datenbank, die nur für Abfragen verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="7d909-138">You can address the requirement using a CQRS approach—you create a denormalized table in a different database that is used just for queries.</span></span> <span data-ttu-id="7d909-139">Die Tabelle kann speziell für die Daten konzipiert werden, die Sie für die komplexe Abfrage benötigen – mit einer 1:1-Beziehung zwischen den Feldern, die vom Bildschirm Ihrer Anwendung benötigt werden, und den Spalten in der Abfragetabelle.</span><span class="sxs-lookup"><span data-stu-id="7d909-139">The table can be designed specifically for the data you need for the complex query, with a one-to-one relationship between fields needed by your application’s screen and the columns in the query table.</span></span> <span data-ttu-id="7d909-140">Sie könnte darüber hinaus für Berichtszwecke verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7d909-140">It could also serve for reporting purposes.</span></span>

<span data-ttu-id="7d909-141">Dieser Ansatz löst nicht nur das ursprüngliche Problem (d.h. die Wahl der Methode für Abfragen und Verknüpfungen zwischen Microservices), sondern verbessert auch im Vergleich zu einer komplexen Verknüpfung erheblich die Leistung, da die von der Anmeldung benötigten Daten bereits in der Abfragetabelle vorliegen.</span><span class="sxs-lookup"><span data-stu-id="7d909-141">This approach not only solves the original problem (how to query and join across microservices); it also improves performance considerably when compared with a complex join, because you already have the data that the application needs in the query table.</span></span> <span data-ttu-id="7d909-142">Natürlich geht die Verwendung von CQRS (Command and Query Responsibility Segregation) mit Abfrage-/Lesetabellen mit zusätzlicher Entwicklungsarbeit einher, und Sie müssen für die letztliche Konsistenz Sorge tragen.</span><span class="sxs-lookup"><span data-stu-id="7d909-142">Of course, using Command and Query Responsibility Segregation (CQRS) with query/reads tables means additional development work, and you will need to embrace eventual consistency.</span></span> <span data-ttu-id="7d909-143">Dennoch sollten Sie CQRS mit mehreren Datenbanken in Situationen anwenden, in denen eine hohe Leistung und Skalierbarkeit in [gemeinsamen Szenarios](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (oder Wettbewerber-Szenarios, je nach Sichtweise) gefordert werden.</span><span class="sxs-lookup"><span data-stu-id="7d909-143">Nonetheless, requirements on performance and high scalability in [collaborative scenarios](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (or competitive scenarios, depending on the point of view) is where you should apply CQRS with multiple databases.</span></span>

<span data-ttu-id="7d909-144">**„Kalte Daten“ in zentralen Datenbanken**.</span><span class="sxs-lookup"><span data-stu-id="7d909-144">**“Cold data” in central databases**.</span></span> <span data-ttu-id="7d909-145">Für komplexe Berichte und Abfragen, die nicht unbedingt Echtzeitdaten erfordern, besteht eine gängige Methode darin, Ihre „heißen Daten“ (Transaktionsdaten aus den Microservices) als „kalte Daten“ in große Datenbanken zu exportieren, die nur für die Berichterstellung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7d909-145">For complex reports and queries that might not require real-time data, a common approach is to export your “hot data” (transactional data from the microservices) as “cold data” into large databases that are used only for reporting.</span></span> <span data-ttu-id="7d909-146">Dieses zentrale Datenbanksystem kann ein auf Big Data basierendes System wie Hadoop, ein Data Warehouse beispielsweise auf Basis von Azure SQL Data Warehouse oder sogar eine einzelne SQL-Datenbank sein, die nur für Berichte verwendet wird (sofern die Größe kein Problem darstellt).</span><span class="sxs-lookup"><span data-stu-id="7d909-146">That central database system can be a Big Data-based system, like Hadoop, a data warehouse like one based on Azure SQL Data Warehouse, or even a single SQL database used just for reports (if size will not be an issue).</span></span>

<span data-ttu-id="7d909-147">Beachten Sie, dass diese zentrale Datenbank nur für Abfragen und Berichte verwendet würde, die keine Echtzeitdaten benötigen.</span><span class="sxs-lookup"><span data-stu-id="7d909-147">Keep in mind that this centralized database would be used only for queries and reports that do not need real-time data.</span></span> <span data-ttu-id="7d909-148">Die ursprünglichen Aktualisierungen und Transaktionen als Ihre Source of Truth müssen sich in Ihren Microservices-Daten befinden.</span><span class="sxs-lookup"><span data-stu-id="7d909-148">The original updates and transactions, as your source of truth, have to be in your microservices data.</span></span> <span data-ttu-id="7d909-149">Für die Synchronisierung der Daten würden Sie entweder eine (in den nächsten Abschnitten behandelte) ereignisgesteuerte Kommunikation oder andere Import/Export-Tools für die Datenbankinfrastruktur verwenden.</span><span class="sxs-lookup"><span data-stu-id="7d909-149">The way you would synchronize data would be either by using event-driven communication (covered in the next sections) or by using other database infrastructure import/export tools.</span></span> <span data-ttu-id="7d909-150">Bei Verwendung einer ereignisgesteuerten Kommunikation würde dieser Integrationsprozess der Methode ähneln, mit der Sie Daten übertragen (wie dies oben für CQRS-Abfragetabellen beschrieben wurde).</span><span class="sxs-lookup"><span data-stu-id="7d909-150">If you use event-driven communication, that integration process would be similar to the way you propagate data as described earlier for CQRS query tables.</span></span>

<span data-ttu-id="7d909-151">Wenn Ihr Anwendungsentwurf jedoch das kontinuierliche Aggregieren von Informationen aus mehreren Microservices für komplexe Abfragen umfasst, wäre dies jedoch möglicherweise ein Indiz für einen schlechten Entwurf, da ein Microservice möglichst von anderen Microservices isoliert sein sollte.</span><span class="sxs-lookup"><span data-stu-id="7d909-151">However, if your application design involves constantly aggregating information from multiple microservices for complex queries, it might be a symptom of a bad design—a microservice should be as isolated as possible from other microservices.</span></span> <span data-ttu-id="7d909-152">(Dies schließt Berichte/Analysen aus, die stets zentrale Datenbanken mit kalten Daten verwenden sollten.) Dieses Problem ist häufig ein Grund für das Zusammenführen von Microservices.</span><span class="sxs-lookup"><span data-stu-id="7d909-152">(This excludes reports/analytics that always should use cold-data central databases.) Having this problem often might be a reason to merge microservices.</span></span> <span data-ttu-id="7d909-153">Sie müssen die Autonomie der Entwicklung und Bereitstellung jedes Microservices und starke Abhängigkeiten, Kohäsion und Datenaggregation gegeneinander abwägen.</span><span class="sxs-lookup"><span data-stu-id="7d909-153">You need to balance the autonomy of evolution and deployment of each microservice with strong dependencies, cohesion, and data aggregation.</span></span>

## <a name="challenge-3-how-to-achieve-consistency-across-multiple-microservices"></a><span data-ttu-id="7d909-154">Herausforderung \#3: Erzielen von Konsistenz über mehrere Microservices</span><span class="sxs-lookup"><span data-stu-id="7d909-154">Challenge \#3: How to achieve consistency across multiple microservices</span></span>

<span data-ttu-id="7d909-155">Wie bereits erwähnt wurde, sind die Daten, die sich im Besitz des einzelnen Microservices befinden, für diesen Microservice privat, und es kann nur mit seiner Microservice-API auf sie zugegriffen werden.</span><span class="sxs-lookup"><span data-stu-id="7d909-155">As stated previously, the data owned by each microservice is private to that microservice and can only be accessed using its microservice API.</span></span> <span data-ttu-id="7d909-156">Dies führt häufig zu der Herausforderung, wie sich End-to-End-Geschäftsprozesse implementieren lassen, wenn gleichzeitig die Konsistenz über mehrere Microservices gewahrt bleiben soll.</span><span class="sxs-lookup"><span data-stu-id="7d909-156">Therefore, a challenge presented is how to implement end-to-end business processes while keeping consistency across multiple microservices.</span></span>

<span data-ttu-id="7d909-157">Um dieses Problem zu untersuchen, sehen wir uns einen Fall aus der [Beispielanwendung eShopOnContainers](http://aka.ms/eshoponcontainers) an.</span><span class="sxs-lookup"><span data-stu-id="7d909-157">To analyze this problem, let’s look at an example from the [eShopOnContainers reference application](http://aka.ms/eshoponcontainers).</span></span> <span data-ttu-id="7d909-158">Der Microservice Katalog verwaltet Informationen zu allen Produkten, einschließlich ihres Lagerbestands.</span><span class="sxs-lookup"><span data-stu-id="7d909-158">The Catalog microservice maintains information about all the products, including their stock level.</span></span> <span data-ttu-id="7d909-159">Der Microservice Bestellung verwaltet Bestellungen und muss sicherstellen, dass eine neue Bestellung nicht den verfügbaren Produktbestand des Katalogs übersteigt.</span><span class="sxs-lookup"><span data-stu-id="7d909-159">The Ordering microservice manages orders and must verify that a new order does not exceed the available catalog product stock.</span></span> <span data-ttu-id="7d909-160">(Alternativ kann das Szenario eine Logik umfassen, die Lieferrückstände berücksichtigt.) In einer hypothetischen monolithischen Version dieser Anwendung könnte das Bestellungssubsystem einfach eine ACID-Transaktion verwenden, um den verfügbaren Bestand zu überprüfen, die Bestellung in der Tabelle Bestellungen zu erstellen und den verfügbaren Bestand in der Tabelle Produkte zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="7d909-160">(Or the scenario might involve logic that handles backordered products.) In a hypothetical monolithic version of this application, the ordering subsystem could simply use an ACID transaction to check the available stock, create the order in the Orders table, and update the available stock in the Products table.</span></span>

<span data-ttu-id="7d909-161">In einer auf Microservices basierenden Anwendung sind die Tabellen Bestellungen und Produkte jedoch im Besitz ihrer jeweiligen Microservices.</span><span class="sxs-lookup"><span data-stu-id="7d909-161">However, in a microservices- based application, the Order and Product tables are owned by their respective microservices.</span></span> <span data-ttu-id="7d909-162">Wie Abbildung 4-9 zeigt, sollte ein Microservice niemals in seinen Transaktionen oder Abfragen Datenbanken umfassen, die im Besitz eines anderen Microservice sind.</span><span class="sxs-lookup"><span data-stu-id="7d909-162">No microservice should ever include databases owned by another microservice in its own transactions or queries, as shown in Figure 4-9.</span></span>

![](./media/image9.PNG)

<span data-ttu-id="7d909-163">**Abbildung 4-9.**</span><span class="sxs-lookup"><span data-stu-id="7d909-163">**Figure 4-9**.</span></span> <span data-ttu-id="7d909-164">Ein Microservice kann nicht direkt auf eine Tabelle in einem anderen Microservice zugreifen</span><span class="sxs-lookup"><span data-stu-id="7d909-164">A microservice cannot directly access a table in another microservice</span></span>

<span data-ttu-id="7d909-165">Der Microservice Bestellung sollte die Tabelle Produkte nicht direkt aktualisieren, da die Tabelle Produkte im Besitz des Microservices Katalog ist.</span><span class="sxs-lookup"><span data-stu-id="7d909-165">The Ordering microservice should not update the Products table directly, because the Products table is owned by the Catalog microservice.</span></span> <span data-ttu-id="7d909-166">Um den Microservice Katalog zu aktualisieren, sollte der Microservice Bestellung stets nur eine asynchrone Kommunikation wie z.B. Integrationsereignisse (nachrichten- und ereignisbasierte Kommunikation) verwenden.</span><span class="sxs-lookup"><span data-stu-id="7d909-166">To make an update to the Catalog microservice, the Ordering microservice should only ever use asynchronous communication such as integration events (message and event-based communication).</span></span> <span data-ttu-id="7d909-167">So wird diese Art der Aktualisierung von der Beispielanwendung [eShopOnContainers](http://aka.ms/eshoponcontainers) ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="7d909-167">This is how the [eShopOnContainers](http://aka.ms/eshoponcontainers) reference application performs this type of update.</span></span>

<span data-ttu-id="7d909-168">Wie aus dem [CAP-Theorem](https://en.wikipedia.org/wiki/CAP_theorem) hervorgeht, müssen Sie sich zwischen der Verfügbarkeit und einer starken ACID-Konsistenz entscheiden.</span><span class="sxs-lookup"><span data-stu-id="7d909-168">As stated by the [CAP theorem](https://en.wikipedia.org/wiki/CAP_theorem), you need to choose between availability and ACID strong consistency.</span></span> <span data-ttu-id="7d909-169">Die meisten auf Microservices basierenden Szenarios erfordern die Verfügbarkeit und eine hohe Skalierbarkeit – und weniger eine starke Konsistenz.</span><span class="sxs-lookup"><span data-stu-id="7d909-169">Most microservice-based scenarios demand availability and high scalability as opposed to strong consistency.</span></span> <span data-ttu-id="7d909-170">Unternehmenskritische Anwendungen müssen ununterbrochen verfügbar sein, und Entwickler können eine starke Konsistenz umgehen, indem sie Techniken für das Arbeiten mit schwachen oder letztlichen Konsistenzen verwenden.</span><span class="sxs-lookup"><span data-stu-id="7d909-170">Mission-critical applications must remain up and running, and developers can work around strong consistency by using techniques for working with weak or eventual consistency.</span></span> <span data-ttu-id="7d909-171">Dieser Ansatz wird von den meisten auf Microservices basierenden Architekturen genutzt.</span><span class="sxs-lookup"><span data-stu-id="7d909-171">This is the approach taken by most microservice-based architectures.</span></span>

<span data-ttu-id="7d909-172">Darüber hinaus verstoßen Transaktionen im ACID-Format bzw. mit Zweiphasen-Commit nicht nur gegen die Grundsätze von Microservices. Die meisten NoSQL-Datenbanken (wie Microsoft Azure Cosmos DB, MongoDB usw.) unterstützen keine Transaktionen mit Zweiphasen-Commit.</span><span class="sxs-lookup"><span data-stu-id="7d909-172">Moreover, ACID-style or two-phase commit transactions are not just against microservices principles; most NoSQL databases (like Azure Cosmos DB, MongoDB, etc.) do not support two-phase commit transactions.</span></span> <span data-ttu-id="7d909-173">Allerdings ist die Wahrung der Datenkonsistenz zwischen Services und Datenbanken unerlässlich.</span><span class="sxs-lookup"><span data-stu-id="7d909-173">However, maintaining data consistency across services and databases is essential.</span></span> <span data-ttu-id="7d909-174">Diese Herausforderung betrifft auch die Frage, wie Änderungen über mehrere Microservices übertragen werden sollen, wenn bestimmte Daten wie z.B. der Name oder die Beschreibung des Produkts im Microservice Katalog und im Microservice Warenkorb redundant sein müssen.</span><span class="sxs-lookup"><span data-stu-id="7d909-174">This challenge is also related to the question of how to propagate changes across multiple microservices when certain data needs to be redundant—for example, when you need to have the product’s name or description in the Catalog microservice and the Basket microservice.</span></span>

<span data-ttu-id="7d909-175">Eine geeignete Lösung für dieses Problem ist die Verwendung einer letztlichen Konsistenz zwischen Microservices, die über eine ereignisgesteuerte Kommunikation und ein Veröffentlichen/Abonnieren-System umgesetzt wird.</span><span class="sxs-lookup"><span data-stu-id="7d909-175">A good solution for this problem is to use eventual consistency between microservices articulated through event-driven communication and a publish-and-subscribe system.</span></span> <span data-ttu-id="7d909-176">Diese Themen werden im Abschnitt [Asynchronous event-driven communication (Asynchrone ereignisgesteuerte Kommunikation)](#async_event_driven_communication) weiter unten in diesem Leitfaden behandelt.</span><span class="sxs-lookup"><span data-stu-id="7d909-176">These topics are covered in the section [Asynchronous event-driven communication](#async_event_driven_communication) later in this guide.</span></span>

## <a name="challenge-4-how-to-design-communication-across-microservice-boundaries"></a><span data-ttu-id="7d909-177">Herausforderung \#4: Gestalten der Kommunikation über Microservice-Grenzen hinweg</span><span class="sxs-lookup"><span data-stu-id="7d909-177">Challenge \#4: How to design communication across microservice boundaries</span></span>

<span data-ttu-id="7d909-178">Die über die Grenzen von Microservices hinausgehende Kommunikation stellt eine echte Herausforderung dar.</span><span class="sxs-lookup"><span data-stu-id="7d909-178">Communicating across microservice boundaries is a real challenge.</span></span> <span data-ttu-id="7d909-179">In diesem Kontext bezieht sich Kommunikation nicht darauf, welches Protokoll (HTTP und REST, AMQP, Messaging usw.) Sie verwenden sollten.</span><span class="sxs-lookup"><span data-stu-id="7d909-179">In this context, communication does not refer to what protocol you should use (HTTP and REST, AMQP, messaging, and so on).</span></span> <span data-ttu-id="7d909-180">Es geht vielmehr darum, welchen Kommunikationsstil Sie verwenden sollten, und insbesondere darum, wie stark Ihre Microservices gekoppelt sein sollten.</span><span class="sxs-lookup"><span data-stu-id="7d909-180">Instead, it addresses what communication style you should use, and especially how coupled your microservices should be.</span></span> <span data-ttu-id="7d909-181">Je nach dem Kopplungsgrad unterscheiden sich die Auswirkungen eines etwaigen Fehlers auf Ihr System erheblich.</span><span class="sxs-lookup"><span data-stu-id="7d909-181">Depending on the level of coupling, when failure occurs, the impact of that failure on your system will vary significantly.</span></span>

<span data-ttu-id="7d909-182">In einem verteilten System wie einer auf Microservices basierenden Anwendung, in der so viele Artefakte vorhanden sind und in der Services über mehrere Server oder Hosts verteilt sind, werden irgendwann Komponenten ausfallen.</span><span class="sxs-lookup"><span data-stu-id="7d909-182">In a distributed system like a microservices-based application, with so many artifacts moving around and with distributed services across many servers or hosts, components will eventually fail.</span></span> <span data-ttu-id="7d909-183">Es wird zu einem teilweisen Ausfall oder sogar zu größeren Ausfällen kommen, weshalb Sie beim Entwerfen Ihrer Microservices und der Kommunikation zwischen ihnen die Risiken berücksichtigen müssen, die bei dieser Art von verteiltem System häufig auftreten.</span><span class="sxs-lookup"><span data-stu-id="7d909-183">Partial failure and even larger outages will occur, so you need to design your microservices and the communication across them taking into account the risks common in this type of distributed system.</span></span>

<span data-ttu-id="7d909-184">Eine beliebte Vorgehensweise besteht darin, HTTP- bzw. REST-basierte Microservices zu implementieren, die sich durch ihre Einfachheit auszeichnen.</span><span class="sxs-lookup"><span data-stu-id="7d909-184">A popular approach is to implement HTTP (REST)- based microservices, due to their simplicity.</span></span> <span data-ttu-id="7d909-185">Ein HTTP-basierter Ansatz ist vollkommen akzeptabel, das Problem liegt vielmehr bei dessen Verwendung.</span><span class="sxs-lookup"><span data-stu-id="7d909-185">An HTTP-based approach is perfectly acceptable; the issue here is related to how you use it.</span></span> <span data-ttu-id="7d909-186">Wenn Sie HTTP-Anforderungen und -Antworten nur für die Interaktion mit Ihren Microservices von Clientanwendungen oder API-Gateways verwenden, ist dies in Ordnung.</span><span class="sxs-lookup"><span data-stu-id="7d909-186">If you use HTTP requests and responses just to interact with your microservices from client applications or from API Gateways, that is fine.</span></span> <span data-ttu-id="7d909-187">Wenn Sie jedoch lange Ketten synchroner HTTP-Aufrufe über Microservices erstellen, die über ihre Grenzen hinweg miteinander kommunizieren, als wären die Microservices Objekte in einer monolithischen Anwendung, wird es bei Ihrer Anwendung irgendwann zu Problemen kommen.</span><span class="sxs-lookup"><span data-stu-id="7d909-187">But if you create long chains of synchronous HTTP calls across microservices, communicating across their boundaries as if the microservices were objects in a monolithic application, your application will eventually run into problems.</span></span>

<span data-ttu-id="7d909-188">Stellen Sie sich z.B. vor, dass Ihre Clientanwendung einen HTTP-API-Aufruf für einen einzelnen Microservice wie den Microservice Bestellung tätigt.</span><span class="sxs-lookup"><span data-stu-id="7d909-188">For instance, imagine that your client application makes an HTTP API call to an individual microservice like the Ordering microservice.</span></span> <span data-ttu-id="7d909-189">Wenn der Microservice Bestellung wiederum über HTTP weitere Microservices innerhalb desselben Anforderungs-/Antwort-Zyklus aufruft, erstellen Sie eine Kette von HTTP-Aufrufen.</span><span class="sxs-lookup"><span data-stu-id="7d909-189">If the Ordering microservice in turn calls additional microservices using HTTP within the same request/response cycle, you are creating a chain of HTTP calls.</span></span> <span data-ttu-id="7d909-190">Dies klingt vielleicht zunächst sinnvoll.</span><span class="sxs-lookup"><span data-stu-id="7d909-190">It might sound reasonable initially.</span></span> <span data-ttu-id="7d909-191">Bei dieser Vorgehensweise müssen jedoch einige wichtige Punkte berücksichtigt werden:</span><span class="sxs-lookup"><span data-stu-id="7d909-191">However, there are important points to consider when going down this path:</span></span>

-   <span data-ttu-id="7d909-192">Blockierung und niedrige Leistung.</span><span class="sxs-lookup"><span data-stu-id="7d909-192">Blocking and low performance.</span></span> <span data-ttu-id="7d909-193">Aufgrund der synchronen Natur des HTTP erhält die ursprüngliche Anforderung erst dann eine Antwort, wenn alle internen HTTP-Aufrufe abgeschlossen sind.</span><span class="sxs-lookup"><span data-stu-id="7d909-193">Due to the synchronous nature of HTTP, the original request will not get a response until all the internal HTTP calls are finished.</span></span> <span data-ttu-id="7d909-194">Stellen Sie sich nun vor, dass die Anzahl dieser Aufrufe beträchtlich zunimmt und gleichzeitig einer der intermediären HTTP-Aufrufe eines Microservice blockiert ist.</span><span class="sxs-lookup"><span data-stu-id="7d909-194">Imagine if the number of these calls increases significantly and at the same time one of the intermediate HTTP calls to a microservice is blocked.</span></span> <span data-ttu-id="7d909-195">Nun ist die Leistung beeinträchtigt, und mit jeder weiteren HTTP-Anforderung ist die allgemeine Skalierbarkeit exponentiell betroffen.</span><span class="sxs-lookup"><span data-stu-id="7d909-195">The result is that performance is impacted, and the overall scalability will be exponentially affected as additional HTTP requests increase.</span></span>

-   <span data-ttu-id="7d909-196">Kopplung von Microservices mit HTTP.</span><span class="sxs-lookup"><span data-stu-id="7d909-196">Coupling microservices with HTTP.</span></span> <span data-ttu-id="7d909-197">Unternehmensmicroservices sollten nicht mit anderen Unternehmensmicroservices gekoppelt werden.</span><span class="sxs-lookup"><span data-stu-id="7d909-197">Business microservices should not be coupled with other business microservices.</span></span> <span data-ttu-id="7d909-198">Im Idealfall sollten sie nichts über das Vorhandensein anderer Microservices „wissen“.</span><span class="sxs-lookup"><span data-stu-id="7d909-198">Ideally, they should not “know” about the existence of other microservices.</span></span> <span data-ttu-id="7d909-199">Wenn Ihre Anwendung wie im Beispiel davon abhängt, dass Microservices gekoppelt werden, lässt sich eine Autonomie der einzelnen Microservices praktisch nicht realisieren.</span><span class="sxs-lookup"><span data-stu-id="7d909-199">If your application relies on coupling microservices as in the example, achieving autonomy per microservice will be almost impossible.</span></span>

-   <span data-ttu-id="7d909-200">Fehler in einem Microservice.</span><span class="sxs-lookup"><span data-stu-id="7d909-200">Failure in any one microservice.</span></span> <span data-ttu-id="7d909-201">Wenn Sie eine Kette von durch HTTP-Aufrufe verknüpften Microservices implementiert haben, führt der Ausfall eines dieser Microservices (der unweigerlich kommen wird) dazu, dass die gesamte Kette von Microservices fehlschlagen wird.</span><span class="sxs-lookup"><span data-stu-id="7d909-201">If you implemented a chain of microservices linked by HTTP calls, when any of the microservices fails (and eventually they will fail) the whole chain of microservices will fail.</span></span> <span data-ttu-id="7d909-202">Ein auf Microservices basierendes System sollte so konzipiert werden, dass es auch bei teilweisen Ausfällen so gut wie möglich weiterarbeitet.</span><span class="sxs-lookup"><span data-stu-id="7d909-202">A microservice-based system should be designed to continue to work as well as possible during partial failures.</span></span> <span data-ttu-id="7d909-203">Selbst wenn Sie eine Clientlogik implementieren, die Wiederholungen mit exponentiellen Backoff- oder Unterbrecher-Mechanismen verwendet, wird es mit wachsender Komplexität der HTTP-Aufrufketten immer schwieriger, eine auf HTTP basierenden Fehlerstrategie zu implementieren.</span><span class="sxs-lookup"><span data-stu-id="7d909-203">Even if you implement client logic that uses retries with exponential backoff or circuit breaker mechanisms, the more complex the HTTP call chains are, the more complex it is implement a failure strategy based on HTTP.</span></span>

<span data-ttu-id="7d909-204">Wenn Ihre internen Microservices miteinander kommunizieren, indem sie wie beschrieben Ketten von HTTP-Anforderungen erstellen, ließe sich in der Tat argumentieren, dass Sie zwar über eine monolithische Anwendung verfügen, diese aber auf HTTP zwischen den Prozessen anstatt auf Kommunikationsmechanismen zwischen den Prozessen basiert.</span><span class="sxs-lookup"><span data-stu-id="7d909-204">In fact, if your internal microservices are communicating by creating chains of HTTP requests as described, it could be argued that you have a monolithic application, but one based on HTTP between processes instead of intraprocess communication mechanisms.</span></span>

<span data-ttu-id="7d909-205">Um eine Autonomie der Microservices zu erzwingen und eine bessere Resilienz zu erhalten, sollten Sie daher die Kommunikation in Form von Anforderungs-/Antwortketten über Microservices auf ein Minimum reduzieren.</span><span class="sxs-lookup"><span data-stu-id="7d909-205">Therefore, in order to enforce microservice autonomy and have better resiliency, you should minimize the use of chains of request/response communication across microservices.</span></span> <span data-ttu-id="7d909-206">Es wird empfohlen, für die Kommunikation zwischen Microservices ausschließlich eine asynchrone Interaktion zu verwenden, und zwar entweder mithilfe einer asynchronen nachrichten- und ereignisbasierten Kommunikation oder mithilfe von HTTP-Abrufen, die vom ursprünglichen HTTP-Anforderungs-/Antwort-Zyklus unabhängig sind.</span><span class="sxs-lookup"><span data-stu-id="7d909-206">It is recommended that you use only asynchronous interaction for inter-microservice communication, either by using asynchronous message- and event-based communication, or by using HTTP polling independently of the original HTTP request/response cycle.</span></span>

<span data-ttu-id="7d909-207">Die Verwendung der asynchronen Kommunikation wird weiter unten in diesem Leitfaden in den Abschnitten [Asynchronous microservice integration enforces microservice’s autonomy (Asynchrone Microservice-Integration erzwingt Microservice-Autonomie)](#asynchronous-microservice-integration-enforce-microservices-autonomy) und [Asynchronous message-based communication (Asynchrone nachrichtenbasierte Kommunikation)](#asynchronous-message-based-communication) mit zusätzlichen Details beschrieben.</span><span class="sxs-lookup"><span data-stu-id="7d909-207">The use of asynchronous communication is explained with additional details later in this guide in the sections [Asynchronous microservice integration enforces microservice’s autonomy](#asynchronous-microservice-integration-enforce-microservices-autonomy) and [Asynchronous message-based communication](#asynchronous-message-based-communication).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="7d909-208">Zusätzliche Ressourcen</span><span class="sxs-lookup"><span data-stu-id="7d909-208">Additional resources</span></span>

-   <span data-ttu-id="7d909-209">**CAP theorem (Das CAP-Theorem)**
    [*https://en.wikipedia.org/wiki/CAP\_theorem*](https://en.wikipedia.org/wiki/CAP_theorem)</span><span class="sxs-lookup"><span data-stu-id="7d909-209">**CAP theorem**
[*https://en.wikipedia.org/wiki/CAP\_theorem*](https://en.wikipedia.org/wiki/CAP_theorem)</span></span>

-   <span data-ttu-id="7d909-210">**Eventual consistency (Letztliche Konsistenz)**
    [*https://en.wikipedia.org/wiki/Eventual\_consistency*](https://en.wikipedia.org/wiki/Eventual_consistency)</span><span class="sxs-lookup"><span data-stu-id="7d909-210">**Eventual consistency**
[*https://en.wikipedia.org/wiki/Eventual\_consistency*](https://en.wikipedia.org/wiki/Eventual_consistency)</span></span>

-   <span data-ttu-id="7d909-211">**Data Consistency Primer (Einführung in die Datenkonsistenz)**
    [*https://msdn.microsoft.com/library/dn589800.aspx*](https://msdn.microsoft.com/library/dn589800.aspx)</span><span class="sxs-lookup"><span data-stu-id="7d909-211">**Data Consistency Primer**
[*https://msdn.microsoft.com/library/dn589800.aspx*](https://msdn.microsoft.com/library/dn589800.aspx)</span></span>

-   <span data-ttu-id="7d909-212">**Martin Fowler. CQRS Command and Query Responsibility Segregation (Zuständigkeitstrennung für Befehle und Abfragen (CQRS))**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="7d909-212">**Martin Fowler. CQRS (Command and Query Responsibility Segregation)**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="7d909-213">**Materialized View (Materialisierte Sicht)**
    [*https://docs.microsoft.com/azure/architecture/patterns/materialized-view*](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span><span class="sxs-lookup"><span data-stu-id="7d909-213">**Materialized View**
[*https://docs.microsoft.com/azure/architecture/patterns/materialized-view*](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span></span>

-   <span data-ttu-id="7d909-214">**Charles Row. ACID vs. BASE: The Shifting pH of Database Transaction Processing (ACID vs. BASE: Die PH-Verschiebung der Datenbanktransaktionsverarbeitung)**
    [*http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/*](http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/)</span><span class="sxs-lookup"><span data-stu-id="7d909-214">**Charles Row. ACID vs. BASE: The Shifting pH of Database Transaction Processing**
[*http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/*](http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/)</span></span>

-   <span data-ttu-id="7d909-215">**Compensating Transaction (Compensating-Transaktion)**
    [*https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction*](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction)</span><span class="sxs-lookup"><span data-stu-id="7d909-215">**Compensating Transaction**
[*https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction*](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction)</span></span>

-   <span data-ttu-id="7d909-216">**Udi Dahan. Service Oriented Composition (Dienstorientierte Komposition)**
    [*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)</span><span class="sxs-lookup"><span data-stu-id="7d909-216">**Udi Dahan. Service Oriented Composition**
[*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="7d909-217">[Zurück] (logical-versus-physical-architecture.md) [Weiter] (identify-microservice-domain-model-boundaries.md)</span><span class="sxs-lookup"><span data-stu-id="7d909-217">[Previous] (logical-versus-physical-architecture.md) [Next] (identify-microservice-domain-model-boundaries.md)</span></span>
