---
title: Migrieren von monolithischen .NET Framework-Anwendungen der Vorversion zu Windows-Containern
description: .NET-Microservices-Architektur für .NET-Containeranwendungen | Migrieren von monolithischen .NET Framework-Anwendungen der Vorversion zu Windows-Containern
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 01b84d29a559bde02ebd30535488c272d5208167
ms.sourcegitcommit: 979597cd8055534b63d2c6ee8322938a27d0c87b
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 06/29/2018
ms.locfileid: "37106514"
---
# <a name="migrating-legacy-monolithic-net-framework-applications-to-windows-containers"></a><span data-ttu-id="00a5c-103">Migrieren von monolithischen .NET Framework-Anwendungen der Vorversion zu Windows-Containern</span><span class="sxs-lookup"><span data-stu-id="00a5c-103">Migrating Legacy Monolithic .NET Framework Applications to Windows Containers</span></span>

<span data-ttu-id="00a5c-104">*Windows-Container können verwendet werden, um die Entwicklung und die Testumgebungen zu verbessern und um Anwendungen bereitzustellen, die auf älteren .NET Framework-Technologien wie Web* *Forms basieren. Diese Verwendung von Containern für ältere Anwendungen wird als „Lift & Shift“-Szenario bezeichnet.*</span><span class="sxs-lookup"><span data-stu-id="00a5c-104">*Windows Containers can be used as a way to improve development and test environments, and to deploy applications that are based on legacy .NET Framework technologies like Web* *Forms. Using containers for legacy applications in this way is referred to as a “lift and shift” scenario.*</span></span>

<span data-ttu-id="00a5c-105">Frühere Abschnitte dieses Handbuchs haben eine Microservice-Architektur vertreten, bei der Geschäftsanwendungen über mehrere verschiedene Container verteilt werden, von denen jeder einen kleinen, fokussierten Dienst ausführt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-105">Earlier sections of this guide have championed a microservices architecture where business applications are distributed among different containers, each running a small, focused service.</span></span> <span data-ttu-id="00a5c-106">Dieses Ziel hat viele Vorteile.</span><span class="sxs-lookup"><span data-stu-id="00a5c-106">That goal has many benefits.</span></span> <span data-ttu-id="00a5c-107">Dieser Ansatz wird in der neuen Entwicklung dringend empfohlen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-107">In new development, that approach is strongly recommended.</span></span> <span data-ttu-id="00a5c-108">Unternehmenskritische Anwendungen profitieren ebenfalls genug davon, um die Kosten eines Neuentwurfs und einer Neuimplementierung zu rechtfertigen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-108">Enterprise-critical applications will also benefit enough to justify the cost of a rearchitecture and reimplementation.</span></span>

<span data-ttu-id="00a5c-109">Es profitiert jedoch nicht jede Anwendung genug davon, um die Kosten zu rechtfertigen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-109">But not every application will benefit enough to justify the cost.</span></span> <span data-ttu-id="00a5c-110">Das bedeutet nicht, dass diese Anwendungen in Containerszenarios nicht verwendet werden können.</span><span class="sxs-lookup"><span data-stu-id="00a5c-110">That does not mean that those applications cannot be used in container scenarios.</span></span>

<span data-ttu-id="00a5c-111">In diesem Abschnitt wird die in Abbildung 7-1 gezeigte Anwendung erläutert.</span><span class="sxs-lookup"><span data-stu-id="00a5c-111">In this section, we will explore an application for eShopOnContainers, shown in Figure 7-1.</span></span> <span data-ttu-id="00a5c-112">Diese Anwendung wird von Enterprise-Teammitgliedern von eShopOnContainers verwendet, um den Produktkatalog anzuzeigen und zu bearbeiten.</span><span class="sxs-lookup"><span data-stu-id="00a5c-112">This application would be used by members of the eShopOnContainers enterprise team to view and edit the product catalog.</span></span>

![](./media/image1.png)

<span data-ttu-id="00a5c-113">**Abbildung 7-1**.</span><span class="sxs-lookup"><span data-stu-id="00a5c-113">**Figure 7-1**.</span></span> <span data-ttu-id="00a5c-114">ASP.NET Web Forms-Anwendung (ältere Technologie) auf einem Windows-Container</span><span class="sxs-lookup"><span data-stu-id="00a5c-114">ASP.NET Web Forms application (legacy technology) on a Windows Container</span></span>

<span data-ttu-id="00a5c-115">Dabei handelt es sich um eine Web Forms-Anwendung, die zum Durchsuchen und Ändern der Katalogeinträge verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="00a5c-115">This is a Web Forms application that is used to browse and modify the catalog entries.</span></span> <span data-ttu-id="00a5c-116">Die Web Forms-Abhängigkeit bedeutet, dass diese Anwendung nicht auf .NET Core ausgeführt werden kann, sofern sie nicht ohne Web Forms neu geschrieben wird und stattdessen ASP.NET Core MVC verwendet.</span><span class="sxs-lookup"><span data-stu-id="00a5c-116">The Web Forms dependency means this application will not run on .NET Core unless it is rewritten without Web Forms and instead uses ASP.NET Core MVC.</span></span> <span data-ttu-id="00a5c-117">Es wird angezeigt, wie Sie solche Anwendungen ohne Änderungen in Containern ausführen können.</span><span class="sxs-lookup"><span data-stu-id="00a5c-117">You will see how you can run applications like these in containers without changes.</span></span> <span data-ttu-id="00a5c-118">Es wird ebenfalls angezeigt, wie Sie minimale Änderungen vornehmen können, um in einem Hybridmodus zu arbeiten, bei dem einige Funktionen in einen separaten Microservice verschoben wurden. Die meisten Funktionen bleiben jedoch in der monolithischen Anwendung.</span><span class="sxs-lookup"><span data-stu-id="00a5c-118">You will also see how you can make minimal changes to work in a hybrid mode where some functionality has been moved into a separate microservice, but most functionality remains in the monolithic application.</span></span>

## <a name="benefits-of-containerizing-a-monolithic-application"></a><span data-ttu-id="00a5c-119">Vorteile des Containerisierens einer monolithischen Anwendung</span><span class="sxs-lookup"><span data-stu-id="00a5c-119">Benefits of containerizing a monolithic application</span></span>

<span data-ttu-id="00a5c-120">Die Anwendung Catalog.WebForms ist im GitHub-Repository von eShopOnContainers verfügbar (<https://github.com/dotnet/eShopOnContainers>).</span><span class="sxs-lookup"><span data-stu-id="00a5c-120">The Catalog.WebForms application is available in the eShopOnContainers GitHub repository (<https://github.com/dotnet/eShopOnContainers>).</span></span> <span data-ttu-id="00a5c-121">Bei dieser Anwendung handelt es sich um eine eigenständige Webanwendung, die auf einen hoch verfügbaren Datenspeicher zugreift.</span><span class="sxs-lookup"><span data-stu-id="00a5c-121">This application is a standalone web application accessing a high-availability data store.</span></span> <span data-ttu-id="00a5c-122">Trotzdem gibt es Vorteile bei der Ausführung der Anwendung in einem Container.</span><span class="sxs-lookup"><span data-stu-id="00a5c-122">Even so, there are advantages to running the application in a container.</span></span> <span data-ttu-id="00a5c-123">Sie erstellen ein Image für die Anwendung.</span><span class="sxs-lookup"><span data-stu-id="00a5c-123">You create an image for the application.</span></span> <span data-ttu-id="00a5c-124">Ab diesem Punkt wird jede Bereitstellung in derselben Umgebung ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-124">From that point forward, every deployment runs in the same environment.</span></span> <span data-ttu-id="00a5c-125">Auf jedem Container wird die gleiche Version des Betriebssystems verwendet, sind die gleichen Abhängigkeiten installiert und wird das gleiche Framework verwendet. Außerdem wird jeder Container mithilfe des gleichen Prozesses erstellt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-125">Every container uses the same OS version, has the same version of dependencies installed, uses the same framework, and is built using the same process.</span></span> <span data-ttu-id="00a5c-126">In Abbildung 7-2 wird Ihnen die in Visual Studio 2017 geladene Anwendung angezeigt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-126">You can see the application loaded in Visual Studio 2017 in Figure 7-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="00a5c-127">**Abbildung 7-2**.</span><span class="sxs-lookup"><span data-stu-id="00a5c-127">**Figure 7-2**.</span></span> <span data-ttu-id="00a5c-128">Web Forms-Anwendung für die Katalogverwaltung in Visual Studio 2017</span><span class="sxs-lookup"><span data-stu-id="00a5c-128">Catalog management Web Forms application in Visual Studio 2017</span></span>

<span data-ttu-id="00a5c-129">Zusätzlich können alle Entwickler die Anwendung in dieser konsistenten Umgebung ausführen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-129">In addition, developers can all run the application in this consistent environment.</span></span> <span data-ttu-id="00a5c-130">Probleme, die nur in bestimmten Versionen auftreten, werden Entwicklern sofort angezeigt, statt in einer Staging- oder Produktionsumgebung verfügbar gemacht zu werden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-130">Issues that only appear with certain versions will appear immediately for developers rather than surfacing in a staging or production environment.</span></span> <span data-ttu-id="00a5c-131">Die Unterschiede zwischen den Entwicklungsumgebungen des Entwicklungsteams sind weniger wichtig, wenn die Anwendung in einem Container ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="00a5c-131">Differences between the development environments among the development team matter less once applications run in containers.</span></span>

<span data-ttu-id="00a5c-132">Zudem verfügen Containeranwendungen über eine flachere horizontale Skalierungskurve.</span><span class="sxs-lookup"><span data-stu-id="00a5c-132">Finally, containerized applications have a flatter scale-out curve.</span></span> <span data-ttu-id="00a5c-133">Sie haben gelernt, wie Containeranwendungen mehr Container in einem virtuellen oder physischen Computer ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-133">You have learned how containerized apps enable more containers in a VM or more containers in a physical machine.</span></span> <span data-ttu-id="00a5c-134">Daraus ergeben sich eine höhere Dichte und weniger erforderliche Ressourcen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-134">This translates to higher density and fewer required resources.</span></span>

<span data-ttu-id="00a5c-135">Deshalb sollten sie ältere monolithische Apps in einem Docker-Container mithilfe eines „Lift & Shift“-Vorgangs ausführen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-135">For all these reasons, consider running legacy monolithic apps in a Docker container using a “lift-and-shift” operation.</span></span> <span data-ttu-id="00a5c-136">Der Ausdruck „Lift & Shift“ beschreibt den Bereich der Aufgabe: Sie heben (*Lift*) die gesamte Anwendung von einem physischen oder virtuellen Computer an und verschieben (*Shift*) diese in einen Container.</span><span class="sxs-lookup"><span data-stu-id="00a5c-136">The phrase “lift and shift” describes the scope of the task: you *lift* the entire application from a physical or virtual machine, and *shift* it into a container.</span></span> <span data-ttu-id="00a5c-137">Im Idealfall müssen Sie keine Änderungen am Anwendungscode vornehmen, um diese in einem Container auszuführen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-137">In ideal situations, you do not need to make any changes to the application code to run it in a container.</span></span>

## <a name="possible-migration-paths"></a><span data-ttu-id="00a5c-138">Mögliche Migrationspfade</span><span class="sxs-lookup"><span data-stu-id="00a5c-138">Possible migration paths</span></span>

<span data-ttu-id="00a5c-139">Die monolithische Catalog.Webforms-Anwendung ist eine Webanwendung, die sämtlichen Code enthält, einschließlich der Datenzugriffsbibliotheken.</span><span class="sxs-lookup"><span data-stu-id="00a5c-139">As a monolithic application, the Catalog.Webforms application is one web application containing all the code, including the data access libraries.</span></span> <span data-ttu-id="00a5c-140">Die Datenbank wird auf einem separaten Hochverfügbarkeitscomputer ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-140">The database runs on a separate high-availability machine.</span></span> <span data-ttu-id="00a5c-141">Diese Konfiguration wird im Beispielcode mithilfe eines Pseudokatalogdiensts simuliert: Sie können die Catalog.Webforms-Anwendung mit den gefälschten Daten ausführen, um ein reines Lift & Shift-Szenario zu simulieren.</span><span class="sxs-lookup"><span data-stu-id="00a5c-141">That configuration is simulated in the sample code by using a mock catalog service: you can run the Catalog.WebForms application against that fake data to simulate a pure lift-and-shift scenario.</span></span> <span data-ttu-id="00a5c-142">Dies zeigt den einfachsten Migrationspfad, in den Sie bestehende Objekte verschieben können, um diese ohne Änderungen im Code in einem Container auszuführen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-142">This demonstrates the simplest migration path, where you move existing assets to run in a container without any code changes at all.</span></span> <span data-ttu-id="00a5c-143">Dieser Pfad ist für Anwendungen geeignet, die vollständig sind und minimal mit den Funktionen interagieren, die Sie in Microservices verschieben.</span><span class="sxs-lookup"><span data-stu-id="00a5c-143">This path is appropriate for applications that are complete and that have minimal interaction with functionality that you are moving to microservices.</span></span>

<span data-ttu-id="00a5c-144">Die eShopOnContainers-Website greift jedoch bereits auf den Datenspeicher zu, da sie Microservices für verschiedene Szenarios verwendet.</span><span class="sxs-lookup"><span data-stu-id="00a5c-144">However, the eShopOnContainers website is already accessing the data storage using microservices for different scenarios.</span></span> <span data-ttu-id="00a5c-145">Es können zusätzlich einige kleine Änderungen am Katalog-Editor vorgenommen werden, um den Katalog-Microservice zu nutzen, statt direkt auf den Datenspeicher des Katalogs zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-145">Some small additional changes can be made to the catalog editor to leverage the catalog microservice instead of accessing the catalog data storage directly.</span></span>

<span data-ttu-id="00a5c-146">Diese Änderungen veranschaulichen das Kontinuum für Ihre eigenen Anwendungen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-146">These changes demonstrate the continuum for your own applications.</span></span> <span data-ttu-id="00a5c-147">Ihnen stehen alle Möglichkeiten offen: Sie können eine bestehende Anwendung ohne Änderungen in einen Container verschieben, kleine Änderungen vornehmen, um bestehenden Anwendungen den Zugriff auf neue Microservices zu ermöglichen oder eine Anwendung komplett neu schreiben, um die vollständige Teilnahme an einer neuen Architektur zu ermöglichen, die auf Microservice basiert.</span><span class="sxs-lookup"><span data-stu-id="00a5c-147">You can do anything from moving an existing application without change into containers, to making small changes that enable existing applications to access some of the new microservices, to completely rewriting an application to fully participate in a new microservice-based architecture.</span></span> <span data-ttu-id="00a5c-148">Der richtige Pfad hängt von den Kosten und den Vorteilen der Migration ab.</span><span class="sxs-lookup"><span data-stu-id="00a5c-148">The right path depends on both the cost of the migration and the benefits from any migration.</span></span>

## <a name="application-tour"></a><span data-ttu-id="00a5c-149">Überblick über die Anwendung</span><span class="sxs-lookup"><span data-stu-id="00a5c-149">Application tour</span></span>

<span data-ttu-id="00a5c-150">Sie können die Projektmappe „Catalog.WebForms“ laden und die Anwendung als eigenständige Anwendung ausführen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-150">You can load the Catalog.WebForms solution and run the application as a standalone application.</span></span> <span data-ttu-id="00a5c-151">In dieser Konfiguration verwendet die Anwendung statt einer beständigen Speicherdatenbank einen gefälschten Dienst, um Daten zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="00a5c-151">In this configuration, instead of a persistent storage database, the application uses a fake service to return data.</span></span> <span data-ttu-id="00a5c-152">Die Anwendung verwendet Autofac (<https://autofac.org/>) als Inversion of Control-Container (IOC).</span><span class="sxs-lookup"><span data-stu-id="00a5c-152">The application uses Autofac (<https://autofac.org/>) as an inversion of control (IOC) container.</span></span> <span data-ttu-id="00a5c-153">Wenn Sie Abhängigkeitsinjektionen (DI) verwenden, können Sie die Anwendung zum Verwenden der gefälschten Daten oder des Livediensts für Katalogdaten konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="00a5c-153">Using Dependency Injection (DI), you can configure the application to use the fake data or the live catalog data service.</span></span> <span data-ttu-id="00a5c-154">(In Kürze wird DI näher erläutert.) Der Startcode liest die Einstellung „useFake“ aus den web.config-Dateien und konfiguriert den Autofac-Container zum Einfügen des gefälschten Datendiensts oder des Livediensts für den Katalog.</span><span class="sxs-lookup"><span data-stu-id="00a5c-154">(We will explain more about DI shortly.) The startup code reads a useFake setting from the web.config files, and configures the Autofac container to inject either the fake data service or the live catalog service.</span></span> <span data-ttu-id="00a5c-155">Wenn Sie die Anwendung ausführen und „useFake“ in der web.config-Datei auf FALSE festgelegt ist, wird Ihnen die Web Forms-Anwendung angezeigt, die die Katalogdaten darstellt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-155">If you run the application with useFake set to false in the web.config file, you see the Web Forms application displaying the catalog data.</span></span>

<span data-ttu-id="00a5c-156">Die meisten in dieser Anwendung verwendeten Techniken sollten jedem vertraut sein, der Web Forms bereits verwendet hat.</span><span class="sxs-lookup"><span data-stu-id="00a5c-156">Most of the techniques used in this application should be very familiar to anyone who has used Web Forms.</span></span> <span data-ttu-id="00a5c-157">Der Katalog-Microservice führt jedoch zwei Techniken ein, die unbekannt sein könnten: Die zuvor erwähnte Abhängigkeitsinjektion (DI) und das Arbeiten mit asynchronen Datenspeichern in Web Forms.</span><span class="sxs-lookup"><span data-stu-id="00a5c-157">However, the catalog microservice introduces two techniques that might be unfamiliar: Dependency Injection (DI), which was mentioned earlier, and working with asynchronous data stores in Web Forms.</span></span>

<span data-ttu-id="00a5c-158">DI kehrt die typische objektorientierte Strategie des Schreibens von Klassen um, die alle erforderlichen Ressourcen zuordnen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-158">DI inverts the typical object-oriented strategy of writing classes that allocate all needed resources.</span></span> <span data-ttu-id="00a5c-159">Stattdessen fordern Klassen ihre Abhängigkeiten von einem Dienstcontainer an.</span><span class="sxs-lookup"><span data-stu-id="00a5c-159">Instead, classes request their dependencies from a service container.</span></span> <span data-ttu-id="00a5c-160">Der Vorteil von DI ist, dass Sie externe Dienste durch Fälschungen (Mocks) ersetzen können, um das Testen oder andere Umgebungen zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-160">The advantage of DI is that you can replace external services with fakes (mocks) to support testing or other environments.</span></span>

<span data-ttu-id="00a5c-161">Der DI-Container verwendet die Konfiguration „web.config appSettings“, um zu steuern, ob die gefälschten Katalogdaten oder die Livedaten des ausgeführten Diensts verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-161">The DI container uses the web.config appSettings configuration to control whether to use the fake catalog data or the live data from the running service.</span></span> <span data-ttu-id="00a5c-162">Die Anwendung registriert ein HttpModule-Objekt, das den Container erstellt und einen Handler für Voranfragen zum Einfügen der Abhängigkeiten.</span><span class="sxs-lookup"><span data-stu-id="00a5c-162">The application registers an HttpModule object that builds the container and registers a pre-request handler to inject dependencies.</span></span> <span data-ttu-id="00a5c-163">Sie finden diesen Code in der Datei „Modules/AutoFacHttpModule.cs“. Dieser gleicht dem folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="00a5c-163">You can see that code in the Modules/AutoFacHttpModule.cs file, which looks like the following example:</span></span>

```cs
private static IContainer CreateContainer()
{
  // Configure AutoFac:
  // Register Containers:

  var settings = WebConfigurationManager.AppSettings;
  var useFake = settings["usefake"];
  bool fake = useFake == "true";
  var builder = new ContainerBuilder();

  if (fake)
  {
    builder.RegisterType<CatalogMockService>()
    .As<ICatalogService>();
  }
  else
  {
    builder.RegisterType<CatalogService>()
    .As<ICatalogService>();
    builder.RegisterType<RequestProvider>()
    .As<IRequestProvider>();
  }

  var container = builder.Build();
  return container;
}

private void InjectDependencies()
{
  if (HttpContext.Current.CurrentHandler is Page page)
  {
    // Get the code-behind class that we may have written
    var pageType = page.GetType().BaseType;

    // Determine if there is a constructor to inject, and grab it
    var ctor = (from c in pageType.GetConstructors()
                where c.GetParameters().Length > 0
                select c).FirstOrDefault();

    if (ctor != null)
    {
      // Resolve the parameters for the constructor
      var args = (from parm in ctor.GetParameters()
                  select Container.Resolve(parm.ParameterType))
                  .ToArray();

      // Execute the constructor method with the arguments resolved
      ctor.Invoke(page, args);
    }

    // Use the Autofac method to inject any
    // properties that can be filled by Autofac
    Container.InjectProperties(page);
  }
}
```

<span data-ttu-id="00a5c-164">Die Anwendungsseiten („Default.aspx.cs“ und „EditPage.aspx.cs“) definieren Konstruktoren, die diese Abhängigkeiten übernehmen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-164">The application’s pages (Default.aspx.cs and EditPage.aspx.cs) define constructors that take these dependencies.</span></span> <span data-ttu-id="00a5c-165">Beachten Sie, dass der Standardkonstruktor weiterhin vorhanden und verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="00a5c-165">Note that the default constructor is still present and accessible.</span></span> <span data-ttu-id="00a5c-166">Die Infrastruktur benötigt den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="00a5c-166">The infrastructure needs the following code.</span></span>

```cs
protected _Default() { }

public _Default(ICatalogService catalog) => this.catalog = catalog;
```

<span data-ttu-id="00a5c-167">Alle Katalog-APIs sind asynchrone Methoden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-167">The catalog APIs are all asynchronous methods.</span></span> <span data-ttu-id="00a5c-168">Web Forms unterstützt diese nun für alle Datenkontrollen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-168">Web Forms now supports these for all data controls.</span></span> <span data-ttu-id="00a5c-169">Die Catalog.WebForms-Anwendung verwendet die Modellbindung für die Seiten „Liste“ und „Bearbeiten“ und die Steuerelemente auf den Seiten, die die Eigenschaften SelectMethod, UpdateMethod, InsertMethod und DeleteMethod definieren. Diese geben asynchrone Operationen an, die eine Aufgabe zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="00a5c-169">The Catalog.WebForms application uses model binding for the list and edit pages; controls on the pages define SelectMethod, UpdateMethod, InsertMethod, and DeleteMethod properties that specify Task-returning asynchronous operations.</span></span> <span data-ttu-id="00a5c-170">Web Forms-Steuerelemente verstehen, wenn die Methoden, die an ein Steuerelement gebunden sind, asynchron sind.</span><span class="sxs-lookup"><span data-stu-id="00a5c-170">Web Forms controls understand when the methods bound to a control are asynchronous.</span></span> <span data-ttu-id="00a5c-171">Die einzige Einschränkung beim Verwenden von asynchronen Select-Methoden ist die, dass diese kein Paging unterstützen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-171">The only restriction you encounter when using asynchronous select methods is that you cannot support paging.</span></span> <span data-ttu-id="00a5c-172">Die Pagingsignatur erfordert einen Out-Parameter, asynchrone Methoden können jedoch keine Out-Parameter besitzen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-172">The paging signature requires an out parameter, and asynchronous methods cannot have out parameters.</span></span> <span data-ttu-id="00a5c-173">Die gleiche Technik wird für andere Seiten verwendet, die Daten aus dem Katalogdienst benötigen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-173">This same technique is used on other pages that require data from the catalog service.</span></span>

<span data-ttu-id="00a5c-174">Die Standardkonfiguration für die Web Forms-Kataloganwendung verwendet eine Pseudoimplementierung des catalog.api-Diensts.</span><span class="sxs-lookup"><span data-stu-id="00a5c-174">The default configuration for the catalog Web Forms application uses a mock implementation of the catalog.api service.</span></span> <span data-ttu-id="00a5c-175">Dieses Mock verwendet einen hartcodierten Datensatz für seine Daten, durch den einige Aufgaben vereinfacht werden, indem die Abhängigkeit vom catalog.api-Dienst aus den Entwicklungsumgebungen entfernt wird.</span><span class="sxs-lookup"><span data-stu-id="00a5c-175">This mock uses a hard-coded dataset for its data, which simplifies some tasks by removing the dependency on the catalog.api service in development environments.</span></span>

## <a name="lifting-and-shifting"></a><span data-ttu-id="00a5c-176">Lift & Shift</span><span class="sxs-lookup"><span data-stu-id="00a5c-176">Lifting and shifting</span></span>

<span data-ttu-id="00a5c-177">Visual Studio bietet eine umfassende Unterstützung für das Containerisieren einer Anwendung.</span><span class="sxs-lookup"><span data-stu-id="00a5c-177">Visual Studio provides great support for containerizing an application.</span></span> <span data-ttu-id="00a5c-178">Klicken Sie mit der rechten Maustaste auf den Projektknoten, und klicken Sie dann auf **Hinzufügen** und **Docker-Unterstützung**.</span><span class="sxs-lookup"><span data-stu-id="00a5c-178">You right-click the project node and then select **Add** and **Docker Support**.</span></span> <span data-ttu-id="00a5c-179">Durch die Docker-Projektvorlage wird ein neues Projekt namens **Docker-Compose** zu der Projektmappe hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-179">The Docker project template adds a new project to the solution called **docker-compose**.</span></span> <span data-ttu-id="00a5c-180">Das Projekt enthält die Docker-Objekte, aus denen die erforderlichen Images zusammengesetzt (oder erstellt) werden und führt wie in Abbildung 7-3 dargestellt die benötigten Container aus.</span><span class="sxs-lookup"><span data-stu-id="00a5c-180">The project contains the Docker assets that compose (or build) the images you need, and starts running the necessary containers, as shown in Figure 7-3.</span></span>

<span data-ttu-id="00a5c-181">In den einfachsten Lift & Shift-Szenarios ist die Anwendung ein einzelner Dienst, den Sie für die Web Forms-Anwendung verwenden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-181">In the simplest lift-and-shift scenarios, the application will be the single service that you use for the Web Forms application.</span></span> <span data-ttu-id="00a5c-182">Die Vorlage ändert auch Ihr Startprojekt, damit dieses auf das **Docker-Compose**-Projekt zeigt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-182">The template also changes your startup project to point to the **docker-compose** project.</span></span> <span data-ttu-id="00a5c-183">Durch das Drücken von STRG+F5 oder F5 wird nun ein Docker-Image erstellt und der Docker-Container gestartet.</span><span class="sxs-lookup"><span data-stu-id="00a5c-183">Pressing Ctrl+F5 or F5 now creates the Docker image and launches the Docker container.</span></span>

![](./media/image3.png)

<span data-ttu-id="00a5c-184">**Abbildung 7-3**.</span><span class="sxs-lookup"><span data-stu-id="00a5c-184">**Figure 7-3**.</span></span> <span data-ttu-id="00a5c-185">Das **Docker-Compose**-Projekt in der Web Forms-Projektmappe</span><span class="sxs-lookup"><span data-stu-id="00a5c-185">The **docker-compose** project in the Web Forms solution</span></span>

<span data-ttu-id="00a5c-186">Versichern Sie sich vor dem Ausführen der Projektmappe, dass Sie Docker für das Verwenden von Windows-Containern konfiguriert haben.</span><span class="sxs-lookup"><span data-stu-id="00a5c-186">Before you run the solution, you must make sure that you configure Docker to use Windows Containers.</span></span> <span data-ttu-id="00a5c-187">Klicken Sie dazu unter Windows mit der rechten Maustaste auf das Docker-Taskleistensymbol, und wählen Sie wie in Abbildung 7-4 gezeigt **Switch to Windows Containers** (Wechseln zu Windows-Containern) aus.</span><span class="sxs-lookup"><span data-stu-id="00a5c-187">To do that, you right-click the Docker taskbar icon in Windows and select **Switch to Windows Containers**, as shown in Figure 7-4.</span></span>

![](./media/image4.png)

<span data-ttu-id="00a5c-188">**Abbildung 7-4**.</span><span class="sxs-lookup"><span data-stu-id="00a5c-188">**Figure 7-4**.</span></span> <span data-ttu-id="00a5c-189">Wechseln zu Windows-Containern mit dem Docker-Taskleistensymbol unter Windows</span><span class="sxs-lookup"><span data-stu-id="00a5c-189">Switching to Windows Containers from the Docker taskbar icon in Windows</span></span>

<span data-ttu-id="00a5c-190">Wenn das Menüelement **Switch to Linux containers** (Wechseln zu Linux-Containern) anzeigt, führen Sie Docker bereits mit Windows-Containern aus.</span><span class="sxs-lookup"><span data-stu-id="00a5c-190">If the menu item says **Switch to Linux containers**, you are already running Docker with Windows Containers.</span></span>

<span data-ttu-id="00a5c-191">Das Ausführen der Projektmappe startet den Docker-Host neu.</span><span class="sxs-lookup"><span data-stu-id="00a5c-191">Running the solution restarts the Docker host.</span></span> <span data-ttu-id="00a5c-192">Während des Buildprozesses werden die Anwendung und das Docker-Image für das Web Forms-Projekt erstellt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-192">When you build, you build the application and the Docker image for the Web Forms project.</span></span> <span data-ttu-id="00a5c-193">Beim ersten Mal beansprucht dies sehr viel Zeit.</span><span class="sxs-lookup"><span data-stu-id="00a5c-193">The first time you do this, it takes considerable time.</span></span> <span data-ttu-id="00a5c-194">Das liegt daran, dass der Buildprozess das Windows Server-Basisimage und das zusätzliche Image für ASP.NET abruft.</span><span class="sxs-lookup"><span data-stu-id="00a5c-194">This is because the build process pulls down the base Windows Server image and the additional image for ASP.NET.</span></span> <span data-ttu-id="00a5c-195">Nachfolgende Build- und Ausführungszyklen sind wesentlich schneller.</span><span class="sxs-lookup"><span data-stu-id="00a5c-195">Subsequent build and run cycles will be much faster.</span></span>

<span data-ttu-id="00a5c-196">Sehen Sie sich die von der Docker-Projektvorlage hinzugefügten Dateien genauer an.</span><span class="sxs-lookup"><span data-stu-id="00a5c-196">Let’s take a deeper look at the files added by the Docker project template.</span></span> <span data-ttu-id="00a5c-197">Diese hat mehrere Dateien für Sie erstellt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-197">It created several files for you.</span></span> <span data-ttu-id="00a5c-198">Visual Studio verwendet diese Dateien, um ein Docker-Image zu erstellen und einen Container zu starten.</span><span class="sxs-lookup"><span data-stu-id="00a5c-198">Visual Studio uses these files to create the Docker image and launch a container.</span></span> <span data-ttu-id="00a5c-199">Sie können die Dateien der CLI verwenden, um Docker-Befehle manuell auszuführen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-199">You can use the same files from the CLI to run Docker commands manually.</span></span>

<span data-ttu-id="00a5c-200">Das folgende Dockerfile-Beispiel zeigt die Grundeinstellungen für das Erstellen eines Docker-Images, das auf dem Windows ASP.NET-Image basiert, das eine ASP.NET-Website ausführt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-200">The following Dockerfile example shows the basic settings for building a Docker image based on the Windows ASP.NET image that runs an ASP.NET site.</span></span>

```
FROM microsoft/aspnet

ARG source

WORKDIR /inetpub/wwwroot

COPY ${source:-obj/Docker/publish} .
```

<span data-ttu-id="00a5c-201">Diese Dockerfile ähnelt denen, die zum Ausführen einer ASP.NET Core-Anwendung in Linux-Containern erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-201">This Dockerfile will look very similar to those created for running an ASP.NET Core application in Linux containers.</span></span> <span data-ttu-id="00a5c-202">Es gibt jedoch ein paar wichtige Unterschiede.</span><span class="sxs-lookup"><span data-stu-id="00a5c-202">However, there are a few important differences.</span></span> <span data-ttu-id="00a5c-203">Der wichtigste Unterschied ist der, dass das Basisimage „microsoft/aspnet“ ist, bei dem es sich um das aktuelle Windows Server-Image handelt, das .NET Framework enthält.</span><span class="sxs-lookup"><span data-stu-id="00a5c-203">The most important difference is that the base image is microsoft/aspnet, which is the current Windows Server image that includes the .NET Framework.</span></span> <span data-ttu-id="00a5c-204">Ein weiterer Unterschied ist der, dass die Verzeichnisse, die aus Ihrem Quellverzeichnis kopiert werden, sich unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-204">Other differences are that the directories copied from your source directory are different.</span></span>

<span data-ttu-id="00a5c-205">Die anderen Dateien im **Docker-Compose**-Projekt sind die Docker-Objekte, die zum Erstellen und Konfigurieren des Containers erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="00a5c-205">The other files in the **docker-compose** project are the Docker assets needed to build and configure the containers.</span></span> <span data-ttu-id="00a5c-206">Visual Studio legt die verschiedenen YML-Dateien von Docker-Compose in einem Knoten ab, um hervorzuheben, wie sie verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-206">Visual Studio puts the various docker-compose.yml files under one node to highlight how they are used.</span></span> <span data-ttu-id="00a5c-207">Die Docker-Compose-Datei enthält die Anweisungen, die für alle Konfigurationen verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="00a5c-207">The base docker-compose file contains the directives that are common to all configurations.</span></span> <span data-ttu-id="00a5c-208">Die Datei „docker-compose.override.yml“ enthält Umgebungsvariablen und die zugehörigen Außerkraftsetzungen für eine Entwicklerkonfiguration.</span><span class="sxs-lookup"><span data-stu-id="00a5c-208">The docker-compose.override.yml file contains environment variables and related overrides for a developer configuration.</span></span> <span data-ttu-id="00a5c-209">Die Varianten mit „.vs.debug“ und „.vs.release“ stellen Umgebungseinstellungen bereit, die es Visual Studio ermöglichen, an den ausgeführten Container anzufügen und ihn zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="00a5c-209">The variants with .vs.debug and .vs.release provide environment settings that enable Visual Studio to attach to and manage the running container.</span></span>

<span data-ttu-id="00a5c-210">Beim Hinzufügen der Docker-Unterstützung zu Ihrer Projektmappe wird Visual Studio integriert. Sie können jedoch auch aus der Befehlszeile erstellen und ausführen, indem Sie den im vorherigen Abschnitt beschriebenen Befehl „docker-compose up“ verwenden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-210">While Visual Studio integration is part of adding Docker support to your solution, you can also build and run from the command line, using the docker-compose up command, as you saw in previous sections.</span></span>

## <a name="getting-data-from-the-existing-catalog-net-core-microservice"></a><span data-ttu-id="00a5c-211">Abrufen von Daten aus dem bestehenden Katalog des .NET Core-Microservices</span><span class="sxs-lookup"><span data-stu-id="00a5c-211">Getting data from the existing catalog .NET Core microservice</span></span>

<span data-ttu-id="00a5c-212">Sie können die Web Forms-Anwendung konfigurieren, um mithilfe des eShopOnContainers-Katalog-Microservices Daten abzurufen anstatt gefälschte Daten zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-212">You can configure the Web Forms application to use the eShopOnContainers catalog microservice to get data instead of using fake data.</span></span> <span data-ttu-id="00a5c-213">Bearbeiten Sie dazu die web.config-Datei, und legen Sie den Wert des useFake-Schlüssels auf FALSE fest.</span><span class="sxs-lookup"><span data-stu-id="00a5c-213">To do this, you edit the web.config file and set the value of the useFake key to false.</span></span> <span data-ttu-id="00a5c-214">Der DI-Container verwendet die Klasse, die auf den Livekatalog von Microservice zugreift, statt der Klasse, die die hartcodierten Daten zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-214">The DI container will use the class that accesses the live catalog microservice instead of the class that returns the hard-coded data.</span></span> <span data-ttu-id="00a5c-215">Es sind keine anderen Änderungen am Code erforderlich.</span><span class="sxs-lookup"><span data-stu-id="00a5c-215">No other code changes are needed.</span></span>

<span data-ttu-id="00a5c-216">Für den Zugriff auf den Livekatalogdienst müssen Sie das **Docker-Compose**-Projekt aktualisieren, um das Katalogdienstimage zu erstellen und den Katalogdienstcontainer zu starten.</span><span class="sxs-lookup"><span data-stu-id="00a5c-216">Accessing the live catalog service does mean you need to update the **docker-compose** project to build the catalog service image and launch the catalog service container.</span></span> <span data-ttu-id="00a5c-217">Docker CE für Windows unterstützt Linux- und Windows-Container, jedoch nicht gleichzeitig.</span><span class="sxs-lookup"><span data-stu-id="00a5c-217">Docker CE for Windows supports both Linux containers and Windows Containers, but not at the same time.</span></span> <span data-ttu-id="00a5c-218">Zum Ausführen des Katalog-Microservices müssen Sie ein Image erstellen, das auf dem Katalog-Microservice zusätzlich zum Windows-basierten Container ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="00a5c-218">To run the catalog microservice, you need to build an image that runs the catalog microservice on top of a Windows-based container.</span></span> <span data-ttu-id="00a5c-219">Diese Vorgehensweise erfordert eine andere Dockerfile für das Microservice-Projekt als in den vorherigen Abschnitten.</span><span class="sxs-lookup"><span data-stu-id="00a5c-219">This approach requires a different Dockerfile for the microservices project than you have seen in earlier sections.</span></span> <span data-ttu-id="00a5c-220">Die Windows-Datei „Dockerfile“ enthält die Konfigurationseinstellungen für das Erstellen eines Containerimages für die Katalog-API, sodass diese beispielsweise für das Verwenden eines Windows Nano-Docker-Images auf einem Windows-Container ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="00a5c-220">The Dockerfile.windows file contains the configuration settings to build the catalog API container image so that it runs on a Windows container—for example, to use a Windows Nano Docker image.</span></span>

<span data-ttu-id="00a5c-221">Der Katalog-Microservice basiert auf der SQL Server-Datenbank.</span><span class="sxs-lookup"><span data-stu-id="00a5c-221">The catalog microservice relies on the SQL Server database.</span></span> <span data-ttu-id="00a5c-222">Deshalb müssen Sie zusätzlich ein Windows-basiertes SQL Server-Docker-Image verwenden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-222">Therefore, you need to use a Windows-based SQL Server Docker image as well.</span></span>

<span data-ttu-id="00a5c-223">Nach diesen Änderungen bietet das Docker-Compose-Projekt mehr als das Starten der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="00a5c-223">After these changes, the docker-compose project does more to start the application.</span></span> <span data-ttu-id="00a5c-224">Das Projekt startet nun den SQL-Server, der das Windows-basierte SQL Server-Image verwendet.</span><span class="sxs-lookup"><span data-stu-id="00a5c-224">The project now starts the SQL Server using the Windows based SQL Server image.</span></span> <span data-ttu-id="00a5c-225">Es startet den Katalog-Microservice in einem Windows-Container.</span><span class="sxs-lookup"><span data-stu-id="00a5c-225">It starts the catalog microservice in a Windows container.</span></span> <span data-ttu-id="00a5c-226">Es startet ebenfalls den Web Forms-Container für den Katalog-Editor in einem Windows-Container.</span><span class="sxs-lookup"><span data-stu-id="00a5c-226">And it starts the Web Forms catalog editor container, also in a Windows container.</span></span> <span data-ttu-id="00a5c-227">Wenn eines der Images noch erstellt werden muss, wird dies zuerst durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-227">If any of the images need building, the images are created first.</span></span>

## <a name="development-and-production-environments"></a><span data-ttu-id="00a5c-228">Entwicklungs- und Produktionsumgebungen</span><span class="sxs-lookup"><span data-stu-id="00a5c-228">Development and production environments</span></span>

<span data-ttu-id="00a5c-229">Es gibt einige Unterschiede zwischen der Entwicklungskonfiguration und einer Produktionskonfiguration.</span><span class="sxs-lookup"><span data-stu-id="00a5c-229">There are a couple of differences between the development configuration and a production configuration.</span></span> <span data-ttu-id="00a5c-230">In der Entwicklungsumgebung führen Sie die Web Forms-Anwendung, den Katalog-Microservice und SQL Server in Windows-Containern als Teil desselben Docker-Hosts aus.</span><span class="sxs-lookup"><span data-stu-id="00a5c-230">In the development environment, you run the Web Forms application, the catalog microservice, and SQL Server in Windows Containers, as part of the same Docker host.</span></span> <span data-ttu-id="00a5c-231">In vorherigen Abschnitten wurden SQL Server-Images erwähnt, die im selben Docker-Host wie die anderen auf .NET Core basierten Dienste in einem Linux-basierten Docker-Host bereitgestellt wurden.</span><span class="sxs-lookup"><span data-stu-id="00a5c-231">In earlier sections, we mentioned SQL Server images deployed in the same Docker host as the other .NET Core-based services on a Linux-based Docker host.</span></span> <span data-ttu-id="00a5c-232">Der Vorteil des Ausführens von mehreren Microservices im selben Docker-Host (oder -Cluster) ist der, dass es weniger Netzwerkkommunikation gibt und die Kommunikation zwischen Containern eine geringere Latenz aufweist.</span><span class="sxs-lookup"><span data-stu-id="00a5c-232">The advantage of running the multiple microservices in the same Docker host (or cluster) is that there is less network communication and the communication between containers has lower latency.</span></span>

<span data-ttu-id="00a5c-233">In der Entwicklungsumgebung müssen Sie alle Container auf dem gleichen Betriebssystem ausführen.</span><span class="sxs-lookup"><span data-stu-id="00a5c-233">In the development environment, you must run all the containers in the same OS.</span></span> <span data-ttu-id="00a5c-234">Docker CE für Windows unterstützt nicht das gleichzeitige Ausführen von Windows- und Linux-basierten Containern.</span><span class="sxs-lookup"><span data-stu-id="00a5c-234">Docker CE for Windows does not support running Windows- and Linux-based containers at the same time.</span></span> <span data-ttu-id="00a5c-235">In der Produktion können Sie entscheiden, ob Sie den Katalog-Microservice in einem Windows-Container in einem einzigen Docker-Host (oder -Cluster) ausführen möchten, oder ob Sie möchten, dass die Web Forms-Anwendung mit einer Instanz des Katalog-Microservices kommuniziert, der in einem Linux-Container in einem anderen Docker-Host ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="00a5c-235">In production, you can decide if you want to run the catalog microservice in a Windows container in a single Docker host (or cluster), or have the Web Forms application communicate with an instance of the catalog microservice running in a Linux container on a different Docker host.</span></span> <span data-ttu-id="00a5c-236">Das hängt davon ab, wie Sie die Netzwerklatenz optimieren möchten.</span><span class="sxs-lookup"><span data-stu-id="00a5c-236">It depends on how you want to optimize for network latency.</span></span> <span data-ttu-id="00a5c-237">In den meisten Fällen sollten Ihre Anwendungen von der Ausführung im selben Docker-Host (oder -Schwarm) abhängig sein, um die Bereitstellung zu erleichtern und die Kommunikationslatenz zu verringern.</span><span class="sxs-lookup"><span data-stu-id="00a5c-237">In most cases, you want the microservices that your applications depend on running in the same Docker host (or swarm) for ease of deployment and lower communication latency.</span></span> <span data-ttu-id="00a5c-238">In diesen Konfigurationen findet die einzige kostspielige Kommunikation zwischen den Microservice-Instanzen und den Hochverfügbarkeitsdiensten des beständigen Datenspeichers statt.</span><span class="sxs-lookup"><span data-stu-id="00a5c-238">In those configurations, the only costly communications is between the microservice instances and the high-availability servers for the persistent data storage.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="00a5c-239">[Zurück](../net-core-single-containers-linux-windows-server-hosts/index.md)
[Weiter](../multi-container-microservice-net-applications/index.md)</span><span class="sxs-lookup"><span data-stu-id="00a5c-239">[Previous](../net-core-single-containers-linux-windows-server-hosts/index.md)
[Next](../multi-container-microservice-net-applications/index.md)</span></span>
