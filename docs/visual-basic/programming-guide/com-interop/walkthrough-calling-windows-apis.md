---
title: 'Exemplarische Vorgehensweise: Aufrufen von Windows-APIs (Visual Basic) | Microsoft-Dokumentation'
ms.custom: 
ms.date: 2015-07-20
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-visual-basic
ms.topic: article
dev_langs:
- VB
helpviewer_keywords:
- DLLs, calling
- Windows API, walkthroughs
- platform invoke, walkthroughs
- API calls, walkthroughs [Visual Basic]
- Windows API, calling
- walkthroughs [Visual Basic], API calls
- DllImport attribute, calling Windows API
- Declare statement, declaring DLL functions
ms.assetid: 9280ca96-7a93-47a3-8d01-6d01be0657cb
caps.latest.revision: 20
author: dotnet-bot
ms.author: dotnetcontent
translation.priority.ht:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
ms.translationtype: Machine Translation
ms.sourcegitcommit: 9f5b8ebb69c9206ff90b05e748c64d29d82f7a16
ms.openlocfilehash: ae1ef60e6e27658c872689f5bfe2779493d42e7a
ms.contentlocale: de-de
ms.lasthandoff: 04/12/2017

---
# <a name="walkthrough-calling-windows-apis-visual-basic"></a><span data-ttu-id="dafb3-102">Exemplarische Vorgehensweise: Aufrufen von Windows-APIs (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="dafb3-102">Walkthrough: Calling Windows APIs (Visual Basic)</span></span>
<span data-ttu-id="dafb3-103">Windows-APIs sind Dynamic Link Libraries (DLLs), die Teil des Windows-Betriebssystems sind.</span><span class="sxs-lookup"><span data-stu-id="dafb3-103">Windows APIs are dynamic-link libraries (DLLs) that are part of the Windows operating system.</span></span> <span data-ttu-id="dafb3-104">Sie verwenden, um Aufgaben auszuführen, wenn es schwierig, eine eigene Prozeduren zu schreiben ist.</span><span class="sxs-lookup"><span data-stu-id="dafb3-104">You use them to perform tasks when it is difficult to write equivalent procedures of your own.</span></span> <span data-ttu-id="dafb3-105">Windows enthält z. B. eine Funktion namens `FlashWindowEx` , mit der Sie die Titelleiste für eine Anwendung zwischen helle und dunkle Farbtöne.</span><span class="sxs-lookup"><span data-stu-id="dafb3-105">For example, Windows provides a function named `FlashWindowEx` that lets you make the title bar for an application alternate between light and dark shades.</span></span>  
  
 <span data-ttu-id="dafb3-106">Der Vorteil der Verwendung von Windows-APIs in Ihrem Code ist, dass sie Entwicklungszeit sparen, da sie enthalten zahlreiche nützliche Funktionen, die bereits geschrieben werden und darauf warten, verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="dafb3-106">The advantage of using Windows APIs in your code is that they can save development time because they contain dozens of useful functions that are already written and waiting to be used.</span></span> <span data-ttu-id="dafb3-107">Der Nachteil besteht darin, dass Windows-APIs arbeiten mit und fehleranfällig, wenn etwas schief geht, schwierig sein kann.</span><span class="sxs-lookup"><span data-stu-id="dafb3-107">The disadvantage is that Windows APIs can be difficult to work with and unforgiving when things go wrong.</span></span>  
  
 <span data-ttu-id="dafb3-108">Windows-APIs stellen eine besondere Kategorie der Interoperabilität dar.</span><span class="sxs-lookup"><span data-stu-id="dafb3-108">Windows APIs represent a special category of interoperability.</span></span> <span data-ttu-id="dafb3-109">Windows-APIs verwenden keinen verwalteten Code, verfügen nicht über integrierte Typbibliotheken und Verwenden von Datentypen, die nicht mit denen in Visual Studio unterscheiden.</span><span class="sxs-lookup"><span data-stu-id="dafb3-109">Windows APIs do not use managed code, do not have built-in type libraries, and use data types that are different than those used with Visual Studio.</span></span> <span data-ttu-id="dafb3-110">Aufgrund dieser Unterschiede und weil Windows-APIs keine COM-Objekte, Interoperabilität mit Windows-APIs sind und die [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] erfolgt unter Verwendung der Plattform aufrufen, oder PInvoke.</span><span class="sxs-lookup"><span data-stu-id="dafb3-110">Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] is performed using platform invoke, or PInvoke.</span></span> <span data-ttu-id="dafb3-111">Der Plattformaufruf ist ein Dienst, wodurch verwalteter Code zum Aufrufen von nicht verwalteter Funktionen in DLLs implementiert.</span><span class="sxs-lookup"><span data-stu-id="dafb3-111">Platform invoke is a service that enables managed code to call unmanaged functions implemented in DLLs.</span></span> <span data-ttu-id="dafb3-112">Weitere Informationen finden Sie unter [verwenden nicht verwalteter DLL-Funktionen](http://msdn.microsoft.com/library/eca7606e-ebfb-4f47-b8d9-289903fdc045).</span><span class="sxs-lookup"><span data-stu-id="dafb3-112">For more information, see [Consuming Unmanaged DLL Functions](http://msdn.microsoft.com/library/eca7606e-ebfb-4f47-b8d9-289903fdc045).</span></span> <span data-ttu-id="dafb3-113">Können PInvoke in [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] mithilfe der `Declare` -Anweisung oder durch Anwenden der `DllImport` -Attribut auf eine leere Prozedur.</span><span class="sxs-lookup"><span data-stu-id="dafb3-113">You can use PInvoke in [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] by using either the `Declare` statement or applying the `DllImport` attribute to an empty procedure.</span></span>  
  
 <span data-ttu-id="dafb3-114">Windows-API-Aufrufe sind ein wichtiger Teil der [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] Programmierung in der Vergangenheit, jedoch sind selten notwendig mit [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)].</span><span class="sxs-lookup"><span data-stu-id="dafb3-114">Windows API calls were an important part of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] programming in the past, but are seldom necessary with [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)].</span></span> <span data-ttu-id="dafb3-115">Wann immer möglich, sollten Sie aus verwalteten Code verwenden die [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] Aufgaben anstelle von Windows-API-Aufrufe.</span><span class="sxs-lookup"><span data-stu-id="dafb3-115">Whenever possible, you should use managed code from the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] to perform tasks, instead of Windows API calls.</span></span> <span data-ttu-id="dafb3-116">Diese exemplarische Vorgehensweise enthält Informationen über die Situationen, in denen die Verwendung von Windows-APIs erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="dafb3-116">This walkthrough provides information for those situations in which using Windows APIs is necessary.</span></span>  
  
[!INCLUDE[note_settings_general](../../../csharp/language-reference/compiler-messages/includes/note_settings_general_md.md)]  
  
## <a name="api-calls-using-declare"></a><span data-ttu-id="dafb3-117">Deklarieren von API-Aufrufe mit</span><span class="sxs-lookup"><span data-stu-id="dafb3-117">API Calls Using Declare</span></span>  
 <span data-ttu-id="dafb3-118">Die gängigste Methode zum Aufrufen von Windows-APIs ist in der `Declare` Anweisung.</span><span class="sxs-lookup"><span data-stu-id="dafb3-118">The most common way to call Windows APIs is by using the `Declare` statement.</span></span>  
  
#### <a name="to-declare-a-dll-procedure"></a><span data-ttu-id="dafb3-119">Deklarieren Sie eine DLL-Prozedur</span><span class="sxs-lookup"><span data-stu-id="dafb3-119">To declare a DLL procedure</span></span>  
  
1.  <span data-ttu-id="dafb3-120">Bestimmen Sie den Namen der Funktion, die Sie aufrufen möchten, sowie die Argumente, Argumenttypen und zurückgeben Sie-Wert als auch den Namen und Speicherort der DLL, die er enthält.</span><span class="sxs-lookup"><span data-stu-id="dafb3-120">Determine the name of the function you want to call, plus its arguments, argument types, and return value, as well as the name and location of the DLL that contains it.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="dafb3-121">Ausführliche Informationen über Windows-APIs finden Sie unter der Win32-SDK-Dokumentation in der Platform SDK-Windows-API.</span><span class="sxs-lookup"><span data-stu-id="dafb3-121">For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API.</span></span> <span data-ttu-id="dafb3-122">Weitere Informationen über die Konstanten, die Windows-APIs verwenden, überprüfen Sie die Headerdateien, z. B. Windows.h im Plattform-SDK enthalten.</span><span class="sxs-lookup"><span data-stu-id="dafb3-122">For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.</span></span>  
  
2.  <span data-ttu-id="dafb3-123">Öffnen Sie ein neues Windows-Anwendungsprojekt, indem Sie auf **neu** auf der **Datei** Menü und dann auf **Projekt**.</span><span class="sxs-lookup"><span data-stu-id="dafb3-123">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="dafb3-124">Das Dialogfeld **Neues Projekt** wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="dafb3-124">The **New Project** dialog box appears.</span></span>  
  
3.  <span data-ttu-id="dafb3-125">Wählen Sie **Windows-Anwendung** aus der Liste der [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] -Projektvorlagen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-125">Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates.</span></span> <span data-ttu-id="dafb3-126">Das neue Projekt wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="dafb3-126">The new project is displayed.</span></span>  
  
4.  <span data-ttu-id="dafb3-127">Fügen Sie die folgenden `Declare` Funktion entweder auf die Klasse oder das Modul, in dem Sie die DLL verwenden möchten:</span><span class="sxs-lookup"><span data-stu-id="dafb3-127">Add the following `Declare` function either to the class or module in which you want to use the DLL:</span></span>  
  
     <span data-ttu-id="dafb3-128">[!code-vb[VbVbalrInterop&#9;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_1.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-128">[!code-vb[VbVbalrInterop#9](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_1.vb)]</span></span>  
  
### <a name="parts-of-the-declare-statement"></a><span data-ttu-id="dafb3-129">Teile der Declare-Anweisung</span><span class="sxs-lookup"><span data-stu-id="dafb3-129">Parts of the Declare Statement</span></span>  
 <span data-ttu-id="dafb3-130">Die `Declare` -Anweisung enthält die folgenden Elemente.</span><span class="sxs-lookup"><span data-stu-id="dafb3-130">The `Declare` statement includes the following elements.</span></span>  
  
#### <a name="auto-modifier"></a><span data-ttu-id="dafb3-131">Auto-Modifizierer</span><span class="sxs-lookup"><span data-stu-id="dafb3-131">Auto modifier</span></span>  
 <span data-ttu-id="dafb3-132">Die `Auto` -Modifizierer weist die Common Language Runtime, die Zeichenfolge entsprechend dem Methodennamen entsprechend den Regeln der common Language Runtime (oder Aliasnamen, sofern angegeben) konvertieren.</span><span class="sxs-lookup"><span data-stu-id="dafb3-132">The `Auto` modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified).</span></span>  
  
#### <a name="lib-and-alias-keywords"></a><span data-ttu-id="dafb3-133">LIB und Alias-Schlüsselwort</span><span class="sxs-lookup"><span data-stu-id="dafb3-133">Lib and Alias keywords</span></span>  
 <span data-ttu-id="dafb3-134">Folgt den `Function` Schlüsselwort ist der Name Ihrer Anwendung verwendet, um die importierte Funktion zugreifen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-134">The name following the `Function` keyword is the name your program uses to access the imported function.</span></span> <span data-ttu-id="dafb3-135">Sie können den Namen der aufgerufenen Funktion identisch sein oder können Sie eine beliebige gültige Prozedurnamen und dann einsetzen der `Alias` -Schlüsselwort verwenden, um den tatsächlichen Namen der Funktion angeben, werden.</span><span class="sxs-lookup"><span data-stu-id="dafb3-135">It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the `Alias` keyword to specify the real name of the function you are calling.</span></span>  
  
 <span data-ttu-id="dafb3-136">Geben Sie die `Lib` -Schlüsselwort, gefolgt vom Namen und Speicherort der DLL mit der Funktion aufrufen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-136">Specify the `Lib` keyword, followed by the name and location of the DLL that contains the function you are calling.</span></span> <span data-ttu-id="dafb3-137">Sie müssen nicht den Pfad zu Dateien in der Windows-Systemverzeichnisse angeben.</span><span class="sxs-lookup"><span data-stu-id="dafb3-137">You do not need to specify the path for files located in the Windows system directories.</span></span>  
  
 <span data-ttu-id="dafb3-138">Verwenden der `Alias` Schlüsselwort ist der Name der aufgerufenen Funktion kein gültiger [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] Prozedurname oder Konflikte mit dem Namen anderer Elemente in der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="dafb3-138">Use the `Alias` keyword if the name of the function you are calling is not a valid [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] procedure name, or conflicts with the name of other items in your application.</span></span> <span data-ttu-id="dafb3-139">`Alias`Gibt den eigentlichen Namen der aufgerufenen Funktion an.</span><span class="sxs-lookup"><span data-stu-id="dafb3-139">`Alias` indicates the true name of the function being called.</span></span>  
  
#### <a name="argument-and-data-type-declarations"></a><span data-ttu-id="dafb3-140">Argument und Deklarationen von Typen</span><span class="sxs-lookup"><span data-stu-id="dafb3-140">Argument and Data Type Declarations</span></span>  
 <span data-ttu-id="dafb3-141">Deklarieren Sie die Argumente und deren Datentypen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-141">Declare the arguments and their data types.</span></span> <span data-ttu-id="dafb3-142">Dieser Teil kann problematisch sein, da die Datentypen, die Windows mit Visual Studio-Datentypen nicht übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-142">This part can be challenging because the data types that Windows uses do not correspond to Visual Studio data types.</span></span> [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="dafb3-143">Führt einen Großteil der Arbeit für Sie durch Konvertieren der Argumente in kompatible Datentypen, eine sogenannte *Marshalling*.</span><span class="sxs-lookup"><span data-stu-id="dafb3-143"> does a lot of the work for you by converting arguments to compatible data types, a process called *marshaling*.</span></span> <span data-ttu-id="dafb3-144">Sie können explizit steuern, wie Argumente gemarshallt werden, mithilfe der <xref:System.Runtime.InteropServices.MarshalAsAttribute>Attribut definiert, der <xref:System.Runtime.InteropServices>Namespace.</xref:System.Runtime.InteropServices> </xref:System.Runtime.InteropServices.MarshalAsAttribute></span><span class="sxs-lookup"><span data-stu-id="dafb3-144">You can explicitly control how arguments are marshaled by using the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute defined in the <xref:System.Runtime.InteropServices> namespace.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="dafb3-145">Frühere Versionen von [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] konnten Sie Parameter deklarieren `As Any`, d. h., Daten eines beliebigen Datentyps verwendet werden konnten.</span><span class="sxs-lookup"><span data-stu-id="dafb3-145">Previous versions of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] allowed you to declare parameters `As Any`, meaning that data of any data type could be used.</span></span> [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="dafb3-146">erfordert, dass Sie einen bestimmten Datentyp für alle `Declare` Anweisungen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-146"> requires that you use a specific data type for all `Declare` statements.</span></span>  
  
#### <a name="windows-api-constants"></a><span data-ttu-id="dafb3-147">Windows-API-Konstanten</span><span class="sxs-lookup"><span data-stu-id="dafb3-147">Windows API Constants</span></span>  
 <span data-ttu-id="dafb3-148">Einige Argumente sind Kombinationen von Konstanten.</span><span class="sxs-lookup"><span data-stu-id="dafb3-148">Some arguments are combinations of constants.</span></span> <span data-ttu-id="dafb3-149">Z. B. die `MessageBox` in dieser exemplarischen Vorgehensweise gezeigten API akzeptiert ein ganzzahliges Argument namens `Typ` , die steuert, wie das Meldungsfeld angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="dafb3-149">For example, the `MessageBox` API shown in this walkthrough accepts an integer argument called `Typ` that controls how the message box is displayed.</span></span> <span data-ttu-id="dafb3-150">Sie können den numerischen Wert dieser Konstanten bestimmen, indem Sie untersuchen das `#define` Anweisungen in der Datei WinUser.h.</span><span class="sxs-lookup"><span data-stu-id="dafb3-150">You can determine the numeric value of these constants by examining the `#define` statements in the file WinUser.h.</span></span> <span data-ttu-id="dafb3-151">Die numerischen Werte werden im Allgemeinen hexadezimal angezeigt, daher sollten Sie mithilfe eines Rechners hinzufügen und Konvertieren in eine Dezimalzahl.</span><span class="sxs-lookup"><span data-stu-id="dafb3-151">The numeric values are generally shown in hexadecimal, so you may want to use a calculator to add them and convert to decimal.</span></span> <span data-ttu-id="dafb3-152">Beispielsweise, wenn Sie die Konstanten für das Format mit Ausrufezeichen kombinieren möchten `MB_ICONEXCLAMATION` 0x00000030 und die Ja/kein Format `MB_YESNO` 0 x 00000004, Sie können die Zahlen addieren, und erhalten Sie ein Ergebnis vom, 0 x 00000034 bzw. 52 decimal.</span><span class="sxs-lookup"><span data-stu-id="dafb3-152">For example, if you want to combine the constants for the exclamation style `MB_ICONEXCLAMATION` 0x00000030 and the Yes/No style `MB_YESNO` 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal.</span></span> <span data-ttu-id="dafb3-153">Decimal Ergebnis direkt verwenden können, es ist besser, diese Werte als Konstanten in der Anwendung zu deklarieren und kombinieren diese mit der `Or` Operator.</span><span class="sxs-lookup"><span data-stu-id="dafb3-153">Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the `Or` operator.</span></span>  
  
###### <a name="to-declare-constants-for-windows-api-calls"></a><span data-ttu-id="dafb3-154">Zum Deklarieren von Konstanten für Windows-API-Aufrufe</span><span class="sxs-lookup"><span data-stu-id="dafb3-154">To declare constants for Windows API calls</span></span>  
  
1.  <span data-ttu-id="dafb3-155">Lesen Sie die Dokumentation für die Windows-Funktion, die Sie aufrufen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-155">Consult the documentation for the Windows function you are calling.</span></span> <span data-ttu-id="dafb3-156">Bestimmen Sie den Namen der verwendeten Konstanten und den Namen der h-Datei, die die numerischen Werte für diese Konstanten enthält.</span><span class="sxs-lookup"><span data-stu-id="dafb3-156">Determine the name of the constants it uses and the name of the .h file that contains the numeric values for these constants.</span></span>  
  
2.  <span data-ttu-id="dafb3-157">Verwenden Sie einen Texteditor wie Editor zum Anzeigen des Inhalts der Headerdatei (. h), und suchen Sie die verwendeten Konstanten zugeordneten Werte.</span><span class="sxs-lookup"><span data-stu-id="dafb3-157">Use a text editor, such as Notepad, to view the contents of the header (.h) file, and find the values associated with the constants you are using.</span></span> <span data-ttu-id="dafb3-158">Zum Beispiel die `MessageBox` -API verwendet, die Konstante `MB_ICONQUESTION` zum Anzeigen eines Fragezeichens im Meldungsfeld.</span><span class="sxs-lookup"><span data-stu-id="dafb3-158">For example, the `MessageBox` API uses the constant `MB_ICONQUESTION` to show a question mark in the message box.</span></span> <span data-ttu-id="dafb3-159">Die Definition für `MB_ICONQUESTION` steht in WinUser.h und sieht wie folgt aus:</span><span class="sxs-lookup"><span data-stu-id="dafb3-159">The definition for `MB_ICONQUESTION` is in WinUser.h and appears as follows:</span></span>  
  
     `#define MB_ICONQUESTION             0x00000020L`  
  
3.  <span data-ttu-id="dafb3-160">Fügen Sie die entsprechende `Const` Anweisungen, die der Klasse oder dem Modul diese Konstanten für Ihre Anwendung verfügbar machen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-160">Add equivalent `Const` statements to your class or module to make these constants available to your application.</span></span> <span data-ttu-id="dafb3-161">Zum Beispiel:</span><span class="sxs-lookup"><span data-stu-id="dafb3-161">For example:</span></span>  
  
     <span data-ttu-id="dafb3-162">[!code-vb[VbVbalrInterop&#11;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_2.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-162">[!code-vb[VbVbalrInterop#11](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_2.vb)]</span></span>  
  
###### <a name="to-call-the-dll-procedure"></a><span data-ttu-id="dafb3-163">Zum Aufrufen der DLL-Prozedur</span><span class="sxs-lookup"><span data-stu-id="dafb3-163">To call the DLL procedure</span></span>  
  
1.  <span data-ttu-id="dafb3-164">Fügen Sie eine Schaltfläche mit dem Namen `Button1` auf den Start des Projekts, und doppelklicken Sie darauf, um ihren Code anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-164">Add a button named `Button1` to the startup form for your project, and then double-click it to view its code.</span></span> <span data-ttu-id="dafb3-165">Der Ereignishandler für die Schaltfläche wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="dafb3-165">The event handler for the button is displayed.</span></span>  
  
2.  <span data-ttu-id="dafb3-166">Fügen Sie Code in der `Click` -Ereignishandler für die Schaltfläche, die Sie hinzugefügt haben, rufen Sie die Prozedur, und geben Sie die entsprechenden Argumente:</span><span class="sxs-lookup"><span data-stu-id="dafb3-166">Add code to the `Click` event handler for the button you added, to call the procedure and provide the appropriate arguments:</span></span>  
  
     <span data-ttu-id="dafb3-167">[!code-vb[VbVbalrInterop&#12;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_3.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-167">[!code-vb[VbVbalrInterop#12](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_3.vb)]</span></span>  
  
3.  <span data-ttu-id="dafb3-168">Führen Sie das Projekt, indem Sie F5 drücken.</span><span class="sxs-lookup"><span data-stu-id="dafb3-168">Run the project by pressing F5.</span></span> <span data-ttu-id="dafb3-169">Das Meldungsfeld wird angezeigt, mit den beiden **Ja** und **Nr.** Antwort Schaltflächen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-169">The message box is displayed with both **Yes** and **No** response buttons.</span></span> <span data-ttu-id="dafb3-170">Klicken Sie auf eine.</span><span class="sxs-lookup"><span data-stu-id="dafb3-170">Click either one.</span></span>  
  
#### <a name="data-marshaling"></a><span data-ttu-id="dafb3-171">Marshallen von Daten</span><span class="sxs-lookup"><span data-stu-id="dafb3-171">Data Marshaling</span></span>  
 [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="dafb3-172">automatisch konvertiert die Datentypen von Parametern und Rückgabewerten für Windows-API-Aufrufe, aber Sie können die `MarshalAs` Attribut explizit nicht verwaltete Datentypen angeben, die eine API erwartet.</span><span class="sxs-lookup"><span data-stu-id="dafb3-172"> automatically converts the data types of parameters and return values for Windows API calls, but you can use the `MarshalAs` attribute to explicitly specify unmanaged data types that an API expects.</span></span> <span data-ttu-id="dafb3-173">Weitere Informationen zum Interop-Marshalling finden Sie unter [Interop-Marshalling](http://msdn.microsoft.com/library/115f7a2f-d422-4605-ab36-13a8dd28142a).</span><span class="sxs-lookup"><span data-stu-id="dafb3-173">For more information about interop marshaling, see [Interop Marshaling](http://msdn.microsoft.com/library/115f7a2f-d422-4605-ab36-13a8dd28142a).</span></span>  
  
###### <a name="to-use-declare-and-marshalas-in-an-api-call"></a><span data-ttu-id="dafb3-174">Deklarieren und mit MarshalAs einen API-Aufruf</span><span class="sxs-lookup"><span data-stu-id="dafb3-174">To use Declare and MarshalAs in an API call</span></span>  
  
1.  <span data-ttu-id="dafb3-175">Bestimmen Sie den Namen der Funktion sowie deren Argumente, Datentypen, soll und Rückgabewerte.</span><span class="sxs-lookup"><span data-stu-id="dafb3-175">Determine the name of the function you want to call, plus its arguments, data types, and return value.</span></span>  
  
2.  <span data-ttu-id="dafb3-176">Um Zugriff auf die `MarshalAs` -Attribut, fügen Sie eine `Imports` -Anweisung am Anfang des Codes für die Klasse oder das Modul wie im folgenden Beispiel:</span><span class="sxs-lookup"><span data-stu-id="dafb3-176">To simplify access to the `MarshalAs` attribute, add an `Imports` statement to the top of the code for the class or module, as in the following example:</span></span>  
  
     <span data-ttu-id="dafb3-177">[!code-vb[VbVbalrInterop&#13;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-177">[!code-vb[VbVbalrInterop#13](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span></span>  
  
3.  <span data-ttu-id="dafb3-178">Fügen Sie einen Funktionsprototyp für die importierte Funktion auf die Klasse oder das Modul, die Sie verwenden und Anwenden der `MarshalAs` -Attribut auf die Parameter oder Rückgabewert.</span><span class="sxs-lookup"><span data-stu-id="dafb3-178">Add a function prototype for the imported function to the class or module you are using, and apply the `MarshalAs` attribute to the parameters or return value.</span></span> <span data-ttu-id="dafb3-179">Im folgenden Beispiel ein API-Aufruf, der den Typ erwartet `void*` als gemarshallt `AsAny`:</span><span class="sxs-lookup"><span data-stu-id="dafb3-179">In the following example, an API call that expects the type `void*` is marshaled as `AsAny`:</span></span>  
  
     <span data-ttu-id="dafb3-180">[!code-vb[VbVbalrInterop&14;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_5.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-180">[!code-vb[VbVbalrInterop#14](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_5.vb)]</span></span>  
  
## <a name="api-calls-using-dllimport"></a><span data-ttu-id="dafb3-181">API-Aufrufe mit DllImport</span><span class="sxs-lookup"><span data-stu-id="dafb3-181">API Calls Using DllImport</span></span>  
 <span data-ttu-id="dafb3-182">Das `DllImport` -Attribut bietet eine zweite Möglichkeit, Funktionen in DLLs ohne Typbibliotheken aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-182">The `DllImport` attribute provides a second way to call functions in DLLs without type libraries.</span></span> <span data-ttu-id="dafb3-183">`DllImport`entspricht ungefähr mit einer `Declare` -Anweisung bietet jedoch besser steuern, wie Funktionen aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="dafb3-183">`DllImport` is roughly equivalent to using a `Declare` statement but provides more control over how functions are called.</span></span>  
  
 <span data-ttu-id="dafb3-184">Sie können `DllImport` mit den meisten Windows-API aufruft, solange der Aufruf einer freigegebenen gilt (bezeichnet *statische*) Methode.</span><span class="sxs-lookup"><span data-stu-id="dafb3-184">You can use `DllImport` with most Windows API calls as long as the call refers to a shared (sometimes called *static*) method.</span></span> <span data-ttu-id="dafb3-185">Sie können keine Methoden verwenden, die eine Instanz einer Klasse erforderlich.</span><span class="sxs-lookup"><span data-stu-id="dafb3-185">You cannot use methods that require an instance of a class.</span></span> <span data-ttu-id="dafb3-186">Im Gegensatz zu `Declare` -Anweisungen, `DllImport` können keine Aufrufe der `MarshalAs` Attribut.</span><span class="sxs-lookup"><span data-stu-id="dafb3-186">Unlike `Declare` statements, `DllImport` calls cannot use the `MarshalAs` attribute.</span></span>  
  
#### <a name="to-call-a-windows-api-using-the-dllimport-attribute"></a><span data-ttu-id="dafb3-187">Aufrufen einer Windows-API mit dem DllImport-Attribut</span><span class="sxs-lookup"><span data-stu-id="dafb3-187">To call a Windows API using the DllImport attribute</span></span>  
  
1.  <span data-ttu-id="dafb3-188">Öffnen Sie ein neues Windows-Anwendungsprojekt, indem Sie auf **neu** auf der **Datei** Menü und dann auf **Projekt**.</span><span class="sxs-lookup"><span data-stu-id="dafb3-188">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="dafb3-189">Das Dialogfeld **Neues Projekt** wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="dafb3-189">The **New Project** dialog box appears.</span></span>  
  
2.  <span data-ttu-id="dafb3-190">Wählen Sie **Windows-Anwendung** aus der Liste der [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] -Projektvorlagen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-190">Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates.</span></span> <span data-ttu-id="dafb3-191">Das neue Projekt wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="dafb3-191">The new project is displayed.</span></span>  
  
3.  <span data-ttu-id="dafb3-192">Fügen Sie eine Schaltfläche mit dem Namen `Button2` auf das Startformular.</span><span class="sxs-lookup"><span data-stu-id="dafb3-192">Add a button named `Button2` to the startup form.</span></span>  
  
4.  <span data-ttu-id="dafb3-193">Doppelklicken Sie auf `Button2` um die Codeansicht für das Formular zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-193">Double-click `Button2` to open the code view for the form.</span></span>  
  
5.  <span data-ttu-id="dafb3-194">Um Zugriff auf `DllImport`, fügen eine `Imports` -Anweisung am Anfang des Codes für die Startklasse für das Formular:</span><span class="sxs-lookup"><span data-stu-id="dafb3-194">To simplify access to `DllImport`, add an `Imports` statement to the top of the code for the startup form class:</span></span>  
  
     <span data-ttu-id="dafb3-195">[!code-vb[VbVbalrInterop&#13;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-195">[!code-vb[VbVbalrInterop#13](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span></span>  
  
6.  <span data-ttu-id="dafb3-196">Deklarieren Sie eine leere Funktion vorhergehenden der `End Class` -Anweisung für das Formular, und der Name der Funktion `MoveFile`.</span><span class="sxs-lookup"><span data-stu-id="dafb3-196">Declare an empty function preceding the `End Class` statement for the form, and name the function `MoveFile`.</span></span>  
  
7.  <span data-ttu-id="dafb3-197">Anwenden der `Public` und `Shared` Modifizierer für die Deklaration und Festlegen von Parametern für `MoveFile` basierend auf den Argumenten, die die Windows-API-Funktion verwendet:</span><span class="sxs-lookup"><span data-stu-id="dafb3-197">Apply the `Public` and `Shared` modifiers to the function declaration and set parameters for `MoveFile` based on the arguments the Windows API function uses:</span></span>  
  
     <span data-ttu-id="dafb3-198">[!code-vb[VbVbalrInterop Nr.&16;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_6.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-198">[!code-vb[VbVbalrInterop#16](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_6.vb)]</span></span>  
  
     <span data-ttu-id="dafb3-199">Die Funktion kann ein beliebiger gültiger Prozedurname haben; das `DllImport` -Attribut gibt den Namen in der DLL.</span><span class="sxs-lookup"><span data-stu-id="dafb3-199">Your function can have any valid procedure name; the `DllImport` attribute specifies the name in the DLL.</span></span> <span data-ttu-id="dafb3-200">Es behandelt auch die Interop-Marshalling für die Parameter und Rückgabewerte, so dass Sie Visual Studio-Datentypen auswählen können, die mit den von der API verwendeten Datentypen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-200">It also handles interoperability marshaling for the parameters and return values, so you can choose Visual Studio data types that are similar to the data types the API uses.</span></span>  
  
8.  <span data-ttu-id="dafb3-201">Anwenden der `DllImport` -Attribut auf die leere Funktion.</span><span class="sxs-lookup"><span data-stu-id="dafb3-201">Apply the `DllImport` attribute to the empty function.</span></span> <span data-ttu-id="dafb3-202">Der erste Parameter ist der Name und Speicherort der DLL mit der Funktion, die Sie aufrufen.</span><span class="sxs-lookup"><span data-stu-id="dafb3-202">The first parameter is the name and location of the DLL containing the function you are calling.</span></span> <span data-ttu-id="dafb3-203">Sie müssen nicht den Pfad zu Dateien in der Windows-Systemverzeichnisse angeben.</span><span class="sxs-lookup"><span data-stu-id="dafb3-203">You do not need to specify the path for files located in the Windows system directories.</span></span> <span data-ttu-id="dafb3-204">Der zweite Parameter ist ein benanntes Argument, das den Namen der Funktion in der Windows-API angibt.</span><span class="sxs-lookup"><span data-stu-id="dafb3-204">The second parameter is a named argument that specifies the name of the function in the Windows API.</span></span> <span data-ttu-id="dafb3-205">In diesem Beispiel die `DllImport` -Attribut erzwingt Aufrufe `MoveFile` an `MoveFileW` in KERNEL32. DLL.</span><span class="sxs-lookup"><span data-stu-id="dafb3-205">In this example, the `DllImport` attribute forces calls to `MoveFile` to be forwarded to `MoveFileW` in KERNEL32.DLL.</span></span> <span data-ttu-id="dafb3-206">Die `MoveFileW` -Methode kopiert eine Datei aus dem Pfad `src` zum Pfad `dst`.</span><span class="sxs-lookup"><span data-stu-id="dafb3-206">The `MoveFileW` method copies a file from the path `src` to the path `dst`.</span></span>  
  
     <span data-ttu-id="dafb3-207">[!code-vb[VbVbalrInterop&17;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_7.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-207">[!code-vb[VbVbalrInterop#17](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_7.vb)]</span></span>  
  
9. <span data-ttu-id="dafb3-208">Fügen Sie Code in der `Button2_Click` -Ereignishandler, um die Funktion aufzurufen:</span><span class="sxs-lookup"><span data-stu-id="dafb3-208">Add code to the `Button2_Click` event handler to call the function:</span></span>  
  
     <span data-ttu-id="dafb3-209">[!code-vb[VbVbalrInterop&18;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_8.vb)]</span><span class="sxs-lookup"><span data-stu-id="dafb3-209">[!code-vb[VbVbalrInterop#18](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_8.vb)]</span></span>  
  
10. <span data-ttu-id="dafb3-210">Erstellen Sie eine Datei mit dem Namen "Test.txt", und fügen Sie ihn in das Verzeichnis C:\Tmp auf Ihrer Festplatte.</span><span class="sxs-lookup"><span data-stu-id="dafb3-210">Create a file named Test.txt and place it in the C:\Tmp directory on your hard drive.</span></span> <span data-ttu-id="dafb3-211">Erstellen Sie bei Bedarf die Tmp-Verzeichnis.</span><span class="sxs-lookup"><span data-stu-id="dafb3-211">Create the Tmp directory if necessary.</span></span>  
  
11. <span data-ttu-id="dafb3-212">Drücken Sie F5, um die Anwendung zu starten.</span><span class="sxs-lookup"><span data-stu-id="dafb3-212">Press F5 to start the application.</span></span> <span data-ttu-id="dafb3-213">Das Hauptformular wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="dafb3-213">The main form appears.</span></span>  
  
12. <span data-ttu-id="dafb3-214">Klicken Sie auf **Button2**.</span><span class="sxs-lookup"><span data-stu-id="dafb3-214">Click **Button2**.</span></span> <span data-ttu-id="dafb3-215">Die Meldung "die Datei wurde erfolgreich verschoben" wird angezeigt, wenn die Datei verschoben werden kann.</span><span class="sxs-lookup"><span data-stu-id="dafb3-215">The message "The file was moved successfully" is displayed if the file can be moved.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="dafb3-216">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="dafb3-216">See Also</span></span>  
 <span data-ttu-id="dafb3-217"><xref:System.Runtime.InteropServices.DllImportAttribute></xref:System.Runtime.InteropServices.DllImportAttribute></span><span class="sxs-lookup"><span data-stu-id="dafb3-217"><xref:System.Runtime.InteropServices.DllImportAttribute></span></span>   
 <span data-ttu-id="dafb3-218"><xref:System.Runtime.InteropServices.MarshalAsAttribute></xref:System.Runtime.InteropServices.MarshalAsAttribute></span><span class="sxs-lookup"><span data-stu-id="dafb3-218"><xref:System.Runtime.InteropServices.MarshalAsAttribute></span></span>   
<span data-ttu-id="dafb3-219"> [Declare-Anweisung](../../../visual-basic/language-reference/statements/declare-statement.md) </span><span class="sxs-lookup"><span data-stu-id="dafb3-219"> [Declare Statement](../../../visual-basic/language-reference/statements/declare-statement.md) </span></span>  
<span data-ttu-id="dafb3-220"> [Auto](../../../visual-basic/language-reference/modifiers/auto.md) </span><span class="sxs-lookup"><span data-stu-id="dafb3-220"> [Auto](../../../visual-basic/language-reference/modifiers/auto.md) </span></span>  
<span data-ttu-id="dafb3-221"> [Alias](../../../visual-basic/language-reference/statements/alias-clause.md) </span><span class="sxs-lookup"><span data-stu-id="dafb3-221"> [Alias](../../../visual-basic/language-reference/statements/alias-clause.md) </span></span>  
<span data-ttu-id="dafb3-222"> [COM-Interop](../../../visual-basic/programming-guide/com-interop/index.md) </span><span class="sxs-lookup"><span data-stu-id="dafb3-222"> [COM Interop](../../../visual-basic/programming-guide/com-interop/index.md) </span></span>  
<span data-ttu-id="dafb3-223"> [Erstellen von Prototypen in verwaltetem Code](http://msdn.microsoft.com/library/ecdcf25d-cae3-4f07-a2b6-8397ac6dc42d) </span><span class="sxs-lookup"><span data-stu-id="dafb3-223"> [Creating Prototypes in Managed Code](http://msdn.microsoft.com/library/ecdcf25d-cae3-4f07-a2b6-8397ac6dc42d) </span></span>  
<span data-ttu-id="dafb3-224"> [Marshalling von Delegaten als Rückrufmethode](http://msdn.microsoft.com/library/6ddd7866-9804-4571-84de-83f5cc017a5a)</span><span class="sxs-lookup"><span data-stu-id="dafb3-224"> [Marshaling a Delegate as a Callback Method](http://msdn.microsoft.com/library/6ddd7866-9804-4571-84de-83f5cc017a5a)</span></span>
