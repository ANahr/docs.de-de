---
title: Inhaltsbasierte Korrelation
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
ms.assetid: f46a2b68-8d24-4122-bbee-9573fc3f9fb4
caps.latest.revision: 17
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: 4b4ebd49fbed12f1e8120e67f32496cd782531da
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/30/2018
---
# <a name="content-based-correlation"></a><span data-ttu-id="ee905-102">Inhaltsbasierte Korrelation</span><span class="sxs-lookup"><span data-stu-id="ee905-102">Content Based Correlation</span></span>
<span data-ttu-id="ee905-103">Wenn Workflowdienste mit Clients und anderen Diensten kommunizieren, sind in den ausgetauschten Nachrichten häufig Daten enthalten, die eine Nachricht eindeutig mit einer bestimmten Instanz verknüpfen.</span><span class="sxs-lookup"><span data-stu-id="ee905-103">When workflow services communicate with clients and other services, often there is some data in the exchanged messages that uniquely relates a message to a particular instance.</span></span> <span data-ttu-id="ee905-104">Die inhaltsbasierte Korrelation verwendet diese Daten in der Nachricht, z. B. eine Kundennummer oder Bestellt-ID, um Nachrichten an die richtige Workflowinstanz weiterzuleiten.</span><span class="sxs-lookup"><span data-stu-id="ee905-104">Content-based correlation uses this data in the message, such as a customer number or order ID, to route messages to the proper workflow instance.</span></span> <span data-ttu-id="ee905-105">In diesem Thema wird erklärt, wie Sie die inhaltsbasierte Korrelation in Workflows verwenden.</span><span class="sxs-lookup"><span data-stu-id="ee905-105">This topic explains how to use content-based correlation in workflows.</span></span>  
  
## <a name="using-content-based-correlation"></a><span data-ttu-id="ee905-106">Verwenden der inhaltsbasierten Korrelation</span><span class="sxs-lookup"><span data-stu-id="ee905-106">Using Content-Based Correlation</span></span>  
 <span data-ttu-id="ee905-107">Die inhaltsbasierte Korrelation wird verwendet, wenn ein Workflowdienst über mehrere Methoden verfügt, auf die von einem einzelnen Client zugegriffen wird, und ein Datenelement in den ausgetauschten Nachrichten die gewünschte Instanz angibt.</span><span class="sxs-lookup"><span data-stu-id="ee905-107">Content-based correlation is used when a workflow service has multiple methods that are accessed by a single client and a piece of data in the exchanged messages identifies the desired instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ee905-108">Die inhaltsbasierte Korrelation ist nützlich, wenn die Kontextkorrelation nicht verwendet werden kann, weil es sich bei der Bindung nicht um eine der unterstützten Bindungen für den Kontextaustausch handelt.</span><span class="sxs-lookup"><span data-stu-id="ee905-108">Content-based correlation is useful when context correlation cannot be used because the binding is not one of the supported context exchange bindings.</span></span> <span data-ttu-id="ee905-109">Weitere Informationen zu kontextkorrelation, finden Sie unter [Kontextaustausch](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span><span class="sxs-lookup"><span data-stu-id="ee905-109">For more information about context correlation, see [Context Exchange](../../../../docs/framework/wcf/feature-details/context-exchange-correlation.md).</span></span>  
  
 <span data-ttu-id="ee905-110">Jede bei dieser Kommunikation verwendete Messagingaktivität muss die Position der Daten in der Nachricht angeben, die die Instanz eindeutig identifizieren.</span><span class="sxs-lookup"><span data-stu-id="ee905-110">Each messaging activity used in these communications must specify the location of the data in the message that uniquely identifies the instance.</span></span> <span data-ttu-id="ee905-111">Dazu wird <xref:System.ServiceModel.MessageQuerySet> mit <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> oder <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> bereitgestellt, um die Nachricht nach einem oder mehreren Datenelementen abzufragen, die die Instanz eindeutig identifizieren.</span><span class="sxs-lookup"><span data-stu-id="ee905-111">This is done by providing a <xref:System.ServiceModel.MessageQuerySet>, using either a <xref:System.ServiceModel.Activities.QueryCorrelationInitializer> or <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>, that queries the message for the piece or pieces of data that uniquely identify the instance.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="ee905-112">Die Daten zur Identifikation der Instanz werden per Hash in einen Korrelationsschlüssel umgewandelt.</span><span class="sxs-lookup"><span data-stu-id="ee905-112">The data that is used to identify the instance is hashed into a correlation key.</span></span> <span data-ttu-id="ee905-113">Dabei müssen Sie sicherstellen, dass die für die Korrelation verwendeten Daten eindeutig sind, da sonst Konflikte im Hashschlüssel auftreten und Nachrichten ggf. falsch weitergeleitet werden können.</span><span class="sxs-lookup"><span data-stu-id="ee905-113">Care must be taken to ensure that the data used for correlation is unique or else collisions in the hashed key could occur and cause messages to be misrouted.</span></span> <span data-ttu-id="ee905-114">Wenn eine Korrelation z. B. ausschließlich auf einem Kundennamen basiert, kann es zu einem Konflikt kommen, da es möglicherweise mehrere Kunden mit dem gleichen Namen gibt.</span><span class="sxs-lookup"><span data-stu-id="ee905-114">For example, a correlation based solely on a customer name may cause a collision because there may be multiple customers with the same name.</span></span> <span data-ttu-id="ee905-115">Der Doppelpunkt (`:`) darf nicht als Bestandteil der Daten verwendet werden, mit denen die Meldung korreliert wird, da hiermit bereits Schlüssel und Wert der Meldungsabfrage begrenzt werden, um die Zeichenfolge zu bilden, für die anschließend der Hashwert berechnet wird.</span><span class="sxs-lookup"><span data-stu-id="ee905-115">The colon (`:`) should not be used as part of the data used to correlate the message because it is already used to delimit the message query’s key and value to form the string that is subsequently hashed.</span></span>  
  
 <span data-ttu-id="ee905-116">Im folgenden Beispiel werden die ursprünglichen <xref:System.ServiceModel.Activities.Receive> / <xref:System.ServiceModel.Activities.SendReply> gibt in einem Workflowdienst eine `OrderId`, dem wird dann vom Client zurück übergeben, auf den Aufruf der folgenden <xref:System.ServiceModel.Activities.Receive> Aktivität im Workflowdienst.</span><span class="sxs-lookup"><span data-stu-id="ee905-116">In the following example, the initial <xref:System.ServiceModel.Activities.Receive>/<xref:System.ServiceModel.Activities.SendReply> in a workflow service returns an `OrderId`, which is then passed back by the client on the call to the following <xref:System.ServiceModel.Activities.Receive> activity in the workflow service.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#1)]  
  
 <span data-ttu-id="ee905-117">Im vorherigen Beispiel wird eine von der <xref:System.ServiceModel.Activities.SendReply>-Antwort initialisierte inhaltsbasierte Korrelation veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="ee905-117">The previous example shows a content-based correlation that is initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="ee905-118">Der <xref:System.ServiceModel.MessageQuerySet> gibt an, dass die Dateneinheit, mit der nachfolgende Nachrichten an diesen Dienst identifiziert werden, die `OrderId` ist.</span><span class="sxs-lookup"><span data-stu-id="ee905-118">The <xref:System.ServiceModel.MessageQuerySet> specifies that the data used to identify subsequent messages to this service is the `OrderId`.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="ee905-119">Die <xref:System.ServiceModel.Activities.Receive>-Aktivität, die der <xref:System.ServiceModel.Activities.SendReply> im Workflow folgt, folgt der Korrelation, die von der <xref:System.ServiceModel.Activities.SendReply> initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="ee905-119">The <xref:System.ServiceModel.Activities.Receive> activity that follows the <xref:System.ServiceModel.Activities.SendReply> in the workflow follows the correlation that was initialized by the <xref:System.ServiceModel.Activities.SendReply>.</span></span> <span data-ttu-id="ee905-120">Beide Aktivitäten haben den gleichen <xref:System.ServiceModel.Activities.CorrelationHandle>, aber jede hat einen eigenen <xref:System.ServiceModel.MessageQuerySet> und eine eigene <xref:System.ServiceModel.XPathMessageQuery>, die angeben, wo in der jeweiligen Nachricht die identifizierenden Daten enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="ee905-120">Both activities share the same <xref:System.ServiceModel.Activities.CorrelationHandle>, but each one has its own <xref:System.ServiceModel.MessageQuerySet> and <xref:System.ServiceModel.XPathMessageQuery> that specifies where the identifying data is in that particular message.</span></span> <span data-ttu-id="ee905-121">Auf die die Korrelation initialisierende Aktivität hin wird dieser <xref:System.ServiceModel.MessageQuerySet> in der <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A>-Eigenschaft angegeben, und bei weiteren <xref:System.ServiceModel.Activities.Receive>-Aktivitäten wird er mit der <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A>-Eigenschaft angegeben.</span><span class="sxs-lookup"><span data-stu-id="ee905-121">On the activity that initializes the correlation, this <xref:System.ServiceModel.MessageQuerySet> is specified in the <xref:System.ServiceModel.Activities.Receive.CorrelationInitializers%2A> property, and for any following <xref:System.ServiceModel.Activities.Receive> activities, it is specified using the <xref:System.ServiceModel.Activities.Receive.CorrelatesOn%2A> property.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="ee905-122">Eine inhaltsbasierte Korrelation kann von jeder Messagingaktivität (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) initialisiert werden, wenn die Daten als Teil einer Nachricht weitergegeben werden.</span><span class="sxs-lookup"><span data-stu-id="ee905-122">A content-based correlation can be initialized by any messaging activity (<xref:System.ServiceModel.Activities.Send>, <xref:System.ServiceModel.Activities.Receive>, <xref:System.ServiceModel.Activities.SendReply>, <xref:System.ServiceModel.Activities.ReceiveReply>) when the data flows as part of a message.</span></span> <span data-ttu-id="ee905-123">Wenn die entsprechenden Daten nicht als Teil einer Nachricht weitergegeben werden, können sie unter Verwendung der <xref:System.ServiceModel.Activities.InitializeCorrelation>-Aktivität ausdrücklich initialisiert werden.</span><span class="sxs-lookup"><span data-stu-id="ee905-123">If the particular piece of data does not flow as part of a message, then it can be initialized explicitly by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="ee905-124">Wenn zur eindeutigen Identifizierung der Nachricht verschiedene Daten erforderlich sind, können dem <xref:System.ServiceModel.MessageQuerySet> mehrere Abfragen hinzugefügt werden.</span><span class="sxs-lookup"><span data-stu-id="ee905-124">If multiple pieces of data are required to uniquely identify the message, then multiple queries can be added to the <xref:System.ServiceModel.MessageQuerySet>.</span></span> <span data-ttu-id="ee905-125">In diesen Beispielen wurde ein <xref:System.ServiceModel.Activities.CorrelationHandle> explizit für jede der Aktivitäten bereitgestellt, die die `CorrelatesWith`-Eigenschaft oder die `CorrelationHandle`-Eigenschaft verwenden, aber wenn nur eine Korrelation für den ganzen Workflow erforderlich ist, z. B. in diesem Beispiel, wo alles mit `OrderId` korreliert, ist die von <xref:System.ServiceModel.Activities.WorkflowServiceHost> bereitgestellte implizite Korrelationshandleverwaltung ausreichend.</span><span class="sxs-lookup"><span data-stu-id="ee905-125">In these examples, a <xref:System.ServiceModel.Activities.CorrelationHandle> was explicitly provided to each of the activities using the `CorrelatesWith` or `CorrelationHandle` properties, but if there is only one correlation required for the entire workflow, such as in this example where everything correlates on `OrderId`, the implicit correlation handle management provided by <xref:System.ServiceModel.Activities.WorkflowServiceHost> is sufficient.</span></span>  
  
## <a name="using-the-initializecorrelation-activity"></a><span data-ttu-id="ee905-126">Verwenden der InitializeCorrelation-Aktivität</span><span class="sxs-lookup"><span data-stu-id="ee905-126">Using the InitializeCorrelation Activity</span></span>  
 <span data-ttu-id="ee905-127">Im vorherigen Beispiel wurde die `OrderId` durch die <xref:System.ServiceModel.Activities.SendReply>-Aktivität an den Aufrufer weitergegeben, und hier wurde die Korrelation initialisiert.</span><span class="sxs-lookup"><span data-stu-id="ee905-127">In the previous example, the `OrderId` flowed to the caller through the <xref:System.ServiceModel.Activities.SendReply> activity and this is where the correlation was initialized.</span></span> <span data-ttu-id="ee905-128">Das gleiche Verhalten kann mit der <xref:System.ServiceModel.Activities.InitializeCorrelation>-Aktivität erreicht werden.</span><span class="sxs-lookup"><span data-stu-id="ee905-128">The same behavior can be accomplished by using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span> <span data-ttu-id="ee905-129">Die <xref:System.ServiceModel.Activities.InitializeCorrelation>-Aktivität akzeptiert den <xref:System.ServiceModel.Activities.CorrelationHandle> und ein Wörterbuch von Elementen, die die Daten darstellen, mit denen die Nachricht der richtigen Instanz zugeordnet wird.</span><span class="sxs-lookup"><span data-stu-id="ee905-129">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity takes the <xref:System.ServiceModel.Activities.CorrelationHandle> and a dictionary of items that represent the data used to map the message to the correct instance.</span></span> <span data-ttu-id="ee905-130">Um im vorhergehenden Beispiel die <xref:System.ServiceModel.Activities.InitializeCorrelation>-Aktivität zu verwenden, entfernen Sie die <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> aus der <xref:System.ServiceModel.Activities.SendReply>-Aktivität, und initialisieren Sie die Korrelation mit der <xref:System.ServiceModel.Activities.InitializeCorrelation>-Aktivität.</span><span class="sxs-lookup"><span data-stu-id="ee905-130">To use the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity in the preceding sample, remove the <xref:System.ServiceModel.Activities.SendReply.CorrelationInitializers%2A> from the <xref:System.ServiceModel.Activities.SendReply> activity and initialize the correlation using the <xref:System.ServiceModel.Activities.InitializeCorrelation> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#4)]  
  
 <span data-ttu-id="ee905-131">Die <xref:System.ServiceModel.Activities.InitializeCorrelation>-Aktivität wird dann im Workflow verwendet, nachdem die die Daten enthaltenden Variablen aufgefüllt wurden, aber vor der <xref:System.ServiceModel.Activities.Receive>-Aktivität, die dem initialisierten <xref:System.ServiceModel.Activities.CorrelationHandle> entspricht.</span><span class="sxs-lookup"><span data-stu-id="ee905-131">The <xref:System.ServiceModel.Activities.InitializeCorrelation> activity is then used in the workflow, after the variables that hold the data are populated but before the <xref:System.ServiceModel.Activities.Receive> activity that correlates with the initialized <xref:System.ServiceModel.Activities.CorrelationHandle>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#5)]  
  
## <a name="configuring-xpath-queries-using-the-workflow-designer"></a><span data-ttu-id="ee905-132">Konfigurieren von XPath-Abfragen mit Workflow-Designer</span><span class="sxs-lookup"><span data-stu-id="ee905-132">Configuring XPath Queries Using the Workflow Designer</span></span>  
 <span data-ttu-id="ee905-133">In den vorherigen Beispielen wurden die in der Nachricht verwendeten Aktivitäten und XPath-Abfragen im Code angegeben.</span><span class="sxs-lookup"><span data-stu-id="ee905-133">In the previous examples, the activities and the XPath queries used in the message queries were specified in code.</span></span> <span data-ttu-id="ee905-134">Der Workflow-Designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] bietet auch die Möglichkeit, XPaths aus `DataContract`-Typen für inhaltsbasierte Korrelation zu generieren.</span><span class="sxs-lookup"><span data-stu-id="ee905-134">The workflow designer in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] also provides the ability to generate XPaths from `DataContract` types for content-based correlation.</span></span> <span data-ttu-id="ee905-135">Der erste im vorherigen Beispiel konfigurierte XPath wurde für die <xref:System.ServiceModel.Activities.SendReply> konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="ee905-135">The first XPath configured in the previous example was configured for the <xref:System.ServiceModel.Activities.SendReply>.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#2)]  
  
 <span data-ttu-id="ee905-136">Um den XPath für eine Messagingaktivität im Workflow-Designer zu konfigurieren, wählen Sie die Aktivität im Workflow-Designer aus.</span><span class="sxs-lookup"><span data-stu-id="ee905-136">To configure the XPath for a messaging activity in the workflow designer, select the activity in the workflow designer.</span></span> <span data-ttu-id="ee905-137">Wenn die Aktivität die Korrelation, wie im vorherigen Beispiel initialisiert wird, klicken Sie auf die Schaltfläche mit den Auslassungspunkten, für die **CorrelationInitializers** Eigenschaft in der **Eigenschaften** Fenster.</span><span class="sxs-lookup"><span data-stu-id="ee905-137">If the activity is initializing the correlation, as in the previous example, click the ellipsis button for the **CorrelationInitializers** property in the **Properties** window.</span></span> <span data-ttu-id="ee905-138">Dadurch wird die **Korrelationsinitialisierer hinzufügen** Dialogfenster.</span><span class="sxs-lookup"><span data-stu-id="ee905-138">This displays the **Add Correlation Initializers** dialog window.</span></span> <span data-ttu-id="ee905-139">In diesem Dialogfeld können Sie die Korrelationsart angeben und den Inhalt auswählen, der für die Korrelation verwendet werden soll.</span><span class="sxs-lookup"><span data-stu-id="ee905-139">From this dialog you can specify the correlation type and select the content that is used for the correlation.</span></span> <span data-ttu-id="ee905-140">Die <xref:System.ServiceModel.Activities.CorrelationHandle> Variablen wird angegeben, der **Initialisierer hinzufügen** Feld Korrelationstyp und die Daten der Korrelation ausgewählt ist, aus der **XPath-Abfragen** Abschnitt des Dialogfelds.</span><span class="sxs-lookup"><span data-stu-id="ee905-140">The <xref:System.ServiceModel.Activities.CorrelationHandle> variable is specified in the **Add initializer** box, and the correlation type and data used for the correlation is selected from the **XPath Queries** section of the dialog box.</span></span>  
  
 <span data-ttu-id="ee905-141">![Dialogfeld "CorrelationInitializer"](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span><span class="sxs-lookup"><span data-stu-id="ee905-141">![CorrelationInitializer Dialog](../../../../docs/framework/wcf/feature-details/media/correlationinitializerdlg.jpg "CorrelationInitializerDlg")</span></span>  
  
 <span data-ttu-id="ee905-142">Die zweite XPath-Abfrage im vorherigen Beispiel wurde in der <xref:System.ServiceModel.Activities.Receive>-Aktivität konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="ee905-142">The second XPath query in the previous example was configured in the <xref:System.ServiceModel.Activities.Receive> activity.</span></span>  
  
 [!code-csharp[CFX_ContentCorrelation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_contentcorrelation/cs/program.cs#3)]  
  
 <span data-ttu-id="ee905-143">Um die XPath-Abfrage für eine Messagingaktivität zu konfigurieren, die nicht die Korrelation initialisiert, wählen Sie die Aktivität im Workflow-Designer, und klicken Sie dann auf die Schaltfläche mit den Auslassungspunkten, für die **CorrelatesOn** Eigenschaft in der  **Eigenschaften** Fenster.</span><span class="sxs-lookup"><span data-stu-id="ee905-143">To configure the XPath query for a messaging activity that does not initialize the correlation, select the activity in the workflow designer and then click the ellipsis button for the **CorrelatesOn** property in the **Properties** window.</span></span> <span data-ttu-id="ee905-144">Dadurch wird die **CorrelatesOn-Definition** Dialogfenster.</span><span class="sxs-lookup"><span data-stu-id="ee905-144">This displays the **CorrelatesOn Definition** dialog window.</span></span>  
  
 <span data-ttu-id="ee905-145">![CorrelatesOn-Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span><span class="sxs-lookup"><span data-stu-id="ee905-145">![CorrelatesOn Definition](../../../../docs/framework/wcf/feature-details/media/correlatesondialog.jpg "CorrelatesOnDialog")</span></span>  
  
 <span data-ttu-id="ee905-146">In diesem Dialogfeld Geben Sie die <xref:System.ServiceModel.Activities.CorrelationHandle> und wählen Elemente in der **XPath-Abfragen** Liste aus, um die XPath-Abfrage zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="ee905-146">From this dialog you specify the <xref:System.ServiceModel.Activities.CorrelationHandle> and choose items in the **XPath Queries** list to build the XPath query.</span></span>
