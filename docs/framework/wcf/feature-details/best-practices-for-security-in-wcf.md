---
title: Best Practices für Sicherheit in WCF
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- best practices [WCF], security
ms.assetid: 3639de41-1fa7-4875-a1d7-f393e4c8bd69
caps.latest.revision: 19
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload:
- dotnet
ms.openlocfilehash: 0545ff40247b7ff86cb6227fa8cf4af8666c3629
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 04/30/2018
---
# <a name="best-practices-for-security-in-wcf"></a><span data-ttu-id="4aa8e-102">Best Practices für Sicherheit in WCF</span><span class="sxs-lookup"><span data-stu-id="4aa8e-102">Best Practices for Security in WCF</span></span>
<span data-ttu-id="4aa8e-103">In den folgenden Abschnitten werden die Best Practices aufgeführt, die beim Erstellen sicherer Anwendungen mit [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] zu berücksichtigen sind.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-103">The following sections list the best practices to consider when creating secure applications using [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span></span> <span data-ttu-id="4aa8e-104">Weitere Informationen zur Sicherheit finden Sie unter [Sicherheitsüberlegungen](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [Sicherheitsüberlegungen zu Daten](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md), und [Sicherheitsüberlegungen für Metadaten](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="4aa8e-104">For more information about security, see [Security Considerations](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md), [Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md), and [Security Considerations with Metadata](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md).</span></span>  
  
## <a name="identify-services-performing-windows-authentication-with-spns"></a><span data-ttu-id="4aa8e-105">Identifizieren von Diensten mit Windows-Authentifizierung mithilfe von SPNs</span><span class="sxs-lookup"><span data-stu-id="4aa8e-105">Identify Services Performing Windows Authentication with SPNs</span></span>  
 <span data-ttu-id="4aa8e-106">Dienste können entweder mit Benutzerprinzipalnamen (User Principal Names, UPNs) oder mit Dienstprinzipalnamen (Service Principal Names, SPNs) identifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-106">Services can be identified with either user principal names (UPNs) or service principal names (SPNs).</span></span> <span data-ttu-id="4aa8e-107">Dienste, die im Rahmen eines Computerkontos ausgeführt werden (beispielsweise der Netzwerkdienst), besitzen eine SPN-Identität, die dem Computer entspricht, auf dem sie ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-107">Services running under machine accounts such as network service have an SPN identity corresponding to the machine they're running.</span></span> <span data-ttu-id="4aa8e-108">Dienste, die im Rahmen eines Benutzerkontos ausgeführt werden, besitzen eine UPN-Identität, die dem Benutzer entspricht, als der sie ausgeführt werden. Mithilfe des `setspn`-Tool kann dem Benutzerkonto jedoch auch ein SPN zugewiesen werden.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-108">Services running under user accounts have a UPN identity corresponding to the user they're running as, although the `setspn` tool can be used to assign an SPN to the user account.</span></span> <span data-ttu-id="4aa8e-109">Wird ein Dienst so konfiguriert, dass er mittels SPN identifiziert werden kann, und werden die Clients, von denen eine Verbindung mit dem Dienst herstellt wird, für die Verwendung dieses SPN konfiguriert, lassen sich bestimmte Angriffe erschweren.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-109">Configuring a service so it can be identified via SPN and configuring the clients connecting to the service to use that SPN can make certain attacks more difficult.</span></span> <span data-ttu-id="4aa8e-110">Diese Anleitung gilt für Bindungen mit Kerberos- oder SSPI-Aushandlung.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-110">This guidance applies to bindings using Kerberos or SSPI negotiation.</span></span>  <span data-ttu-id="4aa8e-111">Für den Fall, dass von SSPI auf NTLM zurückgegriffen wird, sollte von den Clients auch weiterhin ein SPN angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-111">Clients should still specify an SPN in the case where SSPI falls back to NTLM.</span></span>  
  
## <a name="verify-service-identities-in-wsdl"></a><span data-ttu-id="4aa8e-112">Überprüfen von Dienstidentitäten in WSDL</span><span class="sxs-lookup"><span data-stu-id="4aa8e-112">Verify Service Identities in WSDL</span></span>  
 <span data-ttu-id="4aa8e-113">WS-SecurityPolicy ermöglicht es Diensten, Informationen zu ihren eigenen Identitäten in Metadaten zu veröffentlichen.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-113">WS-SecurityPolicy allows services to publish information about their own identities in metadata.</span></span> <span data-ttu-id="4aa8e-114">Wenn diese Identitätsinformationen mittels `svcutil` oder mithilfe anderer Methoden wie <xref:System.ServiceModel.Description.WsdlImporter> abgerufen werden, werde die Daten in die Identitätseigenschaften der Endpunktadressen des [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]-Diensts umgewandelt.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-114">When retrieved via `svcutil` or other methods such as <xref:System.ServiceModel.Description.WsdlImporter>, this identity information is translated to the identity properties of the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] service endpoint addresses.</span></span> <span data-ttu-id="4aa8e-115">Clients, von denen nicht geprüft wird, ob diese Dienstidentitäten korrekt und gültig sind, umgehen die Dienstauthentifizierung.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-115">Clients which do not verify that these service identities are correct and valid effectively bypass service authentication.</span></span> <span data-ttu-id="4aa8e-116">Ein böswilliger Dienst kann solche Clients ausnutzen und Anmeldeinformationen weiterleiten oder andere Man-In-The-Middle-Angriffe ausführen, indem die in der WSDL angegebene Identität geändert wird.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-116">A malicious service can exploit such clients to execute credential forwarding and other "man in the middle" attacks by changing the identity claimed in its WSDL.</span></span>  
  
## <a name="use-x509-certificates-instead-of-ntlm"></a><span data-ttu-id="4aa8e-117">Verwenden von X.509-Zertifikaten anstelle von NTLM</span><span class="sxs-lookup"><span data-stu-id="4aa8e-117">Use X509 Certificates Instead of NTLM</span></span>  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="4aa8e-118"> bietet zwei Mechanismen für die Peer-to-Peer-Authentifizierung: X509-Zertifikate (die vom Peerkanal verwendet werden) und Windows-Authentifizierung, bei der eine SSPI-Aushandlung von Kerberos zu NTLM herabgestuft wird.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-118"> offers two mechanisms for peer-to-peer authentication: X509 certificates (used by peer channel) and Windows authentication where an SSPI negotiation downgrades from Kerberos to NTLM.</span></span>  <span data-ttu-id="4aa8e-119">Die zertifikatbasierte Authentifizierung mit Schlüsselgrößen von 1024&#160;Bits oder mehr wird gegenüber NTLM aus mehreren Gründen vorgezogen:</span><span class="sxs-lookup"><span data-stu-id="4aa8e-119">Certificate-based authentication using key sizes of 1024 bits or more is preferred to NTLM for several reasons:</span></span>  
  
-   <span data-ttu-id="4aa8e-120">Verfügbarkeit der gegenseitigen Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="4aa8e-120">the availability of mutual authentication,</span></span>  
  
-   <span data-ttu-id="4aa8e-121">Verwendung stärkerer Kryptografiealgorithmen</span><span class="sxs-lookup"><span data-stu-id="4aa8e-121">the use of stronger cryptographic algorithms, and</span></span>  
  
-   <span data-ttu-id="4aa8e-122">Erschwerte Verwendung weitergeleiteter X509-Anmeldeinformationen</span><span class="sxs-lookup"><span data-stu-id="4aa8e-122">the greater difficulty of utilizing forwarded X509 credentials.</span></span>  
  
 <span data-ttu-id="4aa8e-123">Eine Übersicht über NTLM Angriffe weiterleiten, finden Sie unter [ http://msdn.microsoft.com/msdnmag/issues/06/09/SecureByDesign/default.aspx ](http://go.microsoft.com/fwlink/?LinkId=109571).</span><span class="sxs-lookup"><span data-stu-id="4aa8e-123">For an overview of NTLM forwarding attacks, go to [http://msdn.microsoft.com/msdnmag/issues/06/09/SecureByDesign/default.aspx](http://go.microsoft.com/fwlink/?LinkId=109571).</span></span>  
  
## <a name="always-revert-after-impersonation"></a><span data-ttu-id="4aa8e-124">Stellen Sie nach Identitätswechseln immer die ursprüngliche Identität wieder her</span><span class="sxs-lookup"><span data-stu-id="4aa8e-124">Always Revert After Impersonation</span></span>  
 <span data-ttu-id="4aa8e-125">Wenn Sie APIs verwenden, die den Identitätswechsel eines Clients ermöglichen, stellen Sie sicher, dass die ursprüngliche Identität wiederhergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-125">When using APIs that enable impersonation of a client, be sure to revert to the original identity.</span></span> <span data-ttu-id="4aa8e-126">Z. B. bei Verwendung der <xref:System.Security.Principal.WindowsIdentity> und <xref:System.Security.Principal.WindowsImpersonationContext>, verwenden Sie die C#- `using` -Anweisung oder die Visual Basic`Using` Anweisung, wie im folgenden Code gezeigt.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-126">For example, when using the <xref:System.Security.Principal.WindowsIdentity> and <xref:System.Security.Principal.WindowsImpersonationContext>, use the C# `using` statement or the Visual Basic`Using` statement, as shown in the following code.</span></span> <span data-ttu-id="4aa8e-127">Die <xref:System.Security.Principal.WindowsImpersonationContext>-Klasse implementiert die <xref:System.IDisposable>-Schnittstelle, und daher stellt die CLR (Common Language Runtime) automatisch die ursprüngliche Identität wieder her, sobald die Ausführung des `using`-Blocks abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-127">The <xref:System.Security.Principal.WindowsImpersonationContext> class implements the <xref:System.IDisposable> interface, and therefore the common language runtime (CLR) automatically reverts to the original identity once the code leaves the `using` block.</span></span>  
  
 [!code-csharp[c_SecurityBestPractices#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_securitybestpractices/cs/source.cs#1)]
 [!code-vb[c_SecurityBestPractices#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_securitybestpractices/vb/source.vb#1)]  
  
## <a name="impersonate-only-as-needed"></a><span data-ttu-id="4aa8e-128">Nehmen Sie Identitätswechsel nur bei Bedarf vor</span><span class="sxs-lookup"><span data-stu-id="4aa8e-128">Impersonate Only as Needed</span></span>  
 <span data-ttu-id="4aa8e-129">Mithilfe der <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A>-Methode der <xref:System.Security.Principal.WindowsIdentity>-Klasse ist es möglich, Identitätswechsel in einem sehr eingeschränkten Bereich vorzunehmen.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-129">Using the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method of the <xref:System.Security.Principal.WindowsIdentity> class, it is possible to use impersonation in a very controlled scope.</span></span> <span data-ttu-id="4aa8e-130">Dies steht im Gegensatz zum Einsatz der <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A>-Eigenschaft der <xref:System.ServiceModel.OperationBehaviorAttribute>-Klasse, die Identitätswechsel im gesamten Vorgangsbereich zulässt.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-130">This is in contrast to using the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute>, which allows impersonation for the scope of the entire operation.</span></span> <span data-ttu-id="4aa8e-131">Wenn möglich, kontrollieren Sie mithilfe der präziseren <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A>-Methode den Bereich des Identitätswechsels.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-131">Whenever possible, control the scope of impersonation by using the more precise <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method.</span></span>  
  
## <a name="obtain-metadata-from-trusted-sources"></a><span data-ttu-id="4aa8e-132">Abrufen von Metadaten aus vertrauenswürdigen Quellen</span><span class="sxs-lookup"><span data-stu-id="4aa8e-132">Obtain Metadata from Trusted Sources</span></span>  
 <span data-ttu-id="4aa8e-133">Stellen Sie sicher, dass die Metadatenquelle vertrauenswürdig ist und dass die Metadaten nicht manipuliert wurden.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-133">Be sure you trust the source of your metadata and make sure that no one has tampered with the metadata.</span></span> <span data-ttu-id="4aa8e-134">Über das HTTP-Protokoll abgerufene Metadaten werden im Klartext gesendet und können manipuliert werden.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-134">Metadata retrieved using the HTTP protocol is sent in clear text and can be tampered with.</span></span> <span data-ttu-id="4aa8e-135">Wenn der Dienst die Eigenschaften <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> und <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> nutzt, verwenden Sie die URL, die der Dienstersteller zum Herunterladen der Daten über das HTTPS-Protokoll angegeben hat.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-135">If the service uses the <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetEnabled%2A> and <xref:System.ServiceModel.Description.ServiceMetadataBehavior.HttpsGetUrl%2A> properties, use the URL supplied by the service creator to download the data using the HTTPS protocol.</span></span>  
  
## <a name="publish-metadata-using-security"></a><span data-ttu-id="4aa8e-136">Veröffentlichen von Metadaten unter Verwendung von Sicherheitsfeatures</span><span class="sxs-lookup"><span data-stu-id="4aa8e-136">Publish Metadata Using Security</span></span>  
 <span data-ttu-id="4aa8e-137">Damit die veröffentlichten Metadaten eines Diensts nicht manipuliert werden können, schützen Sie den Endpunkt für den Metadatenaustausch mit Sicherheitsfeatures auf Transport- oder Nachrichtenebene.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-137">To prevent tampering with a service's published metadata, secure the metadata exchange endpoint with transport or message-level security.</span></span> <span data-ttu-id="4aa8e-138">Weitere Informationen finden Sie unter [Veröffentlichen von Metadatenendpunkten](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) und [Vorgehensweise: Veröffentlichen von Metadaten für einen Dienst mithilfe von Code](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).</span><span class="sxs-lookup"><span data-stu-id="4aa8e-138">For more information, see [Publishing Metadata Endpoints](../../../../docs/framework/wcf/publishing-metadata-endpoints.md) and [How to: Publish Metadata for a Service Using Code](../../../../docs/framework/wcf/feature-details/how-to-publish-metadata-for-a-service-using-code.md).</span></span>  
  
## <a name="ensure-use-of-local-issuer"></a><span data-ttu-id="4aa8e-139">Sicherstellen der Verwendung eines lokalen Ausstellers</span><span class="sxs-lookup"><span data-stu-id="4aa8e-139">Ensure Use of Local Issuer</span></span>  
 <span data-ttu-id="4aa8e-140">Wenn für eine bestimmte Bindung eine Ausstelleradresse und eine Bindung angegeben werden, wird der lokale Aussteller nicht für Endpunkte genutzt, die diese Bindung verwenden.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-140">If an issuer address and binding are specified for a given binding, the local issuer is not used for endpoints that use that binding.</span></span> <span data-ttu-id="4aa8e-141">Clients, die immer den lokalen Aussteller verwenden möchten, sollten sicherstellen, dass keine solche Bindung verwendet wird oder dass die Bindung so geändert wird, dass die Ausstelleradresse NULL lautet.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-141">Clients who expect to always use the local issuer should ensure that they do not use such a binding or that they modify the binding such that the issuer address is null.</span></span>  
  
## <a name="saml-token-size-quotas"></a><span data-ttu-id="4aa8e-142">Größenkontingente für SAML-Token</span><span class="sxs-lookup"><span data-stu-id="4aa8e-142">SAML Token Size Quotas</span></span>  
 <span data-ttu-id="4aa8e-143">Wenn SAML (Security Assertions Markup Language)-Token in Nachrichten serialisiert werden, z.&#160;B. wenn sie von einem Sicherheitstokendienst (Security Token Service, STS) ausgestellt werden oder von Clients im Rahmen der Authentifizierung an Dienste übergegeben werden, muss das Kontingent für die maximale Nachrichtengröße groß genug sein, um das SAML-Token und die anderen Teile der Nachricht aufnehmen zu können.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-143">When Security Assertions Markup Language (SAML) tokens are serialized in messages, either when they are issued by a Security Token Service (STS) or when clients present them to services as part of authentication, the maximum message size quota must be sufficiently large to accommodate the SAML token and the other message parts.</span></span> <span data-ttu-id="4aa8e-144">Normalerweise ist das Kontingent für Nachrichten in Standardgröße ausreichend.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-144">In normal cases, the default message size quotas are sufficient.</span></span> <span data-ttu-id="4aa8e-145">Wenn ein SAML-Token allerdings sehr groß ist, weil es mehrere Hundert Ansprüche enthält, sollten Sie das Kontingent erhöhen, damit das serialisierte Token darin Platz findet.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-145">However, in cases where a SAML token is large because it contains hundreds of claims, the quotas should be increased to accommodate the serialized token.</span></span> <span data-ttu-id="4aa8e-146">Weitere Informationen zu Kontingenten finden Sie unter [Sicherheitsüberlegungen zu Daten](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span><span class="sxs-lookup"><span data-stu-id="4aa8e-146">For more information about quotas, see [Security Considerations for Data](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md).</span></span>  
  
## <a name="set-securitybindingelementincludetimestamp-to-true-on-custom-bindings"></a><span data-ttu-id="4aa8e-147">Festlegen von SecurityBindingElement.IncludeTimestamp für benutzerdefinierte Bindungen auf TRUE</span><span class="sxs-lookup"><span data-stu-id="4aa8e-147">Set SecurityBindingElement.IncludeTimestamp to True on Custom Bindings</span></span>  
 <span data-ttu-id="4aa8e-148">Wenn Sie eine benutzerdefinierte Bindung erstellen, müssen Sie <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> auf `true` festlegen.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-148">When you create a custom binding, you must set <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> to `true`.</span></span> <span data-ttu-id="4aa8e-149">Wenn <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> auf `false` festgelegt ist und der Client ein auf einem asymmetrischen Schlüssel basierendes Token verwendet, z. B. ein X.509-Zertifikat, wird die Nachricht nicht signiert.</span><span class="sxs-lookup"><span data-stu-id="4aa8e-149">Otherwise, if <xref:System.ServiceModel.Channels.SecurityBindingElement.IncludeTimestamp%2A> is set to `false`, and the client is using an asymmetric key-based token such as an X509 certificate, the message will not be signed.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4aa8e-150">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="4aa8e-150">See Also</span></span>  
 [<span data-ttu-id="4aa8e-151">Sicherheitsüberlegungen</span><span class="sxs-lookup"><span data-stu-id="4aa8e-151">Security Considerations</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)  
 [<span data-ttu-id="4aa8e-152">Sicherheitsüberlegungen zu Daten</span><span class="sxs-lookup"><span data-stu-id="4aa8e-152">Security Considerations for Data</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-for-data.md)  
 [<span data-ttu-id="4aa8e-153">Sicherheitsüberlegungen für Metadaten</span><span class="sxs-lookup"><span data-stu-id="4aa8e-153">Security Considerations with Metadata</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-with-metadata.md)
