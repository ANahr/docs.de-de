---
title: Suchproxybeispiel
ms.date: 03/30/2017
ms.assetid: 1dfa02df-15b1-4e97-9c8e-f5f2772711b0
ms.openlocfilehash: 6fc0680bc6b61a6fe1b4b141c8b1e5081df5a124
ms.sourcegitcommit: 3c1c3ba79895335ff3737934e39372555ca7d6d0
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/05/2018
ms.locfileid: "43747911"
---
# <a name="discovery-proxy-sample"></a><span data-ttu-id="d1d2e-102">Suchproxybeispiel</span><span class="sxs-lookup"><span data-stu-id="d1d2e-102">Discovery Proxy Sample</span></span>
<span data-ttu-id="d1d2e-103">In diesem Beispiel wird gezeigt, wie eine Implementierung eines Suchproxys erstellt wird, um Informationen zu vorhandenen Diensten zu speichern, und wie Clients Informationen von diesem Proxy abfragen können.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-103">This sample shows how to create an implementation of a Discovery proxy to store information about existing services and how clients can query that proxy for information.</span></span> <span data-ttu-id="d1d2e-104">Dieses Beispiel umfasst drei Projekte:</span><span class="sxs-lookup"><span data-stu-id="d1d2e-104">This sample consists of three projects:</span></span>  
  
-   <span data-ttu-id="d1d2e-105">**Dienst**: einen einfachen rechnerdienst von Windows Communication Foundation (WCF), der sich beim suchproxy registriert.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-105">**Service**: A simple Windows Communication Foundation (WCF) calculator service that registers itself with the discovery proxy.</span></span>  
  
-   <span data-ttu-id="d1d2e-106">**Suchproxy**: die Implementierung eines suchproxydiensts.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-106">**Discovery Proxy**: The implementation of a discovery proxy service.</span></span>  
  
-   <span data-ttu-id="d1d2e-107">**Client**: ein WCF-Clientanwendung, die den suchproxy zum Suchen nach Diensten aufruft.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-107">**Client**: A WCF client application that calls the discovery proxy to search for services.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="d1d2e-108">Veranschaulicht</span><span class="sxs-lookup"><span data-stu-id="d1d2e-108">Demonstrates</span></span>  
 <span data-ttu-id="d1d2e-109">Implementierung eines Suchproxys</span><span class="sxs-lookup"><span data-stu-id="d1d2e-109">Discovery proxy implementation</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="d1d2e-110">Die Beispiele sind möglicherweise bereits auf dem Computer installiert.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-110">The samples may already be installed on your machine.</span></span> <span data-ttu-id="d1d2e-111">Suchen Sie nach dem folgenden Verzeichnis (Standardverzeichnis), bevor Sie fortfahren.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-111">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="d1d2e-112">Wenn dieses Verzeichnis nicht vorhanden ist, fahren Sie mit [Windows Communication Foundation (WCF) und Windows Workflow Foundation (WF) Samples für .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) alle Windows Communication Foundation (WCF) herunterladen und [!INCLUDE[wf1](../../../../includes/wf1-md.md)] Beispiele.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-112">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="d1d2e-113">Dieses Beispiel befindet sich im folgenden Verzeichnis.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-113">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Discovery\DiscoveryProxy`  
  
## <a name="discoveryproxy"></a><span data-ttu-id="d1d2e-114">DiscoveryProxy</span><span class="sxs-lookup"><span data-stu-id="d1d2e-114">DiscoveryProxy</span></span>  
 <span data-ttu-id="d1d2e-115">Im Beispiel wird in der `Main`-Methode der Datei Program.cs gezeigt, wie ein Dienst des Typs <xref:System.ServiceModel.Discovery.DiscoveryProxy> gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-115">In the `Main` method of the Program.cs file, the sample shows how a service of type <xref:System.ServiceModel.Discovery.DiscoveryProxy> is hosted.</span></span> <span data-ttu-id="d1d2e-116">Zwei Endpunkte, einer vom Typ <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> und einer vom Typ <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>, werden verfügbar gemacht.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-116">It exposes two endpoints, one of type <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> and another of type <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span></span> <span data-ttu-id="d1d2e-117">Beide Endpunkte verwenden TCP als Transport.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-117">Both of the endpoints use TCP as a transport.</span></span> <span data-ttu-id="d1d2e-118">Der <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> hört den durch den `probeEndpointAddress`-Parameter festgelegten URI ab. An dieser Stelle können Clients Überprüfungsnachrichten senden, um Daten vom Proxy abzufragen.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-118">The <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> is listening at the URI specified by the `probeEndpointAddress` parameter, this is where clients can send probe messages to query the proxy for its data.</span></span> <span data-ttu-id="d1d2e-119">Der <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> hört den durch den `announcementEndpointAddress`-Parameter festgelegten URI ab.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-119">The <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> is listening at the URI specified by the `announcementEndpointAddress` parameter.</span></span> <span data-ttu-id="d1d2e-120">An dieser Stelle lauscht der Proxy auf Ankündigungen.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-120">This is where the proxy listens to for announcements.</span></span> <span data-ttu-id="d1d2e-121">Wenn eine Onlineankündigung empfangen wird, fügt der Proxy den Dienst zum Cache hinzu, und wenn eine Offlineankündigung empfangen wird, entfernt er den Dienst aus seinem Cache.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-121">When an online announcement is received, the proxy adds the service to its cache and when an offline announcement is received it removes the service from its cache.</span></span>  
  
 <span data-ttu-id="d1d2e-122">Die Datei DiscoveryProxy.cs enthält die <xref:System.ServiceModel.Discovery.DiscoveryProxy>-Implementierung.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-122">The DiscoveryProxy.cs contains the implementation of the <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span></span> <span data-ttu-id="d1d2e-123">Der Proxy muss von der <xref:System.Object>-Klasse erben und erfordert eine <xref:System.Runtime.Remoting.Messaging.AsyncResult>-Implementierung.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-123">The Proxy must inherit from the <xref:System.Object> class and requires an implementation of <xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span></span> <span data-ttu-id="d1d2e-124">Bei der Instanziierung erstellt der Proxy ein neues <xref:System.Collections.Generic.Dictionary%602>, mit dem er bekannte Elemente speichert.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-124">At instantiation, the Proxy creates a new <xref:System.Collections.Generic.Dictionary%602>, which it uses to store elements it knows about.</span></span>  
  
 <span data-ttu-id="d1d2e-125">Die Datei ist in zwei Bereiche, Proxy Cache Methods und Discovery Proxy Implementation, unterteilt.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-125">The file is divided into two regions, Proxy Cache Methods and Discovery Proxy Implementation.</span></span> <span data-ttu-id="d1d2e-126">Die im Bereich Proxy Cache Methods enthaltenen Methoden werden verwendet, um das <xref:System.Collections.Generic.Dictionary%602> zu aktualisieren, <xref:System.Collections.Generic.Dictionary%602>-Abfragen durchzuführen und die Daten für die Benutzer zu drucken.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-126">The Proxy Cache Methods region contains methods used to update the <xref:System.Collections.Generic.Dictionary%602>, perform queries against the <xref:System.Collections.Generic.Dictionary%602>, and print the data for users.</span></span> <span data-ttu-id="d1d2e-127">Im Bereich Discovery Proxy Implementation sind die überschriebenen Methoden enthalten, die für die Ankündigungs- und Untersuchungsfunktionen erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-127">The Discovery Proxy Implementation region contains the overridden methods required for the Announcement and Probe functionality.</span></span> <span data-ttu-id="d1d2e-128">Sie definieren die Aktionen, die von einem Proxy durchgeführt werden, nachdem eine Onlineankündigung, Offlineankündigung oder Überprüfungsnachricht empfangen wurde.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-128">They define the actions taken by a proxy after receiving an Online Announcement, an Offline Announcement, or a Probe message.</span></span>  
  
## <a name="service"></a><span data-ttu-id="d1d2e-129">Dienst</span><span class="sxs-lookup"><span data-stu-id="d1d2e-129">Service</span></span>  
 <span data-ttu-id="d1d2e-130">In der Datei Program.cs im Dienstprojekt wird der gleiche URI für den Ankündigungsendpunkt als Suchproxy verwendet.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-130">In the Program.cs file in the Service project, the same URI is used for its announcement endpoint as the discovery proxy.</span></span> <span data-ttu-id="d1d2e-131">Das liegt daran, dass der Dienst den Endpunkt zum Senden der Ankündigungen und der Proxy zum Empfangen der Ankündigungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-131">This is because service uses the endpoint for sending the announcements, while the proxy uses it for receiving them.</span></span> <span data-ttu-id="d1d2e-132">Der Dienst verwendet das <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> und fügt einen Ankündigungsendpunkt hinzu.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-132">The service uses the <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> and adds an announcement endpoint to it.</span></span>  
  
## <a name="client"></a><span data-ttu-id="d1d2e-133">Client</span><span class="sxs-lookup"><span data-stu-id="d1d2e-133">Client</span></span>  
 <span data-ttu-id="d1d2e-134">Das Clientprojekt verwendet den gleichen URI für den Überprüfungsendpunkt wie der Proxy.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-134">The Client project uses the same URI for its probe endpoint as the Proxy.</span></span> <span data-ttu-id="d1d2e-135">Das liegt daran, dass die Überprüfungen in diesem Szenario auch per Unicast ausdrücklich an den Endpunkt im Proxy gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-135">This is because the probes in this scenario are also being unicast specifically to the endpoint available on the proxy.</span></span> <span data-ttu-id="d1d2e-136">Der Client stellt eine Verbindung mit dieser bekannten Adresse her und führt dann eine Abfrage nach dem Dienst durch.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-136">The Client connects to this well-known address and then queries it for the service.</span></span> <span data-ttu-id="d1d2e-137">Sobald der Dienst gefunden wurde, wird eine Verbindung zu dem Dienst hergestellt.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-137">Once it has found the service it connects to it.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="d1d2e-138">So verwenden Sie dieses Beispiel</span><span class="sxs-lookup"><span data-stu-id="d1d2e-138">To use this sample</span></span>  
  
1.  <span data-ttu-id="d1d2e-139">Laden Sie die Projektmappe in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], und erstellen Sie das Projekt.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-139">Load the project solution in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] and build the project.</span></span>  
  
2.  <span data-ttu-id="d1d2e-140">Führen Sie zunächst die unter [Projektmappenbasisverzeichnis]\DiscoveryProxy\bin\debug generierte Suchproxyanwendung aus.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-140">First run the Discovery Proxy application, generated in [solution base directory]\DiscoveryProxy\bin\debug.</span></span> <span data-ttu-id="d1d2e-141">Der Suchproxy muss zuerst ausgeführt werden, da TCP-Ankündigungsendpunkte für den Dienst bereit sein müssen, damit die Ankündigungen gesendet werden können.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-141">The Discovery Proxy must run first because TCP announcement endpoints must be up for the service to send its announcements.</span></span>  
  
3.  <span data-ttu-id="d1d2e-142">Führen Sie als Nächstes die unter [Projektmappenbasisverzeichnis] \Service\bin\debug generierte Dienstanwendung aus.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-142">Second, run the service application generated in [solution base directory]\Service\bin\debug.</span></span> <span data-ttu-id="d1d2e-143">Beim Start sendet der Dienst eine Ankündigung an den Ankündigungsendpunkt des Suchproxys und wird im Cache des Proxys registriert.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-143">At start-up, the service sends an announcement to the announcement endpoint of the discovery proxy and is registered in the proxy’s cache.</span></span>  
  
4.  <span data-ttu-id="d1d2e-144">Führen Sie anschließend die unter [Projektmappenbasisverzeichnis] \Client\bin\debug generierte Clientanwendung aus.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-144">Next, run the client application, generated in [solution base directory]\Client\bin\debug.</span></span> <span data-ttu-id="d1d2e-145">Der Client führt die Proxyabfrage durch, ruft die Dienstadresse ab und stellt dann eine Verbindung mit dem Dienst her.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-145">The client queries the proxy, gets the service address and then connects to the service.</span></span>  
  
5.  <span data-ttu-id="d1d2e-146">Beenden Sie schließlich den Client, den Dienst und dann den Proxy.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-146">Lastly, terminate the client, service and then the proxy.</span></span> <span data-ttu-id="d1d2e-147">Der Proxy muss ausgeführt werden, damit er die Offlineankündigung des Diensts empfangen kann.</span><span class="sxs-lookup"><span data-stu-id="d1d2e-147">The proxy must be running for it to receive the service's offline announcement.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d1d2e-148">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="d1d2e-148">See Also</span></span>
