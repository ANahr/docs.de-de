---
title: Threading-Modell
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- text on buttons [WPF], updating
- message processing [WPF], nested
- blocking operations [WPF]
- Common Language Runtime (CLR), locking mechanism
- locking mechanism of Common Language Runtime (CLR)
- threading model [WPF]
- Word [WPF], spelling checking
- button text [WPF], updating
- spelling checking in Word [WPF]
- asynchronous behavior [WPF], exposing
- nested message processing [WPF]
- reentrancy [WPF]
ms.assetid: 02d8fd00-8d7c-4604-874c-58e40786770b
ms.openlocfilehash: 15115cc0ed14cb5605100ebe47abd5cd4dc02ec0
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 05/04/2018
ms.locfileid: "33549502"
---
# <a name="threading-model"></a><span data-ttu-id="a6522-102">Threading-Modell</span><span class="sxs-lookup"><span data-stu-id="a6522-102">Threading Model</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]<span data-ttu-id="a6522-103"> soll Entwicklern bei Problemen mit Threading helfen.</span><span class="sxs-lookup"><span data-stu-id="a6522-103"> is designed to save developers from the difficulties of threading.</span></span> <span data-ttu-id="a6522-104">Als Ergebnis der meisten [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] -Entwickler müssen eine Schnittstelle zu schreiben, mehrere Threads verwendet.</span><span class="sxs-lookup"><span data-stu-id="a6522-104">As a result, the majority of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] developers won't have to write an interface that uses more than one thread.</span></span> <span data-ttu-id="a6522-105">Da Multithreadprogramme komplex und schwierig zu debuggen sind, sollten sie vermieden werden, wenn Singlethread-Lösungen vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="a6522-105">Because multithreaded programs are complex and difficult to debug, they should be avoided when single-threaded solutions exist.</span></span>  
  
 <span data-ttu-id="a6522-106">Ganz gleich, wie gut ausgelegt, jedoch keine [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Framework wird nie in der Lage, eine Singlethread-Lösung für jede Art von Problem bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="a6522-106">No matter how well architected, however, no [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] framework will ever be able to provide a single-threaded solution for every sort of problem.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="a6522-107"> Schließen, stammen, aber es noch Situationen sind, in denen mehrere Threads verbessern [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] Leistung Reaktionsfähigkeit oder Anwendung.</span><span class="sxs-lookup"><span data-stu-id="a6522-107"> comes close, but there are still situations where multiple threads improve [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] responsiveness or application performance.</span></span> <span data-ttu-id="a6522-108">In diesem Artikel werden zunächst einige Hintergrundinformationen angegeben, dann einige dieser Situationen beschrieben und am Ende einige Details auf niedriger Ebene besprochen.</span><span class="sxs-lookup"><span data-stu-id="a6522-108">After discussing some background material, this paper explores some of these situations and then concludes with a discussion of some lower-level details.</span></span>  
  

  
> [!NOTE]
>  <span data-ttu-id="a6522-109">In diesem Thema wird erläutert, threading mithilfe der <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> Methode zum asynchronen Aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a6522-109">This topic discusses threading by using the <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> method for asynchronous calls.</span></span> <span data-ttu-id="a6522-110">Sie können auch asynchrone Aufrufe vornehmen, durch Aufrufen der <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> -Methode, die Ausführen einer <xref:System.Action> oder <xref:System.Func%601> als Parameter.</span><span class="sxs-lookup"><span data-stu-id="a6522-110">You can also make asynchronous calls by calling the <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> method, which take an <xref:System.Action> or <xref:System.Func%601> as a parameter.</span></span>  <span data-ttu-id="a6522-111">Die <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> Methode gibt ein <xref:System.Windows.Threading.DispatcherOperation> oder <xref:System.Windows.Threading.DispatcherOperation%601>, verfügt über eine <xref:System.Windows.Threading.DispatcherOperation.Task%2A> Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="a6522-111">The <xref:System.Windows.Threading.Dispatcher.InvokeAsync%2A> method returns a <xref:System.Windows.Threading.DispatcherOperation> or <xref:System.Windows.Threading.DispatcherOperation%601>, which has a <xref:System.Windows.Threading.DispatcherOperation.Task%2A> property.</span></span> <span data-ttu-id="a6522-112">Können Sie die `await` Schlüsselwort entweder mit der <xref:System.Windows.Threading.DispatcherOperation> oder die zugeordnete <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="a6522-112">You can use the `await` keyword with either the <xref:System.Windows.Threading.DispatcherOperation> or the associated <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="a6522-113">Wenn Sie synchron auf das <xref:System.Threading.Tasks.Task> warten müssen, das von <xref:System.Windows.Threading.DispatcherOperation> oder <xref:System.Windows.Threading.DispatcherOperation%601> zurückgegeben wird, rufen Sie die <xref:System.Windows.Threading.TaskExtensions.DispatcherOperationWait%2A>-Erweiterungsmethode auf.</span><span class="sxs-lookup"><span data-stu-id="a6522-113">If you need to wait synchronously for the <xref:System.Threading.Tasks.Task> that is returned by a <xref:System.Windows.Threading.DispatcherOperation> or <xref:System.Windows.Threading.DispatcherOperation%601>, call the <xref:System.Windows.Threading.TaskExtensions.DispatcherOperationWait%2A> extension method.</span></span>  <span data-ttu-id="a6522-114">Aufrufen von <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> führt zu einem Deadlock.</span><span class="sxs-lookup"><span data-stu-id="a6522-114">Calling <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> will result in a deadlock.</span></span> <span data-ttu-id="a6522-115">Weitere Informationen zum Verwenden einer <xref:System.Threading.Tasks.Task> zum Ausführen von asynchronen Vorgängen finden Sie unter Aufgabenparallelität.</span><span class="sxs-lookup"><span data-stu-id="a6522-115">For more information about using a <xref:System.Threading.Tasks.Task> to perform asynchronous operations, see Task Parallelism.</span></span>  <span data-ttu-id="a6522-116">Die <xref:System.Windows.Threading.Dispatcher.Invoke%2A> Methode verfügt auch über Überladungen, ein <xref:System.Action> oder <xref:System.Func%601> als Parameter.</span><span class="sxs-lookup"><span data-stu-id="a6522-116">The <xref:System.Windows.Threading.Dispatcher.Invoke%2A> method also has overloads that take an <xref:System.Action> or <xref:System.Func%601> as a parameter.</span></span>  <span data-ttu-id="a6522-117">Sie können die <xref:System.Windows.Threading.Dispatcher.Invoke%2A> Methode zum Erstellen von synchronen aufruft, durch die Übergabe in einem Delegaten, <xref:System.Action> oder <xref:System.Func%601>.</span><span class="sxs-lookup"><span data-stu-id="a6522-117">You can use the <xref:System.Windows.Threading.Dispatcher.Invoke%2A> method to make synchronous calls by passing in a delegate, <xref:System.Action> or <xref:System.Func%601>.</span></span>  
  
<a name="threading_overview"></a>   
## <a name="overview-and-the-dispatcher"></a><span data-ttu-id="a6522-118">Übersicht und Verteiler</span><span class="sxs-lookup"><span data-stu-id="a6522-118">Overview and the Dispatcher</span></span>  
 <span data-ttu-id="a6522-119">In der Regel [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Anwendungen beginnen mit zwei Threads: eine für die Behandlung von Rendering- und eine andere für die Verwaltung der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a6522-119">Typically, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications start with two threads: one for handling rendering and another for managing the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="a6522-120">Im Renderingthread ausgeführt effektiv verborgen im Hintergrund während der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread empfängt Eingaben, Ereignisse behandelt, den Bildschirm zeichnet und Anwendungscode ausführt.</span><span class="sxs-lookup"><span data-stu-id="a6522-120">The rendering thread effectively runs hidden in the background while the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread receives input, handles events, paints the screen, and runs application code.</span></span> <span data-ttu-id="a6522-121">Die meisten Anwendungen verwenden eine einzelne [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread, obwohl es in einigen Situationen empfiehlt sich, mehrere ist.</span><span class="sxs-lookup"><span data-stu-id="a6522-121">Most applications use a single [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread, although in some situations it is best to use several.</span></span> <span data-ttu-id="a6522-122">Dies wird weiter unten mit einem Beispiel erläutert.</span><span class="sxs-lookup"><span data-stu-id="a6522-122">We’ll discuss this with an example later.</span></span>  
  
 <span data-ttu-id="a6522-123">Die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread Warteschlangen Typen von Arbeitsaufgaben in einem Objekt namens eine <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="a6522-123">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread queues work items inside an object called a <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="a6522-124">Vom <xref:System.Windows.Threading.Dispatcher> werden Arbeitsaufgaben nach Priorität ausgewählt und jeweils vollständig ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="a6522-124">The <xref:System.Windows.Threading.Dispatcher> selects work items on a priority basis and runs each one to completion.</span></span>  <span data-ttu-id="a6522-125">Jede [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread benötigen mindestens ein <xref:System.Windows.Threading.Dispatcher>, und jede <xref:System.Windows.Threading.Dispatcher> Arbeitsaufgaben in genau einem Thread ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="a6522-125">Every [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread must have at least one <xref:System.Windows.Threading.Dispatcher>, and each <xref:System.Windows.Threading.Dispatcher> can execute work items in exactly one thread.</span></span>  
  
 <span data-ttu-id="a6522-126">Der Trick reaktionsfähige, benutzerfreundliche Anwendungen erstellen wird zum Maximieren der <xref:System.Windows.Threading.Dispatcher> Durchsatz klein bleiben, die Arbeitsaufgaben.</span><span class="sxs-lookup"><span data-stu-id="a6522-126">The trick to building responsive, user-friendly applications is to maximize the <xref:System.Windows.Threading.Dispatcher> throughput by keeping the work items small.</span></span> <span data-ttu-id="a6522-127">Diese Elemente veralten der <xref:System.Windows.Threading.Dispatcher> Warteschlange Verarbeitung warten.</span><span class="sxs-lookup"><span data-stu-id="a6522-127">This way items never get stale sitting in the <xref:System.Windows.Threading.Dispatcher> queue waiting for processing.</span></span> <span data-ttu-id="a6522-128">Jede spürbare Verzögerung zwischen Eingabe und Antwort kann für einen Benutzer frustrierend sein.</span><span class="sxs-lookup"><span data-stu-id="a6522-128">Any perceivable delay between input and response can frustrate a user.</span></span>  
  
 <span data-ttu-id="a6522-129">Klicken Sie dann wie sind [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Anwendungen big Vorgänge durchgeführt werden soll?</span><span class="sxs-lookup"><span data-stu-id="a6522-129">How then are [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications supposed to handle big operations?</span></span> <span data-ttu-id="a6522-130">Was geschieht, wenn der Code eine aufwändige Berechnung beinhaltet oder eine Abfrage einer Datenbank auf einem Remoteserver ausführen muss?</span><span class="sxs-lookup"><span data-stu-id="a6522-130">What if your code involves a large calculation or needs to query a database on some remote server?</span></span> <span data-ttu-id="a6522-131">In der Regel wird die Antwort zum Verarbeiten der big-Vorgangs in einem separaten Thread, wodurch die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread frei, um auf Elemente in der Regel die <xref:System.Windows.Threading.Dispatcher> Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="a6522-131">Usually, the answer is to handle the big operation in a separate thread, leaving the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread free to tend to items in the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="a6522-132">Wenn der umfangreiche Vorgang abgeschlossen ist, meldet sie das Ergebnis an die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread für die Anzeige.</span><span class="sxs-lookup"><span data-stu-id="a6522-132">When the big operation is complete, it can report its result back to the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread for display.</span></span>  
  
 <span data-ttu-id="a6522-133">In der Vergangenheit [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)] ermöglicht [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Elemente nur durch den Thread zugegriffen werden kann, die sie erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="a6522-133">Historically, [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)] allows [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements to be accessed only by the thread that created them.</span></span> <span data-ttu-id="a6522-134">Dies bedeutet, dass ein Hintergrundthread bei einer Aufgabe mit langer Laufzeit kein Textfeld aktualisieren kann, wenn er abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="a6522-134">This means that a background thread in charge of some long-running task cannot update a text box when it is finished.</span></span> [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)]<span data-ttu-id="a6522-135"> ist diese Option, um die Integrität gewährleistet [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Komponenten.</span><span class="sxs-lookup"><span data-stu-id="a6522-135"> does this to ensure the integrity of [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] components.</span></span> <span data-ttu-id="a6522-136">Ein Listenfeld könnte merkwürdig aussehen, wenn sein Inhalt während des Zeichnens von einem Hintergrundthread aktualisiert werden würde.</span><span class="sxs-lookup"><span data-stu-id="a6522-136">A list box could look strange if its contents were updated by a background thread during painting.</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="a6522-137"> verfügt über einen integrierten gegenseitigen Ausschlussmechanismus, der diese Koordination erzwingt.</span><span class="sxs-lookup"><span data-stu-id="a6522-137"> has a built-in mutual exclusion mechanism that enforces this coordination.</span></span> <span data-ttu-id="a6522-138">Die meisten Klassen in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] abgeleitet <xref:System.Windows.Threading.DispatcherObject>.</span><span class="sxs-lookup"><span data-stu-id="a6522-138">Most classes in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] derive from <xref:System.Windows.Threading.DispatcherObject>.</span></span> <span data-ttu-id="a6522-139">Bei der Konstruktion einer <xref:System.Windows.Threading.DispatcherObject> speichert einen Verweis auf die <xref:System.Windows.Threading.Dispatcher> mit den derzeit ausgeführten Thread verknüpft.</span><span class="sxs-lookup"><span data-stu-id="a6522-139">At construction, a <xref:System.Windows.Threading.DispatcherObject> stores a reference to the <xref:System.Windows.Threading.Dispatcher> linked to the currently running thread.</span></span> <span data-ttu-id="a6522-140">Tatsächlich die <xref:System.Windows.Threading.DispatcherObject> ordnet dem Thread, der es erstellt.</span><span class="sxs-lookup"><span data-stu-id="a6522-140">In effect, the <xref:System.Windows.Threading.DispatcherObject> associates with the thread that creates it.</span></span> <span data-ttu-id="a6522-141">Während der Ausführung des Programms einer <xref:System.Windows.Threading.DispatcherObject> kann seinen öffentlichen Aufrufen <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> Methode.</span><span class="sxs-lookup"><span data-stu-id="a6522-141">During program execution, a <xref:System.Windows.Threading.DispatcherObject> can call its public <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> method.</span></span> <span data-ttu-id="a6522-142"><xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> überprüft die <xref:System.Windows.Threading.Dispatcher> dem aktuellen Thread zugeordnet, und vergleicht ihn mit der <xref:System.Windows.Threading.Dispatcher> Referenz, die während der Konstruktion gespeichert.</span><span class="sxs-lookup"><span data-stu-id="a6522-142"><xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> examines the <xref:System.Windows.Threading.Dispatcher> associated with the current thread and compares it to the <xref:System.Windows.Threading.Dispatcher> reference stored during construction.</span></span> <span data-ttu-id="a6522-143">Wenn sie nicht übereinstimmen, <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> löst eine Ausnahme aus.</span><span class="sxs-lookup"><span data-stu-id="a6522-143">If they don’t match, <xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> throws an exception.</span></span> <span data-ttu-id="a6522-144"><xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> am Anfang jeder Methode aufgerufen werden soll eine <xref:System.Windows.Threading.DispatcherObject>.</span><span class="sxs-lookup"><span data-stu-id="a6522-144"><xref:System.Windows.Threading.DispatcherObject.VerifyAccess%2A> is intended to be called at the beginning of every method belonging to a <xref:System.Windows.Threading.DispatcherObject>.</span></span>  
  
 <span data-ttu-id="a6522-145">Wenn nur ein Thread ändern, kann die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], wie interagieren Hintergrundthreads mit dem Benutzer?</span><span class="sxs-lookup"><span data-stu-id="a6522-145">If only one thread can modify the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)], how do background threads interact with the user?</span></span> <span data-ttu-id="a6522-146">Bitten Sie ein Hintergrundthread kann die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread zum Ausführen eines Vorgangs in dessen Auftrag aufzubauen.</span><span class="sxs-lookup"><span data-stu-id="a6522-146">A background thread can ask the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread to perform an operation on its behalf.</span></span> <span data-ttu-id="a6522-147">Dies geschieht, indem Sie eine Arbeitsaufgabe mit registriert die <xref:System.Windows.Threading.Dispatcher> von der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-147">It does this by registering a work item with the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-148">Die <xref:System.Windows.Threading.Dispatcher> Klasse bietet zwei Methoden zum Registrieren von Arbeitsaufgaben: <xref:System.Windows.Threading.Dispatcher.Invoke%2A> und <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A>.</span><span class="sxs-lookup"><span data-stu-id="a6522-148">The <xref:System.Windows.Threading.Dispatcher> class provides two methods for registering work items: <xref:System.Windows.Threading.Dispatcher.Invoke%2A> and <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A>.</span></span> <span data-ttu-id="a6522-149">Beide Methoden planen einen Delegaten für die Ausführung ein.</span><span class="sxs-lookup"><span data-stu-id="a6522-149">Both methods schedule a delegate for execution.</span></span> <span data-ttu-id="a6522-150"><xref:System.Windows.Threading.Dispatcher.Invoke%2A> ist ein synchroner Aufruf – d. h. es ist nicht erst zurückgegeben, wenn die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread tatsächlich die Ausführung der Delegat abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="a6522-150"><xref:System.Windows.Threading.Dispatcher.Invoke%2A> is a synchronous call – that is, it doesn’t return until the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread actually finishes executing the delegate.</span></span> <span data-ttu-id="a6522-151"><xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> ist asynchron und kehrt sofort zurück.</span><span class="sxs-lookup"><span data-stu-id="a6522-151"><xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> is asynchronous and returns immediately.</span></span>  
  
 <span data-ttu-id="a6522-152">Die <xref:System.Windows.Threading.Dispatcher> ordnet die Elemente in seiner Warteschlange nach Priorität.</span><span class="sxs-lookup"><span data-stu-id="a6522-152">The <xref:System.Windows.Threading.Dispatcher> orders the elements in its queue by priority.</span></span> <span data-ttu-id="a6522-153">Es werden zehn Stufen, die beim Hinzufügen eines Elements angegeben werden können die <xref:System.Windows.Threading.Dispatcher> Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="a6522-153">There are ten levels that may be specified when adding an element to the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="a6522-154">Diese Prioritäten werden beibehalten, der <xref:System.Windows.Threading.DispatcherPriority> Enumeration.</span><span class="sxs-lookup"><span data-stu-id="a6522-154">These priorities are maintained in the <xref:System.Windows.Threading.DispatcherPriority> enumeration.</span></span> <span data-ttu-id="a6522-155">Ausführliche Informationen zu <xref:System.Windows.Threading.DispatcherPriority> Ebenen finden Sie in der [!INCLUDE[TLA2#tla_winfxsdk](../../../../includes/tla2sharptla-winfxsdk-md.md)] Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="a6522-155">Detailed information about <xref:System.Windows.Threading.DispatcherPriority> levels can be found in the [!INCLUDE[TLA2#tla_winfxsdk](../../../../includes/tla2sharptla-winfxsdk-md.md)] documentation.</span></span>  
  
<a name="samples"></a>   
## <a name="threads-in-action-the-samples"></a><span data-ttu-id="a6522-156">Threads in Aktion: Beispiele</span><span class="sxs-lookup"><span data-stu-id="a6522-156">Threads in Action: The Samples</span></span>  
  
<a name="prime_number"></a>   
### <a name="a-single-threaded-application-with-a-long-running-calculation"></a><span data-ttu-id="a6522-157">Eine Singlethread-Anwendung mit einer Berechnung mit langer Laufzeit</span><span class="sxs-lookup"><span data-stu-id="a6522-157">A Single-Threaded Application with a Long-Running Calculation</span></span>  
 <span data-ttu-id="a6522-158">Die meisten [!INCLUDE[TLA#tla_gui#plural](../../../../includes/tlasharptla-guisharpplural-md.md)] verbringen einen großen Teil ihrer Zeit im Leerlauf, beim Warten auf Ereignisse, die in Reaktion auf Benutzerinteraktionen generiert werden.</span><span class="sxs-lookup"><span data-stu-id="a6522-158">Most [!INCLUDE[TLA#tla_gui#plural](../../../../includes/tlasharptla-guisharpplural-md.md)] spend a large portion of their time idle while waiting for events that are generated in response to user interactions.</span></span> <span data-ttu-id="a6522-159">Eine sorgfältige Programmierung mit diesem Leerlaufzeit genutzt werden konstruktive Arbeit, ohne Auswirkungen auf die Reaktionsfähigkeit der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span><span class="sxs-lookup"><span data-stu-id="a6522-159">With careful programming this idle time can be used constructively, without affecting the responsiveness of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)].</span></span> <span data-ttu-id="a6522-160">Die [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Threadingmodell lässt nicht die Eingabe für einen Vorgang im Unterbrechen der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-160">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] threading model doesn’t allow input to interrupt an operation happening in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-161">Dies bedeutet, Sie müssen unbedingt zum Zurückgeben der <xref:System.Windows.Threading.Dispatcher> in regelmäßigen Abständen den Prozess ausstehende Eingabeereignisse, bevor sie veralten.</span><span class="sxs-lookup"><span data-stu-id="a6522-161">This means you must be sure to return to the <xref:System.Windows.Threading.Dispatcher> periodically to process pending input events before they get stale.</span></span>  
  
 <span data-ttu-id="a6522-162">Betrachten Sie das folgende Beispiel:</span><span class="sxs-lookup"><span data-stu-id="a6522-162">Consider the following example:</span></span>  
  
 <span data-ttu-id="a6522-163">![Primzahlen-Screenshot](../../../../docs/framework/wpf/advanced/media/threadingprimenumberscreenshot.PNG "ThreadingPrimeNumberScreenShot")</span><span class="sxs-lookup"><span data-stu-id="a6522-163">![Prime numbers screen shot](../../../../docs/framework/wpf/advanced/media/threadingprimenumberscreenshot.PNG "ThreadingPrimeNumberScreenShot")</span></span>  
  
 <span data-ttu-id="a6522-164">Diese einfache Anwendung zählt ab drei aufwärts und sucht dabei nach Primzahlen.</span><span class="sxs-lookup"><span data-stu-id="a6522-164">This simple application counts upwards from three, searching for prime numbers.</span></span> <span data-ttu-id="a6522-165">Wenn der Benutzer klickt auf die **starten** Schaltfläche, um die Suche beginnt.</span><span class="sxs-lookup"><span data-stu-id="a6522-165">When the user clicks the **Start** button, the search begins.</span></span> <span data-ttu-id="a6522-166">Wenn das Programm eine Primzahl findet, wird die Benutzeroberfläche mit dieser Entdeckung aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="a6522-166">When the program finds a prime, it updates the user interface with its discovery.</span></span> <span data-ttu-id="a6522-167">Der Benutzer kann die Suche zu jedem Zeitpunkt beenden.</span><span class="sxs-lookup"><span data-stu-id="a6522-167">At any point, the user can stop the search.</span></span>  
  
 <span data-ttu-id="a6522-168">Obwohl es sich um eine einfache Anwendung handelt, könnte die Suche nach Primzahlen endlos fortgesetzt werden, was einige Probleme bereitet.</span><span class="sxs-lookup"><span data-stu-id="a6522-168">Although simple enough, the prime number search could go on forever, which presents some difficulties.</span></span>  <span data-ttu-id="a6522-169">Wenn wir die gesamte Suche innerhalb der Click-Ereignishandler der Schaltfläche behandelt, es würde nie zur Verfügung stellen die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread eine Möglichkeit, andere Ereignisse zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="a6522-169">If we handled the entire search inside of the click event handler of the button, we would never give the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread a chance to handle other events.</span></span> <span data-ttu-id="a6522-170">Die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] wäre nicht reagieren, Eingabe- oder Prozess Nachrichten.</span><span class="sxs-lookup"><span data-stu-id="a6522-170">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] would be unable to respond to input or process messages.</span></span> <span data-ttu-id="a6522-171">Sie würde nie neu zeichnen und nie auf Mausklicks auf die Schaltflächen reagieren.</span><span class="sxs-lookup"><span data-stu-id="a6522-171">It would never repaint and never respond to button clicks.</span></span>  
  
 <span data-ttu-id="a6522-172">Wir könnten die Suche nach Primzahlen in einem separaten Thread ausführen, aber dann hätten wir Synchronisierungsprobleme.</span><span class="sxs-lookup"><span data-stu-id="a6522-172">We could conduct the prime number search in a separate thread, but then we would need to deal with synchronization issues.</span></span> <span data-ttu-id="a6522-173">Mit einem Singlethread-Ansatz können wir die Bezeichnung, die die größte gefundene Primzahl auflistet, direkt aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="a6522-173">With a single-threaded approach, we can directly update the label that lists the largest prime found.</span></span>  
  
 <span data-ttu-id="a6522-174">Wenn die in überschaubare Abschnitte aufgeteilt wird, können wir in regelmäßigen Abständen zurück zu den <xref:System.Windows.Threading.Dispatcher> Ereignisse und zu verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="a6522-174">If we break up the task of calculation into manageable chunks, we can periodically return to the <xref:System.Windows.Threading.Dispatcher> and process events.</span></span> <span data-ttu-id="a6522-175">Vergeben wir [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Gelegenheit zum Aktualisieren und Verarbeiten der Eingabe.</span><span class="sxs-lookup"><span data-stu-id="a6522-175">We can give [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] an opportunity to repaint and process input.</span></span>  
  
 <span data-ttu-id="a6522-176">Ist die beste Möglichkeit, die Verarbeitungszeit zwischen der Berechnung und der Ereignisbehandlung aufzuteilen Berechnung von der Verwaltung der <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="a6522-176">The best way to split processing time between calculation and event handling is to manage calculation from the <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="a6522-177">Mithilfe der <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> -Methode, können wir Primzahl Überprüfungen planen identisch, die in die Warteschlange [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Ereignisse stammen aus.</span><span class="sxs-lookup"><span data-stu-id="a6522-177">By using the <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> method, we can schedule prime number checks in the same queue that [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] events are drawn from.</span></span> <span data-ttu-id="a6522-178">In unserem Beispiel planen wir nur eine einzige Primzahlüberprüfung zu einem Zeitpunkt ein.</span><span class="sxs-lookup"><span data-stu-id="a6522-178">In our example, we schedule only a single prime number check at a time.</span></span> <span data-ttu-id="a6522-179">Nach Abschluss der Primzahlüberprüfung planen wir sofort die nächste Überprüfung ein.</span><span class="sxs-lookup"><span data-stu-id="a6522-179">After the prime number check is complete, we schedule the next check immediately.</span></span> <span data-ttu-id="a6522-180">Diese Überprüfung fortgesetzt, nachdem ausstehende [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] behandelt wurden.</span><span class="sxs-lookup"><span data-stu-id="a6522-180">This check proceeds only after pending [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] events have been handled.</span></span>  
  
 <span data-ttu-id="a6522-181">![Darstellung der Dispatcher-Warteschlange](../../../../docs/framework/wpf/advanced/media/threadingdispatcherqueue.PNG "ThreadingDispatcherQueue")</span><span class="sxs-lookup"><span data-stu-id="a6522-181">![Dispatcher queue illustration](../../../../docs/framework/wpf/advanced/media/threadingdispatcherqueue.PNG "ThreadingDispatcherQueue")</span></span>  
  
 [!INCLUDE[TLA#tla_word](../../../../includes/tlasharptla-word-md.md)]<span data-ttu-id="a6522-182"> führt die Rechtschreibprüfung mithilfe dieses Mechanismus durch.</span><span class="sxs-lookup"><span data-stu-id="a6522-182"> accomplishes spell checking using this mechanism.</span></span> <span data-ttu-id="a6522-183">Rechtschreibprüfung erfolgt im Hintergrund in die Leerlaufzeit an, der die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-183">Spell checking is done in the background using the idle time of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-184">Sehen wir uns den Code an.</span><span class="sxs-lookup"><span data-stu-id="a6522-184">Let's take a look at the code.</span></span>  
  
 <span data-ttu-id="a6522-185">Das folgende Beispiel zeigt die XAML, die die Benutzeroberfläche erstellt.</span><span class="sxs-lookup"><span data-stu-id="a6522-185">The following example shows the XAML that creates the user interface.</span></span>  
  
 [!code-xaml[ThreadingPrimeNumbers#ThreadingPrimeNumberXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml#threadingprimenumberxaml)]  
  
 <span data-ttu-id="a6522-186">Im folgenden Beispiel wird das CodeBehind gezeigt.</span><span class="sxs-lookup"><span data-stu-id="a6522-186">The following example shows the code-behind.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberCodeBehind](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumbercodebehind)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberCodeBehind](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumbercodebehind)]  
  
 <span data-ttu-id="a6522-187">Im folgenden Beispiel wird des ereignishandlers für das <xref:System.Windows.Controls.Button>.</span><span class="sxs-lookup"><span data-stu-id="a6522-187">The following example shows the event handler for the <xref:System.Windows.Controls.Button>.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberStartOrStop](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumberstartorstop)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberStartOrStop](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumberstartorstop)]  
  
 <span data-ttu-id="a6522-188">Neben dem Aktualisieren des Textes in der <xref:System.Windows.Controls.Button>, dieser Handler ist verantwortlich für die Planung der ersten Überprüfung der Primzahl durch Hinzufügen ein Delegaten an die <xref:System.Windows.Threading.Dispatcher> Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="a6522-188">Besides updating the text on the <xref:System.Windows.Controls.Button>, this handler is responsible for scheduling the first prime number check by adding a delegate to the <xref:System.Windows.Threading.Dispatcher> queue.</span></span> <span data-ttu-id="a6522-189">Nachdem dieser Ereignishandler seine Arbeit abgeschlossen hat die <xref:System.Windows.Threading.Dispatcher> wählt diesen Delegaten für die Ausführung.</span><span class="sxs-lookup"><span data-stu-id="a6522-189">Sometime after this event handler has completed its work, the <xref:System.Windows.Threading.Dispatcher> will select this delegate for execution.</span></span>  
  
 <span data-ttu-id="a6522-190">Wie bereits erwähnt <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> ist die <xref:System.Windows.Threading.Dispatcher> Member verwendet, um einen Delegaten für die Ausführung zu planen.</span><span class="sxs-lookup"><span data-stu-id="a6522-190">As we mentioned earlier, <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> is the <xref:System.Windows.Threading.Dispatcher> member used to schedule a delegate for execution.</span></span> <span data-ttu-id="a6522-191">In diesem Fall wählen wir die <xref:System.Windows.Threading.DispatcherPriority.SystemIdle> Priorität.</span><span class="sxs-lookup"><span data-stu-id="a6522-191">In this case, we choose the <xref:System.Windows.Threading.DispatcherPriority.SystemIdle> priority.</span></span> <span data-ttu-id="a6522-192">Die <xref:System.Windows.Threading.Dispatcher> führt dieser Delegat nur, wenn keine wichtige Ereignisse zum Verarbeiten vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="a6522-192">The <xref:System.Windows.Threading.Dispatcher> will execute this delegate only when there are no important events to process.</span></span> [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]<span data-ttu-id="a6522-193">-Reaktionsfähigkeit ist wichtiger als die Zahlenüberprüfung.</span><span class="sxs-lookup"><span data-stu-id="a6522-193"> responsiveness is more important than number checking.</span></span> <span data-ttu-id="a6522-194">Wir übergeben auch einen neuen Delegaten, der die Zahlenüberprüfungsroutine darstellt.</span><span class="sxs-lookup"><span data-stu-id="a6522-194">We also pass a new delegate representing the number-checking routine.</span></span>  
  
 [!code-csharp[ThreadingPrimeNumbers#ThreadingPrimeNumberCheckNextNumber](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingPrimeNumbers/CSharp/Window1.xaml.cs#threadingprimenumberchecknextnumber)]
 [!code-vb[ThreadingPrimeNumbers#ThreadingPrimeNumberCheckNextNumber](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingPrimeNumbers/visualbasic/mainwindow.xaml.vb#threadingprimenumberchecknextnumber)]  
  
 <span data-ttu-id="a6522-195">Diese Methode überprüft, ob die nächste ungerade Zahl eine Primzahl ist.</span><span class="sxs-lookup"><span data-stu-id="a6522-195">This method checks if the next odd number is prime.</span></span> <span data-ttu-id="a6522-196">Wenn es sich Systemdatenträgern handelt, aktualisiert die Methode direkt die `bigPrime` <xref:System.Windows.Controls.TextBlock> entsprechend der Ermittlung.</span><span class="sxs-lookup"><span data-stu-id="a6522-196">If it is prime, the method directly updates the `bigPrime`<xref:System.Windows.Controls.TextBlock> to reflect its discovery.</span></span> <span data-ttu-id="a6522-197">Dies ist möglich, da die Berechnung im selben Thread ausgeführt wird, der für die Erstellung der Komponente verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="a6522-197">We can do this because the calculation is occurring in the same thread that was used to create the component.</span></span> <span data-ttu-id="a6522-198">Hatten wir entschieden, einen separaten Thread für die Berechnung verwendet, es müsste verwenden einen Synchronisierungsmechanismus komplizierteren, und führen das Update in der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-198">Had we chosen to use a separate thread for the calculation, we would have to use a more complicated synchronization mechanism and execute the update in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-199">Wir werden diese Situation im Folgenden zeigen.</span><span class="sxs-lookup"><span data-stu-id="a6522-199">We’ll demonstrate this situation next.</span></span>  
  
 <span data-ttu-id="a6522-200">Den vollständigen Quellcode für dieses Beispiel, finden Sie unter der [Singlethread-Anwendung mit der lang andauernde Berechnung-Beispiel](http://go.microsoft.com/fwlink/?LinkID=160038)</span><span class="sxs-lookup"><span data-stu-id="a6522-200">For the complete source code for this sample, see the [Single-Threaded Application with Long-Running Calculation Sample](http://go.microsoft.com/fwlink/?LinkID=160038)</span></span>  
  
<a name="weather_sim"></a>   
### <a name="handling-a-blocking-operation-with-a-background-thread"></a><span data-ttu-id="a6522-201">Behandeln eines blockierenden Vorgangs mit einem Hintergrundthread</span><span class="sxs-lookup"><span data-stu-id="a6522-201">Handling a Blocking Operation with a Background Thread</span></span>  
 <span data-ttu-id="a6522-202">Die Behandlung von blockierenden Vorgängen in einer grafischen Anwendung kann schwierig sein.</span><span class="sxs-lookup"><span data-stu-id="a6522-202">Handling blocking operations in a graphical application can be difficult.</span></span> <span data-ttu-id="a6522-203">Wir wollen keine blockierenden Methoden von Ereignishandlern aufrufen, da die Anwendung sonst scheinbar einfriert.</span><span class="sxs-lookup"><span data-stu-id="a6522-203">We don’t want to call blocking methods from event handlers because the application will appear to freeze up.</span></span> <span data-ttu-id="a6522-204">Verwenden wir einen separaten Thread, um diese Vorgänge zu behandeln, aber wir haben eine Synchronisierung mit der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread auf, da wir nicht direkt ändern können die [!INCLUDE[TLA2#tla_gui](../../../../includes/tla2sharptla-gui-md.md)] vom Arbeitsthread aus.</span><span class="sxs-lookup"><span data-stu-id="a6522-204">We can use a separate thread to handle these operations, but when we’re done, we have to synchronize with the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread because we can’t directly modify the [!INCLUDE[TLA2#tla_gui](../../../../includes/tla2sharptla-gui-md.md)] from our worker thread.</span></span> <span data-ttu-id="a6522-205">Wir können <xref:System.Windows.Threading.Dispatcher.Invoke%2A> oder <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> einzufügende Delegaten in der <xref:System.Windows.Threading.Dispatcher> von der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-205">We can use <xref:System.Windows.Threading.Dispatcher.Invoke%2A> or <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> to insert delegates into the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-206">Schließlich werden diese Delegaten ausgeführt werden, mit der Berechtigung zum Ändern der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Elemente.</span><span class="sxs-lookup"><span data-stu-id="a6522-206">Eventually, these delegates will be executed with permission to modify [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements.</span></span>  
  
 <span data-ttu-id="a6522-207">In diesem Beispiel simulieren wir einen Remoteprozeduraufruf, der eine Wettervorhersage abruft.</span><span class="sxs-lookup"><span data-stu-id="a6522-207">In this example, we mimic a remote procedure call that retrieves a weather forecast.</span></span> <span data-ttu-id="a6522-208">Wir verwenden einen separater Arbeitsthread aus, um diesen Anruf auszuführen und wir Planen einer Update-Methode in der <xref:System.Windows.Threading.Dispatcher> von der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread, wenn wir fertig sind.</span><span class="sxs-lookup"><span data-stu-id="a6522-208">We use a separate worker thread to execute this call, and we schedule an update method in the <xref:System.Windows.Threading.Dispatcher> of the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread when we’re finished.</span></span>  
  
 <span data-ttu-id="a6522-209">![Wetter-UI-Screenshot](../../../../docs/framework/wpf/advanced/media/threadingweatheruiscreenshot.PNG "ThreadingWeatherUIScreenShot")</span><span class="sxs-lookup"><span data-stu-id="a6522-209">![Weather UI screen shot](../../../../docs/framework/wpf/advanced/media/threadingweatheruiscreenshot.PNG "ThreadingWeatherUIScreenShot")</span></span>  
  
 [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherCodeBehind](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweathercodebehind)]
 [!code-vb[ThreadingWeatherForecast#ThreadingWeatherCodeBehind](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweathercodebehind)]  
  
 <span data-ttu-id="a6522-210">Im Folgenden sind einige der Details aufgeführt, die beachtet werden sollten.</span><span class="sxs-lookup"><span data-stu-id="a6522-210">The following are some of the details to be noted.</span></span>  
  
-   <span data-ttu-id="a6522-211">Erstellen des Schaltflächenhandlers</span><span class="sxs-lookup"><span data-stu-id="a6522-211">Creating the Button Handler</span></span>  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherButtonHandler](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherbuttonhandler)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherButtonHandler](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherbuttonhandler)]  
  
 <span data-ttu-id="a6522-212">Wenn auf die Schaltfläche geklickt wird, wird die Uhr-Zeichnung angezeigt, und wir beginnen mit der Animation.</span><span class="sxs-lookup"><span data-stu-id="a6522-212">When the button is clicked, we display the clock drawing and start animating it.</span></span> <span data-ttu-id="a6522-213">Die Schaltfläche wird deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="a6522-213">We disable the button.</span></span> <span data-ttu-id="a6522-214">Wir rufen die `FetchWeatherFromServer` Methode in einen neuen Thread, und klicken Sie dann wir zurückgegeben, sodass die <xref:System.Windows.Threading.Dispatcher> Ereignisse verarbeiten, während wir warten, bis der Wettervorhersage.</span><span class="sxs-lookup"><span data-stu-id="a6522-214">We invoke the `FetchWeatherFromServer` method in a new thread, and then we return, allowing the <xref:System.Windows.Threading.Dispatcher> to process events while we wait to collect the weather forecast.</span></span>  
  
-   <span data-ttu-id="a6522-215">Abrufen der Wettervorhersage</span><span class="sxs-lookup"><span data-stu-id="a6522-215">Fetching the Weather</span></span>  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherFetchWeather](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherfetchweather)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherFetchWeather](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherfetchweather)]  
  
 <span data-ttu-id="a6522-216">Aus Gründen der Einfachheit verwenden wir in diesem Beispiel keinen Netzwerk-Code.</span><span class="sxs-lookup"><span data-stu-id="a6522-216">To keep things simple, we don’t actually have any networking code in this example.</span></span> <span data-ttu-id="a6522-217">Stattdessen simulieren wir die Verzögerung des Netzwerkzugriffs, indem wir den neuen Thread für vier Sekunden in den Ruhezustand versetzen.</span><span class="sxs-lookup"><span data-stu-id="a6522-217">Instead, we simulate the delay of network access by putting our new thread to sleep for four seconds.</span></span> <span data-ttu-id="a6522-218">In dieser Zeit wird der ursprüngliche [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread noch ausgeführt wird und reagieren auf Ereignisse.</span><span class="sxs-lookup"><span data-stu-id="a6522-218">In this time, the original [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread is still running and responding to events.</span></span> <span data-ttu-id="a6522-219">Um dies zu zeigen, führen wir eine Animation weiterhin aus, und die Schaltflächen „Minimieren“ und „Maximieren“ funktionieren ebenfalls weiterhin.</span><span class="sxs-lookup"><span data-stu-id="a6522-219">To show this, we’ve left an animation running, and the minimize and maximize buttons also continue to work.</span></span>  
  
 <span data-ttu-id="a6522-220">Wenn die Verzögerung abgeschlossen ist, und wir haben unsere Wettervorhersage nach dem Zufallsprinzip ausgewählt, wird es ist Zeit, die zurück an Berichten, die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-220">When the delay is finished, and we’ve randomly selected our weather forecast, it’s time to report back to the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-221">Dazu wird einen Aufruf zum Planen `UpdateUserInterface` in der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread mithilfe des betreffenden Threads <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="a6522-221">We do this by scheduling a call to `UpdateUserInterface` in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread using that thread’s <xref:System.Windows.Threading.Dispatcher>.</span></span> <span data-ttu-id="a6522-222">Wir übergeben eine Zeichenfolge, die das Wetter beschreibt, an diesen eingeplanten Methodenaufruf.</span><span class="sxs-lookup"><span data-stu-id="a6522-222">We pass a string describing the weather to this scheduled method call.</span></span>  
  
-   <span data-ttu-id="a6522-223">Aktualisieren der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]</span><span class="sxs-lookup"><span data-stu-id="a6522-223">Updating the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]</span></span>  
  
     [!code-csharp[ThreadingWeatherForecast#ThreadingWeatherUpdateUI](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingWeatherForecast/CSharp/Window1.xaml.cs#threadingweatherupdateui)]
     [!code-vb[ThreadingWeatherForecast#ThreadingWeatherUpdateUI](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingWeatherForecast/visualbasic/window1.xaml.vb#threadingweatherupdateui)]  
  
 <span data-ttu-id="a6522-224">Wenn die <xref:System.Windows.Threading.Dispatcher> in der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread Zeit hat, führt er den geplanten Aufruf von `UpdateUserInterface`.</span><span class="sxs-lookup"><span data-stu-id="a6522-224">When the <xref:System.Windows.Threading.Dispatcher> in the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread has time, it executes the scheduled call to `UpdateUserInterface`.</span></span> <span data-ttu-id="a6522-225">Diese Methode hält die Uhr-Animation an und wählt ein Bild aus, um das Wetter zu beschreiben.</span><span class="sxs-lookup"><span data-stu-id="a6522-225">This method stops the clock animation and chooses an image to describe the weather.</span></span> <span data-ttu-id="a6522-226">Sie zeigt dieses Bild an und stellt die Schaltfläche „fetch forecast“ (Wettervorhersage abrufen) wieder her.</span><span class="sxs-lookup"><span data-stu-id="a6522-226">It displays this image and restores the "fetch forecast" button.</span></span>  
  
<a name="multi_browser"></a>   
### <a name="multiple-windows-multiple-threads"></a><span data-ttu-id="a6522-227">Mehrere Fenster, mehrere Threads</span><span class="sxs-lookup"><span data-stu-id="a6522-227">Multiple Windows, Multiple Threads</span></span>  
 <span data-ttu-id="a6522-228">Einige [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Anwendungen erfordern mehrere Fenster auf oberster Ebene.</span><span class="sxs-lookup"><span data-stu-id="a6522-228">Some [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications require multiple top-level windows.</span></span> <span data-ttu-id="a6522-229">Ein Thread vollkommen akzeptabel ist /<xref:System.Windows.Threading.Dispatcher> Kombination zum Verwalten von mehreren Fenstern, aber in einigen Fällen mehrere Threads sind besser.</span><span class="sxs-lookup"><span data-stu-id="a6522-229">It is perfectly acceptable for one Thread/<xref:System.Windows.Threading.Dispatcher> combination to manage multiple windows, but sometimes several threads do a better job.</span></span> <span data-ttu-id="a6522-230">Dies trifft besonders zu, wenn die Möglichkeit besteht, dass eines der Fenster den Thread für sich beansprucht.</span><span class="sxs-lookup"><span data-stu-id="a6522-230">This is especially true if there is any chance that one of the windows will monopolize the thread.</span></span>  
  
 [!INCLUDE[TLA#tla_mswin](../../../../includes/tlasharptla-mswin-md.md)]<span data-ttu-id="a6522-231"> Explorer funktioniert auf diese Weise.</span><span class="sxs-lookup"><span data-stu-id="a6522-231"> Explorer works in this fashion.</span></span> <span data-ttu-id="a6522-232">Jedes neue Explorer-Fenster gehört zum ursprünglichen Prozess, wird jedoch unter der Kontrolle eines unabhängigen Threads erstellt.</span><span class="sxs-lookup"><span data-stu-id="a6522-232">Each new Explorer window belongs to the original process, but it is created under the control of an independent thread.</span></span>  
  
 <span data-ttu-id="a6522-233">Mithilfe einer [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] <xref:System.Windows.Controls.Frame> -Steuerelement, wir können Web Pages anzeigen.</span><span class="sxs-lookup"><span data-stu-id="a6522-233">By using a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<xref:System.Windows.Controls.Frame> control, we can display Web pages.</span></span> <span data-ttu-id="a6522-234">Wir können problemlos erstellen eine einfache [!INCLUDE[TLA2#tla_ie](../../../../includes/tla2sharptla-ie-md.md)] ersetzen.</span><span class="sxs-lookup"><span data-stu-id="a6522-234">We can easily create a simple [!INCLUDE[TLA2#tla_ie](../../../../includes/tla2sharptla-ie-md.md)] substitute.</span></span> <span data-ttu-id="a6522-235">Wir beginnen mit einer wichtigen Funktion, und zwar der Möglichkeit, ein neues Explorerfenster zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="a6522-235">We start with an important feature: the ability to open a new explorer window.</span></span> <span data-ttu-id="a6522-236">Wenn der Benutzer auf die Schaltfläche „Neues Fenster“ klickt, starten wir eine Kopie des Fensters in einem separaten Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-236">When the user clicks the "new window" button, we launch a copy of our window in a separate thread.</span></span> <span data-ttu-id="a6522-237">Auf diese Weise sperren lange andauernde oder blockierende Vorgänge in einem der Fenster nicht alle anderen Fenster.</span><span class="sxs-lookup"><span data-stu-id="a6522-237">This way, long-running or blocking operations in one of the windows won’t lock all the other windows.</span></span>  
  
 <span data-ttu-id="a6522-238">In Wirklichkeit verfügt das Webbrowser-Modell über ein eigenes kompliziertes Threadingmodell.</span><span class="sxs-lookup"><span data-stu-id="a6522-238">In reality, the Web browser model has its own complicated threading model.</span></span> <span data-ttu-id="a6522-239">Wir haben uns dafür entschieden, da die meisten Leser damit vertraut sein sollten.</span><span class="sxs-lookup"><span data-stu-id="a6522-239">We’ve chosen it because it should be familiar to most readers.</span></span>  
  
 <span data-ttu-id="a6522-240">Im folgenden Beispiel wird der Code angezeigt.</span><span class="sxs-lookup"><span data-stu-id="a6522-240">The following example shows the code.</span></span>  
  
 [!code-xaml[ThreadingMultipleBrowsers#ThreadingMultiBrowserXAML](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml#threadingmultibrowserxaml)]  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserCodeBehind](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowsercodebehind)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserCodeBehind](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowsercodebehind)]  
  
 <span data-ttu-id="a6522-241">Die folgenden Threadingsegmente dieses Codes sind für uns in diesem Kontext am interessantesten:</span><span class="sxs-lookup"><span data-stu-id="a6522-241">The following threading segments of this code are the most interesting to us in this context:</span></span>  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserNewWindow](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowsernewwindow)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserNewWindow](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowsernewwindow)]  
  
 <span data-ttu-id="a6522-242">Diese Methode wird aufgerufen, wenn die Schaltfläche „Neues Fenster“ angeklickt wird.</span><span class="sxs-lookup"><span data-stu-id="a6522-242">This method is called when the "new window" button is clicked.</span></span> <span data-ttu-id="a6522-243">Sie erstellt einen neuen Thread und startet diesen asynchron.</span><span class="sxs-lookup"><span data-stu-id="a6522-243">It creates a new thread and starts it asynchronously.</span></span>  
  
 [!code-csharp[ThreadingMultipleBrowsers#ThreadingMultiBrowserThreadStart](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ThreadingMultipleBrowsers/CSharp/Window1.xaml.cs#threadingmultibrowserthreadstart)]
 [!code-vb[ThreadingMultipleBrowsers#ThreadingMultiBrowserThreadStart](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/ThreadingMultipleBrowsers/VisualBasic/Window1.xaml.vb#threadingmultibrowserthreadstart)]  
  
 <span data-ttu-id="a6522-244">Diese Methode ist der Ausgangspunkt für den neuen Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-244">This method is the starting point for the new thread.</span></span> <span data-ttu-id="a6522-245">Wir erstellen ein neues Fenster unter der Kontrolle dieses Threads.</span><span class="sxs-lookup"><span data-stu-id="a6522-245">We create a new window under the control of this thread.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="a6522-246"> erstellt automatisch eine neue <xref:System.Windows.Threading.Dispatcher> um den neuen Thread zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="a6522-246"> automatically creates a new <xref:System.Windows.Threading.Dispatcher> to manage the new thread.</span></span> <span data-ttu-id="a6522-247">Müssen wir tun, damit das Fenster funktionsfähig ist, starten die <xref:System.Windows.Threading.Dispatcher>.</span><span class="sxs-lookup"><span data-stu-id="a6522-247">All we have to do to make the window functional is to start the <xref:System.Windows.Threading.Dispatcher>.</span></span>  
  
<a name="stumbling_points"></a>   
## <a name="technical-details-and-stumbling-points"></a><span data-ttu-id="a6522-248">Technische Details und Stolpersteine</span><span class="sxs-lookup"><span data-stu-id="a6522-248">Technical Details and Stumbling Points</span></span>  
  
### <a name="writing-components-using-threading"></a><span data-ttu-id="a6522-249">Schreiben von Komponenten mithilfe von Threading</span><span class="sxs-lookup"><span data-stu-id="a6522-249">Writing Components Using Threading</span></span>  
 <span data-ttu-id="a6522-250">Microsoft .NET Framework-Entwicklerhandbuch beschreibt ein Muster wie eine Komponente für ihre Clients asynchrones Verhalten verfügbar machen kann (siehe [Übersicht über ereignisbasierte asynchrone Muster](../../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)).</span><span class="sxs-lookup"><span data-stu-id="a6522-250">The Microsoft .NET Framework Developer's Guide describes a pattern for how a component can expose asynchronous behavior to its clients (see [Event-based Asynchronous Pattern Overview](../../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)).</span></span> <span data-ttu-id="a6522-251">Angenommen, wir verpacken möchten die `FetchWeatherFromServer` Methode in einer wiederverwendbaren, nongraphical-Komponente.</span><span class="sxs-lookup"><span data-stu-id="a6522-251">For instance, suppose we wanted to package the `FetchWeatherFromServer` method into a reusable, nongraphical component.</span></span> <span data-ttu-id="a6522-252">Gemäß des standardmäßigen Microsoft .NET Framework-Ereignismusters würde dies etwa wie folgt aussehen.</span><span class="sxs-lookup"><span data-stu-id="a6522-252">Following the standard Microsoft .NET Framework pattern, this would look something like the following.</span></span>  
  
 [!code-csharp[CommandingOverviewSnippets#ThreadingArticleWeatherComponent1](../../../../samples/snippets/csharp/VS_Snippets_Wpf/CommandingOverviewSnippets/CSharp/Window1.xaml.cs#threadingarticleweathercomponent1)]
 [!code-vb[CommandingOverviewSnippets#ThreadingArticleWeatherComponent1](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/CommandingOverviewSnippets/visualbasic/window1.xaml.vb#threadingarticleweathercomponent1)]  
  
 <span data-ttu-id="a6522-253">`GetWeatherAsync` würde eine der zuvor beschriebenen Techniken wie z.B. das Erstellen eines Hintergrundthreads verwenden, um die Arbeit asynchron auszuführen und den aufrufenden Thread nicht zu blockieren.</span><span class="sxs-lookup"><span data-stu-id="a6522-253">`GetWeatherAsync` would use one of the techniques described earlier, such as creating a background thread, to do the work asynchronously, not blocking the calling thread.</span></span>  
  
 <span data-ttu-id="a6522-254">Einer der wichtigsten Teile dieses Muster ist das Aufrufen der *MethodName* `Completed` Methode auf dem gleichen Thread, die aufgerufen der *MethodName* `Async` Methode mit dem begonnen.</span><span class="sxs-lookup"><span data-stu-id="a6522-254">One of the most important parts of this pattern is calling the *MethodName*`Completed` method on the same thread that called the *MethodName*`Async` method to begin with.</span></span> <span data-ttu-id="a6522-255">Konnte erreichen Sie dies mit [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] relativ einfach durch das Speichern von <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A>– aber klicken Sie dann die nongraphical Komponente nur in verwendet werden konnte [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Anwendungen, nicht in [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] oder [!INCLUDE[TLA#tla_aspnet](../../../../includes/tlasharptla-aspnet-md.md)] Programme.</span><span class="sxs-lookup"><span data-stu-id="a6522-255">You could do this using [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] fairly easily, by storing <xref:System.Windows.Threading.Dispatcher.CurrentDispatcher%2A>—but then the nongraphical component could only be used in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applications, not in [!INCLUDE[TLA#tla_winforms](../../../../includes/tlasharptla-winforms-md.md)] or [!INCLUDE[TLA#tla_aspnet](../../../../includes/tlasharptla-aspnet-md.md)] programs.</span></span>  
  
 <span data-ttu-id="a6522-256">Die <xref:System.Windows.Threading.DispatcherSynchronizationContext> Klasse diese zielt – betrachten Sie es als eine vereinfachte Version des <xref:System.Windows.Threading.Dispatcher> das funktioniert mit anderen [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] auch Frameworks.</span><span class="sxs-lookup"><span data-stu-id="a6522-256">The <xref:System.Windows.Threading.DispatcherSynchronizationContext> class addresses this need—think of it as a simplified version of <xref:System.Windows.Threading.Dispatcher> that works with other [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] frameworks as well.</span></span>  
  
 [!code-csharp[CommandingOverviewSnippets#ThreadingArticleWeatherComponent2](../../../../samples/snippets/csharp/VS_Snippets_Wpf/CommandingOverviewSnippets/CSharp/Window1.xaml.cs#threadingarticleweathercomponent2)]
 [!code-vb[CommandingOverviewSnippets#ThreadingArticleWeatherComponent2](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/CommandingOverviewSnippets/visualbasic/window1.xaml.vb#threadingarticleweathercomponent2)]  
  
### <a name="nested-pumping"></a><span data-ttu-id="a6522-257">Geschachtelte Verteilung</span><span class="sxs-lookup"><span data-stu-id="a6522-257">Nested Pumping</span></span>  
 <span data-ttu-id="a6522-258">Manchmal ist es nicht möglich, vollständig gesperrt ist, bis der [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-258">Sometimes it is not feasible to completely lock up the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-259">Betrachten wir die <xref:System.Windows.MessageBox.Show%2A> Methode der <xref:System.Windows.MessageBox> Klasse.</span><span class="sxs-lookup"><span data-stu-id="a6522-259">Let’s consider the <xref:System.Windows.MessageBox.Show%2A> method of the <xref:System.Windows.MessageBox> class.</span></span> <span data-ttu-id="a6522-260"><xref:System.Windows.MessageBox.Show%2A> Gibt nicht zurück, bis der Benutzer die Schaltfläche "OK" klickt.</span><span class="sxs-lookup"><span data-stu-id="a6522-260"><xref:System.Windows.MessageBox.Show%2A> doesn’t return until the user clicks the OK button.</span></span> <span data-ttu-id="a6522-261">Es wird jedoch ein Fenster erstellt, das über eine Meldungsschleife verfügen muss, um interaktiv zu sein.</span><span class="sxs-lookup"><span data-stu-id="a6522-261">It does, however, create a window that must have a message loop in order to be interactive.</span></span> <span data-ttu-id="a6522-262">Während wir warten, bis der Benutzer auf „OK“ klickt, reagiert das ursprüngliche Anwendungsfenster nicht auf Benutzereingaben.</span><span class="sxs-lookup"><span data-stu-id="a6522-262">While we are waiting for the user to click OK, the original application window does not respond to user input.</span></span> <span data-ttu-id="a6522-263">Es verarbeitet jedoch weiterhin Paint-Meldungen.</span><span class="sxs-lookup"><span data-stu-id="a6522-263">It does, however, continue to process paint messages.</span></span> <span data-ttu-id="a6522-264">Das ursprüngliche Fenster zeichnet sich selbst neu, wenn es verdeckt war und dann wieder angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="a6522-264">The original window redraws itself when covered and revealed.</span></span>  
  
 <span data-ttu-id="a6522-265">![MessageBox mit einer „OK“-Schaltfläche](../../../../docs/framework/wpf/advanced/media/threadingnestedpumping.png "ThreadingNestedPumping")</span><span class="sxs-lookup"><span data-stu-id="a6522-265">![MessageBox with an "OK" button](../../../../docs/framework/wpf/advanced/media/threadingnestedpumping.png "ThreadingNestedPumping")</span></span>  
  
 <span data-ttu-id="a6522-266">Ein Thread muss für das Meldungsfenster zuständig sein.</span><span class="sxs-lookup"><span data-stu-id="a6522-266">Some thread must be in charge of the message box window.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="a6522-267"> könnte einen neuen Thread nur für das Meldungsfenster erstellen, aber dieser Thread wäre nicht in der Lage, die deaktivierten Elemente im ursprünglichen Fenster zu zeichnen (beachten Sie den bereits erwähnten gegenseitigen Ausschluss).</span><span class="sxs-lookup"><span data-stu-id="a6522-267"> could create a new thread just for the message box window, but this thread would be unable to paint the disabled elements in the original window (remember the earlier discussion of mutual exclusion).</span></span> <span data-ttu-id="a6522-268">Stattdessen [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] verwendet eine geschachtelte Nachricht System zur Verarbeitung.</span><span class="sxs-lookup"><span data-stu-id="a6522-268">Instead, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] uses a nested message processing system.</span></span> <span data-ttu-id="a6522-269">Die <xref:System.Windows.Threading.Dispatcher> Klasse enthält eine besondere Methode namens <xref:System.Windows.Threading.Dispatcher.PushFrame%2A>, dem aktuellen Ausführungspunkt in eine Anwendung speichert eine neue Meldungsschleife beginnt.</span><span class="sxs-lookup"><span data-stu-id="a6522-269">The <xref:System.Windows.Threading.Dispatcher> class includes a special method called <xref:System.Windows.Threading.Dispatcher.PushFrame%2A>, which stores an application’s current execution point then begins a new message loop.</span></span> <span data-ttu-id="a6522-270">Klicken Sie nach Abschluss die geschachtelten Meldungsschleife Ausführung wird fortgesetzt, nachdem die ursprüngliche <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> aufrufen.</span><span class="sxs-lookup"><span data-stu-id="a6522-270">When the nested message loop finishes, execution resumes after the original <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> call.</span></span>  
  
 <span data-ttu-id="a6522-271">In diesem Fall <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> verwaltet die Programmkontext, in dem Aufruf von <xref:System.Windows.MessageBox>.<xref:System.Windows.MessageBox.Show%2A>, und er beginnt eine neue Meldungsschleife zum aktualisiert das Hintergrundfenster und Eingaben für das Meldungsfenster zu behandeln.</span><span class="sxs-lookup"><span data-stu-id="a6522-271">In this case, <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> maintains the program context at the call to <xref:System.Windows.MessageBox>.<xref:System.Windows.MessageBox.Show%2A>, and it starts a new message loop to repaint the background window and handle input to the message box window.</span></span> <span data-ttu-id="a6522-272">Wenn der Benutzer auf OK klickt und das Popupfenster, die geschachtelte Schleife beendet und das Steuerelement wird nach dem Aufruf von <xref:System.Windows.MessageBox.Show%2A>.</span><span class="sxs-lookup"><span data-stu-id="a6522-272">When the user clicks OK and clears the pop-up window, the nested loop exits and control resumes after the call to <xref:System.Windows.MessageBox.Show%2A>.</span></span>  
  
### <a name="stale-routed-events"></a><span data-ttu-id="a6522-273">Veraltete Routingereignisse</span><span class="sxs-lookup"><span data-stu-id="a6522-273">Stale Routed Events</span></span>  
 <span data-ttu-id="a6522-274">Das Routingereignissystem in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] ganze Strukturen werden benachrichtigt, wenn Ereignisse ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="a6522-274">The routed event system in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] notifies entire trees when events are raised.</span></span>  
  
 [!code-xaml[InputOvw#ThreadingArticleStaticRoutedEvent](../../../../samples/snippets/csharp/VS_Snippets_Wpf/InputOvw/CSharp/Page1.xaml#threadingarticlestaticroutedevent)]  
  
 <span data-ttu-id="a6522-275">Wenn die linke Maustaste, über die Ellipse gedrückt wird `handler2` ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="a6522-275">When the left mouse button is pressed over the ellipse, `handler2` is executed.</span></span> <span data-ttu-id="a6522-276">Nach dem `handler2` abgeschlossen ist, das Ereignis entlang übergeben wird, um die <xref:System.Windows.Controls.Canvas> -Objekt, das verwendet `handler1` verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="a6522-276">After `handler2` finishes, the event is passed along to the <xref:System.Windows.Controls.Canvas> object, which uses `handler1` to process it.</span></span> <span data-ttu-id="a6522-277">Dies geschieht nur, wenn `handler2` wird nicht explizit Markierung jedoch stattdessen das Ereignis als behandelt.</span><span class="sxs-lookup"><span data-stu-id="a6522-277">This happens only if `handler2` does not explicitly mark the event object as handled.</span></span>  
  
 <span data-ttu-id="a6522-278">Es ist möglich, `handler2` dauert viel Zeit für die Verarbeitung dieses Ereignisses.</span><span class="sxs-lookup"><span data-stu-id="a6522-278">It’s possible that `handler2` will take a great deal of time processing this event.</span></span> <span data-ttu-id="a6522-279">`handler2` Verwenden Sie möglicherweise <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> um eine geschachtelte Meldungsschleife zu beginnen, die keinen Stunden zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="a6522-279">`handler2` might use <xref:System.Windows.Threading.Dispatcher.PushFrame%2A> to begin a nested message loop that doesn’t return for hours.</span></span> <span data-ttu-id="a6522-280">Wenn `handler2` nicht markieren, die das Ereignis als behandelt, wenn diese Nachrichtenschleife ist abgeschlossen ist, wird das Ereignis oben in der Struktur übergeben, obwohl es sehr alt ist.</span><span class="sxs-lookup"><span data-stu-id="a6522-280">If `handler2` does not mark the event as handled when this message loop is complete, the event is passed up the tree even though it is very old.</span></span>  
  
### <a name="reentrancy-and-locking"></a><span data-ttu-id="a6522-281">Wiedereintritt und Sperrung</span><span class="sxs-lookup"><span data-stu-id="a6522-281">Reentrancy and Locking</span></span>  
 <span data-ttu-id="a6522-282">Der Mechanismus zum Sperren von der [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] verhält sich nicht genau wie eine möglicherweise angenommen; eine erwarten einen Thread zum Vorgang vollständig eingestellt, wenn eine Sperre angefordert.</span><span class="sxs-lookup"><span data-stu-id="a6522-282">The locking mechanism of the [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] doesn’t behave exactly as one might imagine; one might expect a thread to cease operation completely when requesting a lock.</span></span> <span data-ttu-id="a6522-283">In Wirklichkeit empfängt und verarbeitet der Thread weiterhin Meldungen mit hoher Priorität.</span><span class="sxs-lookup"><span data-stu-id="a6522-283">In actuality, the thread continues to receive and process high-priority messages.</span></span> <span data-ttu-id="a6522-284">Dadurch können Deadlocks vermieden und Schnittstellen minimal reaktionsfähig gemacht werden, aber dadurch können auch schwer erkennbare Fehler entstehen.</span><span class="sxs-lookup"><span data-stu-id="a6522-284">This helps prevent deadlocks and make interfaces minimally responsive, but it introduces the possibility for subtle bugs.</span></span>  <span data-ttu-id="a6522-285">Die meisten Fällen Sie nicht zu dieser jedoch in seltenen Fällen Informationen müssen (normalerweise im Zusammenhang mit [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] fenstermeldungen oder COM-STA-Komponenten) Entwurfsalternativen möglich.</span><span class="sxs-lookup"><span data-stu-id="a6522-285">The vast majority of the time you don’t need to know anything about this, but under rare circumstances (usually involving [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window messages or COM STA components) this can be worth knowing.</span></span>  
  
 <span data-ttu-id="a6522-286">Die meisten Schnittstellen sind mit Threadsicherheit Bedenken nicht erstellt, da Entwickler unter der Annahme arbeiten, die eine [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] nie durch mehrere Threads zugegriffen wird.</span><span class="sxs-lookup"><span data-stu-id="a6522-286">Most interfaces are not built with thread safety in mind because developers work under the assumption that a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] is never accessed by more than one thread.</span></span> <span data-ttu-id="a6522-287">In diesem Fall, dass die einzelnen Thread zu unerwarteten Zeiten umgebungsänderungen treffen verursacht diese falsch Auswirkungen nach sich ziehen, die die <xref:System.Windows.Threading.DispatcherObject> gegenseitigen Ausschlussmechanismus lösen soll.</span><span class="sxs-lookup"><span data-stu-id="a6522-287">In this case, that single thread may make environmental changes at unexpected times, causing those ill effects that the <xref:System.Windows.Threading.DispatcherObject> mutual exclusion mechanism is supposed to solve.</span></span> <span data-ttu-id="a6522-288">Betrachten Sie den folgenden Pseudocode:</span><span class="sxs-lookup"><span data-stu-id="a6522-288">Consider the following pseudocode:</span></span>  
  
 <span data-ttu-id="a6522-289">![Diagramm des Threadingwiedereintritts](../../../../docs/framework/wpf/advanced/media/threadingreentrancy.png "ThreadingReentrancy")</span><span class="sxs-lookup"><span data-stu-id="a6522-289">![Threading reentrancy diagram](../../../../docs/framework/wpf/advanced/media/threadingreentrancy.png "ThreadingReentrancy")</span></span>  
  
 <span data-ttu-id="a6522-290">In den meisten Fällen ist richtig sei, aber es gibt Situationen, in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] , in denen kann solche unerwartete Reentranz wirklich Probleme verursacht.</span><span class="sxs-lookup"><span data-stu-id="a6522-290">Most of the time that’s the right thing, but there are times in [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] where such unexpected reentrancy can really cause problems.</span></span> <span data-ttu-id="a6522-291">So, Key gelegentlich [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Aufrufe <xref:System.Windows.Threading.Dispatcher.DisableProcessing%2A>, welche Änderungen die Lock-Anweisung für den Thread verwendet die [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] Reentranz frei Sperre anstelle des üblichen [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] Sperre.</span><span class="sxs-lookup"><span data-stu-id="a6522-291">So, at certain key times, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] calls <xref:System.Windows.Threading.Dispatcher.DisableProcessing%2A>, which changes the lock instruction for that thread to use the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] reentrancy-free lock, instead of the usual [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] lock.</span></span>  
  
 <span data-ttu-id="a6522-292">Warum also hat die [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] Team wählen Sie dieses Verhalten?</span><span class="sxs-lookup"><span data-stu-id="a6522-292">So why did the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] team choose this behavior?</span></span> <span data-ttu-id="a6522-293">Dies hatte mit COM-STA-Objekten und dem Finalizerthread zu tun.</span><span class="sxs-lookup"><span data-stu-id="a6522-293">It had to do with COM STA objects and the finalization thread.</span></span> <span data-ttu-id="a6522-294">Wenn ein Objekt mit Garbage Collection durchgeführt wird, ist dessen `Finalize` -Methode nicht für die dedizierte Finalizer-Thread ausgeführt wird die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-294">When an object is garbage collected, its `Finalize` method is run on the dedicated finalizer thread, not the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-295">Und darin liegt das Problem, da eine COM-STA-Objekt, das erstellt wurde, auf die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread kann nur freigegeben werden, auf die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread.</span><span class="sxs-lookup"><span data-stu-id="a6522-295">And therein lies the problem, because a COM STA object that was created on the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread can only be disposed on the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread.</span></span> <span data-ttu-id="a6522-296">Die [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] ist das Äquivalent zu einer <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> (in diesem Fall mithilfe von Win32 `SendMessage`).</span><span class="sxs-lookup"><span data-stu-id="a6522-296">The [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] does the equivalent of a <xref:System.Windows.Threading.Dispatcher.BeginInvoke%2A> (in this case using Win32’s `SendMessage`).</span></span> <span data-ttu-id="a6522-297">Wenn Sie allerdings die [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] Thread ausgelastet ist, im Finalizer-Thread wurde unterbrochen, und das COM-STA-Objekt kann nicht verworfen werden, wodurch erstellt einen schwerwiegenden Speicherverlust.</span><span class="sxs-lookup"><span data-stu-id="a6522-297">But if the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] thread is busy, the finalizer thread is stalled and the COM STA object can’t be disposed, which creates a serious memory leak.</span></span> <span data-ttu-id="a6522-298">Damit die [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] Team Aufruf der schwierig zu sperren, die Funktionsweise der dies der Fall.</span><span class="sxs-lookup"><span data-stu-id="a6522-298">So the [!INCLUDE[TLA2#tla_clr](../../../../includes/tla2sharptla-clr-md.md)] team made the tough call to make locks work the way they do.</span></span>  
  
 <span data-ttu-id="a6522-299">Der Task für [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] wird zur Vermeidung unerwarteter Reentranz ohne Wiedereinführung Speicherverlust, weshalb wir überall Reentranz nicht blockieren.</span><span class="sxs-lookup"><span data-stu-id="a6522-299">The task for [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is to avoid unexpected reentrancy without reintroducing the memory leak, which is why we don’t block reentrancy everywhere.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a6522-300">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="a6522-300">See Also</span></span>  
 [<span data-ttu-id="a6522-301">Single-Threaded Application with Long-Running Calculation Sample (Singlethread-Anwendung mit Beispiel für Berechnung mit langer Laufzeit)</span><span class="sxs-lookup"><span data-stu-id="a6522-301">Single-Threaded Application with Long-Running Calculation Sample</span></span>](http://go.microsoft.com/fwlink/?LinkID=160038)
