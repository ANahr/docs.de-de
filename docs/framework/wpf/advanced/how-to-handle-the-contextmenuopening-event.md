---
title: 'Gewusst wie: Behandeln des ContextMenuOpening -Ereignisses'
ms.date: 03/30/2017
helpviewer_keywords:
- ContextMenuOpening properties [WPF]
ms.assetid: 789652fb-1951-4217-934a-7843e355adf4
ms.openlocfilehash: ab4c4867981cd318738b7404d76f2f5932bb9059
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 05/04/2018
ms.locfileid: "33547484"
---
# <a name="how-to-handle-the-contextmenuopening-event"></a><span data-ttu-id="c2467-102">Gewusst wie: Behandeln des ContextMenuOpening -Ereignisses</span><span class="sxs-lookup"><span data-stu-id="c2467-102">How to: Handle the ContextMenuOpening Event</span></span>
<span data-ttu-id="c2467-103">Die <xref:System.Windows.FrameworkElement.ContextMenuOpening> -Ereignis behandelt werden, in einer Anwendung anpassen entweder ein vorhandenes Kontextmenü vor um anzuzeigen, oder klicken Sie im Menü zu unterdrücken, die andernfalls durch die Einstellung angezeigt werden soll die <xref:System.Windows.RoutedEventArgs.Handled%2A> Eigenschaft `true` in den Ereignisdaten.</span><span class="sxs-lookup"><span data-stu-id="c2467-103">The <xref:System.Windows.FrameworkElement.ContextMenuOpening> event can be handled in an application to either adjust an existing context menu prior to display or to suppress the menu that would otherwise be displayed by setting the <xref:System.Windows.RoutedEventArgs.Handled%2A> property to `true` in the event data.</span></span> <span data-ttu-id="c2467-104">Die häufiger Grund für die Einstellung <xref:System.Windows.RoutedEventArgs.Handled%2A> auf `true` im Ereignis Daten sind, klicken Sie im Menü vollständig durch ein neues ersetzt <xref:System.Windows.Controls.ContextMenu> -Objekt, der in einigen Fällen erfordert der Vorgang abgebrochen wird, und starten eine neue geöffnet.</span><span class="sxs-lookup"><span data-stu-id="c2467-104">The typical reason for setting <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data is to replace the menu entirely with a new <xref:System.Windows.Controls.ContextMenu> object, which sometimes requires canceling the operation and starting a new open.</span></span> <span data-ttu-id="c2467-105">Wenn Sie Handler schreiben der <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis, Sie sollten Probleme mit den Zeitabläufen zwischen beachtet werden ein <xref:System.Windows.Controls.ContextMenu> -Steuerelement und dem Dienst, der für das Öffnen und die Position des Kontextmenüs für Steuerelemente im Allgemeinen zuständig ist.</span><span class="sxs-lookup"><span data-stu-id="c2467-105">If you write handlers for the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event, you should be aware of timing issues between a <xref:System.Windows.Controls.ContextMenu> control and the service that is responsible for opening and positioning context menus for controls in general.</span></span> <span data-ttu-id="c2467-106">Dieses Thema veranschaulicht einige der Methoden Code für verschiedene Szenarien des Öffnens Kontextmenü und veranschaulicht einen Fall, in dem das Problem der zeitlichen Steuerung eine sprachbasierte stammen.</span><span class="sxs-lookup"><span data-stu-id="c2467-106">This topic illustrates some of the code techniques for various context menu opening scenarios and illustrates a case where the timing issue comes into play.</span></span>  
  
 <span data-ttu-id="c2467-107">Es gibt mehrere Szenarien für die Behandlung der <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis:</span><span class="sxs-lookup"><span data-stu-id="c2467-107">There are several scenarios for handling the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event:</span></span>  
  
-   <span data-ttu-id="c2467-108">Anpassen der Menüelemente vor der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="c2467-108">Adjusting the menu items before display.</span></span>  
  
-   <span data-ttu-id="c2467-109">Ersetzen das gesamte Menü vor der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="c2467-109">Replacing the entire menu before display.</span></span>  
  
-   <span data-ttu-id="c2467-110">Vollständig unterdrücken vorhandene Kontextmenü, und kein Kontextmenü angezeigt.</span><span class="sxs-lookup"><span data-stu-id="c2467-110">Completely suppressing any existing context menu and displaying no context menu.</span></span>  
  
## <a name="example"></a><span data-ttu-id="c2467-111">Beispiel</span><span class="sxs-lookup"><span data-stu-id="c2467-111">Example</span></span>  
  
## <a name="adjusting-the-menu-items-before-display"></a><span data-ttu-id="c2467-112">Anpassen der Menüelemente vor der Anzeige</span><span class="sxs-lookup"><span data-stu-id="c2467-112">Adjusting the Menu Items Before Display</span></span>  
 <span data-ttu-id="c2467-113">Anpassen der vorhandenen Menüelemente ist recht einfach gehalten und ist wahrscheinlich das häufigste Szenario.</span><span class="sxs-lookup"><span data-stu-id="c2467-113">Adjusting the existing menu items is fairly simple and is probably the most common scenario.</span></span> <span data-ttu-id="c2467-114">Sie können dies zum addieren oder subtrahieren als Antwort auf die aktuelle Statusinformationen in der Anwendung oder bestimmte Statusinformationen, die als Eigenschaft für das Objekt verfügbar ist, in dem im Kontextmenü den Befehl angefordert wird (Kontextmenüoptionen) vornehmen.</span><span class="sxs-lookup"><span data-stu-id="c2467-114">You might do this in order to add or subtract context menu options in response to current state information in your application or particular state information that is available as a property on the object where the context menu is requested.</span></span>  
  
 <span data-ttu-id="c2467-115">Das allgemeine Verfahren ist, um die Quelle des Ereignisses, das das Steuerelement bestimmte, geklickt wurde, und erhalten die <xref:System.Windows.FrameworkElement.ContextMenu%2A> Eigenschaft daraus.</span><span class="sxs-lookup"><span data-stu-id="c2467-115">The general technique is to get the source of the event, which is the specific control that was right-clicked, and get the <xref:System.Windows.FrameworkElement.ContextMenu%2A> property from it.</span></span> <span data-ttu-id="c2467-116">In der Regel überprüfen möchten die <xref:System.Windows.Controls.ItemsControl.Items%2A> Auflistung finden Sie unter welche Kontextmenüelemente bereits vorhanden sind, klicken Sie im Menü, und klicken Sie dann hinzufügen oder entfernen entsprechende neue <xref:System.Windows.Controls.MenuItem> von Elementen in oder aus der Auflistung.</span><span class="sxs-lookup"><span data-stu-id="c2467-116">You typically want to check the <xref:System.Windows.Controls.ItemsControl.Items%2A> collection to see what context menu items already exist in the menu, and then add or remove appropriate new <xref:System.Windows.Controls.MenuItem> items to or from the collection.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#AddItemNoHandle](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#additemnohandle)]  
  
## <a name="replacing-the-entire-menu-before-display"></a><span data-ttu-id="c2467-117">Ersetzen des gesamten Menüs vor der Anzeige</span><span class="sxs-lookup"><span data-stu-id="c2467-117">Replacing the Entire Menu Before Display</span></span>  
 <span data-ttu-id="c2467-118">Eine alternative Szenario ist das gesamte Kontextmenü ersetzen soll.</span><span class="sxs-lookup"><span data-stu-id="c2467-118">An alternative scenario is if you want to replace the entire context menu.</span></span> <span data-ttu-id="c2467-119">Natürlich auch können Sie eine Variation des vorangehenden Codes entfernen Sie jedes Element der vorhandenen Kontextmenüs und neue hinzufügen, beginnend mit 0 (null)-Element.</span><span class="sxs-lookup"><span data-stu-id="c2467-119">You could of course also use a variation of the preceding code, to remove every item of an existing context menu and add new ones starting with item zero.</span></span> <span data-ttu-id="c2467-120">Die intuitivere Vorgehensweise zum Ersetzen aller Elemente im Kontextmenü besteht jedoch zum Erstellen eines neuen <xref:System.Windows.Controls.ContextMenu>mit Elementen zu füllen, und legen Sie dann die <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> Eigenschaft eines Steuerelements auf das neue <xref:System.Windows.Controls.ContextMenu>.</span><span class="sxs-lookup"><span data-stu-id="c2467-120">But the more intuitive approach for replacing all items in the context menu is to create a new <xref:System.Windows.Controls.ContextMenu>, populate it with items, and then set the <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> property of a control to be the new <xref:System.Windows.Controls.ContextMenu>.</span></span>  
  
 <span data-ttu-id="c2467-121">Folgender Ausdruck ist der einfache Handlercode zum Ersetzen einer <xref:System.Windows.Controls.ContextMenu>.</span><span class="sxs-lookup"><span data-stu-id="c2467-121">The following is the simple handler code for replacing a <xref:System.Windows.Controls.ContextMenu>.</span></span> <span data-ttu-id="c2467-122">Der Code verweist auf ein benutzerdefiniertes `BuildMenu` -Methode, die ausgelagert wird, da sie aufgerufen wird, um mehr als eins der Beispiel-Handler.</span><span class="sxs-lookup"><span data-stu-id="c2467-122">The code references a custom `BuildMenu` method, which is separated out because it is called by more than one of the example handlers.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#ReplaceNoReopen](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#replacenoreopen)]  
  
 [!code-csharp[ContextMenuOpeningHandlers#BuildMenu](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#buildmenu)]  
  
 <span data-ttu-id="c2467-123">Jedoch bei Verwendung dieses Format der Handler für <xref:System.Windows.FrameworkElement.ContextMenuOpening>, Sie können möglicherweise ein Problem der zeitlichen Steuerung bereitstellen, wenn das Objekt, das Sie, in dem Festlegen die <xref:System.Windows.Controls.ContextMenu> verfügt nicht über eine bereits vorhandene Kontextmenü.</span><span class="sxs-lookup"><span data-stu-id="c2467-123">However, if you use this style of handler for <xref:System.Windows.FrameworkElement.ContextMenuOpening>, you can potentially expose a timing issue if the object where you are setting the <xref:System.Windows.Controls.ContextMenu> does not have a preexisting context menu.</span></span> <span data-ttu-id="c2467-124">Wenn ein Benutzer ein Steuerelement klickt <xref:System.Windows.FrameworkElement.ContextMenuOpening> wird ausgelöst, selbst wenn die vorhandene <xref:System.Windows.Controls.ContextMenu> ist leer oder null.</span><span class="sxs-lookup"><span data-stu-id="c2467-124">When a user right-clicks a control, <xref:System.Windows.FrameworkElement.ContextMenuOpening> is raised even if the existing <xref:System.Windows.Controls.ContextMenu> is empty or null.</span></span> <span data-ttu-id="c2467-125">Aber in diesem Fall nach Belieben neue <xref:System.Windows.Controls.ContextMenu> Sie festlegen, in der Quelle Element zu spät eintrifft, um angezeigt zu werden.</span><span class="sxs-lookup"><span data-stu-id="c2467-125">But in this case, whatever new <xref:System.Windows.Controls.ContextMenu> you set on the source element arrives too late to be displayed.</span></span> <span data-ttu-id="c2467-126">Auch wenn der Benutzer auf ein zweites Mal auftritt, dieses Mal Ihr neues <xref:System.Windows.Controls.ContextMenu> angezeigt wird, der Wert ist ungleich Null, und die Handler ordnungsgemäß ersetzen und zeigt das Menü, wenn der Handler ein zweites Mal ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="c2467-126">Also, if the user happens to right-click a second time, this time your new <xref:System.Windows.Controls.ContextMenu> appears, the value is non null, and your handler will properly replace and display the menu when the handler runs a second time.</span></span> <span data-ttu-id="c2467-127">Dadurch ergibt sich zwei mögliche problemumgehungen:</span><span class="sxs-lookup"><span data-stu-id="c2467-127">This suggests two possible workarounds:</span></span>  
  
1.  <span data-ttu-id="c2467-128">Sicher, dass <xref:System.Windows.FrameworkElement.ContextMenuOpening> Handler immer für Steuerelemente, die über mindestens einen Platzhalter ausführen <xref:System.Windows.Controls.ContextMenu> verfügbar, die vom Handlercode ersetzt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="c2467-128">Insure that <xref:System.Windows.FrameworkElement.ContextMenuOpening> handlers always run against controls that have at least a placeholder <xref:System.Windows.Controls.ContextMenu> available, which you intend to be replaced by the handler code.</span></span> <span data-ttu-id="c2467-129">In diesem Fall können Sie weiterhin den Handler, die im vorherigen Beispiel dargestellt, aber Sie in der Regel einen Platzhalter zuweisen möchten <xref:System.Windows.Controls.ContextMenu> im anfänglichen Markup:</span><span class="sxs-lookup"><span data-stu-id="c2467-129">In this case, you can still use the handler shown in the previous example, but you typically want to assign a placeholder <xref:System.Windows.Controls.ContextMenu> in the initial markup:</span></span>  
  
     [!code-xaml[ContextMenuOpeningHandlers#XAMLWithInitCM](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml#xamlwithinitcm)]  
  
2.  <span data-ttu-id="c2467-130">Vorausgesetzt, dass der ursprüngliche <xref:System.Windows.Controls.ContextMenu> Wert kann null sein, basierend auf einer vorläufigen Logik.</span><span class="sxs-lookup"><span data-stu-id="c2467-130">Assume that the initial <xref:System.Windows.Controls.ContextMenu> value might be null, based on some preliminary logic.</span></span> <span data-ttu-id="c2467-131">Sie können entweder <xref:System.Windows.Controls.ContextMenu> für Null oder ein Flag in Ihrem Code zu überprüfen, ob der Handler wurde mindestens einmal ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="c2467-131">You could either check <xref:System.Windows.Controls.ContextMenu> for null, or use a flag in your code to check whether your handler has been run at least once.</span></span> <span data-ttu-id="c2467-132">Da Sie davon, die ausgehen die <xref:System.Windows.Controls.ContextMenu> geht es um werden angezeigt, den Handler und legt dann <xref:System.Windows.RoutedEventArgs.Handled%2A> auf `true` in den Ereignisdaten.</span><span class="sxs-lookup"><span data-stu-id="c2467-132">Because you assume that the <xref:System.Windows.Controls.ContextMenu> is about to be displayed, your handler then sets <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data.</span></span> <span data-ttu-id="c2467-133">Um die <xref:System.Windows.Controls.ContextMenuService> , die dient zur Anzeige der Kontext des Menüs, eine `true` Wert für <xref:System.Windows.RoutedEventArgs.Handled%2A> im Ereignis Daten stellt eine Anforderung zum Abbrechen der Anzeige für das Kontextmenü / steuern Kombination, die das Ereignis ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="c2467-133">To the <xref:System.Windows.Controls.ContextMenuService> that is responsible for context menu display, a `true` value for <xref:System.Windows.RoutedEventArgs.Handled%2A> in the event data represents a request to cancel the display for the context menu / control combination that raised the event.</span></span>  
  
 <span data-ttu-id="c2467-134">Nun, da Sie potenziell verdächtige Kontextmenü unterdrückt haben, ist der nächste Schritt, geben Sie eine neue zeigen Sie es.</span><span class="sxs-lookup"><span data-stu-id="c2467-134">Now that you have suppressed the potentially suspect context menu, the next step is to supply a new one, then display it.</span></span> <span data-ttu-id="c2467-135">Einrichten des neuen eine im Grunde identisch mit der vorherigen Handler ist: Sie erstellen ein neues <xref:System.Windows.Controls.ContextMenu> und legen Sie die Steuerelement-Quelle <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> Eigenschaft mit dem sie.</span><span class="sxs-lookup"><span data-stu-id="c2467-135">Setting the new one is basically the same as the previous handler: you build a new <xref:System.Windows.Controls.ContextMenu> and set the control source's <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> property with it.</span></span> <span data-ttu-id="c2467-136">Der zusätzliche Schritt ist, müssen Sie jetzt die Anzeige des Kontextmenüs, zwingen, da Sie beim ersten Versuch unterdrückt.</span><span class="sxs-lookup"><span data-stu-id="c2467-136">The additional step is that you must now force the display of the context menu, because you suppressed the first attempt.</span></span> <span data-ttu-id="c2467-137">Um die Anzeige zu erzwingen, legen Sie die <xref:System.Windows.Controls.Primitives.Popup.IsOpen%2A?displayProperty=nameWithType> Eigenschaft `true` innerhalb der Handler.</span><span class="sxs-lookup"><span data-stu-id="c2467-137">To force the display, you set the <xref:System.Windows.Controls.Primitives.Popup.IsOpen%2A?displayProperty=nameWithType> property to `true` within the handler.</span></span> <span data-ttu-id="c2467-138">Vorsichtig sein, wenn Sie dies tun, da löst aus, öffnen das Kontextmenü im Handler der <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis erneut.</span><span class="sxs-lookup"><span data-stu-id="c2467-138">Be careful when you do this, because opening the context menu in the handler raises the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event again.</span></span> <span data-ttu-id="c2467-139">Wenn Sie den Handler erneut ausführen, wird er endlos rekursiv.</span><span class="sxs-lookup"><span data-stu-id="c2467-139">If you reenter your handler, it becomes infinitely recursive.</span></span> <span data-ttu-id="c2467-140">Daher müssen Sie immer zu suchende `null` oder ein Flag verwenden, wenn Sie ein Kontextmenü, innerhalb Öffnen einer <xref:System.Windows.FrameworkElement.ContextMenuOpening> -Ereignishandler.</span><span class="sxs-lookup"><span data-stu-id="c2467-140">This is why you always need to check for `null` or use a flag if you open a context menu from within a <xref:System.Windows.FrameworkElement.ContextMenuOpening> event handler.</span></span>  
  
## <a name="suppressing-any-existing-context-menu-and-displaying-no-context-menu"></a><span data-ttu-id="c2467-141">Unterdrücken vorhandene Kontextmenü, und kein Kontextmenü angezeigt</span><span class="sxs-lookup"><span data-stu-id="c2467-141">Suppressing Any Existing Context Menu and Displaying No Context Menu</span></span>  
 <span data-ttu-id="c2467-142">Das abschließende Szenario, schreiben einen Ereignishandler, der ein Menü völlig unterdrückt ist ungewöhnlich.</span><span class="sxs-lookup"><span data-stu-id="c2467-142">The final scenario, writing a handler that suppresses a menu totally, is uncommon.</span></span> <span data-ttu-id="c2467-143">Wenn ein bestimmtes Steuerelement nicht wird ein Kontextmenü anzuzeigen erwartet, sind wahrscheinlich besser Möglichkeiten, dies als indem Sie im Menü unterdrücken, sondern nur, wenn ein Benutzer fordert zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="c2467-143">If a given control is not supposed to display a context menu, there are probably more appropriate ways to assure this than by suppressing the menu just when a user requests it.</span></span> <span data-ttu-id="c2467-144">Wenn jedoch den Handler verwenden, um ein Kontextmenü zu unterdrücken und nichts angezeigt werden sollen, legen Sie der Handler sollten einfach <xref:System.Windows.RoutedEventArgs.Handled%2A> auf `true` in den Ereignisdaten.</span><span class="sxs-lookup"><span data-stu-id="c2467-144">But if you want to use the handler to suppress a context menu and show nothing, then your handler should simply set <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data.</span></span> <span data-ttu-id="c2467-145">Die <xref:System.Windows.Controls.ContextMenuService> , die ist verantwortlich für das Anzeigen eines Kontextmenüs die Ereignisdaten des Ereignisses sucht es für das Steuerelement ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="c2467-145">The <xref:System.Windows.Controls.ContextMenuService> that is responsible for displaying a context menu will check the event data of the event it raised on the control.</span></span> <span data-ttu-id="c2467-146">Wenn das Ereignis markiert wurde <xref:System.Windows.RoutedEventArgs.Handled%2A> an einer beliebigen Stelle entlang der Route dann Aktion des Kontextmenüs öffnen, die das Ereignis initiiert wird unterdrückt.</span><span class="sxs-lookup"><span data-stu-id="c2467-146">If the event was marked <xref:System.Windows.RoutedEventArgs.Handled%2A> anywhere along the route, then the context menu open action that initiated the event is suppressed.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#ReplaceReopen](../../../../samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#replacereopen)]  
  
## <a name="see-also"></a><span data-ttu-id="c2467-147">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="c2467-147">See Also</span></span>  
 <xref:System.Windows.Controls.ContextMenu>  
 <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType>  
 [<span data-ttu-id="c2467-148">Übersicht über Basiselemente</span><span class="sxs-lookup"><span data-stu-id="c2467-148">Base Elements Overview</span></span>](../../../../docs/framework/wpf/advanced/base-elements-overview.md)  
 [<span data-ttu-id="c2467-149">Übersicht über ContextMenu</span><span class="sxs-lookup"><span data-stu-id="c2467-149">ContextMenu Overview</span></span>](../../../../docs/framework/wpf/controls/contextmenu-overview.md)
