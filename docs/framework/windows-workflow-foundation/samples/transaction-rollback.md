---
title: Transaktionsrollback
ms.date: 03/30/2017
ms.assetid: 7f377147-7529-4689-a588-608cee87fdf8
ms.openlocfilehash: 8134623248b072ec5a095ab9b10840e94a09243c
ms.sourcegitcommit: efff8f331fd9467f093f8ab8d23a203d6ecb5b60
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/02/2018
ms.locfileid: "43464122"
---
# <a name="transaction-rollback"></a><span data-ttu-id="03fcc-102">Transaktionsrollback</span><span class="sxs-lookup"><span data-stu-id="03fcc-102">Transaction Rollback</span></span>
<span data-ttu-id="03fcc-103">Dieses Beispiel veranschaulicht, wie eine benutzerdefinierte <xref:System.Activities.NativeActivity> erstellt wird, die auf den Ambient-<xref:System.Activities.RuntimeTransactionHandle> zugreift, um die Ambient-Transaktion abzurufen und sie explizit zurückzusetzen.</span><span class="sxs-lookup"><span data-stu-id="03fcc-103">This sample shows how to create a custom <xref:System.Activities.NativeActivity> that accesses the ambient <xref:System.Activities.RuntimeTransactionHandle> to get the ambient transaction and explicitly roll it back.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="03fcc-104">Beispieldetails</span><span class="sxs-lookup"><span data-stu-id="03fcc-104">Sample Details</span></span>  
 <span data-ttu-id="03fcc-105">Im Workflow wird eine Transaktion automatisch abgeschlossen, wenn der äußerste <xref:System.Activities.Statements.TransactionScope> oder <xref:System.ServiceModel.Activities.TransactedReceiveScope> abgeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="03fcc-105">In workflow, a transaction is automatically completed when the outermost <xref:System.Activities.Statements.TransactionScope> or <xref:System.ServiceModel.Activities.TransactedReceiveScope> completes.</span></span>  <span data-ttu-id="03fcc-106">Eine Transaktion wird implizit zurückgesetzt, wenn eine nicht behandelte Ausnahme über die Bereichsgrenze hinausgeht.</span><span class="sxs-lookup"><span data-stu-id="03fcc-106">A transaction implicitly rolls back when an unhandled exception propagates across the scope boundary.</span></span> <span data-ttu-id="03fcc-107">Es kann möglicherweise jedoch sinnvoll sein, explizit eine Transaktion ohne Auslösen einer Ausnahme zurückzusetzen.</span><span class="sxs-lookup"><span data-stu-id="03fcc-107">However, there may be times when it makes sense to explicitly roll back a transaction without having to throw an exception.</span></span> <span data-ttu-id="03fcc-108">In diesem Fall können Sie die benutzerdefinierte Rollbackaktivität wie die in diesem Beispiel verwenden, um die Ambient-Transaktion explizit abzubrechen und einen optionalen Ausnahmegrund bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="03fcc-108">In this case, you can use the custom rollback activity like the one in this sample to explicitly abort the ambient transaction and provide an optional exception reason.</span></span>  
  
 <span data-ttu-id="03fcc-109">Die `RollbackActivity` ist eine <xref:System.Activities.NativeActivity>, da Zugriff auf die Ausführungseigenschaften erforderlich ist, um den Ambient-<xref:System.Activities.RuntimeTransactionHandle> abzurufen.</span><span class="sxs-lookup"><span data-stu-id="03fcc-109">The `RollbackActivity` is a <xref:System.Activities.NativeActivity> as it requires access to the execution properties to get the ambient <xref:System.Activities.RuntimeTransactionHandle>.</span></span> <span data-ttu-id="03fcc-110">In der `Execute`-Methode wird der <xref:System.Activities.RuntimeTransactionHandle> abgerufen und überprüft, ob er `null` ist. Damit wird angegeben, dass die Aktivität ohne Ambient-Laufzeittransaktion verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="03fcc-110">In the `Execute` method, it obtains the <xref:System.Activities.RuntimeTransactionHandle> and checks whether it is `null`, which indicates that the activity was used without an ambient run-time transaction.</span></span> <span data-ttu-id="03fcc-111">Dann wird die Transaktion abgerufen und wieder überprüft, ob `null` vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="03fcc-111">It then obtains the transaction, again checking whether `null` is present.</span></span> <span data-ttu-id="03fcc-112">Es ist möglich, einen Ambient-<xref:System.Activities.RuntimeTransactionHandle> zu bekommen, ohne eine Laufzeittransaktion zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="03fcc-112">It is possible to have an ambient <xref:System.Activities.RuntimeTransactionHandle> without ever initializing a run-time transaction.</span></span> <span data-ttu-id="03fcc-113">Schließlich wird die Transaktion abgebrochen, indem <xref:System.Transactions.Transaction.Rollback%2A> aufgerufen und eine vom Benutzer bereitgestellte Ausnahme oder eine generische Ausnahme angegeben wird, die besagt, dass die Aktivität die Transaktion zurückgesetzt hat.</span><span class="sxs-lookup"><span data-stu-id="03fcc-113">Finally it aborts the transaction by calling <xref:System.Transactions.Transaction.Rollback%2A> and specifying either a user-provided exception or a generic exception that states that the activity rolled back the transaction.</span></span>  
  
 <span data-ttu-id="03fcc-114">Der Beispielworkflow besteht aus einem <xref:System.Activities.Statements.TransactionScope>, dessen Text den Transaktionsstatus ausgibt, bevor und nachdem `RollbackActivity` ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="03fcc-114">The demonstration workflow consists of a <xref:System.Activities.Statements.TransactionScope> whose body prints the transaction status before and after the `RollbackActivity` executes.</span></span> <span data-ttu-id="03fcc-115">Beachten Sie, dass, obwohl die Transaktion zurückgesetzt wurde, der <xref:System.Activities.Statements.TransactionScope> bis zum Abschluss ausgeführt wird und der Workflow nicht abgebrochen wird, bis der Text abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="03fcc-115">Note that even though the transaction has been rolled back, the <xref:System.Activities.Statements.TransactionScope> executes to completion and does not abort the workflow until the body completes.</span></span> <span data-ttu-id="03fcc-116">Der Workflow wird abgebrochen, da die <xref:System.Activities.Statements.TransactionScope.AbortInstanceOnTransactionFailure%2A>-Eigenschaft standardmäßig auf `true` festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="03fcc-116">The workflow is aborted because the <xref:System.Activities.Statements.TransactionScope.AbortInstanceOnTransactionFailure%2A> property defaults to `true`.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="03fcc-117">So verwenden Sie dieses Beispiel</span><span class="sxs-lookup"><span data-stu-id="03fcc-117">To use this sample</span></span>  
  
1.  <span data-ttu-id="03fcc-118">Laden Sie die Projektmappe "TransactionRollback.sln" in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span><span class="sxs-lookup"><span data-stu-id="03fcc-118">Load the TransactionRollback.sln solution in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)].</span></span>  
  
2.  <span data-ttu-id="03fcc-119">Drücken Sie STRG+UMSCHALT+B, um die Projektmappe zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="03fcc-119">Press CTRL+SHIFT+B to build the solution.</span></span>  
  
3.  <span data-ttu-id="03fcc-120">Drücken Sie STRG+F5, um die Anwendung auszuführen.</span><span class="sxs-lookup"><span data-stu-id="03fcc-120">Press CTRL+F5 to run the application.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="03fcc-121">Die Beispiele sind möglicherweise bereits auf dem Computer installiert.</span><span class="sxs-lookup"><span data-stu-id="03fcc-121">The samples may already be installed on your machine.</span></span> <span data-ttu-id="03fcc-122">Suchen Sie nach dem folgenden Verzeichnis (Standardverzeichnis), bevor Sie fortfahren.</span><span class="sxs-lookup"><span data-stu-id="03fcc-122">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="03fcc-123">Wenn dieses Verzeichnis nicht vorhanden ist, fahren Sie mit [Windows Communication Foundation (WCF) und Windows Workflow Foundation (WF) Samples für .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) alle Windows Communication Foundation (WCF) herunterladen und [!INCLUDE[wf1](../../../../includes/wf1-md.md)] Beispiele.</span><span class="sxs-lookup"><span data-stu-id="03fcc-123">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="03fcc-124">Dieses Beispiel befindet sich im folgenden Verzeichnis.</span><span class="sxs-lookup"><span data-stu-id="03fcc-124">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Transactions\TransactionRollback`  
  
## <a name="see-also"></a><span data-ttu-id="03fcc-125">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="03fcc-125">See Also</span></span>  
 [<span data-ttu-id="03fcc-126">Transaktionen</span><span class="sxs-lookup"><span data-stu-id="03fcc-126">Transactions</span></span>](../../../../docs/framework/windows-workflow-foundation/workflow-transactions.md)
