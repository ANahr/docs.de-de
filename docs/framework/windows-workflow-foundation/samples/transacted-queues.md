---
title: Transaktive Warteschlangen
ms.date: 03/30/2017
ms.assetid: b1b011dd-5e0b-482c-9bb0-9d8727038f14
ms.openlocfilehash: db6a9686334eefb02b9360827a23ca8363127eb5
ms.sourcegitcommit: efff8f331fd9467f093f8ab8d23a203d6ecb5b60
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 09/01/2018
ms.locfileid: "43408814"
---
# <a name="transacted-queues"></a><span data-ttu-id="b2183-102">Transaktive Warteschlangen</span><span class="sxs-lookup"><span data-stu-id="b2183-102">Transacted Queues</span></span>
<span data-ttu-id="b2183-103">Dieses Beispiel zeigt, wie Sie Warteschlangen und Transaktionen in Windows Workflow Foundation (WF) zum Erstellen von zuverlässiger und skalierbarer Diensten integrieren.</span><span class="sxs-lookup"><span data-stu-id="b2183-103">This sample shows how to integrate queues and transactions in Windows Workflow Foundation (WF) to create reliable and scalable services.</span></span> <span data-ttu-id="b2183-104">Ein <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` wird im clientworkflow verwendet, zum Senden der Nachricht an eine Warteschlange unter einer Transaktion mithilfe der <xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="b2183-104">A <!--zz <xref:System.Activities.TransactionScope>--> `System.Activities.TransactionScope` is used in the client workflow to send message to a queue under a transaction using the <xref:System.ServiceModel.NetMsmqBinding>.</span></span> <span data-ttu-id="b2183-105">Ein <xref:System.ServiceModel.Activities.TransactedReceiveScope> wird auf dem Server verwendet, um Meldungen von der Warteschlange zu empfangen und den Zustand des Workflows unter der gleichen Transaktion zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="b2183-105">A <xref:System.ServiceModel.Activities.TransactedReceiveScope> is used on the server to receive messages from the queue and update the state of the workflow under the same transaction.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="b2183-106">Veranschaulicht</span><span class="sxs-lookup"><span data-stu-id="b2183-106">Demonstrates</span></span>  
 <span data-ttu-id="b2183-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive> und inhaltsbasierte Korrelation.</span><span class="sxs-lookup"><span data-stu-id="b2183-107"><xref:System.Activities.Statements.TransactionScope>, <xref:System.ServiceModel.Activities.TransactedReceiveScope>, <xref:System.ServiceModel.NetMsmqBinding>, <xref:System.ServiceModel.Activities.Receive>, and content-based correlation.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="b2183-108">Diskussion</span><span class="sxs-lookup"><span data-stu-id="b2183-108">Discussion</span></span>  
 <span data-ttu-id="b2183-109">Zur Veranschaulichung der in diesem Beispiel behandelten Funktionen wird ein `RewardsPoints`-Workflowdienst erstellt, der die für ein bestimmtes Konto verdienten und verwendeten Punkte nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="b2183-109">To demonstrate the features covered in this sample, a `RewardsPoints` workflow service is created, which keeps track of the points earned and used for a given account.</span></span> <span data-ttu-id="b2183-110">Der Client verwendet <xref:System.Activities.WorkflowInvoker>, um das Übermitteln unterschiedlicher Anforderungen an die Warteschlange zu simulieren.</span><span class="sxs-lookup"><span data-stu-id="b2183-110">The client uses <xref:System.Activities.WorkflowInvoker> to simulate posting various requests to the queue.</span></span> <span data-ttu-id="b2183-111">Zum Bereitstellen einer Meldung für eine Warteschlange unter einer Transaktion kann die <xref:System.ServiceModel.Activities.Send>-Aktivität im <xref:System.Activities.Statements.TransactionScope.Body%2A> eines <xref:System.Activities.Statements.TransactionScope> platziert werden.</span><span class="sxs-lookup"><span data-stu-id="b2183-111">To post a message to the queue under a transaction, the <xref:System.ServiceModel.Activities.Send> activity can be placed inside the <xref:System.Activities.Statements.TransactionScope.Body%2A> of a <xref:System.Activities.Statements.TransactionScope>.</span></span> <span data-ttu-id="b2183-112">In diesem Beispiel wird zuerst der Client und dann der Server ausgeführt, um zu veranschaulichen, wie in der Warteschlange befindliche Meldungen die Client- und Serveranwendungen entkoppeln können.</span><span class="sxs-lookup"><span data-stu-id="b2183-112">In this sample, the client runs first, followed by the server, to demonstrate how queued messages can decouple the client and server applications.</span></span>  
  
 <span data-ttu-id="b2183-113">Sobald der Client abgeschlossen wurde, wird der Dienst konfiguriert und gehostet.</span><span class="sxs-lookup"><span data-stu-id="b2183-113">Once the client completes, the service is configured and hosted.</span></span> <span data-ttu-id="b2183-114">Sobald er geöffnet wird, fängt er an, die Meldungen zu verarbeiten, die bereits in der Warteschlange platziert wurden.</span><span class="sxs-lookup"><span data-stu-id="b2183-114">As soon as it opens, it starts processing the messages that have already been placed in the queue.</span></span> <span data-ttu-id="b2183-115">Jede Meldung wird unter der gleichen Servertransaktion empfangen und verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="b2183-115">Each message is received and processed under the same server transaction.</span></span> <span data-ttu-id="b2183-116">In diesem Beispiel ist die erste empfangene Meldung eine `CreateAccount`-Anforderung, die die Instanz erstellt und die Inhaltskorrelation auf Grundlage des Kontonamens initialisiert, der als Teil der Anforderungsmeldung übergeben wurde.</span><span class="sxs-lookup"><span data-stu-id="b2183-116">In this sample, the first message received is a `CreateAccount` request that creates the instance and initializes the content correlation based on the account name passed as part of the request message.</span></span> <span data-ttu-id="b2183-117">Zum Modellieren der Art des Dienstes, die Sie unter realen Bedingungen erwarten können, werden die folgenden beiden <xref:System.ServiceModel.Activities.TransactedReceiveScope>-Aktivitäten, die die `AddPoints`-Meldung und die `UsePoints`-Meldung verarbeiten, in parallelen Verzweigungen in eine `while`-Schleife eingefügt, damit diese Meldungen immer wieder in beliebiger Reihenfolge verarbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="b2183-117">To model the kind of service you might expect in the real world, the following two <xref:System.ServiceModel.Activities.TransactedReceiveScope> activities that process the `AddPoints` and `UsePoints` messages are placed in parallel branches within a `while` loop so that they can process these messages repeatedly in any order.</span></span>  
  
 <span data-ttu-id="b2183-118"><xref:System.Activities.Statements.TransactionScope> und <xref:System.ServiceModel.Activities.TransactedReceiveScope> weisen jeweils am Ende ihrer Bereiche einen impliziten Persistenzpunkt auf. Die Verwendung dieser Aktivitäten in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] in Kombination mit Warteschlangen ist daher eine zuverlässige Möglichkeit, um den Workflow von einem konsistenten Zustand in den nächsten zu verschieben und gleichzeitig sicherzustellen, dass keine Meldungen verloren gehen.</span><span class="sxs-lookup"><span data-stu-id="b2183-118"><xref:System.Activities.Statements.TransactionScope> and <xref:System.ServiceModel.Activities.TransactedReceiveScope> each have an implicit persistence point at the end of their scopes, so using these activities in [!INCLUDE[wf1](../../../../includes/wf1-md.md)] combined with queues is a reliable way to move your workflow from one consistent state to the next, while ensuring that messages are never lost.</span></span>  
  
#### <a name="to-set-up-build-and-run-the-sample"></a><span data-ttu-id="b2183-119">So können Sie das Beispiel einrichten, erstellen und ausführen</span><span class="sxs-lookup"><span data-stu-id="b2183-119">To set up, build, and run the sample</span></span>  
  
1.  <span data-ttu-id="b2183-120">Installieren und konfigurieren Sie MSMQ.</span><span class="sxs-lookup"><span data-stu-id="b2183-120">Install and configure MSMQ.</span></span> <span data-ttu-id="b2183-121">Finden Sie unter [Installieren von Message Queuing](https://go.microsoft.com/fwlink/?LinkId=178526) Details.</span><span class="sxs-lookup"><span data-stu-id="b2183-121">See [Installing Message Queuing](https://go.microsoft.com/fwlink/?LinkId=178526) for details.</span></span>  
  
2.  <span data-ttu-id="b2183-122">Stellen Sie sicher, dass MSDTC ausgeführt wird, indem Sie den folgenden Befehl in einer Befehlszeile ausführen.</span><span class="sxs-lookup"><span data-stu-id="b2183-122">Ensure that MSDTC is running by executing the following command on a command line.</span></span> `net start msdtc`  
  
3.  <span data-ttu-id="b2183-123">Kompilieren Sie das Projekt, und öffnen Sie die ausführbare Datei, oder öffnen Sie das Projekt in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)], und wählen Sie eine Startoption im Debugmenü aus.</span><span class="sxs-lookup"><span data-stu-id="b2183-123">Compile the project and open the executable, or open the project in [!INCLUDE[vs2010](../../../../includes/vs2010-md.md)] and select a start option from the debug menu.</span></span> <span data-ttu-id="b2183-124">Zuerst wird die Warteschlange erstellt; anschließend wird der Client ausgeführt, und Meldungen werden an die Warteschlange übermittelt. Schließlich wird der Dienst gestartet, und die Meldungen werden verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="b2183-124">First, the queue is created, then the client runs and posts messages to the queue, and finally the service starts and the messages are processed.</span></span> <span data-ttu-id="b2183-125">Zum Beenden des Programms drücken Sie die EINGABETASTE.</span><span class="sxs-lookup"><span data-stu-id="b2183-125">To exit the program, press ENTER.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="b2183-126">Die Beispiele sind möglicherweise bereits auf dem Computer installiert.</span><span class="sxs-lookup"><span data-stu-id="b2183-126">The samples may already be installed on your machine.</span></span> <span data-ttu-id="b2183-127">Suchen Sie nach dem folgenden Verzeichnis (Standardverzeichnis), bevor Sie fortfahren.</span><span class="sxs-lookup"><span data-stu-id="b2183-127">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="b2183-128">Wenn dieses Verzeichnis nicht vorhanden ist, fahren Sie mit [Windows Communication Foundation (WCF) und Windows Workflow Foundation (WF) Samples für .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) alle Windows Communication Foundation (WCF) herunterladen und [!INCLUDE[wf1](../../../../includes/wf1-md.md)] Beispiele.</span><span class="sxs-lookup"><span data-stu-id="b2183-128">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="b2183-129">Dieses Beispiel befindet sich im folgenden Verzeichnis.</span><span class="sxs-lookup"><span data-stu-id="b2183-129">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\Transactions\TransactedQueues`
