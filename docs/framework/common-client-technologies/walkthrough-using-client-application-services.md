---
title: 'Exemplarische Vorgehensweise: Verwenden von Clientanwendungsdiensten'
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- application services host [client application services]
- client application services, walkthroughs
ms.assetid: bb7c8950-4517-4dae-b705-b74a14059b26
caps.latest.revision: 47
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.translationtype: HT
ms.sourcegitcommit: 306c608dc7f97594ef6f72ae0f5aaba596c936e1
ms.openlocfilehash: 64a27269ee6f3711f0c51f2c97cd8876c3ea6103
ms.contentlocale: de-de
ms.lasthandoff: 07/28/2017

---
# <a name="walkthrough-using-client-application-services"></a><span data-ttu-id="10765-102">Exemplarische Vorgehensweise: Verwenden von Clientanwendungsdiensten</span><span class="sxs-lookup"><span data-stu-id="10765-102">Walkthrough: Using Client Application Services</span></span>
<span data-ttu-id="10765-103">In diesem Thema wird beschrieben, wie eine Windows-Anwendung erstellen, die Clientanwendungsdienste zum Authentifizieren von Benutzern und zum Abrufen von Benutzerrollen und Einstellungen verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="10765-103">This topic describes how to create a Windows application that uses client application services to authenticate users and retrieve user roles and settings.</span></span>  
  
 <span data-ttu-id="10765-104">Im Verlauf dieser exemplarischen Vorgehensweise führen Sie die folgenden Aufgaben aus:</span><span class="sxs-lookup"><span data-stu-id="10765-104">In this walkthrough, you perform the following tasks:</span></span>  
  
-   <span data-ttu-id="10765-105">In diesem Thema wird beschrieben, wie Sie den [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] Projekt-Designer zum Aktivieren und Konfigurieren von Clientanwendungsdiensten verwenden.</span><span class="sxs-lookup"><span data-stu-id="10765-105">Create a Windows Forms application and use the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] project designer to enable and configure client application services.</span></span>  
  
-   <span data-ttu-id="10765-106">Erstellen Sie eine einfache ASP.NET Web Service-Anwendung, um die Anwendungsdienste zu hosten und Ihre Clientkonfiguration zu testen.</span><span class="sxs-lookup"><span data-stu-id="10765-106">Create a simple ASP.NET Web Service application to host the application services and test your client configuration.</span></span>  
  
-   <span data-ttu-id="10765-107">Fügen Sie die Formularauthentifizierung zur Anwendung hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-107">Add forms authentication to your application.</span></span> <span data-ttu-id="10765-108">Sie beginnen mit einem hartcodierten Benutzernamen und einem Kennwort, um den Dienst zu testen</span><span class="sxs-lookup"><span data-stu-id="10765-108">You will start by using a hard-coded user name and password to test the service.</span></span> <span data-ttu-id="10765-109">Anschließend fügen Sie in der Anwendungskonfiguration ein Anmeldeformular als Anmeldeinformationsanbieter hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-109">You will then add a login form by specifying it as a credentials provider in your application configuration.</span></span>  
  
-   <span data-ttu-id="10765-110">Fügen Sie rollenbasierte Funktionen hinzu, wodurch eine Schaltfläche nur für Benutzer in der Rolle „Manager“ aktiviert und eingeblendet wird.</span><span class="sxs-lookup"><span data-stu-id="10765-110">Add role-based functionality, enabling and displaying a button only for users in the "manager" role.</span></span>  
  
-   <span data-ttu-id="10765-111">Greifen Sie auf die Webeinstellungen zu.</span><span class="sxs-lookup"><span data-stu-id="10765-111">Access Web settings.</span></span> <span data-ttu-id="10765-112">Sie zunächst laden Sie Webeinstellungen für einen authentifizierten (Test)-Benutzer auf die Seite **Einstellungen** im Projekt-Designer.</span><span class="sxs-lookup"><span data-stu-id="10765-112">You will start by loading Web settings for an authenticated (test) user on the **Settings** page of the project designer.</span></span> <span data-ttu-id="10765-113">Dann verwenden Sie den Windows Forms-Designer, um ein Textfeld an eine Webeinstellung zu binden.</span><span class="sxs-lookup"><span data-stu-id="10765-113">You will then use the Windows Forms Designer to bind a text box to a Web setting.</span></span> <span data-ttu-id="10765-114">Speichern Sie abschließend den geänderten Wert wieder auf dem Server.</span><span class="sxs-lookup"><span data-stu-id="10765-114">Finally, you will save the modified value back to the server.</span></span>  
  
-   <span data-ttu-id="10765-115">Implementieren Sie die Abmeldung.</span><span class="sxs-lookup"><span data-stu-id="10765-115">Implement logout.</span></span> <span data-ttu-id="10765-116">Sie fügen dem Formular eine Abmeldeoption hinzu und rufen Sie eine Abmeldemethode auf.</span><span class="sxs-lookup"><span data-stu-id="10765-116">You will add a logout option to the form and call a logout method.</span></span>  
  
-   <span data-ttu-id="10765-117">Aktivieren Sie den Offline-Modus.</span><span class="sxs-lookup"><span data-stu-id="10765-117">Enable offline mode.</span></span> <span data-ttu-id="10765-118">Sie stellen ein Kontrollkästchen bereit, damit Benutzer ihren Verbindungsstatus angeben können.</span><span class="sxs-lookup"><span data-stu-id="10765-118">You will provide a check box so that users can specify their connection status.</span></span> <span data-ttu-id="10765-119">Anschließend verwenden Sie diesen Wert, um anzugeben, ob die Anbieter von Clientanwendungsdiensten lokal zwischengespeicherte Daten verwenden, anstatt auf ihre Webdienste zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="10765-119">You will then use this value to specify whether the client application service providers will use locally cached data instead of accessing their Web services.</span></span> <span data-ttu-id="10765-120">Schließlich authentifizieren Sie den aktuellen Benutzer erneut, wenn die Anwendung zurück in den Onlinemodus wechselt.</span><span class="sxs-lookup"><span data-stu-id="10765-120">Finally, you will re-authenticate the current user when the application returns to online mode.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="10765-121">Erforderliche Komponenten</span><span class="sxs-lookup"><span data-stu-id="10765-121">Prerequisites</span></span>  
 <span data-ttu-id="10765-122">Zum Durchführen dieser exemplarischen Vorgehensweise benötigen Sie die folgenden Komponenten:</span><span class="sxs-lookup"><span data-stu-id="10765-122">You need the following component to complete this walkthrough:</span></span>  
  
-   [!INCLUDE[vs_orcas_long](../../../includes/vs-orcas-long-md.md)]<span data-ttu-id="10765-123">.</span><span class="sxs-lookup"><span data-stu-id="10765-123">.</span></span>  
  
## <a name="creating-the-client-application"></a><span data-ttu-id="10765-124">Erstellen der Clientanwendung</span><span class="sxs-lookup"><span data-stu-id="10765-124">Creating the Client Application</span></span>  
 <span data-ttu-id="10765-125">Zunächst erstellen Sei ein Windows Forms-Projekt.</span><span class="sxs-lookup"><span data-stu-id="10765-125">The first thing that you will do is create a Windows Forms project.</span></span> <span data-ttu-id="10765-126">In dieser exemplarischen Vorgehensweise wird Windows Forms verwendet, da damit mehr Benutzer vertraut sind. Der Vorgang ist jedoch bei Windows Presentation Foundation (WPF)-Projekten ähnlich.</span><span class="sxs-lookup"><span data-stu-id="10765-126">This walkthrough uses Windows Forms because more people are familiar with it, but the process is similar for Windows Presentation Foundation (WPF) projects.</span></span>  
  
#### <a name="to-create-a-client-application-and-enable-client-application-services"></a><span data-ttu-id="10765-127">So erstellen Sie eine Clientanwendung und aktivieren Sie Clientanwendungsdienste:</span><span class="sxs-lookup"><span data-stu-id="10765-127">To create a client application and enable client application services</span></span>  
  
1.  <span data-ttu-id="10765-128">Wählen Sie unter [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] die Menüoption **Datei &#124; Neu &#124; Projekt** aus.</span><span class="sxs-lookup"><span data-stu-id="10765-128">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], select the **File &#124; New &#124; Project** menu option.</span></span>  
  
2.  <span data-ttu-id="10765-129">Erweitern Sie im Dialogfeld **Neues Projekt** im Bereich **Projekttypen** den **Visual Basic**- oder **Visual C#**-Knoten, und wählen Sie den **Windows**-Projekttyp aus.</span><span class="sxs-lookup"><span data-stu-id="10765-129">In the **New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Windows** project type.</span></span>  
  
3.  <span data-ttu-id="10765-130">Stellen Sie sicher, dass **.NET Framework 3.5** ausgewählt ist, und wählen Sie dann die **Windows Forms-Anwendung** -Vorlage aus.</span><span class="sxs-lookup"><span data-stu-id="10765-130">Make sure that **.NET Framework 3.5** is selected, and then select the **Windows Forms Application** template.</span></span>  
  
4.  <span data-ttu-id="10765-131">Ändern Sie den **Namen** des Projekts in `ClientAppServicesDemo`, und klicken Sie dann auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="10765-131">Change the project **Name** to `ClientAppServicesDemo`, and then click **OK**.</span></span>  
  
     <span data-ttu-id="10765-132">Ein neues Windows Forms-Projekt wird in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]geöffnet.</span><span class="sxs-lookup"><span data-stu-id="10765-132">A new Windows Forms project is opened in [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span></span>  
  
5.  <span data-ttu-id="10765-133">Wählen Sie aus dem Menü **Projekt** die Option **ClientAppServicesDemo-Eigenschaften**.</span><span class="sxs-lookup"><span data-stu-id="10765-133">On the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="10765-134">Der Projekt-Designer wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-134">The project designer appears.</span></span>  
  
6.  <span data-ttu-id="10765-135">Wählen Sie auf der Registerkarte **Dienste** die Option **Clientanwendungsdienste aktivieren**aus.</span><span class="sxs-lookup"><span data-stu-id="10765-135">On the **Services** tab, select **Enable client application services**.</span></span>  
  
7.  <span data-ttu-id="10765-136">Stellen Sie sicher, dass **Formularauthentifizierung verwenden** ausgewählt ist, und legen Sie dann **Speicherort des Authentifizierungsdiensts**, **Speicherort des Rollendiensts**und **Speicherort des Webeinstellungsdienstes** auf `http://localhost:55555/AppServices`fest.</span><span class="sxs-lookup"><span data-stu-id="10765-136">Make sure that **Use Forms authentication** is selected, and then set **Authentication service location**, **Roles service location**, and **Web settings service location** to `http://localhost:55555/AppServices`.</span></span>  
  
8.  <span data-ttu-id="10765-137">Legen Sie für [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]auf der Registerkarte **Anwendung** die Option **Authentifizierungsmodus** auf **Anwendungsdefiniert**fest.</span><span class="sxs-lookup"><span data-stu-id="10765-137">For [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)], on the **Application** tab, set **Authentication mode** to **Application-defined**.</span></span>  
  
 <span data-ttu-id="10765-138">Der Designer speichert die festgelegten Einstellungen in der app.config-Datei der Anwendung.</span><span class="sxs-lookup"><span data-stu-id="10765-138">The designer stores the specified settings in the application's app.config file.</span></span>  
  
 <span data-ttu-id="10765-139">An diesem Punkt ist die Anwendung darauf konfiguriert, von demselben Host auf alle drei Dienste zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="10765-139">At this point, the application is configured to access all three services from the same host.</span></span> <span data-ttu-id="10765-140">Im nächsten Abschnitt erstellen Sie den Host als einfache Webdienstanwendung, wodurch Sie ihre  Clientkonfiguration testen können.</span><span class="sxs-lookup"><span data-stu-id="10765-140">In the next section, you will create the host as a simple Web service application, enabling you to test your client configuration.</span></span>  
  
## <a name="creating-the-application-services-host"></a><span data-ttu-id="10765-141">Erstellen des Anwendungsdienst-Hostes</span><span class="sxs-lookup"><span data-stu-id="10765-141">Creating the Application Services Host</span></span>  
 <span data-ttu-id="10765-142">In diesem Abschnitt erstellen Sie eine einfache Webdienstanwendung, die auf Benutzerdaten aus einer lokalen SQL Server Compact-Datenbankdatei zugreift.</span><span class="sxs-lookup"><span data-stu-id="10765-142">In this section, you will create a simple Web service application that accesses user data from a local SQL Server Compact database file.</span></span> <span data-ttu-id="10765-143">Anschließend füllen Sie die Datenbank mit [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec)auf.</span><span class="sxs-lookup"><span data-stu-id="10765-143">Then, you will populate the database using the [ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec).</span></span> <span data-ttu-id="10765-144">Mit dieser einfachen Konfiguration können Sie die Clientanwendung schnell überprüfen.</span><span class="sxs-lookup"><span data-stu-id="10765-144">This simple configuration enables you to quickly test your client application.</span></span> <span data-ttu-id="10765-145">Alternativ können Sie den Webdiensthost so konfigurieren, dass er auf Benutzerdaten aus einer vollständigen SQL Server-Datenbank oder durch benutzerdefinierte Klassen <xref:System.Web.Security.MembershipProvider> und <xref:System.Web.Security.RoleProvider> zugreift.</span><span class="sxs-lookup"><span data-stu-id="10765-145">As an alternative, you can configure the Web service host to access user data from a full SQL Server database or through custom <xref:System.Web.Security.MembershipProvider> and <xref:System.Web.Security.RoleProvider> classes.</span></span> <span data-ttu-id="10765-146">Weitere Informationen finden Sie unter [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).</span><span class="sxs-lookup"><span data-stu-id="10765-146">For more information, see [Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2).</span></span>  
  
 <span data-ttu-id="10765-147">Im folgenden Verfahren erstellen und konfigurieren Sie den AppServices-Webdienst.</span><span class="sxs-lookup"><span data-stu-id="10765-147">In the following procedure, you create and configure the AppServices Web service.</span></span>  
  
#### <a name="to-create-and-configure-the-application-services-host"></a><span data-ttu-id="10765-148">So erstellen und konfigurieren Sie den Anwendungsdienst-Host:</span><span class="sxs-lookup"><span data-stu-id="10765-148">To create and configure the application services host</span></span>  
  
1.  <span data-ttu-id="10765-149">Wählen Sie im **Projektmappen-Explorer** die ClientAppServicesDemo-Projektmappe aus. Wählen Sie dann im Menü **Datei** die Option **Hinzufügen &#124; Neues Projekt** aus.</span><span class="sxs-lookup"><span data-stu-id="10765-149">In **Solution Explorer**, select the ClientAppServicesDemo solution, and then on the **File** menu, select **Add &#124; New Project**.</span></span>  
  
2.  <span data-ttu-id="10765-150">Erweitern Sie im Dialogfeld **Neues Projekt hinzufügen** im Bereich **Projekttypen** den **Visual Basic**- oder **Visual C#**-Knoten, und wählen Sie den **Web**-Projekttyp aus.</span><span class="sxs-lookup"><span data-stu-id="10765-150">In the **Add New Project** dialog box, in the **Project types** pane, expand the **Visual Basic** or **Visual C#** node and select the **Web** project type.</span></span>  
  
3.  <span data-ttu-id="10765-151">Stellen Sie sicher, dass **.NET Framework 3.5** ausgewählt ist, und wählen Sie dann die **ASP .NET-Webdienstanwendung** -Vorlage aus.</span><span class="sxs-lookup"><span data-stu-id="10765-151">Make sure that **.NET Framework 3.5** is selected, and then select the **ASP.NET Web Service Application** template.</span></span>  
  
4.  <span data-ttu-id="10765-152">Ändern Sie den **Namen** des Projekts in `AppServices` , und klicken Sie dann auf **OK**.</span><span class="sxs-lookup"><span data-stu-id="10765-152">Change the project **Name** to `AppServices` and then click **OK**.</span></span>  
  
     <span data-ttu-id="10765-153">Ein neues ASP.NET Web Service-Anwendungsprojekt wird der Projektmappe hinzugefügt, und die Datei Service1.asmx.vb oder Service1.asmx.cs wird im Editor angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-153">A new ASP.NET Web service application project is added to the solution, and the Service1.asmx.vb or Service1.asmx.cs file appears in the editor.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="10765-154">Die Datei Service1.asmx.vb oder Service1.asmx.cs wird in diesem Beispiel nicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="10765-154">The Service1.asmx.vb or Service1.asmx.cs file is not used in this example.</span></span> <span data-ttu-id="10765-155">Wenn die Arbeitsumgebung übersichtlich bleiben soll, können Sie sie schließen und aus dem **Projektmappen-Explorer**löschen.</span><span class="sxs-lookup"><span data-stu-id="10765-155">If you want to keep your work environment uncluttered, you can close it and delete it from **Solution Explorer**.</span></span>  
  
5.  <span data-ttu-id="10765-156">Wählen Sie im **Projektmappen-Explorer**das AppServices-Projekt aus. Wählen Sie dann im Menü **Projekt** die Option **AppServices-Eigenschaften**aus.</span><span class="sxs-lookup"><span data-stu-id="10765-156">In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **AppServices Properties**.</span></span>  
  
     <span data-ttu-id="10765-157">Der Projekt-Designer wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-157">The project designer appears.</span></span>  
  
6.  <span data-ttu-id="10765-158">Stellen Sie auf der Registerkarte **Web** sicher, dass **Mit Visual Studio Development Server** ausgewählt ist.</span><span class="sxs-lookup"><span data-stu-id="10765-158">On the **Web** tab, make sure that **Use Visual Studio Development Server** is selected.</span></span>  
  
7.  <span data-ttu-id="10765-159">Wählen Sie **Bestimmter Port**, geben Sie den Wert `55555`ein, und legen Sie dann den **virtuellen Pfad** auf `/AppServices`fest.</span><span class="sxs-lookup"><span data-stu-id="10765-159">Select **Specific port**, specify a value of `55555`, and then set **Virtual path** to `/AppServices`.</span></span>  
  
8.  <span data-ttu-id="10765-160">Speichern Sie alle Dateien.</span><span class="sxs-lookup"><span data-stu-id="10765-160">Save all files.</span></span>  
  
9. <span data-ttu-id="10765-161">Öffnen Sie im **Projektmappen-Explorer**die Web.config und suchen Sie nach dem `<system.web>` Öffnungstag.</span><span class="sxs-lookup"><span data-stu-id="10765-161">In **Solution Explorer**, open Web.config and find the `<system.web>` opening tag.</span></span>  
  
10. <span data-ttu-id="10765-162">Fügen Sie das folgende Markup vor Tag `<system.web>` hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-162">Add the following markup before the `<system.web>` tag.</span></span>  
  
     <span data-ttu-id="10765-163">Mithilfe der Elemente `authenticationService`, `profileService`und `roleService` in diesem Markup werden die Anwendungsdienste aktiviert und konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="10765-163">The `authenticationService`, `profileService`, and `roleService` elements in this markup enable and configure the application services.</span></span> <span data-ttu-id="10765-164">Für Testzwecke wird das Attribut `requireSSL` des Elements `authenticationService` auf „false“ festgelegt.</span><span class="sxs-lookup"><span data-stu-id="10765-164">For testing purposes, the `requireSSL` attribute of the `authenticationService` element is set to "false".</span></span> <span data-ttu-id="10765-165">Die Attribute `readAccessProperties` und `writeAccessProperties` des Elements `profileService` zeigen an, dass die Eigenschaft `WebSettingsTestText` schreibgeschützt ist.</span><span class="sxs-lookup"><span data-stu-id="10765-165">The `readAccessProperties` and `writeAccessProperties` attributes of the `profileService` element indicate that the `WebSettingsTestText` property is read/write.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="10765-166">In Produktionscode sollten Sie auf den Authentifizierungsdienst stets über SSL (Secure Sockets Layer; unter Verwendung des HTTPS-Protokolls) zugreifen.</span><span class="sxs-lookup"><span data-stu-id="10765-166">In production code, you should always access the authentication service over the secure sockets layer (SSL, by using the HTTPS protocol).</span></span> <span data-ttu-id="10765-167">Weitere Informationen zum Einrichten von SSL finden Sie unter [Konfigurieren von SSL (Secure Sockets Layer) (Bedienerhandbuch zu IIS 6.0)](http://go.microsoft.com/fwlink/?LinkId=91844).</span><span class="sxs-lookup"><span data-stu-id="10765-167">For information about how to set up SSL, see [Configuring Secure Sockets Layer (IIS 6.0 Operations Guide)](http://go.microsoft.com/fwlink/?LinkId=91844).</span></span>  
  
    ```xml  
    <system.web.extensions>  
      <scripting>  
        <webServices>  
          <authenticationService enabled="true" requireSSL = "false"/>  
          <profileService enabled="true"  
            readAccessProperties="WebSettingsTestText"  
            writeAccessProperties="WebSettingsTestText" />  
          <roleService enabled="true"/>  
        </webServices>  
      </scripting>  
    </system.web.extensions>  
    ```  
  
11. <span data-ttu-id="10765-168">Fügen Sie das folgende Markup nach dem  Öffnungstag `<system.web>` hinzu, sodass es sich innerhalb des Elements `<system.web>` befindet.</span><span class="sxs-lookup"><span data-stu-id="10765-168">Add the following markup after the `<system.web>` opening tag so that it is within the `<system.web>` element.</span></span>  
  
     <span data-ttu-id="10765-169">Das Element `profile` konfiguriert eine einzelne Webeinstellung mit dem Namen `WebSettingsTestText`.</span><span class="sxs-lookup"><span data-stu-id="10765-169">The `profile` element configures a single Web setting named `WebSettingsTestText`.</span></span>  
  
    ```xml  
    <profile enabled="true" >  
      <properties>  
        <add name="WebSettingsTestText" type="string"   
          readOnly="false" defaultValue="DefaultText"   
          serializeAs="String" allowAnonymous="false" />  
      </properties>  
    </profile>  
    ```  
  
 <span data-ttu-id="10765-170">Im folgenden Verfahren verwenden Sie das ASP.NET Websiteverwaltungs-Tool, um die Dienstkonfiguration abzuschließen und die lokale Datenbankdatei aufzufüllen.</span><span class="sxs-lookup"><span data-stu-id="10765-170">In the following procedure, you use the ASP.NET Web Site Administration tool to complete the service configuration and populate the local database file.</span></span> <span data-ttu-id="10765-171">Fügen Sie zwei Benutzer mit dem Namen `employee` und `manager` zu zwei Rollen mit denselben Namen hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-171">You will add two users named `employee` and `manager` belonging to two roles with the same names.</span></span> <span data-ttu-id="10765-172">Die Benutzerkennwörter lauten `employee!` bzw. `manager!` .</span><span class="sxs-lookup"><span data-stu-id="10765-172">The user passwords are `employee!` and `manager!` respectively.</span></span>  
  
#### <a name="to-configure-membership-and-roles"></a><span data-ttu-id="10765-173">So konfigurieren Sie die Mitgliedschaft und Rollen:</span><span class="sxs-lookup"><span data-stu-id="10765-173">To configure membership and roles</span></span>  
  
1.  <span data-ttu-id="10765-174">Wählen Sie im **Projektmappen-Explorer**das AppServices-Projekt aus. Wählen Sie dann im Menü **Projekt** die Option **ASP .NET-Konfiguration**aus.</span><span class="sxs-lookup"><span data-stu-id="10765-174">In **Solution Explorer**, select the AppServices project, and then on the **Project** menu, select **ASP.NET Configuration**.</span></span>  
  
     <span data-ttu-id="10765-175">Das **ASP.NET-Websiteverwaltungs-Tool** wird aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="10765-175">The **ASP.NET Web Site Administration Tool** appears.</span></span>  
  
2.  <span data-ttu-id="10765-176">Klicken Sie auf der Registerkarte **Sicherheit** auf **„Verwenden des Sicherheits-Setup-Assistenten“, um die Sicherheit Schritt für Schritt zu konfigurieren.**</span><span class="sxs-lookup"><span data-stu-id="10765-176">On the **Security** tab, click **Use the security Setup Wizard to configure security step by step**.</span></span>  
  
     <span data-ttu-id="10765-177">Die **Sicherheits-Setup-Assistent** wird geöffnet und zeigt den **Begrüßungsschritt** an.</span><span class="sxs-lookup"><span data-stu-id="10765-177">The **Security Setup Wizard** appears and displays the **Welcome** step.</span></span>  
  
3.  <span data-ttu-id="10765-178">Klicken Sie auf **Weiter**.</span><span class="sxs-lookup"><span data-stu-id="10765-178">Click **Next**.</span></span>  
  
     <span data-ttu-id="10765-179">Es wird der Schritt **Zugriffsmethode auswählen** angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-179">The **Select Access Method** step appears.</span></span>  
  
4.  <span data-ttu-id="10765-180">Wählen Sie **Aus dem Internet**.</span><span class="sxs-lookup"><span data-stu-id="10765-180">Select **From the internet**.</span></span> <span data-ttu-id="10765-181">Dadurch wird der Dienst auf die Nutzung der Formularauthentifizierung statt der Windows-Authentifizierung konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="10765-181">This configures the service to use Forms authentication instead of Windows authentication.</span></span>  
  
5.  <span data-ttu-id="10765-182">Klicken Sie zweimal auf **Weiter** .</span><span class="sxs-lookup"><span data-stu-id="10765-182">Click **Next** twice.</span></span>  
  
     <span data-ttu-id="10765-183">Der Schritt **Rollen definieren** wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-183">The **Define Roles** step appears.</span></span>  
  
6.  <span data-ttu-id="10765-184">Wählen Sie **Aktivieren von Rollen für diese Website**.</span><span class="sxs-lookup"><span data-stu-id="10765-184">Select **Enable roles for this Web site**.</span></span>  
  
7.  <span data-ttu-id="10765-185">Klicken Sie auf **Weiter**.</span><span class="sxs-lookup"><span data-stu-id="10765-185">Click **Next**.</span></span> <span data-ttu-id="10765-186">Das Formular **Neue Rolle erstellen** wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-186">The **Create New Role** form appears.</span></span>  
  
8.  <span data-ttu-id="10765-187">Geben Sie in das Textfeld **Name der neuen Rolle** den Wert `manager` ein. Klicken Sie dann auf **Rolle hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="10765-187">In the **New Role Name** text box, type `manager` and then click **Add Role**.</span></span>  
  
     <span data-ttu-id="10765-188">Die Tabelle **Vorhandene Rollen** wird mit dem angegebenen Wert angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-188">The **Existing Roles** table appears with the specified value.</span></span>  
  
9. <span data-ttu-id="10765-189">Ersetzen Sie im Textfeld **Name der neuen Rolle** den Wert `manager` durch `employee` . Klicken Sie dann auf **Rolle hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="10765-189">In the **New Role Name** text box, replace `manager` with `employee` and then click **Add Role**.</span></span>  
  
     <span data-ttu-id="10765-190">Der neue Wert wird in der Tabelle **vorhandene Rollen** angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-190">The new value appears in the **Existing Roles** table.</span></span>  
  
10. <span data-ttu-id="10765-191">Klicken Sie auf **Weiter**.</span><span class="sxs-lookup"><span data-stu-id="10765-191">Click **Next**.</span></span>  
  
     <span data-ttu-id="10765-192">Der Schritt **neue Benutzer hinzufügen** wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-192">The **Add New Users** step appears.</span></span>  
  
11. <span data-ttu-id="10765-193">Legen Sie im Formular **Benutzer erstellen** die folgenden Werte fest:</span><span class="sxs-lookup"><span data-stu-id="10765-193">In the **Create User** form, specify the following values.</span></span>  
  
  	|||  
  	|-|-|  
  	|<span data-ttu-id="10765-194">**Benutzername**</span><span class="sxs-lookup"><span data-stu-id="10765-194">**User Name**</span></span>|`manager`|  
  	|<span data-ttu-id="10765-195">**Kennwort**</span><span class="sxs-lookup"><span data-stu-id="10765-195">**Password**</span></span>|`manager!`|  
  	|<span data-ttu-id="10765-196">**Kennwort bestätigen**</span><span class="sxs-lookup"><span data-stu-id="10765-196">**Confirm Password**</span></span>|`manager!`|  
  	|<span data-ttu-id="10765-197">**E-Mail**</span><span class="sxs-lookup"><span data-stu-id="10765-197">**E-mail**</span></span>|`manager@contoso.com`|  
  	|<span data-ttu-id="10765-198">**Sicherheitsfrage**</span><span class="sxs-lookup"><span data-stu-id="10765-198">**Security Question**</span></span>|`manager`|  
  	|<span data-ttu-id="10765-199">**Sicherheitsantwort**</span><span class="sxs-lookup"><span data-stu-id="10765-199">**Security Answer**</span></span>|`manager`|  
  
12. <span data-ttu-id="10765-200">Klicken Sie auf **Benutzer erstellen**</span><span class="sxs-lookup"><span data-stu-id="10765-200">Click **Create User**.</span></span>  
  
     <span data-ttu-id="10765-201">Eine Erfolgsmeldung wird eingeblendet.</span><span class="sxs-lookup"><span data-stu-id="10765-201">A success message appears.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="10765-202">Die Werte für **E-Mail**, **Sicherheitsfrage**, und **Sicherheitsantwort** werden vom Formular benötigt, werden jedoch in diesem Beispiel nicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="10765-202">The **E-mail**, **Security Question**, and **Security Answer** values are required by the form, but are not used in this example.</span></span>  
  
13. <span data-ttu-id="10765-203">Klicken Sie auf **Weiter**.</span><span class="sxs-lookup"><span data-stu-id="10765-203">Click **Continue**.</span></span>  
  
     <span data-ttu-id="10765-204">Das Formular **Benutzer erstellen** wird erneut angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-204">The **Create User** form reappears.</span></span>  
  
14. <span data-ttu-id="10765-205">Legen Sie im Formular **Benutzer erstellen** die folgenden Werte fest:</span><span class="sxs-lookup"><span data-stu-id="10765-205">In the **Create User** form, specify the following values.</span></span>  
  
  	|||  
  	|-|-|  
  	|<span data-ttu-id="10765-206">**Benutzername**</span><span class="sxs-lookup"><span data-stu-id="10765-206">**User Name**</span></span>|`employee`|  
  	|<span data-ttu-id="10765-207">**Kennwort**</span><span class="sxs-lookup"><span data-stu-id="10765-207">**Password**</span></span>|`employee!`|  
  	|<span data-ttu-id="10765-208">**Kennwort bestätigen**</span><span class="sxs-lookup"><span data-stu-id="10765-208">**Confirm Password**</span></span>|`employee!`|  
  	|<span data-ttu-id="10765-209">**E-Mail**</span><span class="sxs-lookup"><span data-stu-id="10765-209">**E-mail**</span></span>|`employee@contoso.com`|  
  	|<span data-ttu-id="10765-210">**Sicherheitsfrage**</span><span class="sxs-lookup"><span data-stu-id="10765-210">**Security Question**</span></span>|`Employee`|  
  	|<span data-ttu-id="10765-211">**Sicherheitsantwort**</span><span class="sxs-lookup"><span data-stu-id="10765-211">**Security Answer**</span></span>|`employee`|  
  
15. <span data-ttu-id="10765-212">Klicken Sie auf **Benutzer erstellen**</span><span class="sxs-lookup"><span data-stu-id="10765-212">Click **Create User**.</span></span>  
  
     <span data-ttu-id="10765-213">Eine Erfolgsmeldung wird eingeblendet.</span><span class="sxs-lookup"><span data-stu-id="10765-213">A success message appears.</span></span>  
  
16. <span data-ttu-id="10765-214">Klicken Sie auf **Fertig stellen**.</span><span class="sxs-lookup"><span data-stu-id="10765-214">Click **Finish**.</span></span>  
  
     <span data-ttu-id="10765-215">Das **Websiteverwaltungs-Tool** wird wieder eingeblendet.</span><span class="sxs-lookup"><span data-stu-id="10765-215">The **Web Site Administration Tool** reappears.</span></span>  
  
17. <span data-ttu-id="10765-216">Klicken Sie auf **Manager-Benutzer**.</span><span class="sxs-lookup"><span data-stu-id="10765-216">Click **Manager users**.</span></span>  
  
     <span data-ttu-id="10765-217">Die Liste der Benutzer wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-217">The list of users appears.</span></span>  
  
18. <span data-ttu-id="10765-218">Klicken Sie auf **Rollen bearbeiten** für die **Mitarbeiter** -Benutzer, und wählen Sie dann die **Mitarbeiter** -Rolle aus.</span><span class="sxs-lookup"><span data-stu-id="10765-218">Click **Edit roles** for the **employee** user, and then select the **employee** role.</span></span>  
  
19. <span data-ttu-id="10765-219">Klicken Sie auf **Rollen bearbeiten** für den **Manager** -Benutzer, und wählen Sie dann die **Manager** -Rolle aus.</span><span class="sxs-lookup"><span data-stu-id="10765-219">Click **Edit roles** for the **manager** user, and then select the **manager** role.</span></span>  
  
20. <span data-ttu-id="10765-220">Schließen Sie das Browserfenster, in dem das **Websiteverwaltungs-Tool**gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="10765-220">Close the browser window that hosts the **Web Site Administration Tool**.</span></span>  
  
21. <span data-ttu-id="10765-221">Wenn ein Meldungsfeld eingeblendet wird, in dem Sie gefragt werden, ob Sie die geänderte Datei Web.config erneut laden möchten, klicken Sie auf **Ja**.</span><span class="sxs-lookup"><span data-stu-id="10765-221">If a message box appears asking if you want to reload the modified Web.config file, click **Yes**.</span></span>  
  
 <span data-ttu-id="10765-222">Dadurch wird die Einrichtung des Webdiensts abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="10765-222">This completes the Web service setup.</span></span> <span data-ttu-id="10765-223">Sie können nun auf F5 drücken, um die Client-Anwendung auszuführen. Der **ASP.NET Development Server** wird automatisch zusammen mit der Clientanwendung gestartet.</span><span class="sxs-lookup"><span data-stu-id="10765-223">At this point, you can press F5 to run the client application, and the **ASP.NET Development Server** will start automatically along with your client application.</span></span> <span data-ttu-id="10765-224">Der Server wird weiter ausgeführt, nachdem Sie die Anwendung beenden, er wird jedoch bei einem Neustart der Anwendung neu hochgefahren.</span><span class="sxs-lookup"><span data-stu-id="10765-224">The server will continue to run after you exit the application, but will restart when you restart the application.</span></span> <span data-ttu-id="10765-225">Dadurch können alle an der Web.config vorgenommenen Änderungen erkannt werden.</span><span class="sxs-lookup"><span data-stu-id="10765-225">This allows it to detect any changes you have made to Web.config.</span></span>  
  
 <span data-ttu-id="10765-226">Um den Server manuell zu stoppen, klicken Sie im Infobereich der Taskleiste mit der rechten Maustaste auf ASP.NET Development Server. Klicken Sie dann auf **Stopp**.</span><span class="sxs-lookup"><span data-stu-id="10765-226">To stop the server manually, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**.</span></span> <span data-ttu-id="10765-227">Dies empfiehlt sich gelegentlich, um einen reibungslosen Neustart zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="10765-227">This is useful occasionally to make sure that a clean restart occurs.</span></span>  
  
## <a name="adding-forms-authentication"></a><span data-ttu-id="10765-228">Hinzufügen der Formularauthentifizierung</span><span class="sxs-lookup"><span data-stu-id="10765-228">Adding Forms Authentication</span></span>  
 <span data-ttu-id="10765-229">Im folgenden Verfahren fügen Sie Code zum Hauptformular hinzu, der versucht, den Benutzer zu validieren. Er verweigert den Zugang, wenn der Benutzer ungültige Anmeldeinformationen bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="10765-229">In the following procedure, you add code to the main form that attempts to validate the user, and denies access when the user supplies invalid credentials.</span></span> <span data-ttu-id="10765-230">Sie verwenden einen hartcodierten Benutzernamen und ein Kennwort, um den Dienst zu testen</span><span class="sxs-lookup"><span data-stu-id="10765-230">You use a hard-coded user name and password to test the service.</span></span>  
  
#### <a name="to-validate-the-user-in-your-application-code"></a><span data-ttu-id="10765-231">So überprüfen Sie den Benutzer im Anwendungscode:</span><span class="sxs-lookup"><span data-stu-id="10765-231">To validate the user in your application code</span></span>  
  
1.  <span data-ttu-id="10765-232">Fügen Sie im **Projektmappen-Explorer** im Projekt ClientAppServicesDemo einen Verweis auf die Assembly „System.Web“ ein.</span><span class="sxs-lookup"><span data-stu-id="10765-232">In **Solution Explorer**, in the ClientAppServicesDemo project, add a reference to the System.Web assembly.</span></span>  
  
2.  <span data-ttu-id="10765-233">Wählen Sie die Datei Form1 aus. Wählen Sie dann **Ansicht &#124; Code** aus dem [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]-Hauptmenü aus.</span><span class="sxs-lookup"><span data-stu-id="10765-233">Select the Form1 file and then select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
3.  <span data-ttu-id="10765-234">Fügen Sie oben in der Datei Form1 im Code-Editor die folgenden Statements hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-234">In the code editor, add the following statements to the top of the Form1 file.</span></span>  
  
     <span data-ttu-id="10765-235">[!code-csharp[Clientanwendungsdienste#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)] [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]</span><span class="sxs-lookup"><span data-stu-id="10765-235">[!code-csharp[ClientApplicationServices#001](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#001)]  [!code-vb[ClientApplicationServices#001](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#001)]</span></span>  
  
4.  <span data-ttu-id="10765-236">Doppelklicken Sie im **Projektmappen-Explorer**auf Form1, um den Designer anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="10765-236">In **Solution Explorer**, double-click Form1 to display the designer.</span></span>  
  
5.  <span data-ttu-id="10765-237">Doppelklicken Sie im Designer auf die Formularoberfläche, um einen <xref:System.Windows.Forms.Form.Load?displayProperty=fullName> Ereignishandler mit dem Namen `Form1_Load`anzulegen.</span><span class="sxs-lookup"><span data-stu-id="10765-237">In the designer, double-click the form surface to generate a <xref:System.Windows.Forms.Form.Load?displayProperty=fullName> event handler named `Form1_Load`.</span></span>  
  
     <span data-ttu-id="10765-238">Der Code-Editor wird mit dem Cursor im `Form1_Load` -Verfahren angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-238">The code editor appears with the cursor in the `Form1_Load` method.</span></span>  
  
6.  <span data-ttu-id="10765-239">Fügen Sie der `Form1_Load` -Methode folgenden Code hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-239">Add the following code to the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="10765-240">Dieser Code verweigert nicht authentifizierten Benutzern den Zugriff, indem er die Anwendung beendet.</span><span class="sxs-lookup"><span data-stu-id="10765-240">This code denies access to unauthenticated users by exiting the application.</span></span> <span data-ttu-id="10765-241">Alternativ könnten Sie nicht authentifizierten Benutzern den Zugriff auf das Formular gestatten, ihren zugriff auf bestimmte Funktionen hingegen verweigern.</span><span class="sxs-lookup"><span data-stu-id="10765-241">Alternatively, you could allow unauthenticated users access to the form, but deny access to specific functionality.</span></span> <span data-ttu-id="10765-242">Normalerweise nehmen Sie keine Hardcodierung des Benutzernamens und des Kennwortes vor, es ist jedoch hilfreich zu Testzwecken.</span><span class="sxs-lookup"><span data-stu-id="10765-242">Normally, you will not hard-code the user name and password like this, but it is useful for testing purposes.</span></span> <span data-ttu-id="10765-243">Im nächsten Abschnitt ersetzen Sie diesen Code durch einen robusteren Code, der ein Anmeldedialogfeld aufruft und der die Ausnahmebehandlung beinhaltet.</span><span class="sxs-lookup"><span data-stu-id="10765-243">In the next section, you will replace this code with more robust code that displays a login dialog box and includes exception handling.</span></span>  
  
     <span data-ttu-id="10765-244">Beachten Sie, dass die `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> -Methode in [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)]vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="10765-244">Note that the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method is in the [!INCLUDE[dnprdnext](../../../includes/dnprdnext-md.md)].</span></span> <span data-ttu-id="10765-245">Diese Methode delegiert die Arbeit an den konfigurierten Authentifizierungsanbieter und kehrt zurück, wenn die `true` -Authentifizierung erfolgreich war.</span><span class="sxs-lookup"><span data-stu-id="10765-245">This method delegates its work to the configured authentication provider, and returns `true` if authentication is successful.</span></span> <span data-ttu-id="10765-246">Ihr Anwendungscode erfordert keinen direkten Verweis auf den Dienstanbieter.</span><span class="sxs-lookup"><span data-stu-id="10765-246">Your application does not require a direct reference to the client authentication provider.</span></span>  
  
     <span data-ttu-id="10765-247">[!code-csharp[Clientanwendungsdienste#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)] [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]</span><span class="sxs-lookup"><span data-stu-id="10765-247">[!code-csharp[ClientApplicationServices#300](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#300)]  [!code-vb[ClientApplicationServices#300](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#300)]</span></span>  
  
 <span data-ttu-id="10765-248">Sie können jetzt F5 drücken, um die Anwendung auszuführen. Da Sie einen gültigen Benutzernamen und ein Kennwort angeben, wird das Formular angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-248">You can now press F5 to run the application, and because you provide a correct user name and password, you will see the form.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="10765-249">Wenn Sie die Anwendung nicht ausführen können, versuchen Sie, den ASP.NET Development Server anzuhalten.</span><span class="sxs-lookup"><span data-stu-id="10765-249">If you are unable to run the application, try stopping the ASP.NET Development Server.</span></span> <span data-ttu-id="10765-250">Stellen Sie beim Neustart des Servers sicher, dass der Port auf 55555 festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="10765-250">When the server restarts, verify that the port is set to 55555.</span></span>  
  
 <span data-ttu-id="10765-251">Um stattdessen die Fehlermeldung zu sehen, ändern Sie die <xref:System.Web.Security.Membership.ValidateUser%2A> Parameter.</span><span class="sxs-lookup"><span data-stu-id="10765-251">To see the error message instead, change the <xref:System.Web.Security.Membership.ValidateUser%2A> parameters.</span></span> <span data-ttu-id="10765-252">Ersetzen Sie beispielsweise den zweiten `"manager!"` Parameter durch ein falsches Kennwort, wie `"MANAGER"`.</span><span class="sxs-lookup"><span data-stu-id="10765-252">For example, replace the second `"manager!"` parameter with an incorrect password like `"MANAGER"`.</span></span>  
  
## <a name="adding-a-login-form-as-a-credentials-provider"></a><span data-ttu-id="10765-253">Hinzufügen eines Anmeldeformulars als Anmeldeinformationsanbieter</span><span class="sxs-lookup"><span data-stu-id="10765-253">Adding a Login Form as a Credentials Provider</span></span>  
 <span data-ttu-id="10765-254">Sie können die Benutzeranmeldeinformationen im Anwendungscode abrufen und an die <xref:System.Web.Security.Membership.ValidateUser%2A> Methode übergeben.</span><span class="sxs-lookup"><span data-stu-id="10765-254">You can acquire the user credentials in your application code and pass them to the <xref:System.Web.Security.Membership.ValidateUser%2A> method.</span></span> <span data-ttu-id="10765-255">Allerdings ist es oft hilfreich, den Anmeldeinformationen-Akquisitionscode getrennt von Ihrem Anwendungscode zu halten, für den Fall, dass Sie ihn später ändern möchten.</span><span class="sxs-lookup"><span data-stu-id="10765-255">However, it is often useful to keep your credentials-acquiring code separate from your application code, in case you want to change it later.</span></span>  
  
 <span data-ttu-id="10765-256">Im folgenden Verfahren konfigurieren Sie Ihre Anwendung auf die Verwendung eines Anmeldeinformationsanbieters. Dann ändern Sie Ihren <xref:System.Web.Security.Membership.ValidateUser%2A> Methodenaufruf zum Bestehen <xref:System.String.Empty> für beide Parameter.</span><span class="sxs-lookup"><span data-stu-id="10765-256">In the following procedure, you configure your application to use a credentials provider, and then change your <xref:System.Web.Security.Membership.ValidateUser%2A> method call to pass <xref:System.String.Empty> for both parameters.</span></span> <span data-ttu-id="10765-257">Die leeren Zeichenfolgen signalisieren der <xref:System.Web.Security.Membership.ValidateUser%2A> -Methode, dass sie die <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> -Methode des konfigurierten Anmeldeinformationsanbieters aufrufen soll.</span><span class="sxs-lookup"><span data-stu-id="10765-257">The empty strings signal the <xref:System.Web.Security.Membership.ValidateUser%2A> method to call the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> method of the configured credentials provider.</span></span>  
  
#### <a name="to-configure-your-application-to-use-a-credentials-provider"></a><span data-ttu-id="10765-258">So konfigurieren Sie ihre Anwendung auf die Verwendung eines Anmeldeinformationsanbieters:</span><span class="sxs-lookup"><span data-stu-id="10765-258">To configure your application to use a credentials provider</span></span>  
  
1.  <span data-ttu-id="10765-259">Wählen Sie im **Projektmappen-Explorer**das Projekt ClientAppServicesDemo aus. Wählen Sie dann im Menü **Projekt** die **ClientAppServicesDemo-Eigenschaften**aus.</span><span class="sxs-lookup"><span data-stu-id="10765-259">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="10765-260">Der Projekt-Designer wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-260">The project designer appears.</span></span>  
  
2.  <span data-ttu-id="10765-261">Legen Sie auf der Registerkarte **Dienste** die Option **Optional: Anmeldeinformationsanbieter** auf den folgenden Wert fest.</span><span class="sxs-lookup"><span data-stu-id="10765-261">On the **Services** tab, set **Optional: Credential provider** to the following value.</span></span> <span data-ttu-id="10765-262">Dieser Wert gibt den von der Assembly qualifizierten Typnamen an.</span><span class="sxs-lookup"><span data-stu-id="10765-262">This value indicates the assembly-qualified type name.</span></span>  
  
    ```  
    ClientAppServicesDemo.Login, ClientAppServicesDemo  
    ```  
  
3.  <span data-ttu-id="10765-263">Ersetzen Sie in der Codedatei Form1 den Code in der `Form1_Load` -Methode durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="10765-263">In the Form1 code file, replace the code in the `Form1_Load` method with the following code.</span></span>  
  
     <span data-ttu-id="10765-264">Dieser Code zeigt eine Begrüßungsnachricht an. Dann ruft er die `ValidateUsingCredentialsProvider` -Methode auf, die im nächsten Schritt hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-264">This code displays a welcome message and then calls the `ValidateUsingCredentialsProvider` method that you will add in the next step.</span></span> <span data-ttu-id="10765-265">Wenn der Benutzer nicht authentifiziert ist, gibt die `ValidateUsingCredentialsProvider` -Methode `false` aus, und die Methode `Form1_Load` wird wiederhergestellt.</span><span class="sxs-lookup"><span data-stu-id="10765-265">If the user is not authenticated, the `ValidateUsingCredentialsProvider` method returns `false` and the `Form1_Load` method returns.</span></span> <span data-ttu-id="10765-266">Dadurch wird verhindert, dass durch eine Ausführung vor Anwendungsende zusätzlicher Code ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-266">This prevents any additional code from running before the application exits.</span></span> <span data-ttu-id="10765-267">Die Willkommensnachricht ist nützlich, um zu verdeutlichen, wann die Anwendung neu gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="10765-267">The welcome message is useful to make it clear when the application restarts.</span></span> <span data-ttu-id="10765-268">Sie fügen Code hinzugefügt, um die Anwendung neu zu starten, wenn Sie später in dieser exemplarischen Vorgehensweise die Abmeldung implementieren.</span><span class="sxs-lookup"><span data-stu-id="10765-268">You will add code to restart the application when you implement logout later in this walkthrough.</span></span>  
  
     <span data-ttu-id="10765-269">[!code-csharp[Clientanwendungsdienste#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)] [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]</span><span class="sxs-lookup"><span data-stu-id="10765-269">[!code-csharp[ClientApplicationServices#011](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#011)]  [!code-vb[ClientApplicationServices#011](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#011)]</span></span>  
  
4.  <span data-ttu-id="10765-270">Fügen Sie die folgende Methode nach der `Form1_Load` -Methode hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-270">Add the following method after the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="10765-271">Diese Methode transferiert leere Zeichenfolgen an die `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> -Methode, wodurch das Anmeldedialogfeld angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-271">This method passes empty strings to the `static` <xref:System.Web.Security.Membership.ValidateUser%2A?displayProperty=fullName> method, which causes the Login dialog box to appear.</span></span> <span data-ttu-id="10765-272">Wenn der Authentifizierungsdienst nicht verfügbar ist, gibt die <xref:System.Web.Security.Membership.ValidateUser%2A> -Methode <xref:System.Net.WebException>aus.</span><span class="sxs-lookup"><span data-stu-id="10765-272">If the authentication service is unavailable, the <xref:System.Web.Security.Membership.ValidateUser%2A> method will throw a <xref:System.Net.WebException>.</span></span> <span data-ttu-id="10765-273">In diesem Fall zeigt die `ValidateUsingCredentialsProvider` -Methode eine Warnmeldung an und fragt, ob der Benutzer den Vorgang im Offline-Modus wiederholen möchte.</span><span class="sxs-lookup"><span data-stu-id="10765-273">In this case, the `ValidateUsingCredentialsProvider` method displays a warning message and asks if the user wants to try again in offline mode.</span></span> <span data-ttu-id="10765-274">Diese Funktionalität erfordert die Funktion **Kennworthash lokal speichern, um Offlineanmeldung zu ermöglichen** , die in [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md)beschrieben wird.</span><span class="sxs-lookup"><span data-stu-id="10765-274">This functionality requires the **Save password hash locally to enable offline login** feature described in [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span> <span data-ttu-id="10765-275">Dieses Feature wird standardmäßig für neue Projekte aktiviert.</span><span class="sxs-lookup"><span data-stu-id="10765-275">This feature is enabled by default for new projects.</span></span>  
  
     <span data-ttu-id="10765-276">Wenn der Benutzer nicht überprüft wird, zeigt die `ValidateUsingCredentialsProvider` -Methode eine Fehlermeldung an und beendet die Anwendung.</span><span class="sxs-lookup"><span data-stu-id="10765-276">If the user is not validated, the `ValidateUsingCredentialsProvider` method displays an error message and exits the application.</span></span> <span data-ttu-id="10765-277">Schließlich gibt diese Methode das Ergebnis des Authentifizierungsversuchs aus.</span><span class="sxs-lookup"><span data-stu-id="10765-277">Finally, this method returns the result of the authentication attempt.</span></span>  
  
     <span data-ttu-id="10765-278">[!code-csharp[Clientanwendungsdienste#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)] [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]</span><span class="sxs-lookup"><span data-stu-id="10765-278">[!code-csharp[ClientApplicationServices#020](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#020)]  [!code-vb[ClientApplicationServices#020](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#020)]</span></span>  
  
### <a name="creating-a-login-form"></a><span data-ttu-id="10765-279">Erstellen eines Anmeldeformulars</span><span class="sxs-lookup"><span data-stu-id="10765-279">Creating a Login Form</span></span>  
 <span data-ttu-id="10765-280">Ein Anmeldeinformationsanbieter ist eine Klasse oder eine Struktur, die die <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> -Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="10765-280">A credentials provider is a class that implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.</span></span> <span data-ttu-id="10765-281">Diese Schnittstelle verfügt über eine einzelne Methode namens <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> , die ein <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> Objekt ausgibt.</span><span class="sxs-lookup"><span data-stu-id="10765-281">This interface has a single method named <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> that returns a <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationCredentials> object.</span></span> <span data-ttu-id="10765-282">In den folgenden Verfahren wird beschrieben, wie ein Anmeldedialogfeld zu erstellen ist, das <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementiert, um sich selbst darzustellen und um die vom Benutzer angegebenen Anmeldeinformationen auszugeben.</span><span class="sxs-lookup"><span data-stu-id="10765-282">The following procedures describe how to create a login dialog box that implements <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> to display itself and return the user-specified credentials.</span></span>  
  
 <span data-ttu-id="10765-283">Separate Verfahren werden zu [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] und C# geboten, da [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] eine **Anmeldeformular** -Vorlage bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-283">Separate procedures are provided for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] and C# because [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] provides a **Login Form** template.</span></span> <span data-ttu-id="10765-284">Dies spart Zeit- und Programmieraufwand.</span><span class="sxs-lookup"><span data-stu-id="10765-284">This saves some time and coding effort.</span></span>  
  
##### <a name="to-create-a-login-dialog-box-as-a-credentials-provider-in-visual-basic"></a><span data-ttu-id="10765-285">Erstellen Sie als Anmeldeinformationsanbieter ein Anmeldedialogfeld in Visual Basic</span><span class="sxs-lookup"><span data-stu-id="10765-285">To create a login dialog box as a credentials provider in Visual Basic</span></span>  
  
1.  <span data-ttu-id="10765-286">Wählen Sie im **Projektmappen-Explorer**das ClientAppServicesDemo-Projekt aus. Wählen Sie dann im Menü **Projekt** die Option **Hinzufügen | Neues Element**aus.</span><span class="sxs-lookup"><span data-stu-id="10765-286">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add New Item**.</span></span>  
  
2.  <span data-ttu-id="10765-287">Wählen Sie im Dialogfeld **Neues Element hinzufügen** die Vorlage **Anmeldeformular** aus. Ändern Sie den Wert für **Name** in `Login.vb`, und klicken Sie dann auf **Hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="10765-287">In the **Add New Item** dialog box, select the **Login Form** template, change the item **Name** to `Login.vb`, and then click **Add**.</span></span>  
  
     <span data-ttu-id="10765-288">Das Anmeldedialogfeld wird im Windows Forms-Designer angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-288">The login dialog box appears in the Windows Forms Designer.</span></span>  
  
3.  <span data-ttu-id="10765-289">Wählen Sie im Designer die Schaltfläche **OK** aus. Legen Sie im Fenster **Eigenschaften** `DialogResult` auf `OK`fest.</span><span class="sxs-lookup"><span data-stu-id="10765-289">In the designer, select the **OK** button and then, in the **Properties** window, set `DialogResult` to `OK`.</span></span>  
  
4.  <span data-ttu-id="10765-290">Fügen Sie im Designer ein `CheckBox` Steuerelement unterhalb des **Kennwort** -Textfeldes ein.</span><span class="sxs-lookup"><span data-stu-id="10765-290">In the designer, add a `CheckBox` control to the form under the **Password** text box.</span></span>  
  
5.  <span data-ttu-id="10765-291">Geben Sie in das Fenster **Eigenschaften** einen **(Name)**-Wert von `rememberMeCheckBox` und einen **Text**-Wert von `&Remember me` ein.</span><span class="sxs-lookup"><span data-stu-id="10765-291">In the **Properties** window, specify a **(Name)** value of `rememberMeCheckBox` and a **Text** value of `&Remember me`.</span></span>  
  
6.  <span data-ttu-id="10765-292">Wählen Sie **Ansicht &#124; Code** aus [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] im Hauptmenü aus.</span><span class="sxs-lookup"><span data-stu-id="10765-292">Select **View &#124; Code** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
7.  <span data-ttu-id="10765-293">Fügen Sie im Code-Editor am oberen Rand der Datei den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="10765-293">In the code editor, add the following code to the top of the file.</span></span>  
  
     <span data-ttu-id="10765-294">[!code-vb[ClientApplicationServices#101](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#101)]</span><span class="sxs-lookup"><span data-stu-id="10765-294">[!code-vb[ClientApplicationServices#101](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#101)]</span></span>  
  
8.  <span data-ttu-id="10765-295">Ändern Sie als Nächstes die Klassensignatur, sodass die Klasse die <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider>-Schnittstelle implementiert.</span><span class="sxs-lookup"><span data-stu-id="10765-295">Modify the class signature so that the class implements the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider> interface.</span></span>  
  
     <span data-ttu-id="10765-296">[!code-vb[ClientApplicationServices#110](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#110)]</span><span class="sxs-lookup"><span data-stu-id="10765-296">[!code-vb[ClientApplicationServices#110](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#110)]</span></span>  
  
9. <span data-ttu-id="10765-297">Stellen Sie sicher, dass sich der Cursor hinter `IClientformsAuthenticationCredentialsProvider`befindet, und drücken Sie dann die EINGABETASTE, um die `GetCredentials` -Methode zu generieren.</span><span class="sxs-lookup"><span data-stu-id="10765-297">Make sure that the cursor is after `IClientformsAuthenticationCredentialsProvider`, and then press ENTER to generate the `GetCredentials` method.</span></span>  
  
10. <span data-ttu-id="10765-298">Suchen Sie die <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> Implementierung, und ersetzten Sie sie durch den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="10765-298">Locate the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation and then replace it with the following code.</span></span>  
  
     <span data-ttu-id="10765-299">[!code-vb[ClientApplicationServices#120](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#120)]</span><span class="sxs-lookup"><span data-stu-id="10765-299">[!code-vb[ClientApplicationServices#120](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Login.vb#120)]</span></span>  
  
 <span data-ttu-id="10765-300">Die folgende C#-Prozedur enthält die gesamte Codeauflistung für ein einfaches Anmeldedialogfeld.</span><span class="sxs-lookup"><span data-stu-id="10765-300">The following C# procedure provides the entire code listing for a simple login dialog box.</span></span> <span data-ttu-id="10765-301">Das Layout dieses Dialogfelds ist recht einfach gehalten, aber der wichtigste Teil ist die <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> -Implementierung.</span><span class="sxs-lookup"><span data-stu-id="10765-301">The layout for this dialog box is a bit crude, but the important part is the <xref:System.Web.ClientServices.Providers.IClientFormsAuthenticationCredentialsProvider.GetCredentials%2A> implementation.</span></span>  
  
##### <a name="to-create-a-login-dialog-box-as-a-credentials-provider-in-c"></a><span data-ttu-id="10765-302">So erstellen Sie als Anmeldeinformationsanbieter ein Anmeldedialogfeld in C#:</span><span class="sxs-lookup"><span data-stu-id="10765-302">To create a login dialog box as a credentials provider in C#</span></span>  
  
1.  <span data-ttu-id="10765-303">Wählen Sie im **Projektmappen-Explorer**das ClientAppServicesDemo-Projekt aus. Wählen Sie dann im Menü **Projekt** die Option **Klasse hinzufügen**aus.</span><span class="sxs-lookup"><span data-stu-id="10765-303">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **Add Class**.</span></span>  
  
2.  <span data-ttu-id="10765-304">Ändern Sie im Dialogfeld **Neues Element hinzufügen** den Wert für **Name** in `Login.cs`. Klicken Sie dann auf **Hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="10765-304">In the **Add New Item** dialog box, change the **Name** to `Login.cs`, and then click **Add**.</span></span>  
  
     <span data-ttu-id="10765-305">Die Datei Login.cs wird im Code-Editor geöffnet.</span><span class="sxs-lookup"><span data-stu-id="10765-305">The Login.cs file opens in the code editor.</span></span>  
  
3.  <span data-ttu-id="10765-306">Ersetzen Sie den Standardcode durch den folgenden Code.</span><span class="sxs-lookup"><span data-stu-id="10765-306">Replace the default code with the following code.</span></span>  
  
     <span data-ttu-id="10765-307">[!code-csharp[ClientApplicationServices#200](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Login.cs#200)]</span><span class="sxs-lookup"><span data-stu-id="10765-307">[!code-csharp[ClientApplicationServices#200](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Login.cs#200)]</span></span>  
  
 <span data-ttu-id="10765-308">Sie können die Anwendung nun ausführen. Das Anmeldedialogfeld wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-308">You can now run the application and see the login dialog box appear.</span></span> <span data-ttu-id="10765-309">Um diesen Code zu testen, probieren Sie verschiedene Anmeldeinformationen aus – sowohl gültige als auch ungültige – und vergewissern Sie sich, dass Sie nur mit gültigen Anmeldeinformationen auf das Formular zugreifen können.</span><span class="sxs-lookup"><span data-stu-id="10765-309">To test this code, try different credentials, both valid and invalid, and confirm that you can access the form only with valid credentials.</span></span> <span data-ttu-id="10765-310">Gültige Benutzernamen sind `employee` und `manager` mit den Kennwörtern `employee!` bzw. `manager!` .</span><span class="sxs-lookup"><span data-stu-id="10765-310">Valid user names are `employee` and `manager` with passwords `employee!` and `manager!` respectively.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="10765-311">Wählen Sie zu diesem Zeitpunkt nicht **Anmeldedaten** aus. Ansonsten können Sie sich nicht mehr als ein anderer Benutzer anmelden, bis Sie die Abmeldung später in dieser exemplarischen Vorgehensweise implementiert haben.</span><span class="sxs-lookup"><span data-stu-id="10765-311">Do not select **Remember me** at this point or you will not be able to login as another user until you implement logout later in this walkthrough.</span></span>  
  
## <a name="adding-role-based-functionality"></a><span data-ttu-id="10765-312">Hinzufügen rollenbasierter Funktionalität</span><span class="sxs-lookup"><span data-stu-id="10765-312">Adding Role-Based Functionality</span></span>  
 <span data-ttu-id="10765-313">Im folgenden Verfahren müssen Sie dem Formular eine Schaltfläche hinzufügen und diese nur für Benutzer in der Managerrolle anzeigen lassen.</span><span class="sxs-lookup"><span data-stu-id="10765-313">In the following procedure, you add a button to the form and display it only for users in the manager role.</span></span>  
  
#### <a name="to-change-the-user-interface-based-on-user-role"></a><span data-ttu-id="10765-314">So ändern Sie die Benutzerrollen-basierte Benutzeroberfläche:</span><span class="sxs-lookup"><span data-stu-id="10765-314">To change the user interface based on user role</span></span>  
  
1.  <span data-ttu-id="10765-315">Wählen Sie im **Projektmappen-Explorer** im Projekt ClientAppServicesDemo die Option Form1 aus. Wählen Sie dann **Ansicht &#124; Designer** aus [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] im Hauptmenü aus.</span><span class="sxs-lookup"><span data-stu-id="10765-315">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
2.  <span data-ttu-id="10765-316">Fügen Sie im Designer dem Formular ein <xref:System.Windows.Forms.Button>-Steuerelement aus der **Toolbox** hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-316">In the designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.</span></span>  
  
3.  <span data-ttu-id="10765-317">Legen Sie im Fenster **Eigenschaften** die folgenden Eigenschaften für die Schaltfläche fest:</span><span class="sxs-lookup"><span data-stu-id="10765-317">In the **Properties** window, set the following properties for the button.</span></span>  
  
  	|<span data-ttu-id="10765-318">Eigenschaft</span><span class="sxs-lookup"><span data-stu-id="10765-318">Property</span></span>|<span data-ttu-id="10765-319">Wert</span><span class="sxs-lookup"><span data-stu-id="10765-319">Value</span></span>|  
  	|--------------|-----------|  
  	|<span data-ttu-id="10765-320">**(Name)**</span><span class="sxs-lookup"><span data-stu-id="10765-320">**(Name)**</span></span>|<span data-ttu-id="10765-321">managerOnlyButton</span><span class="sxs-lookup"><span data-stu-id="10765-321">managerOnlyButton</span></span>|  
  	|<span data-ttu-id="10765-322">**Text**</span><span class="sxs-lookup"><span data-stu-id="10765-322">**Text**</span></span>|<span data-ttu-id="10765-323">&Manager-Aufgabe</span><span class="sxs-lookup"><span data-stu-id="10765-323">&Manager task</span></span>|  
  	|<span data-ttu-id="10765-324">**Visible**</span><span class="sxs-lookup"><span data-stu-id="10765-324">**Visible**</span></span>|`False`|  
  
4.  <span data-ttu-id="10765-325">Fügen Sie im Code-Editor am Ende des Abschnitts `Form1_Load` den folgenden Code hinzu:</span><span class="sxs-lookup"><span data-stu-id="10765-325">In the code editor for Form1, add the following code to the end of the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="10765-326">Dieser Code ruft die `DisplayButtonForManagerRole` -Methode auf, die im nächsten Schritt hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-326">This code calls the `DisplayButtonForManagerRole` method that you will add in the next step.</span></span>  
  
     <span data-ttu-id="10765-327">[!code-csharp[Clientanwendungsdienste#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)] [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]</span><span class="sxs-lookup"><span data-stu-id="10765-327">[!code-csharp[ClientApplicationServices#012](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#012)]  [!code-vb[ClientApplicationServices#012](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#012)]</span></span>  
  
5.  <span data-ttu-id="10765-328">Fügen Sie der Formular1-Klasse die folgende Methode hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-328">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="10765-329">Diese Methode ruft die <xref:System.Security.Principal.IPrincipal.IsInRole%2A> -Methode von <xref:System.Security.Principal.IPrincipal> auf, die von der Eigenschaft `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> ausgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="10765-329">This method calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method of the <xref:System.Security.Principal.IPrincipal> returned by the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property.</span></span> <span data-ttu-id="10765-330">Für Anwendungen, die für die Verwendung von Clientanwendungsdiensten konfiguriert sind, gibt diese Eigenschaft eine(n) <xref:System.Web.ClientServices.ClientRolePrincipal>aus.</span><span class="sxs-lookup"><span data-stu-id="10765-330">For applications configured to use client application services, this property returns a <xref:System.Web.ClientServices.ClientRolePrincipal>.</span></span> <span data-ttu-id="10765-331">Da diese Klasse die <xref:System.Security.Principal.IPrincipal> -Schnittstelle implementiert, müssen Sie nicht explizit auf diese verweisen.</span><span class="sxs-lookup"><span data-stu-id="10765-331">Because this class implements the <xref:System.Security.Principal.IPrincipal> interface, you do not need to reference it explicitly.</span></span>  
  
     <span data-ttu-id="10765-332">Wenn sich der Benutzer in der „Manager“-Rolle befindet, dann legt die `DisplayButtonForManagerRole` -Methode die <xref:System.Windows.Forms.Control.Visible%2A> -Eigenschaft von `managerOnlyButton` auf `true`fest.</span><span class="sxs-lookup"><span data-stu-id="10765-332">If the user is in the "manager" role, the `DisplayButtonForManagerRole` method sets the <xref:System.Windows.Forms.Control.Visible%2A> property of the `managerOnlyButton` to `true`.</span></span> <span data-ttu-id="10765-333">Bei dieser Methode wird außerdem eine Fehlermeldung angezeigt, wenn eine <xref:System.Net.WebException> ausgelöst wird, was bedeutet, dass der Rollendienst nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="10765-333">This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the roles service is unavailable.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="10765-334">Die <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> Methode gibt stets `false` aus, wenn die Benutzeranmeldung abgelaufen ist.</span><span class="sxs-lookup"><span data-stu-id="10765-334">The <xref:System.Web.ClientServices.ClientRolePrincipal.IsInRole%2A> method will always return `false` if the user login has expired.</span></span> <span data-ttu-id="10765-335">Dies geschieht nicht, wenn die Anwendung die <xref:System.Security.Principal.IPrincipal.IsInRole%2A> Methode einmal kurz nach der Authentifizierung aufruft, wie im Beispielcode für diese exemplarische Vorgehensweise dargestellt.</span><span class="sxs-lookup"><span data-stu-id="10765-335">This will not occur if your application calls the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method one time shortly after authentication, as shown in the example code for this walkthrough.</span></span> <span data-ttu-id="10765-336">Wenn Ihre Anwendung Benutzerrollen zu anderen Zeiten abrufen muss, empfiehlt es sich, Code hinzufügen, um Benutzer, deren Anmeldung abgelaufen ist, erneut zu überprüfen.</span><span class="sxs-lookup"><span data-stu-id="10765-336">If your application must retrieve user roles at other times, you might want to add code to revalidate users whose login has expired.</span></span> <span data-ttu-id="10765-337">Wenn allen gültigen Benutzern Rollen zugewiesen sind, können Sie bestimmen, ob die Anmeldung, abgelaufen ist, in dem Sie die <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> -Methode aufrufen.</span><span class="sxs-lookup"><span data-stu-id="10765-337">If all valid users are assigned to roles, you can determine whether the login has expired by calling the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A?displayProperty=fullName> method.</span></span> <span data-ttu-id="10765-338">Wenn keine Rollen ausgegeben, ist die Anmeldung abgelaufen.</span><span class="sxs-lookup"><span data-stu-id="10765-338">If no roles are returned, the login has expired.</span></span> <span data-ttu-id="10765-339">Ein Beispiel für diese Funktion finden Sie unter der <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> -Methode.</span><span class="sxs-lookup"><span data-stu-id="10765-339">For an example of this functionality, see the <xref:System.Web.ClientServices.Providers.ClientRoleProvider.GetRolesForUser%2A> method.</span></span> <span data-ttu-id="10765-340">Diese Funktion ist nur erforderlich, wenn Sie die Option **Verlangen, dass sich der Benutzer bei Ablauf des Cookies erneut anmelden** in der Anwendungskonfiguration ausgewählt haben.</span><span class="sxs-lookup"><span data-stu-id="10765-340">This functionality is only necessary if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration.</span></span> <span data-ttu-id="10765-341">Weitere Informationen finden Sie unter [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="10765-341">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span>  
  
     <span data-ttu-id="10765-342">[!code-csharp[Clientanwendungsdienste#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)] [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]</span><span class="sxs-lookup"><span data-stu-id="10765-342">[!code-csharp[ClientApplicationServices#030](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#030)]  [!code-vb[ClientApplicationServices#030](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#030)]</span></span>  
  
 <span data-ttu-id="10765-343">Wenn die Authentifizierung erfolgreich ist, legt der Client-Authentifizierungsanbieter die <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName>-Eigenschaft auf eine Instanz der <xref:System.Web.ClientServices.ClientRolePrincipal>-Klasse fest.</span><span class="sxs-lookup"><span data-stu-id="10765-343">If authentication is successful, the client authentication provider sets the <xref:System.Threading.Thread.CurrentPrincipal%2A?displayProperty=fullName> property to an instance of the <xref:System.Web.ClientServices.ClientRolePrincipal> class.</span></span> <span data-ttu-id="10765-344">Diese Klasse implementiert die <xref:System.Security.Principal.IPrincipal.IsInRole%2A> -Methode, damit die Arbeit an den konfigurierten Rollenanbieter delegiert werden kann.</span><span class="sxs-lookup"><span data-stu-id="10765-344">This class implements the <xref:System.Security.Principal.IPrincipal.IsInRole%2A> method so that the work is delegated to the configured role provider.</span></span> <span data-ttu-id="10765-345">Wie zuvor erfordert Ihr Anwendungscode keinen direkten Verweis auf den Dienstanbieter.</span><span class="sxs-lookup"><span data-stu-id="10765-345">As before, your application code does not require a direct reference to the service provider.</span></span>  
  
 <span data-ttu-id="10765-346">Sie können die Anwendung jetzt ausführen und sich als Mitarbeiter anmelden, um festzustellen, dass die Schaltfläche nicht eingeblendet wird. Dann melden Sie sich als Manager an,  um festzustellen, dass die Schaltfläche nun angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-346">You can now run the application and log in as employee to see that the button does not appear, and then log in as manager to see the button.</span></span>  
  
## <a name="accessing-web-settings"></a><span data-ttu-id="10765-347">Zugriff auf Webeinstellungen</span><span class="sxs-lookup"><span data-stu-id="10765-347">Accessing Web Settings</span></span>  
 <span data-ttu-id="10765-348">Im folgenden Verfahren fügen Sie dem Formular ein Textfeld hinzu und binden es an eine Webeinstellung.</span><span class="sxs-lookup"><span data-stu-id="10765-348">In the following procedure, you add a text box to the form and bind it to a Web setting.</span></span> <span data-ttu-id="10765-349">Wie beim vorherigen Code, bei dem Authentifizierung und Rollen verwendet werden, greift der Einstellungscode nicht direkt auf den Einstellungsanbieter zu.</span><span class="sxs-lookup"><span data-stu-id="10765-349">Like the previous code that uses authentication and roles, your settings code does not access the settings provider directly.</span></span> <span data-ttu-id="10765-350">Stattdessen wird die stark typisierte `Settings` Klasse (als `Properties.Settings.Default` in c# und `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]aufgerufen) von [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)]für das Projekt generiert.</span><span class="sxs-lookup"><span data-stu-id="10765-350">Instead, it uses the strongly-typed `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) generated for your project by [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)].</span></span>  
  
#### <a name="to-use-web-settings-in-your-user-interface"></a><span data-ttu-id="10765-351">So verwenden Sie die Webeinstellungen auf  der Benutzeroberfläche:</span><span class="sxs-lookup"><span data-stu-id="10765-351">To use Web settings in your user interface</span></span>  
  
1.  <span data-ttu-id="10765-352">Stellen Sie durch Überprüfung des Benachrichtigungsbereichs der Taskleiste  sicher, dass der **ASP.NET Web Development Server** weiterhin ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-352">Make sure that the **ASP.NET Web Development Server** is still running by checking the notification area of the taskbar.</span></span> <span data-ttu-id="10765-353">Wenn Sie den Server angehalten haben, starten Sie die Anwendung neu (wodurch automatisch der Server gestartet wird). Schließen Sie dann das Anmeldedialogfeld.</span><span class="sxs-lookup"><span data-stu-id="10765-353">If you have stopped the server, restart the application (which starts the server automatically) then close the login dialog box.</span></span>  
  
2.  <span data-ttu-id="10765-354">Wählen Sie im **Projektmappen-Explorer**das Projekt ClientAppServicesDemo aus. Wählen Sie dann im Menü **Projekt** die **ClientAppServicesDemo-Eigenschaften**aus.</span><span class="sxs-lookup"><span data-stu-id="10765-354">In **Solution Explorer**, select the ClientAppServicesDemo project, and then on the **Project** menu, select **ClientAppServicesDemo Properties**.</span></span>  
  
     <span data-ttu-id="10765-355">Der Projekt-Designer wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-355">The project designer appears.</span></span>  
  
3.  <span data-ttu-id="10765-356">Klicken Sie auf der Registerkarte **Einstellungen** auf **Webeinstellungen laden**.</span><span class="sxs-lookup"><span data-stu-id="10765-356">On the **Settings** tab, click **Load Web Settings**.</span></span>  
  
     <span data-ttu-id="10765-357">Ein Dialogfeld **Anmelden** wird angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-357">A **Login** dialog box appears.</span></span>  
  
4.  <span data-ttu-id="10765-358">Geben Sie Anmeldeinformationen für Mitarbeiter oder Manager ein, und klicken Sie auf **Anmelden**.</span><span class="sxs-lookup"><span data-stu-id="10765-358">Enter credentials for employee or manager and click **Log In**.</span></span> <span data-ttu-id="10765-359">Die Webeinstellung, die Sie verwenden, ist nur für den Zugriff durch authentifizierte Benutzer konfiguriert. Ein Klicken auf **Anmeldung überspringen** bewirkt somit, dass keine Einstellungen geladen werden.</span><span class="sxs-lookup"><span data-stu-id="10765-359">The Web setting you will use is configured for access by authenticated users only, so clicking **Skip Login** will not load any settings.</span></span>  
  
     <span data-ttu-id="10765-360">Die `WebSettingsTestText` Einstellung wird im Designer mit dem Standardwert `DefaultText`angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-360">The `WebSettingsTestText` setting appears in the designer with the default value of `DefaultText`.</span></span> <span data-ttu-id="10765-361">Darüber hinaus wird eine `Settings` Klasse mit einer Eigenschaft `WebSettingsTestText` für das Projekt generiert.</span><span class="sxs-lookup"><span data-stu-id="10765-361">Additionally, a `Settings` class that contains a `WebSettingsTestText` property is generated for your project.</span></span>  
  
5.  <span data-ttu-id="10765-362">Wählen Sie im **Projektmappen-Explorer** im Projekt ClientAppServicesDemo die Option Form1 aus. Wählen Sie dann **Ansicht &#124; Designer** aus [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] im Hauptmenü aus.</span><span class="sxs-lookup"><span data-stu-id="10765-362">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
6.  <span data-ttu-id="10765-363">Fügen Sie im Designer dem Formular ein <xref:System.Windows.Forms.TextBox>-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-363">In the designer, add a <xref:System.Windows.Forms.TextBox> control to the form.</span></span>  
  
7.  <span data-ttu-id="10765-364">Geben Sie im Fenster **Eigenschaften** für **(Name)** den Wert `webSettingsTestTextBox`ein.</span><span class="sxs-lookup"><span data-stu-id="10765-364">In the **Properties** window, specify a **(Name)** value of `webSettingsTestTextBox`.</span></span>  
  
8.  <span data-ttu-id="10765-365">Fügen Sie im Code-Editor den folgenden Code am Ende des Abschnitts `Form1_Load` hinzu:</span><span class="sxs-lookup"><span data-stu-id="10765-365">In the code editor, add the following code to the end of the `Form1_Load` method.</span></span>  
  
     <span data-ttu-id="10765-366">Dieser Code ruft die `BindWebSettingsTestTextBox` -Methode auf, die im nächsten Schritt hinzugefügt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-366">This code calls the `BindWebSettingsTestTextBox` method that you will add in the next step.</span></span>  
  
     <span data-ttu-id="10765-367">[!code-csharp[Clientanwendungsdienste#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)] [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]</span><span class="sxs-lookup"><span data-stu-id="10765-367">[!code-csharp[ClientApplicationServices#013](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#013)]  [!code-vb[ClientApplicationServices#013](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#013)]</span></span>  
  
9. <span data-ttu-id="10765-368">Fügen Sie der Formular1-Klasse die folgende Methode hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-368">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="10765-369">Diese Methode bindet die <xref:System.Windows.Forms.TextBox.Text%2A> -Eigenschaft von `webSettingsTestTextBox` an die `WebSettingsTestText` -Eigenschaft  der `Settings` -Klasse, die früher bei diesem Verfahren generiert wurde.</span><span class="sxs-lookup"><span data-stu-id="10765-369">This method binds the <xref:System.Windows.Forms.TextBox.Text%2A> property of the `webSettingsTestTextBox` to the `WebSettingsTestText` property of the `Settings` class generated earlier in this procedure.</span></span> <span data-ttu-id="10765-370">Bei dieser Methode wird außerdem eine Fehlermeldung angezeigt, wenn <xref:System.Net.WebException> ausgelöst wird, was bedeutet, dass der Webeinstellungsdienst nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="10765-370">This method also displays an error message if a <xref:System.Net.WebException> is thrown, which indicates that the Web settings service is unavailable.</span></span>  
  
     <span data-ttu-id="10765-371">[!code-csharp[Clientanwendungsdienste#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)] [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]</span><span class="sxs-lookup"><span data-stu-id="10765-371">[!code-csharp[ClientApplicationServices#040](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#040)]   [!code-vb[ClientApplicationServices#040](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#040)]</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="10765-372">Sie verwenden die Datenbindung in der Regel, um die automatische bidirektionale Kommunikation zwischen einem Steuerelement und einer Webeinstellung zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="10765-372">You will typically use data binding to enable automatic two-way communication between a control and a Web setting.</span></span> <span data-ttu-id="10765-373">Sie können jedoch auf Web-Einstellungen, wie im folgenden Beispiel dargestellt, auch direkt zugreifen:</span><span class="sxs-lookup"><span data-stu-id="10765-373">However, you can also access Web settings directly as shown in the following example:</span></span>  
  
     <span data-ttu-id="10765-374">[!code-csharp[Clientanwendungsdienste#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)] [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]</span><span class="sxs-lookup"><span data-stu-id="10765-374">[!code-csharp[ClientApplicationServices#322](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Class1.cs#322)]   [!code-vb[ClientApplicationServices#322](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Class1.vb#322)]</span></span>  
  
10. <span data-ttu-id="10765-375">Wählen Sie im Designer das Formular aus. Klicken Sie dann im Fenster **Eigenschaften** auf die Schaltfläche **Ereignisse** .</span><span class="sxs-lookup"><span data-stu-id="10765-375">In the designer, select the form, and then, in the **Properties** window, click the **Events** button.</span></span>  
  
11. <span data-ttu-id="10765-376">Wählen Sie das <xref:System.Windows.Forms.Form.FormClosing> -Ereignis aus, und drücken Sie dann die EINGABETASTE, um einen Ereignishandler zu generieren.</span><span class="sxs-lookup"><span data-stu-id="10765-376">Select the <xref:System.Windows.Forms.Form.FormClosing> event and then press ENTER to generate an event handler.</span></span>  
  
12. <span data-ttu-id="10765-377">Ersetzen Sie die generierte Methode durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="10765-377">Replace the generated method with the following code.</span></span>  
  
     <span data-ttu-id="10765-378">Der <xref:System.Windows.Forms.Form.FormClosing> -Ereignishandler ruft die `SaveSettings` -Methode ab, welche auch von der Abmeldefunktion verwendet wird, die Sie im nächsten Abschnitt hinzufügen werden.</span><span class="sxs-lookup"><span data-stu-id="10765-378">The <xref:System.Windows.Forms.Form.FormClosing> event handler calls the `SaveSettings` method, which is also used by the logout functionality that you will add in the next section.</span></span> <span data-ttu-id="10765-379">Bei der `SaveSettings` -Methode wird zunächst verifiziert, dass sich der Benutzer nicht abgemeldet hat.</span><span class="sxs-lookup"><span data-stu-id="10765-379">The `SaveSettings` method first confirms that the user has not logged out.</span></span> <span data-ttu-id="10765-380">Dies geschieht durch die Überprüfung der <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> -Eigenschaft von <xref:System.Security.Principal.IIdentity> , die vom derzeitigen Rektor zurückgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="10765-380">It does this by checking the <xref:System.Security.Principal.IIdentity.AuthenticationType%2A> property of the <xref:System.Security.Principal.IIdentity> returned by the current principal.</span></span> <span data-ttu-id="10765-381">Der aktuelle Rektor wird über die Eigenschaft `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="10765-381">The current principal is retrieved through the `static` <xref:System.Threading.Thread.CurrentPrincipal%2A> property.</span></span> <span data-ttu-id="10765-382">Wenn der Benutzer für Clientanwendungsdienste authentifiziert wurde, ist der Authentifizierungstyp „ClientForms“.</span><span class="sxs-lookup"><span data-stu-id="10765-382">If the user has been authenticated for client application services, the authentication type will be "ClientForms".</span></span> <span data-ttu-id="10765-383">Die `SaveSettings` -Methode kann nicht einfach nur die <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName> -Eigenschaft überprüfen, da der Benutzer nach der Abmeldung über eine gültige Windows-Identität verfügen mag.</span><span class="sxs-lookup"><span data-stu-id="10765-383">The `SaveSettings` method cannot just check the <xref:System.Security.Principal.IIdentity.IsAuthenticated%2A?displayProperty=fullName> property because the user might have a valid Windows identity after logout.</span></span>  
  
     <span data-ttu-id="10765-384">Wenn sich der Benutzer nicht abgemeldet hat, erfasst die `SaveSettings` -Methode die <xref:System.Configuration.ApplicationSettingsBase.Save%2A> -Methode der `Settings` -Klasse, die zuvor in diesem Verfahren weiter oben in diesem Verfahren generiert wurde.</span><span class="sxs-lookup"><span data-stu-id="10765-384">If the user has not logged out, the `SaveSettings` method calls the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method of the `Settings` class generated earlier in this procedure.</span></span> <span data-ttu-id="10765-385">Diese Methode kann eine(n) <xref:System.Net.WebException> auslösen, wenn der Authentifizierungscookie abgelaufen ist.</span><span class="sxs-lookup"><span data-stu-id="10765-385">This method can throw a <xref:System.Net.WebException> if the authentication cookie has expired.</span></span> <span data-ttu-id="10765-386">Dies tritt nur ein, wenn Sie die Option **Verlangen, dass sich der Benutzer bei Ablauf des Cookies erneut anmelden** in der Anwendungskonfiguration ausgewählt haben.</span><span class="sxs-lookup"><span data-stu-id="10765-386">This occurs only if you have selected **Require users to log on again whenever the server cookie expires** in your application configuration.</span></span> <span data-ttu-id="10765-387">Weitere Informationen finden Sie unter [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="10765-387">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span> <span data-ttu-id="10765-388">Die `SaveSettings` -Methode verarbeitet den Ablauf der Cookies durch den Aufruf <xref:System.Web.Security.Membership.ValidateUser%2A> des Anmeldedialogfeldes.</span><span class="sxs-lookup"><span data-stu-id="10765-388">The `SaveSettings` method handles cookie expiration by calling <xref:System.Web.Security.Membership.ValidateUser%2A> to display the login dialog box.</span></span> <span data-ttu-id="10765-389">Wenn sich der Benutzer erfolgreich anmeldet, versucht die `SaveSettings` -Methode, die Einstellungen erneut zu speichern, indem sie sich selbst aufruft.</span><span class="sxs-lookup"><span data-stu-id="10765-389">If the user logs in successfully, the `SaveSettings` method tries to save the settings again by calling itself.</span></span>  
  
     <span data-ttu-id="10765-390">Wie beim vorherigen Code gibt die `SaveSettings` -Methode eine Fehlermeldung aus, wenn der Remotedienst nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="10765-390">Like in previous code, the `SaveSettings` method displays an error message if the remote service is unavailable.</span></span> <span data-ttu-id="10765-391">Wenn der Einstellungsanbieter nicht auf den Remotedienst zugreifen kann, werden die Einstellungen weiterhin im lokalen Cache gespeichert und erneut geladen, wenn die Anwendung neu gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="10765-391">If the settings provider cannot access the remote service, the settings are still saved to the local cache and reloaded when the application restarts.</span></span>  
  
     <span data-ttu-id="10765-392">[!code-csharp[Clientanwendungsdienste#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)] [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]</span><span class="sxs-lookup"><span data-stu-id="10765-392">[!code-csharp[ClientApplicationServices#050](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#050)]  [!code-vb[ClientApplicationServices#050](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#050)]</span></span>  
  
13. <span data-ttu-id="10765-393">Fügen Sie der Formular1-Klasse die folgende Methode hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-393">Add the following method to the end of the Form1 class.</span></span>  
  
     <span data-ttu-id="10765-394">Dieser Code behandelt das <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName> -Ereignis und zeigt eine Warnung an, wenn eine oder mehrere der Einstellungen nicht gespeichert werden konnten.</span><span class="sxs-lookup"><span data-stu-id="10765-394">This code handles the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved?displayProperty=fullName> event and displays a warning if any of the settings could not be saved.</span></span> <span data-ttu-id="10765-395">Das <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> -Ereignis tritt nicht ein, wenn der Einstellungsdienst nicht verfügbar ist, oder wenn der Authentifizierungscookie abgelaufen ist.</span><span class="sxs-lookup"><span data-stu-id="10765-395">The <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event does not occur if the settings service is unavailable or if the authentication cookie has expired.</span></span> <span data-ttu-id="10765-396">Das <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> -Ereignis tritt beispielsweise ein, wenn sich ein Benutzer bereits abgemeldet hat.</span><span class="sxs-lookup"><span data-stu-id="10765-396">One example of when the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event will occur is if the user has already logged out.</span></span> <span data-ttu-id="10765-397">Sie können diesen Ereignishandler testen, indem Sie den Abmeldungscode unmittelbar vor dem Aufruf der `SaveSettings` -Methode direkt zur <xref:System.Configuration.ApplicationSettingsBase.Save%2A> -Methode hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="10765-397">You can test this event handler by adding logout code to the `SaveSettings` method directly before the <xref:System.Configuration.ApplicationSettingsBase.Save%2A> method call.</span></span> <span data-ttu-id="10765-398">Der von Ihnen verwendbare Abmeldungscode ist im nächsten Abschnitt beschrieben.</span><span class="sxs-lookup"><span data-stu-id="10765-398">Logout code that you can use is described in the next section.</span></span>  
  
     <span data-ttu-id="10765-399">[!code-csharp[Clientanwendungsdienste#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)] [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]</span><span class="sxs-lookup"><span data-stu-id="10765-399">[!code-csharp[ClientApplicationServices#090](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#090)]  [!code-vb[ClientApplicationServices#090](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#090)]</span></span>  
  
14. <span data-ttu-id="10765-400">Fügen Sie bei C# den folgenden Code am Ende der `Form1_Load` -Methode hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-400">For C#, add the following code to the end of the `Form1_Load` method.</span></span> <span data-ttu-id="10765-401">Dieser Code weist die Methode zu, die Sie im letzten Schritt mit dem <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved>-Ereignis hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="10765-401">This code associates the method you added in the last step with the <xref:System.Web.ClientServices.Providers.ClientSettingsProvider.SettingsSaved> event.</span></span>  
  
     <span data-ttu-id="10765-402">[!code-csharp[ClientApplicationServices#015](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#015)]</span><span class="sxs-lookup"><span data-stu-id="10765-402">[!code-csharp[ClientApplicationServices#015](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#015)]</span></span>  
  
 <span data-ttu-id="10765-403">Um die Anwendung an diesem Punkt zu testen, führen Sie sie mehrmals, sowohl als Mitarbeiter als auch als Manager aus. Geben Sie dabei unterschiedliche Werte in das Textfeld ein.</span><span class="sxs-lookup"><span data-stu-id="10765-403">To test the application at this point, run it multiple times as both employee and manager, and type different values into the text box.</span></span> <span data-ttu-id="10765-404">Die Werte bleiben von einer Sitzung zur nächsten je nach Benutzer erhalten.</span><span class="sxs-lookup"><span data-stu-id="10765-404">The values will persist across sessions on a per-user basis.</span></span>  
  
## <a name="implementing-logout"></a><span data-ttu-id="10765-405">Implementieren der Abmeldung</span><span class="sxs-lookup"><span data-stu-id="10765-405">Implementing Logout</span></span>  
 <span data-ttu-id="10765-406">Wenn der Benutzer bei der Anmeldung das Kontrollkästchen **Anmeldedaten** auswählt, authentifiziert die Anwendung den Benutzer bei nachfolgenden Ausführungen automatisch.</span><span class="sxs-lookup"><span data-stu-id="10765-406">When the user selects the **Remember me** check box when logging in, the application will automatically authenticate the user on subsequent runs.</span></span> <span data-ttu-id="10765-407">Die automatische Authentifizierung wird dann fortgesetzt, während sich die Anwendung im Offline-Modus befindet, oder bis der Authentifizierungscookie abläuft.</span><span class="sxs-lookup"><span data-stu-id="10765-407">Automatic authentication will then continue while the application is in offline mode or until the authentication cookie expires.</span></span> <span data-ttu-id="10765-408">In manchen Fällen benötigen jedoch mehrere Benutzer Zugriff auf die Anwendung oder ein einzelner Benutzer muss sich gelegentlich möglicherweise mit anderen Anmeldeinformationen anmelden.</span><span class="sxs-lookup"><span data-stu-id="10765-408">Sometimes, however, multiple users will need access to the application or a single user might occasionally log in with different credentials.</span></span> <span data-ttu-id="10765-409">Um dieses Szenario zu aktivieren, müssen Sie die Abmeldefunktion implementieren, wie im folgenden Verfahren beschrieben.</span><span class="sxs-lookup"><span data-stu-id="10765-409">To enable this scenario, you must implement logout functionality, as described in the following procedure.</span></span>  
  
#### <a name="to-implement-logout-functionality"></a><span data-ttu-id="10765-410">So implementieren Sie die Abmeldefunktion:</span><span class="sxs-lookup"><span data-stu-id="10765-410">To implement logout functionality</span></span>  
  
1.  <span data-ttu-id="10765-411">Fügen Sie im Form1-Designer dem Formular ein <xref:System.Windows.Forms.Button>-Steuerelement aus der **Toolbox** hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-411">In the Form1 designer, add a <xref:System.Windows.Forms.Button> control to the form from the **ToolBox**.</span></span>  
  
2.  <span data-ttu-id="10765-412">Geben Sie im Fenster **Eigenschaften** als **(Name)** den Wert `logoutButton` und für **Text** den Wert **&Abmelden** ein.</span><span class="sxs-lookup"><span data-stu-id="10765-412">In the **Properties** window, specify a **(Name)** value of `logoutButton` and a **Text** value of **&Log Out**.</span></span>  
  
3.  <span data-ttu-id="10765-413">Doppelklicken Sie auf `logoutButton`, um einen <xref:System.Windows.Forms.Control.Click>-Ereignishandler zu generieren.</span><span class="sxs-lookup"><span data-stu-id="10765-413">Double-click the `logoutButton` to generate a <xref:System.Windows.Forms.Control.Click> event handler.</span></span>  
  
     <span data-ttu-id="10765-414">Der Code-Editor wird mit dem Cursor im `logoutButton_Click` -Verfahren angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-414">The code editor appears with the cursor in the `logoutButton_Click` method.</span></span>  
  
4.  <span data-ttu-id="10765-415">Ersetzen Sie die `logoutButton_Click` -Methode durch folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="10765-415">Replace the generated `logoutButton_Click` method with the following code.</span></span>  
  
     <span data-ttu-id="10765-416">Dieser Ereignishandler ruft zuerst die `SaveSettings` -Methode auf, die Sie im vorherigen Abschnitt hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="10765-416">This event handler first calls the `SaveSettings` method that you added in the previous section.</span></span> <span data-ttu-id="10765-417">Anschließend ruft der Ereignishandler die <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName> -Methode auf.</span><span class="sxs-lookup"><span data-stu-id="10765-417">Then, the event handler calls the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A?displayProperty=fullName> method.</span></span> <span data-ttu-id="10765-418">Wenn der Authentifizierungsdienst nicht verfügbar ist, gibt die <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> -Methode <xref:System.Net.WebException>aus.</span><span class="sxs-lookup"><span data-stu-id="10765-418">If the authentication service is unavailable, the <xref:System.Web.ClientServices.Providers.ClientFormsAuthenticationMembershipProvider.Logout%2A> method will throw a <xref:System.Net.WebException>.</span></span> <span data-ttu-id="10765-419">In diesem Fall die `logoutButton_Click` Methode zeigt eine Warnmeldung an und wechselt vorübergehend in den Offline-Modus, um den Benutzer abzumelden.</span><span class="sxs-lookup"><span data-stu-id="10765-419">In this case, the `logoutButton_Click` method displays a warning message and switches temporarily to offline mode to log the user out.</span></span> <span data-ttu-id="10765-420">Der Offline-Modus wird im nächsten Abschnitt beschrieben.</span><span class="sxs-lookup"><span data-stu-id="10765-420">Offline mode is described in the next section.</span></span>  
  
     <span data-ttu-id="10765-421">Beim Abmelden wird der lokale Authentifizierungscookie gelöscht, sodass beim Neustart der Anwendung eine Anmeldung erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="10765-421">Logout deletes the local authentication cookie so that login will be required when the application is restarted.</span></span> <span data-ttu-id="10765-422">Nach der Abmeldung startet der Ereignishandler die Anwendung neu.</span><span class="sxs-lookup"><span data-stu-id="10765-422">After logout, the event handler restarts the application.</span></span> <span data-ttu-id="10765-423">Wenn die Anwendung neu gestartet wird, wird die Begrüßungsnachricht, gefolgt vom Dialogfeld „Anmelden“ angezeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-423">When the application restarts, it displays the welcome message followed by the login dialog box.</span></span> <span data-ttu-id="10765-424">Die Begrüßungsnachricht verdeutlicht, dass die Anwendung neu gestartet wurde.</span><span class="sxs-lookup"><span data-stu-id="10765-424">The welcome message makes it clear that the application has restarted.</span></span> <span data-ttu-id="10765-425">Dadurch wird eine mögliche Verwirrung vermieden, wenn sich der Benutzer anmelden muss, um die Einstellungen zu speichern, und sich dann erneut anmelden muss, weil die Anwendung neu gestartet wurde.</span><span class="sxs-lookup"><span data-stu-id="10765-425">This prevents potential confusion if the user must log in to save settings, and then must log in again because the application has restarted.</span></span>  
  
     <span data-ttu-id="10765-426">[!code-csharp[Clientanwendungsdienste#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)] [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]</span><span class="sxs-lookup"><span data-stu-id="10765-426">[!code-csharp[ClientApplicationServices#070](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#070)]  [!code-vb[ClientApplicationServices#070](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#070)]</span></span>  
  
 <span data-ttu-id="10765-427">Um die Abmeldefunktionalität zu testen, führen Sie die Anwendung aus, und wählen Sie **Anmeldedaten** aus dem Dialogfeld „Anmelden“ aus.</span><span class="sxs-lookup"><span data-stu-id="10765-427">To test the logout functionality, run the application and select **Remember me** on the Login dialog box.</span></span> <span data-ttu-id="10765-428">Als Nächstes schließen Sie die Anwendung und starten Sie sie neu, um zu verifizieren, dass Sie sich nicht mehr anmelden müssen.</span><span class="sxs-lookup"><span data-stu-id="10765-428">Next, close and restart the application to confirm that you no longer have to log in.</span></span> <span data-ttu-id="10765-429">Schließlich starten Sie die Anwendung durch Klicken auf Abmelden.</span><span class="sxs-lookup"><span data-stu-id="10765-429">Finally, restart the application by clicking Log out.</span></span>  
  
## <a name="enabling-offline-mode"></a><span data-ttu-id="10765-430">Aktivieren des Offline-Modus</span><span class="sxs-lookup"><span data-stu-id="10765-430">Enabling Offline Mode</span></span>  
 <span data-ttu-id="10765-431">Im folgenden Verfahren fügen Sie dem Formular ein Kontrollkästchen hinzu, um den Benutzer den Wechsel in den Offline-Modus zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="10765-431">In the following procedure, you add a check box to the form to enable the user to enter offline mode.</span></span> <span data-ttu-id="10765-432">Die Anwendung zeigt den Offline-Modus an, indem die `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName> -Eigenschaft auf `true`festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="10765-432">Your application indicates offline mode by setting the `static` <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A?displayProperty=fullName> property to `true`.</span></span> <span data-ttu-id="10765-433">Der Offline-Status wird auf der lokalen Festplatte an dem Speicherort gespeichert, den die <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName> -Eigenschaft angibt.</span><span class="sxs-lookup"><span data-stu-id="10765-433">The offline status is stored on the local hard disk at the location indicated by the <xref:System.Windows.Forms.Application.UserAppDataPath%2A?displayProperty=fullName> property.</span></span> <span data-ttu-id="10765-434">Dies bedeutet, dass der Offline-Status je nach Benutzer und Anwendung gespeichert wird.</span><span class="sxs-lookup"><span data-stu-id="10765-434">This means that the offline status is stored on a per-user, per-application basis.</span></span>  
  
 <span data-ttu-id="10765-435">Im Offline-Modus werden bei allen Kundenanwendungsdienst-Anforderungen Daten aus dem lokalen Cache abgerufen, statt zu versuchen, ob die Dienste zuzugreifen</span><span class="sxs-lookup"><span data-stu-id="10765-435">In offline mode, all client application service requests retrieve data from the local cache instead of trying to access the services.</span></span> <span data-ttu-id="10765-436">In der Standardkonfiguration enthalten die lokalen Daten das Benutzerkennwort in verschlüsselter Form.</span><span class="sxs-lookup"><span data-stu-id="10765-436">In the default configuration, the local data includes an encrypted form of the user's password.</span></span> <span data-ttu-id="10765-437">Dadurch kann sich der Benutzer anmelden, während sich die Anwendung im Offline-Modus befindet.</span><span class="sxs-lookup"><span data-stu-id="10765-437">This enables the user to log in while the application is in offline mode.</span></span> <span data-ttu-id="10765-438">Weitere Informationen finden Sie unter [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span><span class="sxs-lookup"><span data-stu-id="10765-438">For more information, see [How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md).</span></span>  
  
#### <a name="to-enable-offline-mode-in-your-application"></a><span data-ttu-id="10765-439">So wird der Offline-Modus in der Anwendung aktiviert:</span><span class="sxs-lookup"><span data-stu-id="10765-439">To enable offline mode in your application</span></span>  
  
1.  <span data-ttu-id="10765-440">Wählen Sie im **Projektmappen-Explorer** im Projekt ClientAppServicesDemo die Option Form1 aus. Wählen Sie dann **Ansicht &#124; Designer** aus [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] im Hauptmenü aus.</span><span class="sxs-lookup"><span data-stu-id="10765-440">In **Solution Explorer**, in the ClientAppServicesDemo project, select Form1 and then select **View &#124; Designer** from the [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)] main menu.</span></span>  
  
2.  <span data-ttu-id="10765-441">Fügen Sie im Designer dem Formular ein <xref:System.Windows.Forms.CheckBox>-Steuerelement hinzu.</span><span class="sxs-lookup"><span data-stu-id="10765-441">In the designer, add a <xref:System.Windows.Forms.CheckBox> control to the form.</span></span>  
  
3.  <span data-ttu-id="10765-442">Geben Sie im Fenster **Eigenschaften** als **(Name)** den Wert `workOfflineCheckBox` und als **Text** den Wert **&Offline arbeiten** ein.</span><span class="sxs-lookup"><span data-stu-id="10765-442">In the **Properties** window, specify a **(Name)** value of `workOfflineCheckBox` and a **Text** value of **&Work offline**.</span></span>  
  
4.  <span data-ttu-id="10765-443">Klicken Sie im Fenster **Eigenschaften** auf die Schaltfläche **Ereignisse** .</span><span class="sxs-lookup"><span data-stu-id="10765-443">In the **Properties** window, click the **Events** button.</span></span>  
  
5.  <span data-ttu-id="10765-444">Wählen Sie das <xref:System.Windows.Forms.CheckBox.CheckedChanged> -Ereignis aus, und drücken Sie dann die EINGABETASTE, um einen Ereignishandler zu generieren.</span><span class="sxs-lookup"><span data-stu-id="10765-444">Select the <xref:System.Windows.Forms.CheckBox.CheckedChanged> event and then press ENTER to generate an event handler.</span></span>  
  
6.  <span data-ttu-id="10765-445">Ersetzen Sie die generierte Methode durch den folgenden Code:</span><span class="sxs-lookup"><span data-stu-id="10765-445">Replace the generated method with the following code.</span></span>  
  
     <span data-ttu-id="10765-446">Dieser Code aktualisiert den <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> Wert und validiert den Benutzer, wenn dieser wieder in den Online-Modus wechselt, im Hintergrund neu.</span><span class="sxs-lookup"><span data-stu-id="10765-446">This code updates the <xref:System.Web.ClientServices.ConnectivityStatus.IsOffline%2A> value and silently revalidates the user when they return to online mode.</span></span> <span data-ttu-id="10765-447">Bei der <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName> -Methode werden die zwischengespeicherten Anmeldeinformationen verwendet, sodass sich der Benutzer nicht explizit neu anmelden muss.</span><span class="sxs-lookup"><span data-stu-id="10765-447">The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A?displayProperty=fullName> method uses the cached credentials so that the user does not have to explicitly log in.</span></span> <span data-ttu-id="10765-448">Wenn der Authentifizierungsdienst nicht verfügbar ist, wird eine Warnmeldung angezeigt, und die Anwendung bleibt offline.</span><span class="sxs-lookup"><span data-stu-id="10765-448">If the authentication service is unavailable, a warning message appears and the application stays offline.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="10765-449">Die <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> -Methode wird nur ergänzend bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="10765-449">The <xref:System.Web.ClientServices.ClientFormsIdentity.RevalidateUser%2A> method is for convenience only.</span></span> <span data-ttu-id="10765-450">Da sie nicht über einen Rückgabewert verfügt, kann sie nicht angeben, ob die erneute Überprüfung fehlgeschlagen ist.</span><span class="sxs-lookup"><span data-stu-id="10765-450">Because it does not have a return value, it cannot indicate whether revalidation has failed.</span></span> <span data-ttu-id="10765-451">Die erneute Überprüfung kann z. B. fehlschlagen, wenn die Anmeldeinformationen des Benutzers auf dem Server geändert wurden.</span><span class="sxs-lookup"><span data-stu-id="10765-451">Revalidation can fail, for example, if the user credentials have changed on the server.</span></span> <span data-ttu-id="10765-452">In diesem Fall ist es ratsam, Code einzuschließen, der die Benutzer nach dem Fehlschlagen eines Dienstaufrufs explizit validiert.</span><span class="sxs-lookup"><span data-stu-id="10765-452">In this case, you might want to include code that explicitly validates users after a service call fails.</span></span> <span data-ttu-id="10765-453">Weitere Informationen finden Sie im Abschnitt Zugriff auf Webeinstellungen weiter oben in dieser exemplarischen Vorgehensweise.</span><span class="sxs-lookup"><span data-stu-id="10765-453">For more information, see the Accessing Web Settings section earlier in this walkthrough.</span></span>  
  
     <span data-ttu-id="10765-454">Nach der erneuten Validierung speichert dieser Code alle Änderungen an den lokalen Webeinstellungen durch Aufrufen der `SaveSettings` -Methode, die Sie zuvor hinzugefügt haben.</span><span class="sxs-lookup"><span data-stu-id="10765-454">After revalidation, this code saves any changes to the local Web settings by calling the `SaveSettings` method that you added previously.</span></span> <span data-ttu-id="10765-455">Dann werden alle neuen Werte auf dem Server mithilfe der <xref:System.Configuration.ApplicationSettingsBase.Reload%2A>-Methode der Projekt `Settings`-Klasse aufgerufen (als `Properties.Settings.Default` in c# und `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).</span><span class="sxs-lookup"><span data-stu-id="10765-455">It then retrieves any new values on the server by calling the <xref:System.Configuration.ApplicationSettingsBase.Reload%2A> method of the project's `Settings` class (accessed as `Properties.Settings.Default` in C# and `My.Settings` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]).</span></span>  
  
     <span data-ttu-id="10765-456">[!code-csharp[Clientanwendungsdienste#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)] [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]</span><span class="sxs-lookup"><span data-stu-id="10765-456">[!code-csharp[ClientApplicationServices#080](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#080)]  [!code-vb[ClientApplicationServices#080](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#080)]</span></span>  
  
7.  <span data-ttu-id="10765-457">Fügen Sie den folgenden Code am Ende der `Form1_Load` -Methode ein, um sicherzustellen, dass das Kontrollkästchen den aktuellen Verbindungsstatus anzeigt.</span><span class="sxs-lookup"><span data-stu-id="10765-457">Add the following code to the end of the `Form1_Load` method to make sure that the check box displays the current connection state.</span></span>  
  
     <span data-ttu-id="10765-458">[!code-csharp[Clientanwendungsdienste#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)] [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]</span><span class="sxs-lookup"><span data-stu-id="10765-458">[!code-csharp[ClientApplicationServices#014](../../../samples/snippets/csharp/VS_Snippets_Winforms/ClientApplicationServices/CS/Form1.cs#014)]  [!code-vb[ClientApplicationServices#014](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/ClientApplicationServices/VB/Form1.vb#014)]</span></span>  
  
 <span data-ttu-id="10765-459">Dadurch ist die exemplarische Anwendung abgeschlossen.</span><span class="sxs-lookup"><span data-stu-id="10765-459">This completes the example application.</span></span> <span data-ttu-id="10765-460">Um den Offlinebetrieb zu testen, führen Sie die Anwendung aus. Melden Sie sich als Mitarbeiter oder Manager an, und wählen Sie dann **Offline arbeiten**aus.</span><span class="sxs-lookup"><span data-stu-id="10765-460">To test the offline capability, run the application, log in as either employee or manager, and then select **Work offline**.</span></span> <span data-ttu-id="10765-461">Ändern Sie den Wert im Textfeld, und schließen Sie die Anwendung.</span><span class="sxs-lookup"><span data-stu-id="10765-461">Modify the value in the text box, and then close the application.</span></span> <span data-ttu-id="10765-462">Starten Sie die Anwendung neu.</span><span class="sxs-lookup"><span data-stu-id="10765-462">Restart the application.</span></span> <span data-ttu-id="10765-463">Bevor Sie sich anmelden, klicken Sie im Infobereich der Taskleiste mit der rechten Maustaste auf ASP.NET Development Server. Klicken Sie dann auf **Stopp**.</span><span class="sxs-lookup"><span data-stu-id="10765-463">Before you log in, right-click the ASP.NET Development Server icon in the notification area of the taskbar and then click **Stop**.</span></span> <span data-ttu-id="10765-464">Melden Sie sich dann wie üblich an.</span><span class="sxs-lookup"><span data-stu-id="10765-464">Then, log in like normal.</span></span> <span data-ttu-id="10765-465">Selbst wenn der Server nicht ausgeführt wird, können Sie sich dennoch anmelden.</span><span class="sxs-lookup"><span data-stu-id="10765-465">Even when the server is not running, you can still log in.</span></span> <span data-ttu-id="10765-466">Ändern Sie den Wert im Textfeld, beenden Sie den Server und starten Sie ihn neu, um den geänderten Wert anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="10765-466">Modify the text box value, exit, and restart to see the modified value.</span></span>  
  
## <a name="summary"></a><span data-ttu-id="10765-467">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="10765-467">Summary</span></span>  
 <span data-ttu-id="10765-468">In dieser exemplarischen Vorgehensweise haben Sie gelernt, Clientanwendungsdiensten in einer Windows Forms-Anwendung zu aktivieren und zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="10765-468">In this walkthrough, you learned how to enable and use client application services in a Windows Forms application.</span></span> <span data-ttu-id="10765-469">Nach dem Einrichten eines Testservers haben Sie Ihrer Anwendung Code hinzugefügt, um die Benutzer zu authentifizieren und die Benutzerrollen und Anwendungseinstellungen vom Server abzurufen.</span><span class="sxs-lookup"><span data-stu-id="10765-469">After setting up a test server, you added code to your application to authenticate users and retrieve user roles and application settings from the server.</span></span> <span data-ttu-id="10765-470">Außerdem haben Sie gelernt, den Offlinemodus zu aktivieren, sodass Ihre Anwendung anstelle von Remotediensten einen lokalen Datencache verwendet, wenn keine Verbindung verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="10765-470">You also learned how to enable offline mode so that your application uses a local data cache instead of the remote services when connectivity is not available.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="10765-471">Nächste Schritte</span><span class="sxs-lookup"><span data-stu-id="10765-471">Next Steps</span></span>  
 <span data-ttu-id="10765-472">In einer realen Anwendung werden Sie für viele Benutzer auf Daten von einem Remoteserver zugreifen, der möglicherweise nicht immer verfügbar ist bzw. der ohne Vorwarnung ausfallen kann.</span><span class="sxs-lookup"><span data-stu-id="10765-472">In a real-world application, you will access data for many users from a remote server that may not always be available, or may go down without notice.</span></span> <span data-ttu-id="10765-473">Um die Anwendung robuster machen, müssen Sie angemessen auf Situationen reagieren, in denen der Dienst nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="10765-473">To make your application robust, you must respond appropriately to situations where the service is not available.</span></span> <span data-ttu-id="10765-474">Diese exemplarische Vorgehensweise umfasst Try/Catch-Blöcke zum Abfangen von <xref:System.Net.WebException> und zum Anzeigen einer Fehlermeldung, wenn der Dienst nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="10765-474">This walkthrough includes try/catch blocks to catch a <xref:System.Net.WebException> and display an error message when the service is not available.</span></span> <span data-ttu-id="10765-475">Im Produktionscode empfiehlt es sich, in diesem Fall den Wechsel in den Offline-Modus, das Beenden der Anwendung oder die Verweigerung des Zugriffs auf bestimmte Funktionen zu erwägen.</span><span class="sxs-lookup"><span data-stu-id="10765-475">In production code, you might want to handle this case by switching to offline mode, exiting the application, or denying access to specific functionality.</span></span>  
  
 <span data-ttu-id="10765-476">Zur Erhöhung der Sicherheit Ihrer Anwendung stellen Sie sicher, dass Anwendung und Server vor der Bereitstellung gründlich getestet wurden.</span><span class="sxs-lookup"><span data-stu-id="10765-476">To increase the security of your application, make sure to thoroughly test the application and server before deployment.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="10765-477">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="10765-477">See Also</span></span>  
 <span data-ttu-id="10765-478">[Clientanwendungsdienste](../../../docs/framework/common-client-technologies/client-application-services.md) </span><span class="sxs-lookup"><span data-stu-id="10765-478">[Client Application Services](../../../docs/framework/common-client-technologies/client-application-services.md) </span></span>  
 <span data-ttu-id="10765-479">[Übersicht über Clientanwendungsdienste](../../../docs/framework/common-client-technologies/client-application-services-overview.md) </span><span class="sxs-lookup"><span data-stu-id="10765-479">[Client Application Services Overview](../../../docs/framework/common-client-technologies/client-application-services-overview.md) </span></span>  
 <span data-ttu-id="10765-480">[Vorgehensweise: Konfigurieren von Clientanwendungsdiensten](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md) </span><span class="sxs-lookup"><span data-stu-id="10765-480">[How to: Configure Client Application Services](../../../docs/framework/common-client-technologies/how-to-configure-client-application-services.md) </span></span>  
 <span data-ttu-id="10765-481">[ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec) </span><span class="sxs-lookup"><span data-stu-id="10765-481">[ASP.NET Web Site Administration Tool](http://msdn.microsoft.com/library/100ddd8b-7d11-4df9-91ef-0bbbe92e5aec) </span></span>  
 <span data-ttu-id="10765-482">[Erstellen und Konfigurieren der Datenbank für die Anwendungsdienste für SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2) </span><span class="sxs-lookup"><span data-stu-id="10765-482">[Creating and Configuring the Application Services Database for SQL Server](http://msdn.microsoft.com/library/ab894e83-7e2f-4af8-a116-b1bff8f815b2) </span></span>  
 [<span data-ttu-id="10765-483">Exemplarische Vorgehensweise: Verwenden von ASP.NET-Anwendungsdiensten</span><span class="sxs-lookup"><span data-stu-id="10765-483">Walkthrough: Using ASP.NET Application Services</span></span>](http://msdn.microsoft.com/library/f3f394f0-20d6-4361-aa8f-4b21bf4933eb)

